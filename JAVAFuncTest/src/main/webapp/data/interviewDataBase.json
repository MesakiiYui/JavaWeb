[
  {
    "category": "dataBase",
    "qes": "MyISAM与InnoDB两者之间区别与选择，详细总结，性能对比",
    "ans": "<div id=\"article_content\" class=\"article_content clearfix\">\n        <link rel=\"stylesheet\" href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css\">\n                <div id=\"content_views\" class=\"htmledit_views\">\n                    <p><span style=\"font-size:12px\">1、MyISAM：默认表类型，它是基于传统的ISAM类型，ISAM是Indexed Sequential Access Method (有索引的顺序访问方法) 的缩写，它是存储记录和文件的标准方法。不是事务安全的，而且不支持外键，如果执行大量的select，insert MyISAM比较适合。</span></p> \n<p><span style=\"font-size:12px\">2、InnoDB：支持事务安全的引擎，支持外键、行锁、事务是他的最大特点。如果有大量的update和insert，建议使用InnoDB，特别是针对多个并发和QPS较高的情况。</span></p> \n<p><span style=\"font-size:12px\"><br> </span></p> \n<p><span style=\"font-size:12px\"><strong>一、表锁差异</strong></span></p> \n<p><strong>MyISAM:</strong> </p> \n<p><span style=\"font-size:12px\">myisam只支持表级锁，</span><span style=\"font-size:12px\">用户在操作myisam表时，select，update，delete，insert语句都会给表自动加锁，如果加锁以后的表满足insert并发的情况下，可以在表的尾部插入新的数据。也可以通过lock table命令来锁表，这样操作主要是可以模仿事务，但是消耗非常大，一般只在实验演示中使用。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\"><strong>InnoDB ：</strong></span> </p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">Innodb支持事务和行级锁，是innodb的最大特色。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">事务的ACID属性：atomicity,consistent,isolation,durable。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">并发事务带来的几个问题：更新丢失，脏读，不可重复读，幻读。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">事务隔离级别：未提交读(Read uncommitted)，已提交读(Read committed)，可重复读(Repeatable read)，可序列化(Serializable)</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">四种隔离级别的比较</span></p> \n<span style=\"font-size:12px\"></span> \n<div class=\"table-box\"><table class=\"table table-bordered\" height=\"242\" border=\"1\" cellpadding=\"0\" cellspacing=\"0\" width=\"529\"><tbody><tr><td width=\"177\"> <p><span style=\"font-size:12px\">读数据一致性及并发副作用</span></p> <p><span style=\"font-size:12px\">&nbsp;</span></p> <p><span style=\"font-size:12px\">隔离级别</span></p> </td><td width=\"132\"> <p><span style=\"font-size:12px\">读数据一致性</span></p> </td><td width=\"102\"> <p><span style=\"font-size:12px\">脏读</span></p> </td><td width=\"125\"> <p><span style=\"font-size:12px\">不可重复读</span></p> </td><td width=\"113\"> <p><span style=\"font-size:12px\">幻读</span></p> </td></tr><tr><td width=\"177\"><span style=\"font-size:12px\">为提交读(read uncommitted)</span></td><td width=\"132\"> <p><span style=\"font-size:12px\">最低级别，不读物理上顺坏的数据</span></p> </td><td width=\"102\"> <p><span style=\"font-size:12px\">是</span></p> </td><td width=\"125\"> <p><span style=\"font-size:12px\">是</span></p> </td><td width=\"113\"> <p><span style=\"font-size:12px\">是</span></p> </td></tr><tr><td width=\"177\"><span style=\"font-size:12px\">已提交读(read committed)</span></td><td width=\"132\"> <p><span style=\"font-size:12px\">语句级</span></p> </td><td width=\"102\"> <p><span style=\"font-size:12px\">否</span></p> </td><td width=\"125\"> <p><span style=\"font-size:12px\">是</span></p> </td><td width=\"113\"> <p><span style=\"font-size:12px\">是</span></p> </td></tr><tr><td width=\"177\"><span style=\"font-size:12px\">可重复读(Repeatable red)</span></td><td width=\"132\"> <p><span style=\"font-size:12px\">事务级</span></p> </td><td width=\"102\"> <p><span style=\"font-size:12px\">否</span></p> </td><td width=\"125\"> <p><span style=\"font-size:12px\">否</span></p> </td><td width=\"113\"> <p><span style=\"font-size:12px\">是</span></p> </td></tr><tr><td width=\"177\"><span style=\"font-size:12px\">可序列化(Serializable)</span></td><td width=\"132\"> <p><span style=\"font-size:12px\">最高级别，事务级</span></p> </td><td width=\"102\"> <p><span style=\"font-size:12px\">否</span></p> </td><td width=\"125\"> <p><span style=\"font-size:12px\">否</span></p> </td><td width=\"113\"> <p><span style=\"font-size:12px\">否</span></p> </td></tr></tbody></table></div> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">&nbsp;</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">查看mysql的默认事务隔离级别“show global variables like ‘tx_isolation’; ”</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">Innodb的行锁模式有以下几种：共享锁，排他锁，意向共享锁(表锁)，意向排他锁(表锁)，间隙锁。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">注意：当语句没有使用索引，innodb不能确定操作的行，这个时候就使用的意向锁，也就是表锁</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">关于死锁：</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">什么是死锁？当两个事务都需要获得对方持有的排他锁才能完成事务，这样就导致了循环锁等待，也就是常见的死锁类型。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">解决死锁的方法：</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">1、&nbsp; 数据库参数</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">2、&nbsp; 应用中尽量约定程序读取表的顺序一样</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">3、&nbsp; 应用中处理一个表时，尽量对处理的顺序排序</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">4、&nbsp; 调整事务隔离级别（避免两个事务同时操作一行不存在的数据，容易发生死锁）</span></p> \n<p><span style=\"font-size:12px\"><br> </span></p> \n<span style=\"font-size:12px\"></span>\n<span style=\"font-size:12px\"><strong>二、数据库文件差异</strong></span>\n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\"><strong>MyISAM ：</strong></span> </p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam属于堆表</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam在磁盘存储上有三个文件，每个文件名以表名开头，扩展名指出文件类型。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">.frm 用于存储表的定义</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">.MYD 用于存放数据</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">.MYI 用于存放表索引</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam表还支持三种不同的存储格式：</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">静态表(默认，但是注意数据末尾不能有空格，会被去掉)</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">动态表</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">压缩表</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\"><strong>InnoDB ：</strong></span> </p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb属于索引组织表</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb有两种存储方式，共享表空间存储和多表空间存储</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">两种存储方式的表结构和myisam一样，以表名开头，扩展名是.frm。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">如果使用共享表空间，那么所有表的数据文件和索引文件都保存在一个表空间里，一个表空间可以有多个文件，通过innodb_data_file_path和innodb_data_home_dir参数设置共享表空间的位置和名字，一般共享表空间的名字叫ibdata1-n。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">如果使用多表空间，那么每个表都有一个表空间文件用于存储每个表的数据和索引，文件名以表名开头，以.ibd为扩展名。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><br> </p> \n<p><span style=\"font-size:12px\"><strong>三、索引差异</strong></span> </p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">1、关于自动增长</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam引擎的自动增长列必须是索引，如果是组合索引，自动增长可以不是第一列，他可以根据前面几列进行排序后递增。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb引擎的自动增长咧必须是索引，如果是组合索引也必须是组合索引的第一列。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">2、关于主键</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam允许没有任何索引和主键的表存在，</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam的索引都是保存行的地址。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb引擎如果没有设定主键或者非空唯一索引，就会自动生成一个6字节的主键(用户不可见)</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb的数据是主索引的一部分，附加索引保存的是主索引的值。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">3、关于count()函数</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam保存有表的总行数，如果select count(*) from table;会直接取出出该值</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb没有保存表的总行数，如果使用select count(*) from table；就会遍历整个表，消耗相当大，但是在加了wehre&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 条件后，myisam和innodb处理的方式都一样。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">4、全文索引</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam支持 FULLTEXT类型的全文索引</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb不支持FULLTEXT类型的全文索引，但是innodb可以使用sphinx插件支持全文索引，并且效果更好。（sphinx&nbsp;&nbsp; 是一个开源软件，提供多种语言的API接口，可以优化mysql的各种查询）</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">5、delete from table</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">使用这条命令时，innodb不会从新建立表，而是一条一条的删除数据，在innodb上如果要清空保存有大量数据的表，最&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 好不要使用这个命令。(推荐使用truncate table，不过需要用户有drop此表的权限)</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">6、索引保存位置</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">myisam的索引以表名+.MYI文件分别保存。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">innodb的索引和数据一起保存在表空间里。</span></p> \n<p><span style=\"font-size:12px\"><br> </span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\"><strong>四、开发的注意事项</strong></span> </p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">1、可以用 show create table tablename 命令看表的引擎类型。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">2、对不支持事务的表做start/commit操作没有任何效果，在执行commit前已经提交。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">3、可以执行以下命令来切换非事务表到事务（数据不会丢失），innodb表比myisam表更安全：alter table tablename type=innodb;或者使用 alter table tablename engine = innodb;</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">4、默认innodb是开启自动提交的，如果你按照myisam的使用方法来编写代码页不会存在错误，只是性能会很低。如何在编写代码时候提高数据库性能呢？</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">a、尽量将多个语句绑到一个事务中，进行提交，避免多次提交导致的数据库开销。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">b、在一个事务获得排他锁或者意向排他锁以后，如果后面还有需要处理的sql语句，在这两条或者多条sql语句之间程序应尽量少的进行逻辑运算和处理，减少锁的时间。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">c、尽量避免死锁</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">d、sql语句如果有where子句一定要使用索引，尽量避免获取意向排他锁。</span></p> \n<span style=\"font-size:12px\"></span> \n<p><span style=\"font-size:12px\">f、针对我们自己的数据库环境，日志系统是直插入，不修改的，所以我们使用混合引擎方式，ZION_LOG_DB照旧使用myisam存储引擎，只有ZION_GAME_DB，ZION_LOGIN_DB，DAUM_BILLING使用Innodb引擎。</span></p> \n<p><span style=\"font-size:12px\"><br> </span></p> \n<p><span style=\"font-size:12px\"><strong>五、究竟该怎么选择</strong><br> </span></p> \n<p><span style=\"font-size:12px\">下面先让我们回答一些问题：&nbsp;&nbsp; <br> </span></p> \n<p><span style=\"font-size:12px\">◆你的数据库有外键吗？&nbsp;&nbsp; <br> </span></p> \n<p><span style=\"font-size:12px\">◆你需要事务支持吗？&nbsp;&nbsp; <br> </span></p> \n<p><span style=\"font-size:12px\">◆你需要全文索引吗？&nbsp;&nbsp; <br> </span></p> \n<p><span style=\"font-size:12px\">◆你经常使用什么样的查询模式？&nbsp;&nbsp; <br> </span></p> \n<p><span style=\"font-size:12px\">◆你的数据有多大？&nbsp;&nbsp; <br> &nbsp; <br> myisam只有索引缓存&nbsp;&nbsp; <br> innodb不分索引文件数据文件 innodb buffer&nbsp;&nbsp; <br> myisam只能管理索引，在索引数据大于分配的资源时，会由操作系统来cache；数据文件依赖于操作系统的cache。innodb不管是索引还是数据，都是自己来管理&nbsp;&nbsp;<br> &nbsp; <br> 思考上面这些问题可以让你找到合适的方向，但那并不是绝对的。如果你需要事务处理或是外键，那么InnoDB 可能是比较好的方式。如果你需要全文索引，那么通常来说 MyISAM是好的选择，因为这是系统内建的，然而，我们其实并不会经常地去测试两百万行记录。所以，就算是慢一点，我们可以通过使用Sphinx从InnoDB中获得全文索引。&nbsp;&nbsp;<br> &nbsp; <br> 数据的大小，是一个影响你选择什么样存储引擎的重要因素，大尺寸的数据集趋向于选择InnoDB方式，因为其支持事务处理和故障恢复。数据库的在小决定了故障恢复的时间长短，InnoDB可以利用事务日志进行数据恢复，这会比较快。而MyISAM可能会需要几个小时甚至几天来干这些事，InnoDB只需要几分钟。&nbsp;&nbsp;<br> &nbsp; <br> 操作数据库表的习惯可能也会是一个对性能影响很大的因素。比如： COUNT() 在 MyISAM 表中会非常快，而在InnoDB 表下可能会很痛苦。而主键查询则在InnoDB下会相当相当的快，但需要小心的是如果我们的主键太长了也会导致性能问题。大批的inserts 语句在 MyISAM下会快一些，但是updates 在InnoDB下会更快一些——尤其在并发量大的时候。&nbsp;&nbsp;<br> &nbsp; <br> 所以，到底你检使用哪一个呢？根据经验来看，如果是一些小型的应用或项目，那么MyISAM 也许会更适合。当然，在大型的环境下使用 MyISAM 也会有很大成功的时候，但却不总是这样的。如果你正在计划使用一个超大数据量的项目，而且需要事务处理或外键支持，那么你真的应该直接使用 InnoDB方式。但需要记住InnoDB 的表需要更多的内存和存储，转换100GB 的MyISAM 表到InnoDB 表可能会让你有非常坏的体验。&nbsp;&nbsp;<br> &nbsp; <br> 对于支持事务的InnoDB类型的表，影响速度的主要原因是AUTOCOMMIT默认设置是打开的，而且程序没有显式调用BEGIN 开始事务，导致每插入一条都自动Commit，严重影响了速度。可以在执行sql前调用begin，多条sql形成一个事务（即使autocommit打开也可以），将大大提高性能。&nbsp;&nbsp;<br> </span></p> \n<p><br> </p> \n<p><span style=\"font-size:12px\"><span style=\"font-size:12px\">InnoDB</span></span></p> \n<p><span style=\"font-size:12px\">InnoDB 给 MySQL 提供了具有事务(commit)、回滚(rollback)和崩溃修复能力 (crash recovery capabilities)的事务安全(transaction-safe (ACID compliant))型表。 InnoDB 提供了行锁(locking on row level)，提供与 Oracle 类型一致的不加锁读取(non- locking read in SELECTs)。这些特性均提高了多用户并发操作的性能表现。在InnoDB表中不需要扩大锁定 (lock escalation)，因为 InnoDB 的列锁定(row level locks)适宜非常小的空间。 InnoDB 是 MySQL 上第一个提供外键约束(FOREIGN KEY constraints)的表引擎。&nbsp;&nbsp;<br> <br> InnoDB 的设计目标是处理大容量数据库系统，它的 CPU 利用率是其它基于磁盘的关系数据库引擎所不能比的。在技术上，InnoDB 是一套放在 MySQL 后台的完整数据库系统，InnoDB 在主内存中建立其专用的缓冲池用于高速缓冲数据和索引。 InnoDB 把数据和索引存放在表空间里，可能包含多个文件，这与其它的不一样，举例来说，在 MyISAM 中，表被存放在单独的文件中。InnoDB 表的大小只受限于操作系统的文件大小，一般为 2 GB。&nbsp;&nbsp;<br> InnoDB所有的表都保存在同一个数据文件 ibdata1 中（也可能是多个文件，或者是独立的表空间文件）,相对来说比较不好备份，免费的方案可以是拷贝数据文件、备份 binlog，或者用 mysqldump。&nbsp;&nbsp;<br> </span></p> \n<p><span style=\"font-size:12px\"><br> MyISAM&nbsp;&nbsp; <br> MyISAM 是MySQL缺省存贮引擎 .&nbsp;&nbsp; <br> 每张MyISAM 表被存放在三个文件 。frm 文件存放表格定义。 数据文件是MYD (MYData) 。 索引文件是 MYI (MYIndex) 引伸。&nbsp;&nbsp; <br> 因为MyISAM相对简单所以在效率上要优于InnoDB..小型应用使用MyISAM是不错的选择.&nbsp;&nbsp; <br> MyISAM表是保存成文件的形式,在跨平台的数据转移中使用MyISAM存储会省去不少的麻烦&nbsp;&nbsp; <br> &nbsp; <br> 以下是一些细节和具体实现的差别：&nbsp;&nbsp; <br> &nbsp; <br> 1.InnoDB不支持FULLTEXT类型的索引。&nbsp;&nbsp; <br> 2.InnoDB 中不保存表的具体行数，也就是说，执行select count(*) from table时，InnoDB要扫描一遍整个表来计算有多少行，但是MyISAM只要简单的读出保存好的行数即可。注意的是，当count(*)语句包含 where条件时，两种表的操作是一样的。&nbsp;&nbsp;<br> 3.对于AUTO_INCREMENT类型的字段，InnoDB中必须包含只有该字段的索引，但是在MyISAM表中，可以和其他字段一起建立联合索引。&nbsp;&nbsp; <br> 4.DELETE FROM table时，InnoDB不会重新建立表，而是一行一行的删除。&nbsp;&nbsp; <br> 5.LOAD TABLE FROM MASTER操作对InnoDB是不起作用的，解决方法是首先把InnoDB表改成MyISAM表，导入数据后再改成InnoDB表，但是对于使用的额外的InnoDB特性（例如外键）的表不适用。&nbsp;&nbsp;<br> <br> 另外，InnoDB表的行锁也不是绝对的，如果在执行一个SQL语句时MySQL不能确定要扫描的范围，InnoDB表同样会锁全表，例如 update table set num=1 where name like “%aaa%”&nbsp;&nbsp;<br> <br> 任何一种表都不是万能的，只用恰当的针对业务类型来选择合适的表类型，才能最大的发挥MySQL的性能优势。&nbsp;&nbsp; <br> </span></p> \n<p><br> </p> \n<p><span style=\"font-size:12px\"><strong>六、重复地总结一遍</strong></span><br> </p> \n<p></p> \n<p><span style=\"font-size:12px\">1、MyISAM不支持事务，InnoDB是事务类型的存储引擎，当我们的表需要用到事务支持的时候，那肯定是不能选择MyISAM了。</span></p> \n<p><span style=\"font-size:12px\">2、MyISAM只支持表级锁，BDB支持页级锁和表级锁默认为页级锁，而InnoDB支持行级锁和表级锁默认为行级锁<br> &nbsp;<br> 表级锁：直接锁定整张表，在锁定期间，其他进程无法对该表进行写操作，如果设置的是写锁，那么其他进程读也不允许<br> &nbsp;<br> MyISAM是表级锁定的存储引擎，它不会出现死锁问题<br> &nbsp;<br> 对于write，表锁定原理如下：<br> &nbsp;<br> 如果表上没有锁，在其上面放置一个写锁，否则，把锁定请求放在写锁队列中。<br> &nbsp;<br> 对于read，表锁定原理如下 ：<br> &nbsp;<br> 如果表上没有写锁定，那么把一个读锁放在其上面，否则把锁请求放在读锁定队列中<br> &nbsp;<br> 当一个锁定被释放时，表可被写锁定队列中的线程得到，然后才是读锁定队列中的线程。这意味着，如果你在一个表上有许多更新，那么你的SELECT语句将等到所有的写锁定线程执行完。</span></p> \n<p><span style=\"font-size:12px\">行级锁：只对指定的行进行锁定，其他进程还是可以对表中的其他行进行操作的。<br> &nbsp;<br> 行级锁是Mysql粒度最小的一种锁，它能大大的减少数据库操作的冲突，但是粒度越小实现成本也越大。<br> &nbsp;<br> 行级锁可能会导致“死锁”，那到底是怎么导致的呢，分析原因：Mysql行级锁并不是直接锁记录，而是锁索引。索引分为主键索引和非主键索引两种，如果一条sql语句操作了主键索引，那么Mysql就会锁定这个主键索引，如果sql语句操作的是非主键索引，那么Mysql会先锁定这个非主键索引，再去锁定主键索引。<br> &nbsp;<br> 在UPDATE 和 DELETE操作时Mysql不仅会锁定所有WHERE 条件扫描过得索引，还会锁定相邻的键值。<br> &nbsp;<br> “死锁”举例分析：<br> &nbsp;<br> 表Test：（ID,STATE,TIME）&nbsp; 主键索引：ID&nbsp; 非主键索引：STATE<br> &nbsp;<br> 当执行\"UPDATE&nbsp; STATE =1011 WHERE STATE=1000\"&nbsp; 语句的时候会锁定STATE索引，由于STATE 是非主键索引,所以Mysql还会去请求锁定ID索引<br> &nbsp;<br> 当另一个SQL语句与语句1几乎同时执行时：“UPDATE STATE=1010 WHERE ID=1”&nbsp; 对于语句2 Mysql会先锁定ID索引，由于语句2操作了STATE字段，所以Mysql还会请求锁定STATE索引。这时。彼此锁定着对方需要的索引，又都在等待对方释放锁定。所以出现了\"死锁\"的情况。<br> &nbsp;<br> 行级锁的优点：<br> &nbsp;<br> 有许多线程访问不同的行时，只存在少量的冲突。<br> &nbsp;<br> 回滚时只有少量的更改<br> &nbsp;<br> 可以长时间锁定单一的行<br> &nbsp;<br> 行级锁缺点：<br> &nbsp;<br> 相对于页级锁和表级锁来说占用了更多的内存<br> &nbsp;<br> 当表的大部分行在使用时，比页级锁和表级锁慢，因为你必须获得更多的锁<br> &nbsp;<br> 当在大部分数据上经常使用GROUP BY操作，肯定会比表级锁和页级锁慢。<br> &nbsp;<br> 页级锁：表级锁速度快，但是冲突多；行级锁速度慢，但冲突少；页级锁就是他俩折中的，一次锁定相邻的一组记录。</span></p> \n<p><span style=\"font-size:12px\">3、MyISAM引擎不支持外键，InnoDB支持外键</span></p> \n<p><span style=\"font-size:12px\">4、MyISAM引擎的表在大量高并发的读写下会经常出现表损坏的情况<br> &nbsp;<br> 我们以前做的项目就遇到这个问题，表的INSERT 和 UPDATE操作很频繁，原来用的MyISAM引擎，导致表隔三差五就损坏，后来更换成了InnoDB引擎。<br> &nbsp;<br> 其他容易导致表损坏原因：<br> &nbsp;<br> 服务器突然断电导致数据文件损坏，强制关机（mysqld未关闭情况下）导致表损坏<br> &nbsp;<br> mysqld进程在写入操作的时候被杀掉<br> &nbsp;<br> 磁盘故障<br> &nbsp;<br> 表损坏常见症状：<br> &nbsp;<br> 查询表不能返回数据或返回部分数据<br> &nbsp;<br> 打开表失败： Can’t open file: ‘×××.MYI’ (errno: 145) 。<br> &nbsp;<br> Error: Table 'p' is marked as crashed and should be repaired 。</span></p> \n<p><span style=\"font-size:12px\">Incorrect key file for table: '...'. Try to repair it<br> &nbsp;<br> Mysql表的恢复：</span></p> \n<p><span style=\"font-size:12px\">对于MyISAM表的恢复：</span></p> \n<p><span style=\"font-size:12px\">可以使用Mysql自带的myisamchk工具： myisamchk -r tablename&nbsp; 或者 myisamchk -o tablename（比前面的更保险） 对表进行修复</span></p> \n<p><span style=\"font-size:12px\">5、对于count()查询来说MyISAM更有优势</span></p> \n<p><span style=\"font-size:12px\">因为MyISAM存储了表中的行数记录，执行SELECT COUNT() 的时候可以直接获取到结果，而InnoDB需要扫描全部数据后得到结果。</span></p> \n<p><span style=\"font-size:12px\">但是注意一点：对于带有WHERE 条件的 SELECT COUNT()语句两种引擎的表执行过程是一样的，都需要扫描全部数据后得到结果</span></p> \n<p><span style=\"font-size:12px\">6、 InnoDB是为处理巨大数据量时的最大性能设计，它的CPU效率可能是任何其它基于磁盘的关系数据库引擎所不能匹敌的。</span></p> \n<p><span style=\"font-size:12px\">7、MyISAM支持全文索引（FULLTEXT），InnoDB不支持</span></p> \n<p><span style=\"font-size:12px\">8、MyISAM引擎的表的查询、更新、插入的效率要比InnoDB高</span></p> \n<p><span style=\"font-size:12px\">网上截取了前辈们测试结论： <br> </span></p> \n<p><span style=\"font-size:12px\">测试方法：连续提交10个query， 表记录总数：38万 ， 时间单位 s<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 引擎类型&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyISAM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InnoDB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 性能相差<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; count&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.0008357&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.0163&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3609<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 查询主键&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.005708&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.1574&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 27.57<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 查询非主键&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24.01&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80.37&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.348<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 更新主键&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.008124&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.8183&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100.7<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 更新非主键&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.004141&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.02625&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6.338<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 插入&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.004188&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.3694&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 88.21<br> &nbsp;</span></p> \n<p><span style=\"font-size:12px\">&nbsp; &nbsp; （1）加了索引以后，对于MyISAM查询可以加快：4 206.09733倍，对InnoDB查询加快510.72921倍，同时对MyISAM更新速度减慢为原来的1/2，InnoDB的更<br> &nbsp; 新速度减慢为原来的1/30。要看情况决定是否要加索引，比如不查询的log表，不要做任何的索引。<br> &nbsp;<br> &nbsp; &nbsp; （2）如果你的数据量是百万级别的，并且没有任何的事务处理，那么用MyISAM是性能最好的选择。<br> &nbsp;<br> &nbsp; &nbsp; （3）InnoDB表的大小更加的大，用MyISAM可省很多的硬盘空间。<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; 在我们测试的这个38w的表中，表占用空间的情况如下：<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 引擎类型&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyISAM&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InnoDB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 数据&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 53,924 KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 58,976 KB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 索引&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 13,640 KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 21,072 KB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 占用总空间&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 67,564 KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 80,048 KB<br> &nbsp; <br> &nbsp; &nbsp; &nbsp; &nbsp; 另外一个176W万记录的表， 表占用空间的情况如下：<br> &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 引擎类型&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyIsam&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InnorDB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 数据&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 56,166 KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 90,736 KB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 索引&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 67,103 KB&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 88,848 KB<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 占用总空间&nbsp; &nbsp; &nbsp; &nbsp; 123,269 KB&nbsp; &nbsp; &nbsp; &nbsp; 179,584 KB</span></p> \n<p><br> </p> \n<p><span style=\"font-size:12px\">七、性能对比</span></p> \n<p><span style=\"font-size:12px\"></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">测试的版本是mysql &nbsp;Ver 14.14 Distrib 5.1.49, for debian-linux-gnu (i686)，使用的是Innodb plugin 1.0.8（官方称比built-in版本性能更好）和默认的MyISAM<span style=\"font-family:'Courier New'\">。</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">测试机器是笔记本，配置如下：<span style=\"\">Intel 酷睿2双核 P8600，2G*2 DDR3 1066内存，320G硬盘5400转。</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">测试一：数据插入性能测试，这里我分别对innodb_flush_log_at_trx_commit参数打开和关闭都测了了一下，每次测试都是运行40s，表中数字都是实际插入条数。</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><br style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"> </span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"white-space:pre\"></span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MyISAM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">Innodb (打开) &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">Innodb (关闭)</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">单线程，逐个插入 &nbsp; &nbsp; &nbsp; &nbsp; 120000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">60000 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;60000</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">4线程，逐个插入 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">40000*4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">20000*4 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;40000*4</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">单线程，批量100条/次插入 &nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">3600*100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>800*100 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>3000*100</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"font-family:'Courier New'\">单线程，批量200条/次插入 &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>1800*200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>400*200 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1600*200</span></span><span style=\"font-family:'Courier New'\"><br> </span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">可以发现批量插入的性能远高于单条插入，但是一次批量的大小对性能影响不大。每条记录是否都刷新日志的参数对innodb性能的影响巨大。总体上来说，MyISAM性能更优一点。这里有一点需要注意，在插入测试过程中，我对系统资源进行了监控，发现MyISAM对系统资源占用很低，但是Innodb对磁盘占用却很高，应该是对事务控制多了很多需要记录的日志。</span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"font-family:'Courier New'\">测试二：数据读取性能测试。每次随机读取1000条记录，反复进行读取。</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MyISAM &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">Innodb</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">单线程，200次读取 &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>5.7s &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">16.7s</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">4线程，200次读取 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>12s &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">40.8s</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">可以看出MyISAM的读取性能非常恐怖，性能差距在3倍的样子。</span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">以上两个测试发现MyISAM在无事务的需求下几乎完胜，但是要知道它是表锁，Innodb是行锁，那么在并发读写同时存在的情况下，那结果会是怎么样呢？！</span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"font-family:'Courier New'\">测试三：两个线程并发写入，2个线程并发读取。</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MyISAM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">Innodb</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">逐个插入 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span>写入40s：10000*2 读取200次*2：14s &nbsp; &nbsp; &nbsp; &nbsp;<span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; white-space:pre\"></span></span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">写入40s：60000*2 读取200次*2：50s</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\"><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">批量100条/次插入 &nbsp; &nbsp; &nbsp; &nbsp;写入40s：1000*100*2 读取200次*2：10s &nbsp; &nbsp; &nbsp;</span><span style=\"padding-top:0px; padding-right:0px; padding-bottom:0px; padding-left:0px; margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px\">写入40s：1500*100*2 读取200次*2：50s</span></span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">这下立刻显示出Innodb在并发情况下强劲的性能，几乎没有什么性能衰减。而MyISAM单条插入速度变得非常慢，批量插入也下降了40%性能。</span></p> \n<p style=\"padding-top:0px; padding-bottom:15px; margin-top:0px; margin-bottom:0px; font-size:14px; line-height:28px\"> <span style=\"font-family:'Courier New'\">总结一下，在写多读少的应用中还是Innodb插入性能更稳定，在并发情况下也能基本，如果是对读取速度要求比较快的应用还是选MyISAM。</span></p> \n<br> \n<br>\n                </div><div><div></div></div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "快速理解脏读、不可重复读、幻读",
    "ans": "<div id=\"article_content\" class=\"article_content clearfix\">\n        <link rel=\"stylesheet\" href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css\">\n                <div id=\"content_views\" class=\"htmledit_views\">\n                    <h1><a name=\"t0\"></a><a name=\"t0\"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;快速理解脏读、不可重复读、幻读？</h1> \n<p>&nbsp;</p> \n<h3><a name=\"t1\"></a><a name=\"t1\"></a>理解这三种由于并发访问导致的数据读取问题，再理解事务隔离级别就简单多了。</h3> \n<p>&nbsp;</p> \n<h3><a name=\"t2\"></a><a name=\"t2\"></a>【1】脏读（<span style=\"color:#f33b45;\">读取未提交数据</span>）</h3> \n<p style=\"text-indent:33px;\">A事务读取B事务尚未提交的数据，此时如果B事务发生错误并执行回滚操作，那么A事务读取到的数据就是脏数据。就好像原本的数据比较干净、纯粹，此时由于B事务更改了它，这个数据变得不再纯粹。这个时候A事务立即读取了这个脏数据，但事务B良心发现，又用回滚把数据恢复成原来干净、纯粹的样子，而事务A却什么都不知道，最终结果就是事务A读取了此次的脏数据，称为脏读。</p> \n<p>这种情况常发生于转账与取款操作中</p> \n<div class=\"table-box\"><table cellspacing=\"0\" style=\"width:421.55pt;\"><tbody><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\">时间顺序</p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\">转账事务</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">取款事务</p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">1</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">2</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">3</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">查询账户余额为2000元</span></p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">4</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">取款1000元，余额被更改为1000元</span></p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">5</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">查询账户余额为1000元（产生脏读）</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">6</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">取款操作发生未知错误，事务回滚，余额变更为2000元</span></p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">7</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">转入2000元，余额被更改为3000元（脏读的1000+2000）</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">8</span></p> </td><td style=\"width:166.55pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">提交事务</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:85.2pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">备注</span></p> </td><td colspan=\"2\" style=\"width:336.35pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">按照正确逻辑，此时账户余额应该为4000元</span></p> </td></tr></tbody></table></div>\n<p>&nbsp;</p> \n<p>&nbsp;</p> \n<h3><a name=\"t3\"></a><a name=\"t3\"></a>【2】不可重复读（<span style=\"color:#f33b45;\">前后多次读取，数据内容不一致</span>）</h3> \n<p style=\"text-indent:33px;\">事务A在执行读取操作，由整个事务A比较大，前后读取同一条数据需要经历很长的时间 。而在事务A第一次读取数据，比如此时读取了小明的年龄为20岁，事务B执行更改操作，将小明的年龄更改为30岁，此时事务A第二次读取到小明的年龄时，发现其年龄是30岁，和之前的数据不一样了，也就是数据不重复了，系统不可以读取到重复的数据，成为不可重复读。</p> \n<div class=\"table-box\"><table cellspacing=\"0\" style=\"width:421.55pt;\"><tbody><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\">时间顺序</p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">事务A</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">事务B</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">1</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">2</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">第一次查询，小明的年龄为20岁</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">3</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">4</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">其他操作</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">5</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">更改小明的年龄为30岁</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">6</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">提交事务</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">7</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">第二次查询，小明的年龄为30岁</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">备注</span></p> </td><td colspan=\"2\" style=\"width:345.6pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">按照正确逻辑，事务A前后两次读取到的数据应该一致</span></p> </td></tr></tbody></table></div>\n<p>&nbsp;</p> \n<p>&nbsp;</p> \n<h3><a name=\"t4\"></a><a name=\"t4\"></a>【3】幻读（<span style=\"color:#f33b45;\">前后多次读取，数据总量不一致</span>）</h3> \n<p style=\"text-indent:33px;\">事务A在执行读取操作，需要两次统计数据的总量，前一次查询数据总量后，此时事务B执行了新增数据的操作并提交后，这个时候事务A读取的数据总量和之前统计的不一样，就像产生了幻觉一样，平白无故的多了几条数据，成为幻读。</p> \n<div class=\"table-box\"><table cellspacing=\"0\" style=\"width:421.55pt;\"><tbody><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\">时间顺序</p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">事务A</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">事务B</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">1</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">2</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">第一次查询，数据总量为100条</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">3</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">开始事务</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">4</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">其他操作</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">5</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">新增100条数据</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">6</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">提交事务</span></p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">7</span></p> </td><td style=\"width:175.8pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">第二次查询，数据总量为200条</span></p> </td><td style=\"width:169.8pt;\"> <p style=\"margin-left:0pt;\">&nbsp;</p> </td></tr><tr><td style=\"width:75.95pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">备注</span></p> </td><td colspan=\"2\" style=\"width:345.6pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">按照正确逻辑，事务A前后两次读取到的数据总量应该一致</span></p> </td></tr></tbody></table></div>\n<hr>\n<p>趁热打铁，既然理解了脏读、不可重复读、幻读，那么接下来看看事务隔离级别是怎么个回事<a href=\"https://blog.csdn.net/qq_33591903/article/details/82079302?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522158632818519726869014448%2522%252C%2522scm%2522%253A%252220140713.130056874..%2522%257D&amp;request_id=158632818519726869014448&amp;biz_id=0&amp;utm_source=distribute.pc_search_result.none-task-blog-blog_SOOPENSEARCH-1\">【数据库】事务隔离级别</a></p> \n<h3><a name=\"t5\"></a><a name=\"t5\"></a><strong><strong><span style=\"color:#ffffff;\"><strong>不可</strong></span></strong></strong></h3> \n<p style=\"margin-left:0pt;\">&nbsp;</p>\n                </div><div><div></div></div><div><div></div></div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "四种事务隔离级别",
    "ans": "<div id=\"article_content\" class=\"article_content clearfix\">\n        <link rel=\"stylesheet\" href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css\">\n                <div id=\"content_views\" class=\"htmledit_views\">\n                    <h1><a name=\"t0\"></a><a name=\"t0\"></a>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 事务隔离级别</h1> \n<p style=\"text-indent:33px;\"><strong>为了更好地说明事务隔离级别，请先移步<a href=\"https://blog.csdn.net/qq_33591903/article/details/81672260\">快速理解脏读、不可重复读、幻读</a></strong></p> \n<p style=\"text-indent:33px;\"><strong>有四种隔离级别，分别是读未提交（Read uncommitted），读已提交（Read committed），可重复读（Repeatable read），可串行化（Serializable），用来解决数据库操作中产生的各种问题。</strong></p> \n<hr>\n<h3><a name=\"t1\"></a><a name=\"t1\"></a>一、读未提交（Read uncommitted）</h3> \n<p style=\"text-indent:50px;\">在这种隔离级别下，所有事务能够读取其他事务未提交的数据。读取其他事务未提交的数据，会造成脏读。因此在该种隔离级别下，不能解决脏读、不可重复读和幻读。</p> \n<hr>\n<p style=\"text-indent:50px;\">读未提交可能会产生脏读的现象，那么怎么解决脏读呢？那就是使用读已提交。</p> \n<hr>\n<h3 style=\"text-indent:0px;\"><a name=\"t2\"></a><a name=\"t2\"></a><strong>二、读已提交（Read committed）</strong></h3> \n<p style=\"text-indent:50px;\">在这种隔离级别下，所有事务只能读取其他事务已经提交的内容。能够彻底解决脏读的现象。但在这种隔离级别下，会出现一个事务的前后多次的查询中却返回了不同内容的数据的现象，也就是出现了不可重复读。</p> \n<p style=\"text-indent:50px;\">注意【1】这是大多数数据库系统默认的隔离级别，例如Oracle和SQL Server，但mysql不是。</p> \n<hr>\n<p style=\"text-indent:50px;\">已提交可能会产生不可重复读的现象，我们可以使用可重复读。</p> \n<hr>\n<h3><a name=\"t3\"></a><a name=\"t3\"></a>三、可重复读（Repeatable read）</h3> \n<p style=\"text-indent:50px;\">在这种隔离级别下，所有事务前后多次的读取到的数据内容是不变的。也就是某个事务在执行的过程中，不允许其他事务进行update操作，但允许其他事务进行add操作，造成某个事务前后多次读取到的数据总量不一致的现象，从而产生幻读。</p> \n<p style=\"text-indent:50px;\">注意【1】这才是mysql的默认事务隔离级别</p> \n<hr>\n<p style=\"text-indent:50px;\">可重复读依然会产生幻读的现象，此时我们可以使用串行化来解决。</p> \n<hr>\n<h3><a name=\"t4\"></a><a name=\"t4\"></a>四、可串行化（Serializable）</h3> \n<p style=\"text-indent:50px;\">在这种隔离级别下，所有的事务顺序执行，所以他们之间不存在冲突，从而能有效地解决脏读、不可重复读和幻读的现象。但是安全和效率不能兼得，这样事务隔离级别，会导致大量的操作超时和锁竞争，从而大大降低数据库的性能，一般不使用这样事务隔离级别。</p> \n<hr>\n<h3><a name=\"t5\"></a><a name=\"t5\"></a>下面用一张表格来表示他们能够解决的问题</h3> \n<div class=\"table-box\"><table border=\"1\" cellspacing=\"0\" style=\"width:426.1pt;\"><tbody><tr><td style=\"width:219.9pt;\"> <p style=\"margin-left:0pt;\"><strong>隔离级别</strong></p> </td><td style=\"width:70.35pt;\"> <p style=\"margin-left:0pt;\"><strong>脏读</strong></p> </td><td style=\"width:83.45pt;\"> <p style=\"margin-left:0pt;\"><strong>不可重复读</strong></p> </td><td style=\"width:52.4pt;\"> <p style=\"margin-left:0pt;\"><strong>幻读</strong></p> </td></tr><tr><td style=\"width:219.9pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">读未提交（Read uncommitted）</span></p> </td><td style=\"width:70.35pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span><span style=\"color:#000000;\">(未解决)</span></p> </td><td style=\"width:83.45pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span></p> </td><td style=\"width:52.4pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span></p> </td></tr><tr><td style=\"width:219.9pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">读已提交（Read committed）</span></p> </td><td style=\"width:70.35pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span><span style=\"color:#000000;\">(解决)</span></p> </td><td style=\"width:83.45pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span></p> </td><td style=\"width:52.4pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span></p> </td></tr><tr><td style=\"width:219.9pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">可重复读（Repeatable read）</span></p> </td><td style=\"width:70.35pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span></p> </td><td style=\"width:83.45pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span></p> </td><td style=\"width:52.4pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">×</span></p> </td></tr><tr><td style=\"width:219.9pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">可串行化（Serializable）</span></p> </td><td style=\"width:70.35pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span></p> </td><td style=\"width:83.45pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span></p> </td><td style=\"width:52.4pt;\"> <p style=\"margin-left:0pt;\"><span style=\"color:#000000;\">√</span></p> </td></tr></tbody></table></div>\n<p style=\"text-indent:33px;\">当然，以上的内容是一种规范，不同的数据库厂商可以有不同的实现。例如在mysql的可重复读的级别上，使用间隙锁的方式就已经解决了幻读的问题。详细的加锁处理过程可以参考这篇文章<a href=\"https://blog.csdn.net/qq_33591903/article/details/105365777\">【数据库】MySQL 加锁处理分析</a></p>\n                </div><div data-report-view=\"{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;dest&quot;:&quot;https://blog.csdn.net/qq_33591903/article/details/82079302&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}\"><div></div></div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "MySQL 加锁处理分析",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body\">\n    <p>本文来自：<a href=\"http://hedengcheng.com/?p=771\">何登成的技术博客</a></p>\n<p>&nbsp;</p>\n<h1>一、背景</h1>\n<p>MySQL/InnoDB的加锁分析，一直是一个比较困难的话题。我在工作过程中，经常会有同事咨询这方面的问题。同时，微博上也经常会收到MySQL锁相关的私信，让我帮助解决一些死锁的问题。本文，准备就MySQL/InnoDB的加锁问题，展开较为深入的分析与讨论，主要是介绍一种思路，运用此思路，拿到任何一条SQL语句，都能完整的分析出这条语句会加什么锁？会有什么样的使用风险？甚至是分析线上的一个死锁场景，了解死锁产生的原因。<br><span id=\"more-2127\"></span></p>\n<p><strong>注：</strong>MySQL是一个支持插件式存储引擎的数据库系统。本文下面的所有介绍，都是基于InnoDB存储引擎，其他引擎的表现，会有较大的区别。</p>\n<h3><strong>1.1 &nbsp;MVCC：Snapshot Read vs Current Read</strong></h3>\n<p>MySQL InnoDB存储引擎，实现的是基于多版本的并发控制协议——MVCC (<a href=\"http://en.wikipedia.org/wiki/Multiversion_concurrency_control\" target=\"_blank\">Multi-Version Concurrency Control</a>) (注：与MVCC相对的，是基于锁的并发控制，Lock-Based Concurrency Control)。MVCC最大的好处，相信也是耳熟能详：读不加锁，读写不冲突。在读多写少的OLTP应用中，读写不冲突是非常重要的，极大的增加了系统的并发性能，这也是为什么现阶段，几乎所有的RDBMS，都支持了MVCC。</p>\n<p>&nbsp;</p>\n<p>在MVCC并发控制中，读操作可以分成两类：快照读 (snapshot read)与当前读 (current read)。快照读，读取的是记录的可见版本 (有可能是历史版本)，不用加锁。当前读，读取的是记录的最新版本，并且，当前读返回的记录，都会加上锁，保证其他事务不会再并发修改这条记录。</p>\n<p>&nbsp;</p>\n<p>在一个支持MVCC并发控制的系统中，哪些读操作是快照读？哪些操作又是当前读呢？以MySQL InnoDB为例：</p>\n<p>&nbsp;</p>\n<ul>\n<li>\n<div><strong>快照读：</strong>简单的select操作，属于快照读，不加锁。(当然，也有例外，下面会分析)</div>\n<ul>\n<li>select * from table where ?;</li>\n\n</ul>\n<p>&nbsp;</p>\n\n</li>\n<li>\n<div><strong>当前读：</strong>特殊的读操作，插入/更新/删除操作，属于当前读，需要加锁。</div>\n<ul>\n<li>select * from table where ? lock in share mode;</li>\n<li>select * from table where ? for update;</li>\n<li>insert into table values (…);</li>\n<li>update table set ? where ?;</li>\n<li>delete from table where ?;</li>\n\n</ul>\n<p>所有以上的语句，都属于当前读，读取记录的最新版本。并且，读取之后，还需要保证其他并发事务不能修改当前记录，对读取记录加锁。其中，除了第一条语句，对读取记录加S锁 (共享锁)外，其他的操作，都加的是X锁 (排它锁)。</p>\n<p>&nbsp;</p>\n\n</li>\n\n</ul>\n<p>为什么将 插入/更新/删除 操作，都归为当前读？可以看看下面这个 更新 操作，在数据库中的执行流程：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish.jpg\"><img class=\"alignnone size-full wp-image-2128\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish.jpg\" alt=\"medish\" width=\"640\" height=\"524\"></a></p>\n<p>&nbsp;</p>\n<p>从图中，可以看到，一个Update操作的具体流程。当Update SQL被发给MySQL后，MySQL Server会根据where条件，读取第一条满足条件的记录，然后InnoDB引擎会将第一条记录返回，并加锁 (current read)。待MySQL Server收到这条加锁的记录之后，会再发起一个Update请求，更新这条记录。一条记录操作完成，再读取下一条记录，直至没有满足条件的记录为止。因此，Update操作内部，就包含了一个当前读。同理，Delete操作也一样。Insert操作会稍微有些不同，简单来说，就是Insert操作可能会触发Unique Key的冲突检查，也会进行一个当前读。</p>\n<p>&nbsp;</p>\n<p><strong>注</strong>：根据上图的交互，针对一条当前读的SQL语句，InnoDB与MySQL Server的交互，是一条一条进行的，因此，加锁也是一条一条进行的。先对一条满足条件的记录加锁，返回给MySQL Server，做一些DML操作；然后在读取下一条加锁，直至读取完毕。</p>\n<h3><strong>1.2 Cluster Index：聚簇索引</strong></h3>\n<p>InnoDB存储引擎的数据组织方式，是聚簇索引表：完整的记录，存储在主键索引中，通过主键索引，就可以获取记录所有的列。关于聚簇索引表的组织方式，可以参考MySQL的官方文档：<a href=\"http://dev.mysql.com/doc/refman/5.0/en/innodb-index-types.html\" target=\"_blank\">Clustered and Secondary Indexes</a>&nbsp;。本文假设读者对这个，已经有了一定的认识，就不再做具体的介绍。接下来的部分，主键索引/聚簇索引 两个名称，会有一些混用，望读者知晓。</p>\n<h3><strong>1.3 &nbsp;2PL：Two-Phase Locking</strong></h3>\n<p>传统RDBMS加锁的一个原则，就是2PL (二阶段锁)：<a href=\"http://en.wikipedia.org/wiki/Two-phase_locking\" target=\"_blank\">Two-Phase Locking</a>。相对而言，2PL比较容易理解，说的是锁操作分为两个阶段：加锁阶段与解锁阶段，并且保证加锁阶段与解锁阶段不相交。下面，仍旧以MySQL为例，来简单看看2PL在MySQL中的实现。</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-1.jpg\"><img class=\"alignnone size-full wp-image-2129\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-1.jpg\" alt=\"medish (1)\" width=\"640\" height=\"602\"></a></p>\n<p>&nbsp;</p>\n<p>从上图可以看出，2PL就是将加锁/解锁分为两个完全不相交的阶段。加锁阶段：只加锁，不放锁。解锁阶段：只放锁，不加锁。</p>\n<p>&nbsp;</p>\n<p><strong>1.4 &nbsp;Isolation Level</strong></p>\n<p>隔离级别：<a href=\"http://en.wikipedia.org/wiki/Isolation_(database_systems)\">Isolation Level</a>，也是RDBMS的一个关键特性。相信对数据库有所了解的朋友，对于4种隔离级别：Read Uncommited，Read Committed，Repeatable Read，Serializable，都有了深入的认识。本文不打算讨论数据库理论中，是如何定义这4种隔离级别的含义的，而是跟大家介绍一下MySQL/InnoDB是如何定义这4种隔离级别的。</p>\n<p>&nbsp;</p>\n<p>MySQL/InnoDB定义的4种隔离级别：</p>\n<ul>\n<li>\n<div><strong>Read Uncommited<br></strong></div>\n<p>可以读取未提交记录。此隔离级别，不会使用，忽略。</p>\n\n</li>\n<li>\n<div><strong>Read Committed (RC)<br></strong></div>\n<p>快照读忽略，本文不考虑。</p>\n<p>针对当前读，<strong>RC隔离级别保证对读取到的记录加锁 (记录锁)</strong>，存在幻读现象。</p>\n\n</li>\n<li>\n<div><strong>Repeatable Read (RR)<br></strong></div>\n<p>快照读忽略，本文不考虑。</p>\n<p>针对当前读，<strong>RR隔离级别保证对读取到的记录加锁 (记录锁)，同时保证对读取的范围加锁，新的满足查询条件的记录不能够插入 (间隙锁)</strong>，不存在幻读现象。</p>\n\n</li>\n<li>\n<div><strong>Serializable<br></strong></div>\n<p>从MVCC并发控制退化为基于锁的并发控制。不区别快照读与当前读，所有的读操作均为当前读，读加读锁 (S锁)，写加写锁 (X锁)。</p>\n<p>Serializable隔离级别下，读写冲突，因此并发度急剧下降，在MySQL/InnoDB下不建议使用。</p>\n\n</li>\n\n</ul>\n<h1>二、一条简单SQL的加锁实现分析</h1>\n<p>在介绍完一些背景知识之后，本文接下来将选择几个有代表性的例子，来详细分析MySQL的加锁处理。当然，还是从最简单的例子说起。经常有朋友发给我一个SQL，然后问我，这个SQL加什么锁？就如同下面两条简单的SQL，他们加什么锁？</p>\n<p>&nbsp;</p>\n<ul>\n<li><strong>SQL1：</strong>select * from t1 where id = 10;</li>\n<li><strong>SQL2：</strong>delete from t1 where id = 10;</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>针对这个问题，该怎么回答？我能想象到的一个答案是：</p>\n<p>&nbsp;</p>\n<ul>\n<li><strong>SQL1：</strong>不加锁。因为MySQL是使用多版本并发控制的，读不加锁。</li>\n<li><strong>SQL2：</strong>对id = 10的记录加写锁 (走主键索引)。</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>这个答案对吗？说不上来。即可能是正确的，也有可能是错误的，已知条件不足，这个问题没有答案。如果让我来回答这个问题，我必须还要知道以下的一些前提，前提不同，我能给出的答案也就不同。要回答这个问题，还缺少哪些前提条件？</p>\n<p>&nbsp;</p>\n<ul>\n<li><strong>前提一：</strong>id列是不是主键？</li>\n\n</ul>\n<p>&nbsp;</p>\n<ul>\n<li><strong>前提二：</strong>当前系统的隔离级别是什么？</li>\n\n</ul>\n<ul>\n<li><strong>前提三：</strong>id列如果不是主键，那么id列上有索引吗？</li>\n\n</ul>\n<ul>\n<li><strong>前提四：</strong>id列上如果有二级索引，那么这个索引是唯一索引吗？</li>\n\n</ul>\n<ul>\n<li><strong>前提五：</strong>两个SQL的执行计划是什么？索引扫描？全表扫描？</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>没有这些前提，直接就给定一条SQL，然后问这个SQL会加什么锁，都是很业余的表现。而当这些问题有了明确的答案之后，给定的SQL会加什么锁，也就一目了然。下面，我将这些问题的答案进行组合，然后按照从易到难的顺序，逐个分析每种组合下，对应的SQL会加哪些锁？</p>\n<p>&nbsp;</p>\n<p><strong>注：</strong>下面的这些组合，我做了一个前提假设，也就是有索引时，执行计划一定会选择使用索引进行过滤 (索引扫描)。但实际情况会复杂很多，真正的执行计划，还是需要根据MySQL输出的为准。</p>\n<p>&nbsp;</p>\n<ul>\n<li><strong>组合一：</strong>id列是主键，RC隔离级别</li>\n<li><strong>组合二：</strong>id列是二级唯一索引，RC隔离级别</li>\n<li><strong>组合三：</strong>id列是二级非唯一索引，RC隔离级别</li>\n<li><strong>组合四：</strong>id列上没有索引，RC隔离级别</li>\n<li><strong>组合五：</strong>id列是主键，RR隔离级别</li>\n<li><strong>组合六：</strong>id列是二级唯一索引，RR隔离级别</li>\n<li><strong>组合七：</strong>id列是二级非唯一索引，RR隔离级别</li>\n<li><strong>组合八：</strong>id列上没有索引，RR隔离级别</li>\n<li><strong>组合九：</strong>Serializable隔离级别</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>排列组合还没有列举完全，但是看起来，已经很多了。真的有必要这么复杂吗？事实上，要分析加锁，就是需要这么复杂。但是从另一个角度来说，只要你选定了一种组合，SQL需要加哪些锁，其实也就确定了。接下来，就让我们来逐个分析这9种组合下的SQL加锁策略。</p>\n<p>&nbsp;</p>\n<p>注：在前面八种组合下，也就是RC，RR隔离级别下，SQL1：select操作均不加锁，采用的是快照读，因此在下面的讨论中就忽略了，主要讨论SQL2：delete操作的加锁。</p>\n<h3>2.1 组合一：id主键+RC</h3>\n<p>这个组合，是最简单，最容易分析的组合。id是主键，Read Committed隔离级别，给定SQL：delete from t1 where id = 10; 只需要将主键上，id = 10的记录加上X锁即可。如下图所示：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-2.jpg\"><img class=\"alignnone size-full wp-image-2130\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-2.jpg\" alt=\"medish (2)\" width=\"640\" height=\"579\"></a></p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>id是主键时，此SQL只需要在id=10这条记录上加X锁即可。</p>\n<h3><strong>2.2 组合二：id唯一索引+RC</strong></h3>\n<p>这个组合，id不是主键，而是一个Unique的二级索引键值。那么在RC隔离级别下，delete from t1 where id = 10; 需要加什么锁呢？见下图：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-3.jpg\"><img class=\"alignnone size-full wp-image-2131\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-3.jpg\" alt=\"medish (3)\" width=\"640\" height=\"578\"></a></p>\n<p>此组合中，id是unique索引，而主键是name列。此时，加锁的情况由于组合一有所不同。由于id是unique索引，因此delete语句会选择走id列的索引进行where条件的过滤，在找到id=10的记录后，首先会将unique索引上的id=10索引记录加上X锁，同时，会根据读取到的name列，回主键索引(聚簇索引)，然后将聚簇索引上的name = ‘d’ 对应的主键索引项加X锁。为什么聚簇索引上的记录也要加锁？试想一下，如果并发的一个SQL，是通过主键索引来更新：update t1 set id = 100 where name = ‘d’; 此时，如果delete语句没有将主键索引上的记录加锁，那么并发的update就会感知不到delete语句的存在，违背了同一记录上的更新/删除需要串行执行的约束。</p>\n<p>&nbsp;</p>\n<p><strong>结论</strong>：若id列是unique列，其上有unique索引。那么SQL需要加两个X锁，一个对应于id unique索引上的id = 10的记录，另一把锁对应于聚簇索引上的[name='d',id=10]的记录。</p>\n<h3>2.3 &nbsp;组合三：id非唯一索引+RC</h3>\n<h2>&nbsp;</h2>\n<p>相对于组合一、二，组合三又发生了变化，隔离级别仍旧是RC不变，但是id列上的约束又降低了，id列不再唯一，只有一个普通的索引。假设delete from t1 where id = 10; 语句，仍旧选择id列上的索引进行过滤where条件，那么此时会持有哪些锁？同样见下图：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-4.jpg\"><img class=\"alignnone size-full wp-image-2132\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-4.jpg\" alt=\"medish (4)\" width=\"640\" height=\"578\"></a></p>\n<p>根据此图，可以看到，首先，id列索引上，满足id = 10查询条件的记录，均已加锁。同时，这些记录对应的主键索引上的记录也都加上了锁。与组合二唯一的区别在于，组合二最多只有一个满足等值查询的记录，而组合三会将所有满足查询条件的记录都加锁。</p>\n<p>&nbsp;</p>\n<p><strong>结论</strong>：若id列上有非唯一索引，那么对应的所有满足SQL查询条件的记录，都会被加锁。同时，这些记录在主键索引上的记录，也会被加锁。</p>\n<h3>2.4 组合四：id无索引+RC</h3>\n<p>相对于前面三个组合，这是一个比较特殊的情况。id列上没有索引，where id = 10;这个过滤条件，没法通过索引进行过滤，那么只能走全表扫描做过滤。对应于这个组合，SQL会加什么锁？或者是换句话说，全表扫描时，会加什么锁？这个答案也有很多：有人说会在表上加X锁；有人说会将聚簇索引上，选择出来的id = 10;的记录加上X锁。那么实际情况呢？请看下图：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-5.jpg\"><img class=\"alignnone size-full wp-image-2133\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-5.jpg\" alt=\"medish (5)\" width=\"640\" height=\"579\"></a></p>\n<p>由于id列上没有索引，因此只能走聚簇索引，进行全部扫描。从图中可以看到，满足删除条件的记录有两条，但是，聚簇索引上所有的记录，都被加上了X锁。无论记录是否满足条件，全部被加上X锁。既不是加表锁，也不是在满足条件的记录上加行锁。</p>\n<p>&nbsp;</p>\n<p>有人可能会问？为什么不是只在满足条件的记录上加锁呢？这是由于MySQL的实现决定的。如果一个条件无法通过索引快速过滤，那么存储引擎层面就会将所有记录加锁后返回，然后由MySQL Server层进行过滤。因此也就把所有的记录，都锁上了。</p>\n<p>&nbsp;</p>\n<p>注：在实际的实现中，MySQL有一些改进，在MySQL Server过滤条件，发现不满足后，会调用unlock_row方法，把不满足条件的记录放锁 (违背了2PL的约束)。这样做，保证了最后只会持有满足条件记录上的锁，但是每条记录的加锁操作还是不能省略的。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>若id列上没有索引，SQL会走聚簇索引的全扫描进行过滤，由于过滤是由MySQL Server层面进行的。因此每条记录，无论是否满足条件，都会被加上X锁。但是，为了效率考量，MySQL做了优化，对于不满足条件的记录，会在判断后放锁，最终持有的，是满足条件的记录上的锁，但是不满足条件的记录上的加锁/放锁动作不会省略。同时，优化也违背了2PL的约束。</p>\n<h3>2.5 组合五：id主键+RR</h3>\n<p>上面的四个组合，都是在Read Committed隔离级别下的加锁行为，接下来的四个组合，是在Repeatable Read隔离级别下的加锁行为。</p>\n<p>&nbsp;</p>\n<p>组合五，id列是主键列，Repeatable Read隔离级别，针对delete from t1 where id = 10; 这条SQL，加锁与组合一：[<a href=\"http://hedengcheng.com/?p=771#_组合一：id主键+RC\">id主键，Read Committed</a>]一致。</p>\n<h3>2.6 &nbsp;组合六：id唯一索引+RR</h3>\n<p>与组合五类似，组合六的加锁，与组合二：[<a href=\"http://hedengcheng.com/?p=771#_组合二：id唯一索引+RC\">id唯一索引，Read Committed</a>]一致。两个X锁，id唯一索引满足条件的记录上一个，对应的聚簇索引上的记录一个。</p>\n<h3>2.7 &nbsp; 组合七：id非唯一索引+RR</h3>\n<h2>&nbsp;</h2>\n<p>还记得前面提到的MySQL的四种隔离级别的区别吗？RC隔离级别允许幻读，而RR隔离级别，不允许存在幻读。但是在组合五、组合六中，加锁行为又是与RC下的加锁行为完全一致。那么RR隔离级别下，如何防止幻读呢？问题的答案，就在组合七中揭晓。</p>\n<p>&nbsp;</p>\n<p>组合七，Repeatable Read隔离级别，id上有一个非唯一索引，执行delete from t1 where id = 10; 假设选择id列上的索引进行条件过滤，最后的加锁行为，是怎么样的呢？同样看下面这幅图：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-6.jpg\"><img class=\"alignnone size-full wp-image-2134\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-6.jpg\" alt=\"medish (6)\" width=\"640\" height=\"578\"></a></p>\n<p>此图，相对于组合三：[<a href=\"http://hedengcheng.com/?p=771#_组合三：id非唯一索引+RC\">id列上非唯一锁，Read Committed</a>]看似相同，其实却有很大的区别。最大的区别在于，这幅图中多了一个GAP锁，而且GAP锁看起来也不是加在记录上的，倒像是加载两条记录之间的位置，GAP锁有何用？</p>\n<p>&nbsp;</p>\n<p>其实这个多出来的GAP锁，就是RR隔离级别，相对于RC隔离级别，不会出现幻读的关键。确实，GAP锁锁住的位置，也不是记录本身，而是两条记录之间的GAP。所谓幻读，就是同一个事务，连续做两次当前读 (例如：select * from t1 where id = 10 for update;)，那么这两次当前读返回的是完全相同的记录 (记录数量一致，记录本身也一致)，第二次的当前读，不会比第一次返回更多的记录 (幻象)。</p>\n<p>&nbsp;</p>\n<p>如何保证两次当前读返回一致的记录，那就需要在第一次当前读与第二次当前读之间，其他的事务不会插入新的满足条件的记录并提交。为了实现这个功能，GAP锁应运而生。</p>\n<p>&nbsp;</p>\n<p>如图中所示，有哪些位置可以插入新的满足条件的项 (id = 10)，考虑到B+树索引的有序性，满足条件的项一定是连续存放的。记录[6,c]之前，不会插入id=10的记录；<a name=\"OLE_LINK1\"></a>[6,c]与[10,b]间可以插入[10, aa]；[10,b]与[10,d]间，可以插入新的[10,bb],[10,c]等；[10,d]与[11,f]间可以插入满足条件的[10,e],[10,z]等；而[11,f]之后也不会插入满足条件的记录。因此，为了保证[6,c]与[10,b]间，[10,b]与[10,d]间，[10,d]与[11,f]不会插入新的满足条件的记录，MySQL选择了用GAP锁，将这三个GAP给锁起来。</p>\n<p>&nbsp;</p>\n<p>Insert操作，如insert [10,aa]，首先会定位到[6,c]与[10,b]间，然后在插入前，会检查这个GAP是否已经被锁上，如果被锁上，则Insert不能插入记录。因此，通过第一遍的当前读，不仅将满足条件的记录锁上 (X锁)，与组合三类似。同时还是增加3把GAP锁，将可能插入满足条件记录的3个GAP给锁上，保证后续的Insert不能插入新的id=10的记录，也就杜绝了同一事务的第二次当前读，出现幻象的情况。</p>\n<p>&nbsp;</p>\n<p>有心的朋友看到这儿，可以会问：既然防止幻读，需要靠GAP锁的保护，为什么组合五、组合六，也是RR隔离级别，却不需要加GAP锁呢？</p>\n<p>&nbsp;</p>\n<p>首先，这是一个好问题。其次，回答这个问题，也很简单。GAP锁的目的，是为了防止同一事务的两次当前读，出现幻读的情况。而组合五，id是主键；组合六，id是unique键，都能够保证唯一性。一个等值查询，最多只能返回一条记录，而且新的相同取值的记录，一定不会在新插入进来，因此也就避免了GAP锁的使用。其实，针对此问题，还有一个更深入的问题：如果组合五、组合六下，针对SQL：select * from t1 where id = 10 for update; 第一次查询，没有找到满足查询条件的记录，那么GAP锁是否还能够省略？此问题留给大家思考。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>Repeatable Read隔离级别下，id列上有一个非唯一索引，对应SQL：delete from t1 where id = 10; 首先，通过id索引定位到第一条满足查询条件的记录，加记录上的X锁，加GAP上的GAP锁，然后加主键聚簇索引上的记录X锁，然后返回；然后读取下一条，重复进行。直至进行到第一条不满足条件的记录[11,f]，此时，不需要加记录X锁，但是仍旧需要加GAP锁，最后返回结束。</p>\n<h3>2.8 &nbsp;组合八：id无索引+RR</h3>\n<p>组合八，Repeatable Read隔离级别下的最后一种情况，id列上没有索引。此时SQL：delete from t1 where id = 10; 没有其他的路径可以选择，只能进行全表扫描。最终的加锁情况，如下图所示：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-7.jpg\"><img class=\"alignnone size-full wp-image-2135\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-7.jpg\" alt=\"medish (7)\" width=\"640\" height=\"614\"></a></p>\n<p>&nbsp;</p>\n<p>如图，这是一个很恐怖的现象。首先，聚簇索引上的所有记录，都被加上了X锁。其次，聚簇索引每条记录间的间隙(GAP)，也同时被加上了GAP锁。这个示例表，只有6条记录，一共需要6个记录锁，7个GAP锁。试想，如果表上有1000万条记录呢？</p>\n<p>&nbsp;</p>\n<p>在这种情况下，这个表上，除了不加锁的快照度，其他任何加锁的并发SQL，均不能执行，不能更新，不能删除，不能插入，全表被锁死。</p>\n<p>&nbsp;</p>\n<p>当然，跟组合四：[<a href=\"http://hedengcheng.com/?p=771#_组合四：id无索引+RC\">id无索引, Read Committed</a>]类似，这个情况下，MySQL也做了一些优化，就是所谓的semi-consistent read。semi-consistent read开启的情况下，对于不满足查询条件的记录，MySQL会提前放锁。针对上面的这个用例，就是除了记录[d,10]，[g,10]之外，所有的记录锁都会被释放，同时不加GAP锁。semi-consistent read如何触发：要么是read committed隔离级别；要么是Repeatable Read隔离级别，同时设置了<a href=\"http://dev.mysql.com/doc/refman/5.5/en/innodb-parameters.html\">innodb_locks_unsafe_for_binlog</a>&nbsp;参数。更详细的关于semi-consistent read的介绍，可参考我之前的一篇博客：<a href=\"http://hedengcheng.com/?p=220\">MySQL+InnoDB semi-consitent read原理及实现分析</a>&nbsp;。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>在Repeatable Read隔离级别下，如果进行全表扫描的当前读，那么会锁上表中的所有记录，同时会锁上聚簇索引内的所有GAP，杜绝所有的并发 更新/删除/插入 操作。当然，也可以通过触发semi-consistent read，来缓解加锁开销与并发影响，但是semi-consistent read本身也会带来其他问题，不建议使用。</p>\n<h3>2.9 &nbsp;组合九：Serializable</h3>\n<p>针对前面提到的简单的SQL，最后一个情况：Serializable隔离级别。对于SQL2：delete from t1 where id = 10; 来说，Serializable隔离级别与Repeatable Read隔离级别完全一致，因此不做介绍。</p>\n<p>&nbsp;</p>\n<p>Serializable隔离级别，影响的是SQL1：select * from t1 where id = 10; 这条SQL，在RC，RR隔离级别下，都是快照读，不加锁。但是在Serializable隔离级别，SQL1会加读锁，也就是说快照读不复存在，MVCC并发控制降级为Lock-Based CC。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>在MySQL/InnoDB中，所谓的读不加锁，并不适用于所有的情况，而是隔离级别相关的。Serializable隔离级别，读不加锁就不再成立，所有的读操作，都是当前读。</p>\n<h1>三、一条复杂的SQL</h1>\n<h1>&nbsp;</h1>\n<p>写到这里，其实MySQL的加锁实现也已经介绍的八八九九。只要将本文上面的分析思路，大部分的SQL，都能分析出其会加哪些锁。而这里，再来看一个稍微复杂点的SQL，用于说明MySQL加锁的另外一个逻辑。SQL用例如下：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-8.jpg\"><img class=\"alignnone size-full wp-image-2136\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-8.jpg\" alt=\"medish (8)\" width=\"640\" height=\"626\"></a></p>\n<p>&nbsp;</p>\n<p>如图中的SQL，会加什么锁？假定在Repeatable Read隔离级别下 (Read Committed隔离级别下的加锁情况，留给读者分析。)，同时，假设SQL走的是idx_t1_pu索引。</p>\n<p>&nbsp;</p>\n<p>在详细分析这条SQL的加锁情况前，还需要有一个知识储备，那就是一个SQL中的where条件如何拆分？具体的介绍，建议阅读我之前的一篇文章：<a href=\"http://hedengcheng.com/?p=577\">SQL中的where条件，在数据库中提取与应用浅析</a>&nbsp;。在这里，我直接给出分析后的结果：</p>\n<p>&nbsp;</p>\n<ul>\n<li>\n<div><strong>Index key：</strong>pubtime &gt; 1 and puptime &lt; 20。此条件，用于确定SQL在idx_t1_pu索引上的查询范围。</div>\n<p>&nbsp;</p>\n\n</li>\n<li><strong>Index Filter：</strong>userid = ‘hdc’ 。此条件，可以在idx_t1_pu索引上进行过滤，但不属于Index Key。</li>\n\n</ul>\n<ul>\n<li><strong>Table Filter：</strong>comment is not NULL。此条件，在idx_t1_pu索引上无法过滤，只能在聚簇索引上过滤。</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>在分析出SQL where条件的构成之后，再来看看这条SQL的加锁情况 (RR隔离级别)，如下图所示：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-9.jpg\"><img class=\"alignnone size-full wp-image-2137\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-9.jpg\" alt=\"medish (9)\" width=\"640\" height=\"626\"></a></p>\n<p>&nbsp;</p>\n<p>从图中可以看出，在Repeatable Read隔离级别下，由Index Key所确定的范围，被加上了GAP锁；Index Filter锁给定的条件 (userid = ‘hdc’)何时过滤，视MySQL的版本而定，在MySQL 5.6版本之前，不支持<a href=\"http://dev.mysql.com/doc/refman/5.6/en/index-condition-pushdown-optimization.html\">Index Condition Pushdown</a>(ICP)，因此Index Filter在MySQL Server层过滤，在5.6后支持了Index Condition Pushdown，则在index上过滤。若不支持ICP，不满足Index Filter的记录，也需要加上记录X锁，若支持ICP，则不满足Index Filter的记录，无需加记录X锁 (图中，用红色箭头标出的X锁，是否要加，视是否支持ICP而定)；而Table Filter对应的过滤条件，则在聚簇索引中读取后，在MySQL Server层面过滤，因此聚簇索引上也需要X锁。最后，选取出了一条满足条件的记录[8,hdc,d,5,good]，但是加锁的数量，要远远大于满足条件的记录数量。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>在Repeatable Read隔离级别下，针对一个复杂的SQL，首先需要提取其where条件。Index Key确定的范围，需要加上GAP锁；Index Filter过滤条件，视MySQL版本是否支持ICP，若支持ICP，则不满足Index Filter的记录，不加X锁，否则需要X锁；Table Filter过滤条件，无论是否满足，都需要加X锁。</p>\n<h3><strong>四、死锁原理与分析&nbsp;</strong></h3>\n<p>本文前面的部分，基本上已经涵盖了MySQL/InnoDB所有的加锁规则。深入理解MySQL如何加锁，有两个比较重要的作用：</p>\n<p>&nbsp;</p>\n<ul>\n<li>\n<div>可以根据MySQL的加锁规则，写出不会发生死锁的SQL；</div>\n<p>&nbsp;</p>\n\n</li>\n<li>可以根据MySQL的加锁规则，定位出线上产生死锁的原因；</li>\n\n</ul>\n<p>下面，来看看两个死锁的例子 (一个是两个Session的两条SQL产生死锁；另一个是两个Session的一条SQL，产生死锁)：</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-10.jpg\"><img class=\"alignnone size-full wp-image-2138\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-10.jpg\" alt=\"medish (10)\" width=\"640\" height=\"424\"></a></p>\n<p>&nbsp;</p>\n<p><a href=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-11.jpg\"><img class=\"alignnone size-full wp-image-2139\" src=\"http://officialblog-wordpress.stor.sinaapp.com/uploads/2013/12/medish-11.jpg\" alt=\"medish (11)\" width=\"640\" height=\"499\"></a></p>\n<p>&nbsp;</p>\n<p>上面的两个死锁用例。第一个非常好理解，也是最常见的死锁，每个事务执行两条SQL，分别持有了一把锁，然后加另一把锁，产生死锁。</p>\n<p>&nbsp;</p>\n<p>第二个用例，虽然每个Session都只有一条语句，仍旧会产生死锁。要分析这个死锁，首先必须用到本文前面提到的MySQL加锁的规则。针对Session 1，从name索引出发，读到的[hdc, 1]，[hdc, 6]均满足条件，不仅会加name索引上的记录X锁，而且会加聚簇索引上的记录X锁，加锁顺序为先[1,hdc,100]，后[6,hdc,10]。而Session 2，从pubtime索引出发，[10,6],[100,1]均满足过滤条件，同样也会加聚簇索引上的记录X锁，加锁顺序为[6,hdc,10]，后[1,hdc,100]。发现没有，跟Session 1的加锁顺序正好相反，如果两个Session恰好都持有了第一把锁，请求加第二把锁，死锁就发生了。</p>\n<p>&nbsp;</p>\n<p><strong>结论：</strong>死锁的发生与否，并不在于事务中有多少条SQL语句，<strong>死锁的关键在于</strong>：两个(或以上)的Session<strong>加锁的顺序</strong>不一致。而使用本文上面提到的，分析MySQL每条SQL语句的加锁规则，分析出每条语句的加锁顺序，然后检查多个并发SQL间是否存在以相反的顺序加锁的情况，就可以分析出各种潜在的死锁情况，也可以分析出线上死锁发生的原因。</p>\n<h3>五、总结</h3>\n<p>写到这儿，本文也告一段落，做一个简单的总结，要做的完全掌握MySQL/InnoDB的加锁规则，甚至是其他任何数据库的加锁规则，需要具备以下的一些知识点：</p>\n<p>&nbsp;</p>\n<ul>\n<li>了解数据库的一些基本理论知识：数据的存储格式 (堆组织表 vs 聚簇索引表)；并发控制协议 (MVCC vs Lock-Based CC)；Two-Phase Locking；数据库的隔离级别定义 (Isolation Level)；</li>\n<li>了解SQL本身的执行计划 (主键扫描 vs 唯一键扫描 vs 范围扫描 vs 全表扫描)；</li>\n<li>了解数据库本身的一些实现细节 (过滤条件提取；Index Condition Pushdown；Semi-Consistent Read)；</li>\n<li>了解死锁产生的原因及分析的方法 (加锁顺序不一致；分析每个SQL的加锁顺序)</li>\n\n</ul>\n<p>&nbsp;</p>\n<p>有了这些知识点，再加上适当的实战经验，全面掌控MySQL/InnoDB的加锁规则，当不在话下。</p>\n<p>&nbsp;</p>\n</div>"
  },
  {
    "category": "dataBase",
    "qes": "什么是事务？事务的四个特性以及事务的隔离级别",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body\">\n    <p><span style=\"font-size: 18pt\"><strong><span style=\"font-family: 宋体\">什么是事务</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　事务是指是程序中一系列严密的逻辑操作，而且所有操作必须全部成功完成，否则在每个操作中所作的所有更改都会被撤消。可以通俗理解为：就是把多件事情当做一件事情来处理，好比大家同在一条船上，要活一起活，要完一起完 。</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p><span style=\"font-size: 18pt\"><strong><span style=\"font-family: 宋体\">事物的四个特性（ACID）</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;<span style=\"color: rgba(255, 0, 0, 1)\">原子性</span></strong></span>（Atomicity）<span style=\"font-family: 宋体; font-size: 16px\"><strong><span style=\"color: rgba(255, 0, 0, 1)\">：</span></strong>操作这些指令时，要么全部执行成功，要么全部不执行。只要其中一个指令执行失败，所有的指令都执行失败，数据进行回滚，回到执行指令前的数据状态。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">拿转账来说，假设用户A和用户B两者的钱加起来一共是20000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是20000，这就是事务的一致性。</span></span></p>\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;<span style=\"color: rgba(255, 0, 0, 1)\">一致性</span></strong></span>（Consistency）<span style=\"font-family: 宋体; font-size: 16px\"><strong><span style=\"color: rgba(255, 0, 0, 1)\">：</span></strong>事务的执行使数据从一个状态转换为另一个状态，但是对于整个数据的完整性保持稳定。</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;<span style=\"color: rgba(255, 0, 0, 1)\">隔离性</span></strong></span>（Isolation）<span style=\"font-family: 宋体; font-size: 16px\"><strong><span style=\"color: rgba(255, 0, 0, 1)\">：</span></strong></span><span style=\"font-family: 宋体; font-size: 16px\">隔离性是当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离。</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　　　　　　　　　　　&nbsp; 即要达到这么一种效果：对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行。</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;<span style=\"color: rgba(255, 0, 0, 1)\">持久性</span></strong></span>（Durability）<span style=\"font-family: 宋体; font-size: 16px\"><strong><span style=\"color: rgba(255, 0, 0, 1)\">：</span></strong>当事务正确完成后，它对于数据的改变是永久性的。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\"> 例如我们在使用JDBC操作数据库时，在提交事务方法后，提示用户事务操作完成，当我们程序执行完成直到看到提示后，就可以认定事务以及正确提交，即使这时候数据库出现了问题，也必须要将我们的事务完全执行完成，否则就会造成我们看到提示事务处理完毕，但是数据库因为故障而没有执行事务的重大错误。</span></span></p>\n</blockquote>\n<p>&nbsp;</p>\n<p><strong><span style=\"font-family: 宋体; font-size: 18pt\">并发事务导致的问题</span></strong></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　在许多事务处理同一个数据时，如果没有采取有效的隔离机制，那么并发处理数据时，会带来一些的问题。</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;</strong>第一类丢失更新：撤销一个事务时，把其他事务已提交的更新数据覆盖。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">小明去银行柜台存钱，他的账户里原来的余额为100元，现在打算存入100元。在他存钱的过程中，银行年费扣了5元，余额只剩95元。突然他又想着这100元要用来请女朋友看电影吃饭，不打算存了。在他撤回存钱操作后，余额依然为他存钱之前的100元。所以那5块钱到底扣了谁的？</span></span></p>\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●<span style=\"color: rgba(255, 0, 0, 1)\">&nbsp;脏读：</span>脏读是指在一个事务处理过程里读取了另一个未提交的事务中的数据。</strong><br></span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">小明的银行卡余额里有100元。现在他打算用手机点一个外卖饮料，需要付款10元。但是这个时候，他的女朋友看中了一件衣服95元，她正在使用小明的银行卡付款。于是小明在付款的时候，程序后台读取到他的余额只有5块钱了，根本不够10元，所以系统拒绝了他的交易，告诉余额不足。但是小明的女朋友最后因为密码错误，无法进行交易。小明非常郁闷，明明银行卡里还有100元，怎么会余额不足呢？（他女朋友更郁闷。。。）</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●<span style=\"color: rgba(255, 0, 0, 1)\">&nbsp;幻读也叫虚读：</span>一个事务执行两次查询，第二次结果集包含第一次中没有或某些行已经被删除的数据，造成两次结果不一致，只是另一个事务在这两次查询中间插入或删除了数据造成的。</strong>幻读是事务非独立执行时发生的一种现象。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">例如事务T1对一个表中所有的行的某个数据项做了从“1”修改为“2”的操作，这时事务T2又对这个表中插入了一行数据项，而这个数据项的数值还是为“1”并且提交给数据库。而操作事务T1的用户如果再查看刚刚修改的数据，会发现还有一行没有修改，其实这行是从事务T2中添加的，就好像产生幻觉一样，这就是发生了幻读。</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●<span style=\"color: rgba(255, 0, 0, 1)\">&nbsp;不可重复读：</span></strong>一个事务两次读取同一行的数据，结果得到不同状态的结果，中间正好另一个事务更新了该数据，两次结果相异，不可被信任。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">例如事务T1在读取某一数据，而事务T2立马修改了这个数据并且提交事务给数据库，事务T1再次读取该数据就得到了不同的结果，发送了不可重复读。</span></span></p>\n\n\n</blockquote>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Tips：</strong><span style=\"color: rgba(255, 0, 0, 1)\">不可重复读和脏读的区别：</span>脏读是某一事务读取了另一个事务未提交的脏数据，而不可重复读则是读取了前一事务提交的数据。</span><span style=\"font-family: 宋体; font-size: 16px\">　</span></p>\n\n\n</blockquote>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Tips：</strong>幻读和不可重复读都是<span style=\"color: rgba(255, 0, 0, 1)\">读取了另一条已经提交的事务</span>（这点就脏读不同），所不同的是不可重复读查询的都是<span style=\"color: rgba(255, 0, 0, 1)\">同一个数据项</span>，而幻读针对的是<span style=\"color: rgba(255, 0, 0, 1)\">一批数据整体</span>（比如数据的个数）。</span></p>\n\n\n</blockquote>\n<p>&nbsp;</p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　<strong>●&nbsp;</strong>第二类丢失更新：是不可重复读的特殊情况。如果两个事物都读取同一行，然后两个都进行写操作，并提交，第一个事物所做的改变就会丢失。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">小明和女朋友一起去逛街。女朋友看中了一支口红，（对，女朋友就是用来表现买买买的）小明大方的掏出了自己的银行卡，告诉女朋友：亲爱的，随便刷，随便买，我坐着等你。然后小明就坐在商城座椅上玩手机，等着女朋友。这个时候，程序员的聊天群里有人推荐了一本书，小明一看，哎呀，真是本好书，还是限量发行呢，我一定更要买到。于是小明赶紧找到购买渠道，进行付款操作。而同时，小明的女朋友也在不亦乐乎的买买买，他们同时进行了一笔交易操作，但是这个时候银行系统出了问题，当他们都付款成功后，却发现，银行只扣了小明的买书钱，却没有扣去女朋友此时交易的钱。哈哈哈，小明真是太开心了！</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p><strong><span style=\"font-family: 宋体; font-size: 18pt\">数据库事务的隔离级别</span></strong></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">　　事务的隔离级别有4种，由低到高分别为<strong>Read uncommitted</strong> 、<strong>Read committed</strong> 、<strong>Repeatable read</strong> 、<strong>Serializable</strong> 。而且，在事务的<span style=\"color: rgba(255, 0, 0, 1)\">并发</span>操作中可能会出现<strong>脏读</strong>，<strong>不可重复读</strong>，<strong>幻读</strong>。下面通过事例一一阐述它们的概念与联系。</span></p>\n<p><span style=\"color: rgba(255, 0, 0, 1)\"><strong><span style=\"font-family: 宋体; font-size: 16px\">Read uncommitted（最低级别，任何情况都无法保证。）</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">读未提交，顾名思义，就是一个事务可以读取另一个未提交事务的数据。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">老板要给程序员发工资，程序员的工资是3.6万/月。但是发工资时老板不小心按错了数字，按成3.9万/月，该钱已经打到程序员的户口，但是事务还没有提交，就在这时，程序员去查看自己这个月的工资，发现比往常多了3千元，以为涨工资了非常高兴。但是老板及时发现了不对，马上回滚差点就提交了的事务，将数字改成3.6万再提交。</span></span></p>\n\n\n</blockquote>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Analyse：</strong><span style=\"font-size: 14px\">实际程序员这个月的工资还是3.6万，但是程序员看到的是3.9万。他看到的是老板还没提交事务时的数据。这就是脏读。</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">那怎么解决脏读呢？Read committed！读提交，能解决脏读问题。</span><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p>&nbsp;</p>\n<p><span style=\"color: rgba(255, 0, 0, 1)\"><strong><span style=\"font-family: 宋体; font-size: 16px\">Read committed（可避免脏读的发生。）</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">读提交，顾名思义，就是一个事务要等另一个事务提交后才能读取数据。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">程序员拿着信用卡去享受生活（卡里当然是只有3.6万），当他埋单时（程序员事务开启），收费系统事先检测到他的卡里有3.6万，就在这个时候！！程序员的妻子要把钱全部转出充当家用，并提交。当收费系统准备扣款时，再检测卡里的金额，发现已经没钱了（第二次检测金额当然要等待妻子转出金额事务提交完）。程序员就会很郁闷，明明卡里是有钱的…</span></span></p>\n\n\n</blockquote>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Analyse：</strong><span style=\"font-size: 14px\">这就是读提交，若有事务对数据进行更新（UPDATE）操作时，读操作事务要等待这个更新操作事务提交后才能读取数据，可以解决脏读问题。但在这个事例中，出现了一个事务范围内两个相同的查询却返回了不同数据，这就是不可重复读。</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">那怎么解决可能的不可重复读问题？Repeatable read ！</span></p>\n<p>&nbsp;</p>\n<p><span style=\"color: rgba(255, 0, 0, 1)\"><strong><span style=\"font-family: 宋体; font-size: 16px\">Repeatable read（可避免脏读、不可重复读的发生。）</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">重复读，就是在开始读取数据（事务开启）时，不再允许修改操作</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">程序员拿着信用卡去享受生活（卡里当然是只有3.6万），当他埋单时（事务开启，不允许其他事务的UPDATE修改操作），收费系统事先检测到他的卡里有3.6万。这个时候他的妻子不能转出金额了。接下来收费系统就可以扣款了。</span></span></p>\n\n\n</blockquote>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Analyse：</strong><span style=\"font-size: 14px\">重复读可以解决不可重复读问题。写到这里，应该明白的一点就是，不可重复读对应的是修改，即UPDATE操作。但是可能还会有幻读问题。因为幻读问题对应的是插入INSERT操作，而不是UPDATE操作。</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">什么时候会出现幻读？</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>eg：</strong><span style=\"font-size: 14px\">程序员某一天去消费，花了2千元，然后他的妻子去查看他今天的消费记录（全表扫描FTS，妻子事务开启），看到确实是花了2千元，就在这个时候，程序员花了1万买了一部电脑，即新增INSERT了一条消费记录，并提交。当妻子打印程序员的消费记录清单时（妻子事务提交），发现花了1.2万元，似乎出现了幻觉，这就是幻读。</span></span></p>\n\n\n</blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\">那怎么解决幻读问题？Serializable！</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><span style=\"color: rgba(255, 0, 0, 1)\"><strong>Serializable（可避免脏读、不可重复读、幻读的发生。）</strong> </span>序列化</span></p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">Serializable 是最高的事务隔离级别，在该级别下，事务串行化顺序执行，可以避免脏读、不可重复读与幻读。但是这种事务隔离级别效率低下，比较耗数据库性能，一般不使用。</span></p>\n<blockquote>\n<p><span style=\"font-family: 宋体; font-size: 16px\"><strong>Tips：<span style=\"font-size: 14px\">大多数数据库默认的事务隔离级别是Read committed，比如Sql Server , Oracle。</span></strong></span></p>\n<p><span style=\"font-family: 宋体; font-size: 14px\"><strong>　　　　Mysql的默认隔离级别是Repeatable read。</strong></span></p>\n\n\n</blockquote>\n<blockquote>\n<p><strong><span style=\"font-family: 宋体; font-size: 16px\">Tips</span>：</strong><span style=\"font-family: 宋体; font-size: 14px\"><span style=\"color: rgba(255, 0, 0, 1)\">隔离级别的设置只对当前链接有效</span>。对于使用MySQL命令窗口而言，一个窗口就相当于一个链接，当前窗口设置的隔离级别只对当前窗口中的事务有效；对于JDBC操作数据库来说，一个Connection对象相当于一个链接，而对于Connection对象设置的隔离级别只对该Connection对象有效，与其他链接Connection对象无关。</span></p>\n\n\n</blockquote>\n<blockquote>\n<p><strong><span style=\"font-family: 宋体; font-size: 16px\">Tips</span>：</strong><span style=\"font-family: 宋体; font-size: 14px\">设置数据库的隔离级别一定要是在<span style=\"color: rgba(255, 0, 0, 1)\">开启事务之前</span>。</span></p>\n\n\n</blockquote>\n<p>&nbsp;</p>\n<p>&nbsp;</p>\n<p><span style=\"font-family: 宋体; font-size: 16px\">&nbsp;</span></p>\n</div>"
  },
  {
    "category": "dataBase",
    "qes": "MySQL大表优化方案",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n    <p class=\"copy-right-box\"><img src=\"https://fulu-common-util.oss-cn-hangzhou.aliyuncs.com/wiki_assets/full-logo.png\"><span class=\"declare\">版权声明：本博客所有文章归武汉福禄网络科技有限公司所有，欢迎转载，转载请注明出处。</span></p><p style=\"margin: 15px 0 0 0;border-bottom: 1px solid #ddd;\"></p><p></p><h2 id=\"背景\">背景</h2>\n<p>阿里云RDS FOR MySQL（MySQL5.7版本）数据库业务表每月新增数据量超过千万,随着数据量持续增加,我们业务出现大表慢查询,在业务高峰期主业务表的慢查询需要几十秒严重影响业务</p>\n<h2 id=\"方案概述\">方案概述</h2>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201030141518.png\" alt=\"20201030141518\" loading=\"lazy\"></p>\n<h2 id=\"一、数据库设计及索引优化\">一、数据库设计及索引优化</h2>\n<p>MySQL数据库本身高度灵活，造成性能不足，严重依赖开发人员的表设计能力以及索引优化能力,在这里给几点优化建议</p>\n<ul>\n<li>时间类型转化为时间戳格式,用int类型储存,建索引增加查询效率</li>\n<li>建议字段定义not null，null值很难查询优化且占用额外的索引空间</li>\n<li>使用TINYINT类型代替枚举ENUM</li>\n<li>存储精确浮点数必须使用DECIMAL替代FLOAT和DOUBLE</li>\n<li>字段长度严重根据业务需求来,不要设置过大</li>\n<li>尽量不要使用TEXT类型，如必须使用建议将不常用的大字段拆分到其它表</li>\n<li>MySQL对索引字段长度是有限制的, innodb引擎的每个索引列长度默认限制为767字节（bytes），所有组成索引列的长度和不能大于3072字节(mysql8.0单索引可以创建1024字符)</li>\n<li>大表有DDL需求时请联系DBA</li>\n</ul>\n<h4 id=\"最左索引匹配规则\">最左索引匹配规则</h4>\n<p>顾名思义就是最左优先，在创建组合索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。复合索引很重要的问题是如何安排列的顺序，比如where后面用到c1, c2 这两个字段，那么索引的顺序是(c1,c2)还是(c2,c1)呢，正确的做法是，重复值越少的越放前面，比如一个列 95%的值都不重复，那么一般可以将这个列放最前面</p>\n<ul>\n<li>复合索引index(a,b,c)</li>\n<li>where a=3    只使用了a</li>\n<li>where a=3 and b=5    使用了a,b</li>\n<li>where a=3 and b=5 and c=4    使用了a,b,c</li>\n<li>where b=3 or where c=4    没有使用索引</li>\n<li>where a=3 and c=4    仅使用了 a</li>\n<li>where a=3 and b&gt;10 and c=7    使用了a,b</li>\n<li>where a=3 and b like 'xx%' and c=7    使用了a,b</li>\n<li>其实相当于创建了多个索引：key(a)、key(a,b)、key(a,b,c)</li>\n</ul>\n<h2 id=\"二、数据库切换到ploardb读写分离\">二、数据库切换到PloarDB读写分离</h2>\n<p>PolarDB是阿里云自研的下一代关系型云数据库，100%兼容MySQL存储容量最高可达100 TB，单库最多可扩展到16个节点，适用于企业多样化的数据库应用场景。PolarDB采用存储和计算分离的架构，所有计算节点共享一份数据，提供分钟级的配置升降级、秒级的故障恢复、全局数据一致性和免费的数据备份容灾服务。</p>\n<ul>\n<li>集群架构，计算与存储分离<br>\nPolarDB采用多节点集群的架构，集群中有一个Writer节点（主节点）和多个Reader节点（只读节点），各节点通过分布式文件系统（PolarFileSystem）共享底层的存储（PolarStore）</li>\n<li>读写分离<br>\n当应用程序使用集群地址时，PolarDB通过内部的代理层（Proxy）对外提供服务，应用程序的请求都先经过代理，然后才访问到数据库节点。代理层不仅可以做安全认证和保护，还可以解析SQL，把写操作（例如事务、UPDATE、INSERT、DELETE、DDL等）发送到主节点，把读操作（例如SELECT）均衡地分发到多个只读节点，实现自动的读写分离。对于应用程序来说，就像使用一个单点的数据库一样简单。</li>\n</ul>\n<p>在离线混合场景：不同业务用不同的连接地址，使用不同的数据节点，避免相互影响</p>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029160013.png\" alt=\"20201029160013\" loading=\"lazy\"></p>\n<p>Sysbench性能压测报告：</p>\n<ul>\n<li>PloarDB 4核16G 2台</li>\n</ul>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029160525.png\" alt=\"20201029160525\" loading=\"lazy\"><br>\n<img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029160550.png\" alt=\"20201029160550\" loading=\"lazy\"></p>\n<ul>\n<li>PloarDB 8核32G 2台</li>\n</ul>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029160755.png\" alt=\"20201029160755\" loading=\"lazy\"><br>\n<img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029160845.png\" alt=\"20201029160845\" loading=\"lazy\"></p>\n<h2 id=\"三、分表历史数据迁移到mysql80-x-engine存储引擎\">三、分表历史数据迁移到MySQL8.0 X-Engine存储引擎</h2>\n<p>分表业务表保留3个月数据(这个根据公司需求来),历史数据按月分表到历史库X-Engine存储引擎表, 为什么要选用X-Engine存储引擎表,它有什么优点?</p>\n<ol>\n<li>节约成本, X-Engine的存储成本约为InnoDB的一半</li>\n<li>X-Engine分层存储提高QPS, 采用层次化的存储结构，将热数据与冷数据分别存放在不同的层次中，并默认对冷数据所在层次进行压缩</li>\n</ol>\n<p>X-Engine是阿里云数据库产品事业部自研的联机事务处理OLTP（On-Line Transaction Processing）数据库存储引擎。<br>\nX-Engine存储引擎不仅可以无缝对接兼容MySQL（得益于MySQL Pluginable Storage Engine特性），同时X-Engine使用分层存储架构。因为目标是面向大规模的海量数据存储，提供高并发事务处理能力和降低存储成本，在大部分大数据量场景下，数据被访问的机会是不均等的，访问频繁的热数据实际上占比很少，X-Engine根据数据访问频度的不同将数据划分为多个层次，针对每个层次数据的访问特点，设计对应的存储结构，写入合适的存储设备</p>\n<ul>\n<li>X-Engine使用了LSM-Tree作为分层存储的架构基础，并进行了重新设计：</li>\n<li>热数据层和数据更新使用内存存储，通过内存数据库技术（Lock-Free index structure/append only）提高事务处理的性能。</li>\n<li>流水线事务处理机制，把事务处理的几个阶段并行起来，极大提升了吞吐。</li>\n<li>访问频度低的数据逐渐淘汰或是合并到持久化的存储层次中，并结合多层次的存储设备（NVM/SSD/HDD）进行存储。</li>\n<li>对性能影响比较大的Compaction过程做了大量优化：</li>\n<li>拆分数据存储粒度，利用数据更新热点较为集中的特征，尽可能的在合并过程中复用数据。</li>\n<li>精细化控制LSM的形状，减少I/O和计算代价，有效缓解了合并过程中的空间增大。</li>\n<li>同时使用更细粒度的访问控制和缓存机制，优化读的性能。</li>\n</ul>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029162440.png\" alt=\"20201029162440\" loading=\"lazy\"></p>\n<h2 id=\"四、阿里云ploardb-mysql80版本并行查询\">四、阿里云PloarDB MySQL8.0版本并行查询</h2>\n<p>分表之后我们的数据量依然很大,并没有完全解决我们的慢查询问题,只是降低了我们业务表的体量,这部分慢查询我们需要用到PolarDB的并行查询优化</p>\n<p>PolarDB MySQL 8.0重磅推出并行查询框架，当您的查询数据量到达一定阈值，就会自动启动并行查询框架，从而使查询耗时指数级下降<br>\n在存储层将数据分片到不同的线程上，多个线程并行计算，将结果流水线汇总到总线程，最后总线程做些简单归并返回给用户，提高查询效率。<br>\n并行查询（Parallel Query）利用多核CPU的并行处理能力，以8核32 GB配置为例，示意图如下所示。</p>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201029163124.png\" alt=\"20201029163124\" loading=\"lazy\"></p>\n<p>并行查询适用于大部分SELECT语句，例如大表查询、多表连接查询、计算量较大的查询。对于非常短的查询，效果不太显著。</p>\n<p>并行查询用法，使用Hint语法可以对单个语句进行控制，例如系统默认关闭并行查询情况下，但需要对某个高频的慢SQL查询进行加速，此时就可以使用Hint对特定SQL进行加速。</p>\n<p>SELECT /<em>+PARALLEL(x)</em>/ ... FROM ...;   -- x &gt;0</p>\n<p>SELECT /*+ SET_VAR(max_parallel_degree=n) */  *  FROM ...   // n &gt; 0</p>\n<p>查询测试：数据库配置 16核32G 单表数据量超3千万</p>\n<p>没加并行查询之前是4326ms，加了之后是525ms，性能提升8.24倍</p>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/lALPDhmOtqINirTNAl_NBIw_1164_607.png\" alt=\"lALPDhmOtqINirTNAl_NBIw_1164_607\" loading=\"lazy\"></p>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/lALPDgQ9vsVjxDbNAl7NBHk_1145_606.png\" alt=\"lALPDgQ9vsVjxDbNAl7NBHk_1145_606\" loading=\"lazy\"></p>\n<h2 id=\"五、交互式分析hologre\">五、交互式分析Hologre</h2>\n<p>大表慢查询我们虽然用并行查询优化提升了效率,但是一些特定的需求实时报表、实时大屏我们还是无法实现，只能依赖大数据去处理。<br>\n这里推荐大家阿里云的交互式分析Hologre（<br>\n<a href=\"https://help.aliyun.com/product/113622.html%EF%BC%89\">https://help.aliyun.com/product/113622.html）</a></p>\n<p><img src=\"https://fulu-item11-zjk.oss-cn-zhangjiakou.aliyuncs.com/images/20201030151537.png\" alt=\"20201030151537\" loading=\"lazy\"></p>\n<h2 id=\"六、后记\">六、后记</h2>\n<p>千万级大表优化是根据业务场景，以成本为代价优化的，不是一上来就数据库水平切分扩展，这样会给运维和业务带来巨大挑战，很多时候效果不一定好，我们的数据库设计、索引优化、分表策略是否做到位了，应该根据业务需求选择合适的技术去实现。</p>\n<div style=\"display: none\">\n <span id=\"fulu-org\">福禄研发中心群·运维中心</span>\n <span id=\"fulu-author\">OP小雷</span>\n</div>\n<p><img src=\"https://fulu-common-util.oss-cn-hangzhou.aliyuncs.com/wiki_assets/footer-banner.png\"><span class=\"fulu-banner-box\"><span class=\"org\">福禄研发中心群·运维中心</span><br><span>OP小雷</span></span></p></div>"
  },
  {
    "category": "dataBase",
    "qes": "大表优化方案2",
    "ans": "<div class=\"Post-content\" data-zop-usertoken=\"{&quot;userToken&quot;:&quot;he-xie-4-31&quot;}\" data-zop=\"{&quot;authorName&quot;:&quot;蛙课网&quot;,&quot;itemId&quot;:147615129,&quot;title&quot;:&quot;MySQL大表优化方案&quot;,&quot;type&quot;:&quot;article&quot;}\" data-za-detail-view-path-module=\"PostItem\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;token&quot;:&quot;147615129&quot;}}}\"><div class=\"ColumnPageHeader-Wrapper\"><div><div class=\"Sticky ColumnPageHeader is-fixed\" style=\"width: 1903px; top: 0px; left: 0px;\"><div class=\"ColumnPageHeader-content\"><a class=\"ZhihuLogoLink\" href=\"//www.zhihu.com\" aria-label=\"知乎\"><svg viewBox=\"0 0 200 91\" fill=\"#0084FF\" width=\"64\" height=\"30\"><path d=\"M53.29 80.035l7.32.002 2.41 8.24 13.128-8.24h15.477v-67.98H53.29v67.978zm7.79-60.598h22.756v53.22h-8.73l-8.718 5.473-1.587-5.46-3.72-.012v-53.22zM46.818 43.162h-16.35c.545-8.467.687-16.12.687-22.955h15.987s.615-7.05-2.68-6.97H16.807c1.09-4.1 2.46-8.332 4.1-12.708 0 0-7.523 0-10.085 6.74-1.06 2.78-4.128 13.48-9.592 24.41 1.84-.2 7.927-.37 11.512-6.94.66-1.84.785-2.08 1.605-4.54h9.02c0 3.28-.374 20.9-.526 22.95H6.51c-3.67 0-4.863 7.38-4.863 7.38H22.14C20.765 66.11 13.385 79.24 0 89.62c6.403 1.828 12.784-.29 15.937-3.094 0 0 7.182-6.53 11.12-21.64L43.92 85.18s2.473-8.402-.388-12.496c-2.37-2.788-8.768-10.33-11.496-13.064l-4.57 3.627c1.363-4.368 2.183-8.61 2.46-12.71H49.19s-.027-7.38-2.372-7.38zm128.752-.502c6.51-8.013 14.054-18.302 14.054-18.302s-5.827-4.625-8.556-1.27c-1.874 2.548-11.51 15.063-11.51 15.063l6.012 4.51zm-46.903-18.462c-2.814-2.577-8.096.667-8.096.667s12.35 17.2 12.85 17.953l6.08-4.29s-8.02-11.752-10.83-14.33zM199.99 46.5c-6.18 0-40.908.292-40.953.292v-31.56c1.503 0 3.882-.124 7.14-.376 12.773-.753 21.914-1.25 27.427-1.504 0 0 3.817-8.496-.185-10.45-.96-.37-7.24 1.43-7.24 1.43s-51.63 5.153-72.61 5.64c.5 2.756 2.38 5.336 4.93 6.11 4.16 1.087 7.09.53 15.36.277 7.76-.5 13.65-.76 17.66-.76v31.19h-41.71s.88 6.97 7.97 7.14h33.73v22.16c0 4.364-3.498 6.87-7.65 6.6-4.4.034-8.15-.36-13.027-.566.623 1.24 1.977 4.496 6.035 6.824 3.087 1.502 5.054 2.053 8.13 2.053 9.237 0 14.27-5.4 14.027-14.16V53.93h38.235c3.026 0 2.72-7.432 2.72-7.432z\" fill-rule=\"evenodd\"></path></svg></a><div class=\"ColumnPageHeader-Button\"><button type=\"button\" class=\"Button ColumnPageHeader-WriteButton Button--blue\"><svg class=\"Zi Zi--EditSurround\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path d=\"M18.453 7.992l-1.833-1.65.964-.978a1.223 1.223 0 0 1 1.73-.012l.005.006a1.24 1.24 0 0 1 .007 1.748l-.873.886zm-1.178 1.194l-5.578 5.66-1.935.697a.393.393 0 0 1-.504-.504l.697-1.935 5.488-5.567 1.832 1.65zM7.58 5.848l5.654.006-1.539 1.991-3.666.012A1.02 1.02 0 0 0 7 8.868v7.993c0 .558.46 1.01 1.029 1.01l7.941-.01c.568 0 1.03-.453 1.03-1.012v-4.061l2-1.442v6.002c0 1.397-1.2 2.501-2.62 2.501H7.574C6.153 19.85 5 18.717 5 17.32V8.35c0-1.397 1.16-2.502 2.58-2.502z\"></path></svg>写文章</button><div class=\"Popover\"><button title=\"更多\" id=\"Popover1-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover1-content\" type=\"button\" class=\"Button ColumnPageHeader-MenuToggler Button--plain\"><svg class=\"Zi Zi--Dots\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path d=\"M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z\" fill-rule=\"evenodd\"></path></svg></button></div></div></div></div><div class=\"Sticky--holder\" style=\"position: relative; top: 0px; right: 0px; bottom: 0px; left: 0px; display: block; float: none; margin: 0px; height: 52px;\"></div></div></div><article class=\"Post-Main Post-NormalMain\" tabindex=\"-1\"><header class=\"Post-Header\"><h1 class=\"Post-Title\">MySQL大表优化方案</h1><div class=\"Post-Author\"><div class=\"AuthorInfo\" itemprop=\"author\" itemscope=\"\" itemtype=\"http://schema.org/Person\"><meta itemprop=\"name\" content=\"蛙课网\"><meta itemprop=\"image\" content=\"https://pic1.zhimg.com/v2-30aa51ec03d2db32ee481188e0f37fdf_l.jpg?source=172ae18b\"><meta itemprop=\"url\" content=\"https://www.zhihu.com/people/wa-ke-wang\"><meta itemprop=\"zhihu:followerCount\"><span class=\"UserLink AuthorInfo-avatarWrapper\"><div class=\"Popover\"><div id=\"Popover8-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover8-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/org/wa-ke-wang\"><img class=\"Avatar Avatar--round AuthorInfo-avatar\" width=\"38\" height=\"38\" src=\"https://pic1.zhimg.com/v2-30aa51ec03d2db32ee481188e0f37fdf_xs.jpg?source=172ae18b\" srcset=\"https://pic1.zhimg.com/v2-30aa51ec03d2db32ee481188e0f37fdf_l.jpg?source=172ae18b 2x\" alt=\"蛙课网\"></a></div></div></span><div class=\"AuthorInfo-content\"><div class=\"AuthorInfo-head\"><span class=\"UserLink AuthorInfo-name\"><div class=\"Popover\"><div id=\"Popover9-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover9-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/org/wa-ke-wang\">蛙课网</a></div></div><a href=\"https://www.zhihu.com/question/48510028\" target=\"_blank\" class=\"css-n99yhz\" aria-label=\"已认证的官方帐号\" data-tooltip=\"已认证的官方帐号\"><span class=\"css-18biwo\">&#8203;<svg viewBox=\"0 0 24 24\" class=\"css-1ifz0go\" width=\"18\" height=\"18\"><svg viewBox=\"0 0 24 24\" x=\"-3\" y=\"-3\" fill=\"#FFFFFF\" width=\"30\" height=\"30\"><path d=\"M3.56231227,13.8535307 C2.40051305,12.768677 2.41398885,11.0669203 3.59484487,9.99979213 L3.59222085,9.99654885 C4.26730143,9.45036719 4.79446755,8.21005186 4.7184197,7.34453784 L4.72305873,7.34412719 C4.66942824,5.75539997 5.8824188,4.56066914 7.47188965,4.64242381 L7.47229112,4.6386236 C8.33515314,4.72977993 9.58467253,4.22534048 10.1426329,3.55925173 L10.1462611,3.56228565 C11.2316055,2.40008701 12.9353108,2.41394456 14.0015072,3.59634088 L14.0047263,3.59374004 C14.5498229,4.26841874 15.7896857,4.79521622 16.6545744,4.71844347 L16.6549836,4.72304294 C18.245027,4.66894057 19.4396947,5.88213996 19.3575031,7.47241135 L19.3623099,7.47292747 C19.2704388,8.3358681 19.7742711,9.58421483 20.4407199,10.1424506 L20.437686,10.1460789 C21.5997217,11.2312209 21.5860695,12.9345218 20.4042441,14.0007396 L20.4072865,14.0045125 C19.7325967,14.5495925 19.2055209,15.7896954 19.2815865,16.6561959 L19.2770449,16.6565978 C19.3315454,18.2453037 18.1173775,19.4393568 16.5274188,19.3571512 L16.5269029,19.3619539 C15.6647098,19.270083 14.415408,19.7741709 13.8573671,20.4403558 L13.8537409,20.4373235 C12.76842,21.5995708 11.0650432,21.5864553 9.99899434,20.4039226 L9.99527367,20.406923 C9.45025436,19.7323399 8.21017638,19.2051872 7.34461983,19.2812352 L7.344304,19.2776405 C5.75448683,19.3312904 4.55977145,18.1170085 4.64254978,16.527117 L4.63769921,16.5265942 C4.72957031,15.6644394 4.22547659,14.4151814 3.55928015,13.8571569 L3.56231227,13.8535307 Z\"></path></svg><path d=\"M2.63951518,13.3895441 C3.70763333,14.2842292 4.44777637,16.1226061 4.30075305,17.5023312 L4.32211542,17.3063047 C4.17509209,18.6910561 5.17786655,19.7063729 6.5613937,19.5844846 L6.364106,19.6008202 C7.75140298,19.4789319 9.57474349,20.2554985 10.4468305,21.3349009 L10.3224262,21.1803415 C11.1982831,22.2647703 12.6257916,22.2723098 13.5167278,21.2079863 L13.3898102,21.3600325 C14.2845162,20.2919393 16.1229361,19.5518136 17.5026934,19.6988334 L17.3054057,19.6774716 C18.6914461,19.8244915 19.7067866,18.8217404 19.5836389,17.4395022 L19.6012314,17.6367853 C19.4793403,16.2482641 20.255925,14.4249662 21.3353526,13.5528995 L21.1807897,13.677301 C22.2639871,12.8014646 22.2727834,11.3739894 21.2084351,10.483074 L21.3604848,10.6099886 C20.2923667,9.71530351 19.5522236,7.87818322 19.6992469,6.49720154 L19.6778846,6.69448464 C19.8249079,5.30847665 18.8221335,4.2944164 17.4386063,4.41630468 L17.635894,4.39871256 C16.248597,4.52185742 14.4252565,3.74529084 13.5531695,2.66588842 L13.6775738,2.81919121 C12.8017169,1.73601905 11.3742084,1.72722299 10.4832722,2.79154644 L10.6101898,2.63950024 C9.71548377,3.70759343 7.87706394,4.44771919 6.49730661,4.30195588 L6.69459432,4.32206116 C5.30855394,4.17504128 4.29447,5.17904888 4.41636114,6.56128713 L4.3987686,6.36400404 C4.52065973,7.75126861 3.74407501,9.57456653 2.66464737,10.4478898 L2.81921035,10.3222318 C1.73601288,11.1993248 1.72721662,12.6255433 2.79156494,13.5164587 L2.63951518,13.3895441 Z\" fill=\"#0084FF\"></path><svg class=\"Zi Zi--Check\" fill=\"#fff\" x=\"6\" y=\"6\" viewBox=\"0 0 24 24\" width=\"12\" height=\"12\"><path d=\"M10.229 17.516c-.318.327-.75.484-1.199.484-.453 0-.884-.16-1.202-.488l-4.335-4.47a1.77 1.77 0 0 1 .007-2.459 1.663 1.663 0 0 1 2.397.01l3.137 3.246 9.072-9.329a1.662 1.662 0 0 1 2.397 0c.663.681.663 1.786 0 2.466L10.23 17.516z\" fill-rule=\"evenodd\"></path></svg></svg></span></a></span></div><div class=\"AuthorInfo-detail\"><div class=\"AuthorInfo-badge\"><div class=\"ztext AuthorInfo-badgeText\">已认证的官方帐号</div></div></div></div></div><button type=\"button\" class=\"Button FollowButton Button--primary Button--blue\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Plus FollowButton-icon\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M13.491 10.488s-.012-5.387 0-5.998c-.037-1.987-3.035-1.987-2.997 0-.038 1.912 0 5.998 0 5.998H4.499c-1.999.01-1.999 3.009 0 3.009s5.995-.01 5.995-.01v5.999c0 2.019 3.006 2.019 2.997 0-.01-2.019 0-5.998 0-5.998s3.996.009 6.004.009c2.008 0 2.008-3-.01-3.009h-5.994z\" fill-rule=\"evenodd\"></path></svg></span>关注他</button></div><div><span class=\"Voters\"><button type=\"button\" class=\"Button Button--plain\">140 人<!-- -->赞同了该文章</button></span></div></header><div class=\"Post-RichTextContainer\"><div class=\"RichText ztext Post-RichText\"><p>当MySQL单表记录数过大时，增删改查性能都会急剧下降，可以参考以下步骤来优化：</p><h3>单表优化</h3><p>除非单表数据未来会一直不断上涨，否则不要一开始就考虑拆分，拆分会带来逻辑、部署、运维的各种复杂度，一般以整型值为主的表在<code>千万级</code>以下，字符串为主的表在<code>五百万</code>以下是没有太大问题的。而事实上很多时候MySQL单表的性能依然有不少优化空间，甚至能正常支撑千万级以上的数据量：</p><h3>字段</h3><ul><li>尽量使用<code>TINYINT</code>、<code>SMALLINT</code>、<code>MEDIUM_INT</code>作为整数类型而非<code>INT</code>，如果非负则加上<code>UNSIGNED</code></li><li><code>VARCHAR</code>的长度只分配真正需要的空间</li><li>使用枚举或整数代替字符串类型</li><li>尽量使用<code>TIMESTAMP</code>而非<code>DATETIME</code>，</li><li>单表不要有太多字段，建议在20以内</li><li>避免使用NULL字段，很难查询优化且占用额外索引空间</li><li>用整型来存IP</li></ul><h3>索引</h3><ul><li>索引并不是越多越好，要根据查询有针对性的创建，考虑在<code>WHERE</code>和<code>ORDER BY</code>命令上涉及的列建立索引，可根据<code>EXPLAIN</code>来查看是否用了索引还是全表扫描</li><li>应尽量避免在<code>WHERE</code>子句中对字段进行<code>NULL</code>值判断，否则将导致引擎放弃使用索引而进行全表扫描</li><li>值分布很稀少的字段不适合建索引，例如\"性别\"这种只有两三个值的字段</li><li>字符字段只建前缀索引</li><li>字符字段最好不要做主键</li><li>不用外键，由程序保证约束</li><li>尽量不用<code>UNIQUE</code>，由程序保证约束</li><li>使用多列索引时主意顺序和查询条件保持一致，同时删除不必要的单列索引</li></ul><h3>查询SQL</h3><ul><li>可通过开启慢查询日志来找出较慢的SQL</li><li>不做列运算：<code>SELECT id WHERE age + 1 = 10</code>，任何对列的操作都将导致表扫描，它包括数据库教程函数、计算表达式等等，查询时要尽可能将操作移至等号右边</li><li>sql语句尽可能简单：一条sql只能在一个cpu运算；大语句拆小语句，减少锁时间；一条大sql可以堵死整个库</li><li>不用<code>SELECT *</code></li><li><code>OR</code>改写成<code>IN</code>：<code>OR</code>的效率是n级别，<code>IN</code>的效率是log(n)级别，in的个数建议控制在200以内</li><li>不用函数和触发器，在应用程序实现</li><li>避免<code>%xxx</code>式查询</li><li>少用<code>JOIN</code></li><li>使用同类型进行比较，比如用<code>'123'</code>和<code>'123'</code>比，<code>123</code>和<code>123</code>比</li><li>尽量避免在<code>WHERE</code>子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描</li><li>对于连续数值，使用<code>BETWEEN</code>不用<code>IN</code>：<code>SELECT id FROM t WHERE num BETWEEN 1 AND 5</code></li><li>列表数据不要拿全表，要使用<code>LIMIT</code>来分页，每页数量也不要太大</li></ul><h3>引擎</h3><p>目前广泛使用的是MyISAM和InnoDB两种引擎：</p><h3>MyISAM</h3><p>MyISAM引擎是MySQL 5.1及之前版本的默认引擎，它的特点是：</p><ul><li>不支持行锁，读取时对需要读到的所有表加锁，写入时则对表加排它锁</li><li>不支持事务</li><li>不支持外键</li><li>不支持崩溃后的安全恢复</li><li>在表有读取查询的同时，支持往表中插入新纪录</li><li>支持<code>BLOB</code>和<code>TEXT</code>的前500个字符索引，支持全文索引</li><li>支持延迟更新索引，极大提升写入性能</li><li>对于不会进行修改的表，支持压缩表，极大减少磁盘空间占用</li></ul><h3>InnoDB</h3><p>InnoDB在MySQL 5.5后成为默认索引，它的特点是：</p><ul><li>支持行锁，采用MVCC来支持高并发</li><li>支持事务</li><li>支持外键</li><li>支持崩溃后的安全恢复</li><li>不支持全文索引</li></ul><p>总体来讲，MyISAM适合<code>SELECT</code>密集型的表，而InnoDB适合<code>INSERT</code>和<code>UPDATE</code>密集型的表</p><h3>系统调优参数</h3><p>可以使用下面几个工具来做基准测试：</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/akopytov/sysbench\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">sysbench</a>：一个模块化，跨平台以及多线程的性能测试工具</li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/tmcallaghan/iibench-mysql\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">iibench-mysql</a>：基于 Java 的 MySQL/Percona/MariaDB 索引进行插入性能测试工具</li><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/Percona-Lab/tpcc-mysql\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">tpcc-mysql</a>：Percona开发的TPC-C测试工具</li></ul><p>具体的调优参数内容较多，具体可参考官方文档，这里介绍一些比较重要的参数：</p><ul><li>back_log：back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。也就是说，如果MySql的连接数据达到max_connections时，新来的请求将会被存在堆栈中，以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。可以从默认的50升至500</li><li>wait_timeout：数据库连接闲置时间，闲置连接会占用内存资源。可以从默认的8小时减到半小时</li><li>max_user_connection: 最大连接数，默认为0无上限，最好设一个合理上限</li><li>thread_concurrency：并发线程数，设为CPU核数的两倍</li><li>skip_name_resolve：禁止对外部连接进行DNS解析，消除DNS解析时间，但需要所有远程主机用IP访问</li><li>key_buffer_size：索引块的缓存大小，增加会提升索引处理速度，对MyISAM表性能影响最大。对于内存4G左右，可设为256M或384M，通过查询<code>show status like 'key_read%'</code>，保证<code>key_reads / key_read_requests</code>在0.1%以下最好</li><li>innodb_buffer_pool_size：缓存数据块和索引块，对InnoDB表性能影响最大。通过查询<code>show status like 'Innodb_buffer_pool_read%'</code>，保证 <code>(Innodb_buffer_pool_read_requests – Innodb_buffer_pool_reads) / Innodb_buffer_pool_read_requests</code>越高越好</li><li>innodb_additional_mem_pool_size：InnoDB存储引擎用来存放数据字典信息以及一些内部数据结构的内存空间大小，当数据库对象非常多的时候，适当调整该参数的大小以确保所有数据都能存放在内存中提高访问效率，当过小的时候，MySQL会记录Warning信息到数据库的错误日志中，这时就需要该调整这个参数大小</li><li>innodb_log_buffer_size：InnoDB存储引擎的事务日志所使用的缓冲区，一般来说不建议超过32MB</li><li>query_cache_size：缓存MySQL中的ResultSet，也就是一条SQL语句执行的结果集，所以仅仅只能针对select语句。当某个表的数据有任何任何变化，都会导致所有引用了该表的select语句在Query Cache中的缓存数据失效。所以，当我们的数据变化非常频繁的情况下，使用Query Cache可能会得不偿失。根据命中率<code>(Qcache_hits/(Qcache_hits+Qcache_inserts)*100))</code>进行调整，一般不建议太大，256MB可能已经差不多了，大型的配置型静态数据可适当调大.<br>可以通过命令<code>show status like 'Qcache_%'</code>查看目前系统Query catch使用大小</li><li>read_buffer_size：MySql读入缓冲区大小。对表进行顺序扫描的请求将分配一个读入缓冲区，MySql会为它分配一段内存缓冲区。如果对表的顺序扫描请求非常频繁，可以通过增加该变量值以及内存缓冲区大小提高其性能</li><li>sort_buffer_size：MySql执行排序使用的缓冲大小。如果想要增加<code>ORDER BY</code>的速度，首先看是否可以让MySQL使用索引而不是额外的排序阶段。如果不能，可以尝试增加sort_buffer_size变量的大小</li><li>read_rnd_buffer_size：MySql的随机读缓冲区大小。当按任意顺序读取行时(例如，按照排序顺序)，将分配一个随机读缓存区。进行排序查询时，MySql会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。但MySql会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大。</li><li>record_buffer：每个进行一个顺序扫描的线程为其扫描的每张表分配这个大小的一个缓冲区。如果你做很多顺序扫描，可能想要增加该值</li><li>thread_cache_size：保存当前没有与连接关联但是准备为后面新的连接服务的线程，可以快速响应连接的线程请求而无需创建新的</li><li>table_cache：类似于thread_cache_size，但用来缓存表文件，对InnoDB效果不大，主要用于MyISAM</li></ul><h3>升级硬件</h3><p>Scale up，这个不多说了，根据MySQL是CPU密集型还是I/O密集型，通过提升CPU和内存、使用SSD，都能显著提升MySQL性能</p><h3>读写分离</h3><p>也是目前常用的优化，从库读主库写，一般不要采用双主或多主引入很多复杂性，尽量采用文中的其他方案来提高性能。同时目前很多拆分的解决方案同时也兼顾考虑了读写分离</p><h3>缓存</h3><p>缓存可以发生在这些层次：</p><ul><li>MySQL内部：在系统调优参数介绍了相关设置</li><li>数据访问层：比如MyBatis针对SQL语句做缓存，而Hibernate可以精确到单个记录，这里缓存的对象主要是持久化对象<code>Persistence Object</code></li><li>应用服务层：这里可以通过编程手段对缓存做到更精准的控制和更多的实现策略，这里缓存的对象是数据传输对象<code>Data Transfer Object</code></li><li>Web层：针对web页面做缓存</li><li>浏览器客户端：用户端的缓存</li></ul><p>可以根据实际情况在一个层次或多个层次结合加入缓存。这里重点介绍下服务层的缓存实现，目前主要有两种方式：</p><ul><li>直写式（Write Through）：在数据写入数据库后，同时更新缓存，维持数据库与缓存的一致性。这也是当前大多数应用缓存框架如Spring Cache的工作方式。这种实现非常简单，同步好，但效率一般。</li><li>回写式（Write Back）：当有数据要写入数据库时，只会更新缓存，然后异步批量的将缓存数据同步到数据库上。这种实现比较复杂，需要较多的应用逻辑，同时可能会产生数据库与缓存的不同步，但效率非常高。</li></ul><h3>表分区</h3><p>MySQL在5.1版引入的分区是一种简单的水平拆分，用户需要在建表的时候加上分区参数，对应用是透明的无需修改代码</p><p>对用户来说，分区表是一个独立的逻辑表，但是底层由多个物理子表组成，实现分区的代码实际上是通过对一组底层表的对象封装，但对SQL层来说是一个完全封装底层的黑盒子。MySQL实现分区的方式也意味着索引也是按照分区的子表定义，没有全局索引</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-16cb226deb71f00b5e73c22c81b2bb27_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"540\" data-rawheight=\"344\" class=\"origin_image zh-lightbox-thumb\" width=\"540\" data-original=\"https://pic4.zhimg.com/v2-16cb226deb71f00b5e73c22c81b2bb27_r.jpg\"/></noscript><img src=\"https://pic4.zhimg.com/80/v2-16cb226deb71f00b5e73c22c81b2bb27_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"540\" data-rawheight=\"344\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"540\" data-original=\"https://pic4.zhimg.com/v2-16cb226deb71f00b5e73c22c81b2bb27_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-16cb226deb71f00b5e73c22c81b2bb27_b.jpg\" data-lazy-status=\"ok\"></figure><p>用户的SQL语句是需要针对分区表做优化，SQL条件中要带上分区条件的列，从而使查询定位到少量的分区上，否则就会扫描全部分区，可以通过<code>EXPLAIN PARTITIONS</code>来查看某条SQL语句会落在那些分区上，从而进行SQL优化，如下图5条记录落在两个分区上：</p><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">mysql</span><span class=\"o\">&gt;</span> <span class=\"n\">explain</span> <span class=\"n\">partitions</span> <span class=\"n\">select</span> <span class=\"nf\">count</span><span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">)</span> <span class=\"n\">from</span> <span class=\"n\">user_partition</span> <span class=\"n\">where</span> <span class=\"n\">id</span> <span class=\"nf\">in</span> <span class=\"o\">(</span><span class=\"n\">1</span><span class=\"o\">,</span><span class=\"n\">2</span><span class=\"o\">,</span><span class=\"n\">3</span><span class=\"o\">,</span><span class=\"n\">4</span><span class=\"o\">,</span><span class=\"n\">5</span><span class=\"o\">);</span>\n<span class=\"o\">+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+</span>\n<span class=\"o\">|</span> <span class=\"n\">id</span> <span class=\"o\">|</span> <span class=\"n\">select_type</span> <span class=\"o\">|</span> <span class=\"n\">table</span>          <span class=\"o\">|</span> <span class=\"n\">partitions</span> <span class=\"o\">|</span> <span class=\"n\">type</span>  <span class=\"o\">|</span> <span class=\"n\">possible_keys</span> <span class=\"o\">|</span> <span class=\"n\">key</span>     <span class=\"o\">|</span> <span class=\"n\">key_len</span> <span class=\"o\">|</span> <span class=\"n\">ref</span>  <span class=\"o\">|</span> <span class=\"n\">rows</span> <span class=\"o\">|</span> <span class=\"n\">Extra</span>                    <span class=\"o\">|</span>\n<span class=\"o\">+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+</span>\n<span class=\"o\">|</span>  <span class=\"n\">1</span> <span class=\"o\">|</span> <span class=\"n\">SIMPLE</span>      <span class=\"o\">|</span> <span class=\"n\">user_partition</span> <span class=\"o\">|</span> <span class=\"n\">p1</span><span class=\"o\">,</span><span class=\"n\">p4</span>      <span class=\"o\">|</span> <span class=\"n\">range</span> <span class=\"o\">|</span> <span class=\"n\">PRIMARY</span>       <span class=\"o\">|</span> <span class=\"n\">PRIMARY</span> <span class=\"o\">|</span> <span class=\"n\">8</span>       <span class=\"o\">|</span> <span class=\"n\">NULL</span> <span class=\"o\">|</span>    <span class=\"n\">5</span> <span class=\"o\">|</span> <span class=\"n\">Using</span> <span class=\"n\">where</span><span class=\"o\">;</span> <span class=\"n\">Using</span> <span class=\"n\">index</span> <span class=\"o\">|</span>\n<span class=\"o\">+----+-------------+----------------+------------+-------+---------------+---------+---------+------+------+--------------------------+</span>\n<span class=\"n\">1</span> <span class=\"n\">row</span> <span class=\"n\">in</span> <span class=\"nf\">set</span> <span class=\"o\">(</span><span class=\"n\">0</span><span class=\"o\">.</span><span class=\"na\">00</span> <span class=\"n\">sec</span><span class=\"o\">)</span></code></pre></div><p>分区的好处是：</p><ul><li>可以让单表存储更多的数据</li><li>分区表的数据更容易维护，可以通过清楚整个分区批量删除大量数据，也可以增加新的分区来支持新插入的数据。另外，还可以对一个独立分区进行优化、检查、修复等操作</li><li>部分查询能够从查询条件确定只落在少数分区上，速度会很快</li><li>分区表的数据还可以分布在不同的物理设备上，从而搞笑利用多个硬件设备</li><li>可以使用分区表赖避免某些特殊瓶颈，例如InnoDB单个索引的互斥访问、ext3文件系统的inode锁竞争</li><li>可以备份和恢复单个分区</li></ul><p>分区的限制和缺点：</p><ul><li>一个表最多只能有1024个分区</li><li>如果分区字段中有主键或者唯一索引的列，那么所有主键列和唯一索引列都必须包含进来</li><li>分区表无法使用外键约束</li><li>NULL值会使分区过滤无效</li><li>所有分区必须使用相同的存储引擎</li></ul><p>分区的类型：</p><ul><li>RANGE分区：基于属于一个给定连续区间的列值，把多行分配给分区</li><li>LIST分区：类似于按RANGE分区，区别在于LIST分区是基于列值匹配一个离散值集合中的某个值来进行选择</li><li>HASH分区：基于用户定义的表达式的返回值来进行选择的分区，该表达式使用将要插入到表中的这些行的列值进行计算。这个函数可以包含MySQL中有效的、产生非负整数值的任何表达式</li><li>KEY分区：类似于按HASH分区，区别在于KEY分区只支持计算一列或多列，且MySQL服务器提供其自身的哈希函数。必须有一列或多列包含整数值</li></ul><p>分区适合的场景有：</p><ul><li>最适合的场景数据的时间序列性比较强，则可以按时间来分区，如下所示：</li></ul><div class=\"highlight\"><pre><code class=\"language-java\"><span class=\"n\">CREATE</span> <span class=\"n\">TABLE</span> <span class=\"nf\">members</span> <span class=\"o\">(</span>\n    <span class=\"n\">firstname</span> <span class=\"nf\">VARCHAR</span><span class=\"o\">(</span><span class=\"n\">25</span><span class=\"o\">)</span> <span class=\"n\">NOT</span> <span class=\"n\">NULL</span><span class=\"o\">,</span>\n    <span class=\"n\">lastname</span> <span class=\"nf\">VARCHAR</span><span class=\"o\">(</span><span class=\"n\">25</span><span class=\"o\">)</span> <span class=\"n\">NOT</span> <span class=\"n\">NULL</span><span class=\"o\">,</span>\n    <span class=\"n\">username</span> <span class=\"nf\">VARCHAR</span><span class=\"o\">(</span><span class=\"n\">16</span><span class=\"o\">)</span> <span class=\"n\">NOT</span> <span class=\"n\">NULL</span><span class=\"o\">,</span>\n    <span class=\"n\">email</span> <span class=\"nf\">VARCHAR</span><span class=\"o\">(</span><span class=\"n\">35</span><span class=\"o\">),</span>\n    <span class=\"n\">joined</span> <span class=\"n\">DATE</span> <span class=\"n\">NOT</span> <span class=\"n\">NULL</span>\n<span class=\"o\">)</span>\n<span class=\"n\">PARTITION</span> <span class=\"n\">BY</span> <span class=\"nf\">RANGE</span><span class=\"o\">(</span> <span class=\"n\">YEAR</span><span class=\"o\">(</span><span class=\"n\">joined</span><span class=\"o\">)</span> <span class=\"o\">)</span> <span class=\"o\">(</span>\n    <span class=\"n\">PARTITION</span> <span class=\"n\">p0</span> <span class=\"n\">VALUES</span> <span class=\"n\">LESS</span> <span class=\"nf\">THAN</span> <span class=\"o\">(</span><span class=\"n\">1960</span><span class=\"o\">),</span>\n    <span class=\"n\">PARTITION</span> <span class=\"n\">p1</span> <span class=\"n\">VALUES</span> <span class=\"n\">LESS</span> <span class=\"nf\">THAN</span> <span class=\"o\">(</span><span class=\"n\">1970</span><span class=\"o\">),</span>\n    <span class=\"n\">PARTITION</span> <span class=\"n\">p2</span> <span class=\"n\">VALUES</span> <span class=\"n\">LESS</span> <span class=\"nf\">THAN</span> <span class=\"o\">(</span><span class=\"n\">1980</span><span class=\"o\">),</span>\n    <span class=\"n\">PARTITION</span> <span class=\"n\">p3</span> <span class=\"n\">VALUES</span> <span class=\"n\">LESS</span> <span class=\"nf\">THAN</span> <span class=\"o\">(</span><span class=\"n\">1990</span><span class=\"o\">),</span>\n    <span class=\"n\">PARTITION</span> <span class=\"n\">p4</span> <span class=\"n\">VALUES</span> <span class=\"n\">LESS</span> <span class=\"n\">THAN</span> <span class=\"n\">MAXVALUE</span>\n<span class=\"o\">);</span></code></pre></div><p>查询时加上时间范围条件效率会非常高，同时对于不需要的历史数据能很容的批量删除。</p><ul><li>如果数据有明显的热点，而且除了这部分数据，其他数据很少被访问到，那么可以将热点数据单独放在一个分区，让这个分区的数据能够有机会都缓存在内存中，查询时只访问一个很小的分区表，能够有效使用索引和缓存</li></ul><p>另外MySQL有一种早期的简单的分区实现 - 合并表（merge table），限制较多且缺乏优化，不建议使用，应该用新的分区机制来替代</p><h3>垂直拆分</h3><p>垂直分库是根据数据库里面的数据表的相关性进行拆分，比如：一个数据库里面既存在用户数据，又存在订单数据，那么垂直拆分可以把用户数据放到用户库、把订单数据放到订单库。垂直分表是对数据表进行垂直拆分的一种方式，常见的是把一个多字段的大表按常用字段和非常用字段进行拆分，每个表里面的数据记录数一般情况下是相同的，只是字段不一样，使用主键关联</p><p>比如原始的用户表是：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-c18c5e6e4842435e4237bfd7385c2b69_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"203\" class=\"origin_image zh-lightbox-thumb\" width=\"530\" data-original=\"https://pic2.zhimg.com/v2-c18c5e6e4842435e4237bfd7385c2b69_r.jpg\"/></noscript><img src=\"https://pic2.zhimg.com/80/v2-c18c5e6e4842435e4237bfd7385c2b69_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"203\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"530\" data-original=\"https://pic2.zhimg.com/v2-c18c5e6e4842435e4237bfd7385c2b69_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-c18c5e6e4842435e4237bfd7385c2b69_b.jpg\" data-lazy-status=\"ok\"></figure><p>垂直拆分后是：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-a10e2b1859de4a9a51670b39bd36094a_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"182\" class=\"origin_image zh-lightbox-thumb\" width=\"530\" data-original=\"https://pic3.zhimg.com/v2-a10e2b1859de4a9a51670b39bd36094a_r.jpg\"/></noscript><img src=\"https://pic3.zhimg.com/80/v2-a10e2b1859de4a9a51670b39bd36094a_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"182\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"530\" data-original=\"https://pic3.zhimg.com/v2-a10e2b1859de4a9a51670b39bd36094a_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-a10e2b1859de4a9a51670b39bd36094a_b.jpg\" data-lazy-status=\"ok\"></figure><p>垂直拆分的优点是：</p><ul><li>可以使得行数据变小，一个数据块(Block)就能存放更多的数据，在查询时就会减少I/O次数(每次查询时读取的Block 就少)</li><li>可以达到最大化利用Cache的目的，具体在垂直拆分的时候可以将不常变的字段放一起，将经常改变的放一起</li><li>数据维护简单</li></ul><p>缺点是：</p><ul><li>主键出现冗余，需要管理冗余列</li><li>会引起表连接JOIN操作（增加CPU开销）可以通过在业务服务器上进行join来减少数据库压力</li><li>依然存在单表数据量过大的问题（需要水平拆分）</li><li>事务处理复杂</li></ul><h3>水平拆分</h3><h3>概述</h3><p>水平拆分是通过某种策略将数据分片来存储，分库内分表和分库两部分，每片数据会分散到不同的MySQL表或库，达到分布式的效果，能够支持非常大的数据量。前面的表分区本质上也是一种特殊的库内分表</p><p>库内分表，仅仅是单纯的解决了单一表数据过大的问题，由于没有把表的数据分布到不同的机器上，因此对于减轻MySQL服务器的压力来说，并没有太大的作用，大家还是竞争同一个物理机上的IO、CPU、网络，这个就要通过分库来解决</p><p>前面垂直拆分的用户表如果进行水平拆分，结果是：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic3.zhimg.com/v2-4fdc484953ec9c304c1d128dff94861e_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb\" width=\"530\" data-original=\"https://pic3.zhimg.com/v2-4fdc484953ec9c304c1d128dff94861e_r.jpg\"/></noscript><img src=\"https://pic3.zhimg.com/80/v2-4fdc484953ec9c304c1d128dff94861e_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"530\" data-rawheight=\"271\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"530\" data-original=\"https://pic3.zhimg.com/v2-4fdc484953ec9c304c1d128dff94861e_r.jpg\" data-actualsrc=\"https://pic3.zhimg.com/v2-4fdc484953ec9c304c1d128dff94861e_b.jpg\" data-lazy-status=\"ok\"></figure><p>实际情况中往往会是垂直拆分和水平拆分的结合，即将<code>Users_A_M</code>和<code>Users_N_Z</code>再拆成<code>Users</code>和<code>UserExtras</code>，这样一共四张表</p><p>水平拆分的优点是:</p><ul><li>不存在单库大数据和高并发的性能瓶颈</li><li>应用端改造较少</li><li>提高了系统的稳定性和负载能力</li></ul><p>缺点是：</p><ul><li>分片事务一致性难以解决</li><li>跨节点Join性能差，逻辑复杂</li><li>数据多次扩展难度跟维护量极大</li></ul><h3>分片原则</h3><ul><li>能不分就不分，参考单表优化</li><li>分片数量尽量少，分片尽量均匀分布在多个数据结点上，因为一个查询SQL跨分片越多，则总体性能越差，虽然要好于所有数据在一个分片的结果，只在必要的时候进行扩容，增加分片数量</li><li>分片规则需要慎重选择做好提前规划，分片规则的选择，需要考虑数据的增长模式，数据的访问模式，分片关联性问题，以及分片扩容问题，最近的分片策略为范围分片，枚举分片，一致性Hash分片，这几种分片都有利于扩容</li><li>尽量不要在一个事务中的SQL跨越多个分片，分布式事务一直是个不好处理的问题</li><li>查询条件尽量优化，尽量避免Select * 的方式，大量数据结果集下，会消耗大量带宽和CPU资源，查询尽量避免返回大量结果集，并且尽量为频繁使用的查询语句建立索引。</li><li>通过数据冗余和表分区赖降低跨库Join的可能</li></ul><p>这里特别强调一下分片规则的选择问题，如果某个表的数据有明显的时间特征，比如订单、交易记录等，则他们通常比较合适用时间范围分片，因为具有时效性的数据，我们往往关注其近期的数据，查询条件中往往带有时间字段进行过滤，比较好的方案是，当前活跃的数据，采用跨度比较短的时间段进行分片，而历史性的数据，则采用比较长的跨度存储。</p><p>总体上来说，分片的选择是取决于最频繁的查询SQL的条件，因为不带任何Where语句的查询SQL，会遍历所有的分片，性能相对最差，因此这种SQL越多，对系统的影响越大，所以我们要尽量避免这种SQL的产生。</p><h3>解决方案</h3><p>由于水平拆分牵涉的逻辑比较复杂，当前也有了不少比较成熟的解决方案。这些方案分为两大类：客户端架构和代理架构。</p><h3>客户端架构</h3><p>通过修改数据访问层，如JDBC、Data Source、MyBatis，通过配置来管理多个数据源，直连数据库，并在模块内完成数据的分片整合，一般以Jar包的方式呈现</p><p>这是一个客户端架构的例子：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic1.zhimg.com/v2-5fca039fd8512b61971fd061207e9f24_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"553\" class=\"origin_image zh-lightbox-thumb\" width=\"800\" data-original=\"https://pic1.zhimg.com/v2-5fca039fd8512b61971fd061207e9f24_r.jpg\"/></noscript><img src=\"https://pic1.zhimg.com/80/v2-5fca039fd8512b61971fd061207e9f24_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"800\" data-rawheight=\"553\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"800\" data-original=\"https://pic1.zhimg.com/v2-5fca039fd8512b61971fd061207e9f24_r.jpg\" data-actualsrc=\"https://pic1.zhimg.com/v2-5fca039fd8512b61971fd061207e9f24_b.jpg\" data-lazy-status=\"ok\"></figure><p>可以看到分片的实现是和应用服务器在一起的，通过修改Spring JDBC层来实现</p><p>客户端架构的优点是：</p><ul><li>应用直连数据库，降低外围系统依赖所带来的宕机风险</li><li>集成成本低，无需额外运维的组件</li></ul><p>缺点是：</p><ul><li>限于只能在数据库访问层上做文章，扩展性一般，对于比较复杂的系统可能会力不从心</li><li>将分片逻辑的压力放在应用服务器上，造成额外风险</li></ul><h3>代理架构</h3><p>通过独立的中间件来统一管理所有数据源和数据分片整合，后端数据库集群对前端应用程序透明，需要独立部署和运维代理组件</p><p>这是一个代理架构的例子：</p><figure data-size=\"normal\"><noscript><img src=\"https://pic4.zhimg.com/v2-87986f6244cc63c5efb17cdafaaba043_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"505\" data-rawheight=\"282\" class=\"origin_image zh-lightbox-thumb\" width=\"505\" data-original=\"https://pic4.zhimg.com/v2-87986f6244cc63c5efb17cdafaaba043_r.jpg\"/></noscript><img src=\"https://pic4.zhimg.com/80/v2-87986f6244cc63c5efb17cdafaaba043_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"505\" data-rawheight=\"282\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"505\" data-original=\"https://pic4.zhimg.com/v2-87986f6244cc63c5efb17cdafaaba043_r.jpg\" data-actualsrc=\"https://pic4.zhimg.com/v2-87986f6244cc63c5efb17cdafaaba043_b.jpg\" data-lazy-status=\"ok\"></figure><p>代理组件为了分流和防止单点，一般以集群形式存在，同时可能需要Zookeeper之类的服务组件来管理</p><p>代理架构的优点是：</p><ul><li>能够处理非常复杂的需求，不受数据库访问层原来实现的限制，扩展性强</li><li>对于应用服务器透明且没有增加任何额外负载</li></ul><p>缺点是：</p><ul><li>需部署和运维独立的代理中间件，成本高</li><li>应用需经过代理来连接数据库，网络上多了一跳，性能有损失且有额外风险 </li></ul><p><b>各方案比较</b></p><figure data-size=\"normal\"><noscript><img src=\"https://pic2.zhimg.com/v2-4d15fcc0d7a2d7a16fa2ce3e93ae9a8d_b.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"541\" class=\"origin_image zh-lightbox-thumb\" width=\"640\" data-original=\"https://pic2.zhimg.com/v2-4d15fcc0d7a2d7a16fa2ce3e93ae9a8d_r.jpg\"/></noscript><img src=\"https://pic2.zhimg.com/80/v2-4d15fcc0d7a2d7a16fa2ce3e93ae9a8d_720w.jpg\" data-caption=\"\" data-size=\"normal\" data-rawwidth=\"640\" data-rawheight=\"541\" class=\"origin_image zh-lightbox-thumb lazy\" width=\"640\" data-original=\"https://pic2.zhimg.com/v2-4d15fcc0d7a2d7a16fa2ce3e93ae9a8d_r.jpg\" data-actualsrc=\"https://pic2.zhimg.com/v2-4d15fcc0d7a2d7a16fa2ce3e93ae9a8d_b.jpg\" data-lazy-status=\"ok\"></figure><p>如此多的方案，如何进行选择？可以按以下思路来考虑：</p><ol><li>确定是使用代理架构还是客户端架构。中小型规模或是比较简单的场景倾向于选择客户端架构，复杂场景或大规模系统倾向选择代理架构</li><li>具体功能是否满足，比如需要跨节点<code>ORDER BY</code>，那么支持该功能的优先考虑</li><li>不考虑一年内没有更新的产品，说明开发停滞，甚至无人维护和技术支持</li><li>最好按大公司-&gt;社区-&gt;小公司-&gt;个人这样的出品方顺序来选择</li><li>选择口碑较好的，比如github星数、使用者数量质量和使用者反馈</li><li>开源的优先，往往项目有特殊需求可能需要改动源代码</li></ol><p>按照上述思路，推荐以下选择：</p><ul><li>客户端架构：ShardingJDBC</li><li>代理架构：MyCat或者Atlas</li></ul><h3>兼容MySQL且可水平扩展的数据库</h3><p>目前也有一些开源数据库兼容MySQL协议，如：</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//github.com/pingcap/tidb\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">TiDB</a></li><li><a href=\"https://link.zhihu.com/?target=http%3A//www.cubrid.org/\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">Cubrid</a></li></ul><p>但其工业品质和MySQL尚有差距，且需要较大的运维投入，如果想将原始的MySQL迁移到可水平扩展的新数据库中，可以考虑一些云数据库：</p><ul><li><a href=\"https://link.zhihu.com/?target=https%3A//cn.aliyun.com/product/petadata/%3Fspm%3D5176.7960203.237031.38.cAzx5r\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">阿里云PetaData</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//cn.aliyun.com/product/oceanbase%3Fspm%3D5176.7960203.237031.40.cAzx5r\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">阿里云OceanBase</a></li><li><a href=\"https://link.zhihu.com/?target=https%3A//www.qcloud.com/product/dcdb_for_tdsql.html\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">腾讯云DCDB</a></li></ul><h3>NoSQL</h3><p>在MySQL上做Sharding是一种戴着镣铐的跳舞，事实上很多大表本身对MySQL这种RDBMS的需求并不大，并不要求ACID，可以考虑将这些表迁移到NoSQL，彻底解决水平扩展问题，例如：</p><ul><li>日志类、监控类、统计类数据</li><li>非结构化或弱结构化数据</li><li>对事务要求不强，且无太多关联操作的数据</li></ul><p>来源：思否</p><p>作者：manong</p><p>原文：<a href=\"https://link.zhihu.com/?target=http%3A//segmentfault.com/a/1190000006158186\" class=\" wrap external\" target=\"_blank\" rel=\"nofollow noreferrer\" data-za-detail-view-id=\"1043\">segmentfault.com/a/1190000006158186</a> </p><p></p><p></p><p></p></div></div><div class=\"ContentItem-time\">编辑于 06-11</div><div class=\"Post-topicsAndReviewer\"><div class=\"TopicList Post-Topics\"><div class=\"Tag Topic\" data-za-detail-view-path-module=\"TopicItem\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19552067&quot;}}}\"><span class=\"Tag-content\"><a class=\"TopicLink\" href=\"//www.zhihu.com/topic/19552067\" target=\"_blank\"><div class=\"Popover\"><div id=\"Popover2-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover2-content\">数据库</div></div></a></span></div><div class=\"Tag Topic\" data-za-detail-view-path-module=\"TopicItem\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;20075899&quot;}}}\"><span class=\"Tag-content\"><a class=\"TopicLink\" href=\"//www.zhihu.com/topic/20075899\" target=\"_blank\"><div class=\"Popover\"><div id=\"Popover3-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover3-content\">MySQL DBA</div></div></a></span></div><div class=\"Tag Topic\" data-za-detail-view-path-module=\"TopicItem\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Topic&quot;,&quot;token&quot;:&quot;19554128&quot;}}}\"><span class=\"Tag-content\"><a class=\"TopicLink\" href=\"//www.zhihu.com/topic/19554128\" target=\"_blank\"><div class=\"Popover\"><div id=\"Popover4-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover4-content\">MySQL</div></div></a></span></div></div></div><div><div class=\"Sticky RichContent-actions is-fixed is-bottom\" style=\"width: 690px; bottom: 0px; left: 606.5px;\"><div class=\"ContentItem-actions\" data-za-detail-view-path-module=\"BottomBar\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;147615129&quot;}}}\"><span><button aria-label=\"赞同 140 \" type=\"button\" class=\"Button VoteButton VoteButton--up\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--TriangleUp VoteButton-TriangleUp\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"10\" height=\"10\"><path d=\"M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z\" fill-rule=\"evenodd\"></path></svg></span>赞同 140</button><button aria-label=\"反对\" type=\"button\" class=\"Button VoteButton VoteButton--down\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--TriangleDown\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"10\" height=\"10\"><path d=\"M20.044 3H3.956C2.876 3 2 3.517 2 4.9c0 .326.087.533.236.896L10.216 19c.355.571.87 1.143 1.784 1.143s1.429-.572 1.784-1.143l7.98-13.204c.149-.363.236-.57.236-.896 0-1.386-.876-1.9-1.956-1.9z\" fill-rule=\"evenodd\"></path></svg></span></button></span><button type=\"button\" class=\"Button BottomActions-CommentBtn Button--plain Button--withIcon Button--withLabel\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Comment Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M10.241 19.313a.97.97 0 0 0-.77.2 7.908 7.908 0 0 1-3.772 1.482.409.409 0 0 1-.38-.637 5.825 5.825 0 0 0 1.11-2.237.605.605 0 0 0-.227-.59A7.935 7.935 0 0 1 3 11.25C3 6.7 7.03 3 12 3s9 3.7 9 8.25-4.373 9.108-10.759 8.063z\" fill-rule=\"evenodd\"></path></svg></span>4 条评论</button><div class=\"Popover ShareMenu\"><div class=\"ShareMenu-toggler\" id=\"Popover5-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover5-content\"><button type=\"button\" class=\"Button Button--plain Button--withIcon Button--withLabel\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Share Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z\" fill-rule=\"evenodd\"></path></svg></span>分享</button></div></div><button type=\"button\" class=\"Button ContentItem-action Button--plain Button--withIcon Button--withLabel\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Heart Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M2 8.437C2 5.505 4.294 3.094 7.207 3 9.243 3 11.092 4.19 12 6c.823-1.758 2.649-3 4.651-3C19.545 3 22 5.507 22 8.432 22 16.24 13.842 21 12 21 10.158 21 2 16.24 2 8.437z\" fill-rule=\"evenodd\"></path></svg></span>喜欢</button><button type=\"button\" class=\"Button ContentItem-action Button--plain Button--withIcon Button--withLabel\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Star Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M5.515 19.64l.918-5.355-3.89-3.792c-.926-.902-.639-1.784.64-1.97L8.56 7.74l2.404-4.871c.572-1.16 1.5-1.16 2.072 0L15.44 7.74l5.377.782c1.28.186 1.566 1.068.64 1.97l-3.89 3.793.918 5.354c.219 1.274-.532 1.82-1.676 1.218L12 18.33l-4.808 2.528c-1.145.602-1.896.056-1.677-1.218z\" fill-rule=\"evenodd\"></path></svg></span>收藏</button><button type=\"button\" class=\"Button ContentItem-action Button--plain Button--withIcon Button--withLabel\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Deliver Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M5.171 4H18.83a1.5 1.5 0 0 1 1.455 1.136l2.597 10.386a4 4 0 0 1 .119.97V19s0 2-2.002 2H3c-2 0-2-2-2-2v-2.508a4 4 0 0 1 .12-.97L3.715 5.136A1.5 1.5 0 0 1 5.171 4zm1.074 2a1 1 0 0 0-.97.761l-2.123 8.62a.5.5 0 0 0 .486.619h4.717a1 1 0 0 1 .892.548C9.906 17.85 10.824 18.5 12 18.5c1.176 0 2.094-.65 2.753-1.952a1 1 0 0 1 .892-.548h4.717a.5.5 0 0 0 .486-.62l-2.122-8.619A1 1 0 0 0 17.755 6H6.245zM8 9c0-.552.453-1 .997-1h6.006c.55 0 .997.444.997 1 0 .552-.453 1-.997 1H8.997A.996.996 0 0 1 8 9zm-1.5 4c0-.552.445-1 .996-1h9.008c.55 0 .996.444.996 1 0 .552-.445 1-.996 1H7.496a.995.995 0 0 1-.996-1z\"></path></svg></span>申请转载</button><div class=\"Post-ActionMenuButton\"><div class=\"Popover\"><div id=\"Popover6-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover6-content\"><button type=\"button\" class=\"Button Button--plain Button--withIcon Button--iconOnly\"><span style=\"display:inline-flex;align-items:center\">&#8203;<svg class=\"Zi Zi--Dots Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M5 14a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm7 0a2 2 0 1 1 0-4 2 2 0 0 1 0 4z\" fill-rule=\"evenodd\"></path></svg></span></button></div></div></div></div><div class=\"Post-SideActions\" data-za-detail-view-path-module=\"LeftTabBar\" data-za-extra-module=\"{&quot;card&quot;:{&quot;content&quot;:{&quot;type&quot;:&quot;Post&quot;,&quot;id&quot;:&quot;147615129&quot;}}}\" style=\"opacity: 1;\"><button class=\"like\"><div class=\"Post-SideActions-icon\"><svg class=\"Zi Zi--TriangleUp Post-SideActions-upIcon\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\"><path d=\"M2 18.242c0-.326.088-.532.237-.896l7.98-13.203C10.572 3.57 11.086 3 12 3c.915 0 1.429.571 1.784 1.143l7.98 13.203c.15.364.236.57.236.896 0 1.386-.875 1.9-1.955 1.9H3.955c-1.08 0-1.955-.517-1.955-1.9z\" fill-rule=\"evenodd\"></path></svg></div><div class=\"likeCount\"><div class=\"likeCount-inner\" data-previous=\"已赞同 141\">赞同 140</div></div></button><div class=\"Popover ShareMenu\"><div class=\"ShareMenu-toggler\" id=\"Popover17-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover17-content\"><button><div class=\"Post-SideActions-icon\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Share\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"20\" height=\"20\"><path d=\"M2.931 7.89c-1.067.24-1.275 1.669-.318 2.207l5.277 2.908 8.168-4.776c.25-.127.477.198.273.39L9.05 14.66l.927 5.953c.18 1.084 1.593 1.376 2.182.456l9.644-15.242c.584-.892-.212-2.029-1.234-1.796L2.93 7.89z\" fill-rule=\"evenodd\"></path></svg></span></div>分享</button></div></div></div></div><div class=\"Sticky--holder\" style=\"position: static; top: auto; right: auto; bottom: 0px; left: 0px; display: block; float: none; margin: 0px 0px 10px; height: 54px;\"></div></div></article><div class=\"Post-Sub Post-NormalSub\"><div class=\"Recommendations-Main\" style=\"width: 1903px;\"><h3 class=\"BlockTitle Recommendations-BlockTitle\">推荐阅读</h3><ul class=\"Recommendations-List\"><button class=\"PagingButton PagingButton-Previous\" disabled=\"\" data-za-detail-view-path-module=\"Unknown\" data-za-detail-view-path-module_name=\"推荐阅读\" data-za-extra-module=\"{}\"><svg class=\"Zi Zi--ArrowLeft\" fill=\"#d3d3d3\" viewBox=\"0 0 24 24\" width=\"40\" height=\"40\"><path d=\"M14.782 16.78a.737.737 0 0 1-1.052 0L9.218 12.53a.758.758 0 0 1 0-1.063L13.73 7.22a.737.737 0 0 1 1.052 0c.29.294.29.77.001 1.063L11 12l3.782 3.716c.29.294.29.77 0 1.063z\" fill-rule=\"evenodd\"></path></svg></button><a href=\"https://zhuanlan.zhihu.com/p/106061137\" class=\"PostItem\"><div><h1 class=\"PostItem-Title\">3万字总结，Mysql优化之精髓</h1><p class=\"PostItem-Summary\">本文知识点较多，篇幅较长，请耐心学习MySQL已经成为时下关系型数据库产品的中坚力量，备受互联网大厂的青睐，出门面试想进BAT，想拿高工资，不会点MySQL优化知识，拿offer的成功率会大大下…</p><div class=\"PostItem-Footer\"><span>蛙课网</span><span class=\"PostItem-FooterTitle\"></span></div></div></a><a href=\"https://zhuanlan.zhihu.com/p/84729922\" class=\"PostItem\"><div><img src=\"https://pic4.zhimg.com/v2-450d0092ab8b76826697cd0b7e686b56_250x0.jpg?source=172ae18b\" srcset=\"https://pic4.zhimg.com/v2-450d0092ab8b76826697cd0b7e686b56_qhd.jpg?source=172ae18b 2x\" class=\"PostItem-TitleImage\" alt=\"MySQL大表优化方案\"><h1 class=\"PostItem-Title\">MySQL大表优化方案</h1><div class=\"PostItem-Footer\"><span>皮皮Q</span><span class=\"PostItem-FooterTitle\">发表于码农自主学...</span></div></div></a><a href=\"https://zhuanlan.zhihu.com/p/113736497\" class=\"PostItem\"><div><h1 class=\"PostItem-Title\">MySQL 大表优化方案</h1><p class=\"PostItem-Summary\">单表优化读写分离缓存表分区垂直拆分水平拆分兼容MySQL且可水平扩展的数据库NoSQL《Java 2019 超神之路》《Dubbo 实现原理与源码解析 —— 精品合集》《Spring 实现原理与源码解析 —— 精…</p><div class=\"PostItem-Footer\"><span>芋道源码</span><span class=\"PostItem-FooterTitle\">发表于芋道源码</span></div></div></a><a href=\"https://zhuanlan.zhihu.com/p/128533614\" class=\"PostItem\"><div><h1 class=\"PostItem-Title\">MySQL常用优化指南，及大表优化思路（值得收藏）</h1><p class=\"PostItem-Summary\">当MySQL单表记录数过大时，增删改查性能都会急剧下降 单表优化 除非单表数据未来会一直不断上涨，否则不要一开始就考虑拆分，拆分会带来逻辑、部署、运维的各种复杂度，一般以整型值为主的…</p><div class=\"PostItem-Footer\"><span>IT领域君</span><span class=\"PostItem-FooterTitle\"></span></div></div></a><button class=\"PagingButton PagingButton-Next\" data-za-detail-view-path-module=\"Unknown\" data-za-detail-view-path-module_name=\"推荐阅读\" data-za-extra-module=\"{}\"><svg class=\"Zi Zi--ArrowRight\" fill=\"#d3d3d3\" viewBox=\"0 0 24 24\" width=\"40\" height=\"40\"><path d=\"M9.218 16.78a.737.737 0 0 0 1.052 0l4.512-4.249a.758.758 0 0 0 0-1.063L10.27 7.22a.737.737 0 0 0-1.052 0 .759.759 0 0 0-.001 1.063L13 12l-3.782 3.716a.758.758 0 0 0 0 1.063z\" fill-rule=\"evenodd\"></path></svg></button></ul></div><div class=\"Comments-container\" data-za-detail-view-path-module=\"CommentList\" data-za-extra-module=\"{}\"><div class=\"CommentsV2 CommentsV2--withEditor CommentsV2-withPagination\"><div class=\"Topbar CommentTopbar\"><div class=\"Topbar-title\"><h2 class=\"CommentTopbar-title\">4 条评论</h2></div><div class=\"Topbar-options\"><button type=\"button\" class=\"Button Button--plain Button--withIcon Button--withLabel\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Switch Button-zi\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"1.2em\" height=\"1.2em\"><path d=\"M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z\" fill-rule=\"evenodd\"></path></svg></span>切换为时间排序</button></div></div><div><div class=\"CommentsV2-footer CommentEditorV2--normal\"><div class=\"CommentEditorV2-inputWrap\"><div class=\"InputLike CommentEditorV2-input Editable\"><div class=\"Dropzone Editable-content RichText RichText--editable RichText--clearBoth ztext\" style=\"min-height: 198px;\"><div class=\"DraftEditor-root\"><div class=\"public-DraftEditorPlaceholder-root\"><div class=\"public-DraftEditorPlaceholder-inner\" id=\"placeholder-4oi7f\" style=\"white-space: pre-wrap;\">已开启预审评论，评论由机构筛选后公开</div></div><div class=\"DraftEditor-editorContainer\"><div aria-describedby=\"placeholder-4oi7f\" class=\"notranslate public-DraftEditor-content\" contenteditable=\"true\" role=\"textbox\" spellcheck=\"true\" tabindex=\"0\" style=\"outline: none; user-select: text; white-space: pre-wrap; overflow-wrap: break-word;\"><div data-contents=\"true\"><div class=\"Editable-unstyled\" data-block=\"true\" data-editor=\"4oi7f\" data-offset-key=\"s92b-0-0\"><div data-offset-key=\"s92b-0-0\" class=\"public-DraftStyleDefault-block public-DraftStyleDefault-ltr\"><span data-offset-key=\"s92b-0-0\"><br data-text=\"true\"></span></div></div></div></div></div></div></div><input multiple=\"\" type=\"file\" accept=\"image/webp,image/jpg,image/jpeg,image/png,image/gif\" style=\"display: none;\"><div></div></div><div class=\"CommentEditorV2-inputUpload\"><div class=\"CommentEditorV2-popoverWrap\"><div class=\"Popover CommentEditorV2-inputUpLoad-Icon\"><button aria-label=\"插入表情\" data-tooltip=\"插入表情\" data-tooltip-position=\"bottom\" data-tooltip-will-hide-on-click=\"true\" id=\"Popover7-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover7-content\" type=\"button\" class=\"Button Editable-control Button--plain\"><svg class=\"Zi Zi--Emotion\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path d=\"M7.523 13.5h8.954c-.228 2.47-2.145 4-4.477 4-2.332 0-4.25-1.53-4.477-4zM12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1.5a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zm-3-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z\"></path></svg></button></div></div></div></div><button type=\"button\" disabled=\"\" class=\"Button CommentEditorV2-singleButton Button--primary Button--blue\">发布</button></div></div><div><div class=\"CommentListV2\"><ul class=\"NestComment\"><li class=\"NestComment--rootCommentNoChild\"><div class=\"CommentItemV2\"><div><div class=\"CommentItemV2-meta\"><span class=\"UserLink CommentItemV2-avatar\"><div class=\"Popover\"><div id=\"Popover12-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover12-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/gui-wan-meng-38\"><img class=\"Avatar UserLink-avatar\" width=\"24\" height=\"24\" src=\"https://pic1.zhimg.com/v2-7041ba0d417d8c3c12ec440d941a3dad_s.jpg?source=06d4cd63\" srcset=\"https://pic1.zhimg.com/v2-7041ba0d417d8c3c12ec440d941a3dad_xs.jpg?source=06d4cd63 2x\" alt=\"噜噜\"></a></div></div></span><span class=\"UserLink\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/gui-wan-meng-38\">噜噜</a></span><span class=\"CommentItemV2-time\">06-12</span></div><div class=\"CommentItemV2-metaSibling\"><div class=\"CommentRichText CommentItemV2-content\"><div class=\"RichText ztext\"><p>myisam 现在 和 innodb相比，已经几乎没有优势了</p></div></div><div class=\"CommentItemV2-footer\"><button type=\"button\" class=\"Button CommentItemV2-likeBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>1</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Reply\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z\" fill-rule=\"evenodd\"></path></svg></span>回复</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"transform: rotate(180deg); margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>踩</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Report\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z\" fill-rule=\"evenodd\"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class=\"NestComment\"><li class=\"NestComment--rootComment\"><div class=\"CommentItemV2\"><div><div class=\"CommentItemV2-meta\"><span class=\"UserLink CommentItemV2-avatar\"><div class=\"Popover\"><div id=\"Popover13-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover13-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/yuansu007\"><img class=\"Avatar UserLink-avatar\" width=\"24\" height=\"24\" src=\"https://pic4.zhimg.com/v2-c322528a7848b4e6e7294a6cf61ef9b6_s.jpg?source=06d4cd63\" srcset=\"https://pic4.zhimg.com/v2-c322528a7848b4e6e7294a6cf61ef9b6_xs.jpg?source=06d4cd63 2x\" alt=\"元素\"></a></div></div></span><span class=\"UserLink\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/yuansu007\">元素</a></span><span class=\"CommentItemV2-time\">06-20</span></div><div class=\"CommentItemV2-metaSibling\"><div class=\"CommentRichText CommentItemV2-content\"><div class=\"RichText ztext\"><p>问题是timestamp只能到2038年</p></div></div><div class=\"CommentItemV2-footer\"><button type=\"button\" class=\"Button CommentItemV2-likeBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>赞</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Reply\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z\" fill-rule=\"evenodd\"></path></svg></span>回复</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"transform: rotate(180deg); margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>踩</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Report\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z\" fill-rule=\"evenodd\"></path></svg></span>举报</button></div></div></div></div></li><li class=\"NestComment--child\"><div class=\"CommentItemV2\"><div><div class=\"CommentItemV2-meta\"><span class=\"UserLink CommentItemV2-avatar\"><div class=\"Popover\"><div id=\"Popover14-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover14-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/ling-zuo-83\"><img class=\"Avatar UserLink-avatar\" width=\"24\" height=\"24\" src=\"https://pic4.zhimg.com/v2-4e3a96b53dbb45995d97ad064f856bcf_s.jpg?source=06d4cd63\" srcset=\"https://pic4.zhimg.com/v2-4e3a96b53dbb45995d97ad064f856bcf_xs.jpg?source=06d4cd63 2x\" alt=\"如果我们不曾相遇\"></a></div></div></span><span class=\"UserLink\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/ling-zuo-83\">如果我们不曾相遇</a></span><span class=\"CommentItemV2-reply\">回复</span><span class=\"UserLink\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/yuansu007\">元素</a></span><span class=\"CommentItemV2-time\">06-24</span></div><div class=\"CommentItemV2-metaSibling\"><div class=\"CommentRichText CommentItemV2-content\"><div class=\"RichText ztext\"><p>还有18年，坐等很多项目的暴雷</p></div></div><div class=\"CommentItemV2-footer\"><button type=\"button\" class=\"Button CommentItemV2-likeBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>赞</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Reply\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z\" fill-rule=\"evenodd\"></path></svg></span>回复</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"transform: rotate(180deg); margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>踩</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Report\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z\" fill-rule=\"evenodd\"></path></svg></span>举报</button></div></div></div></div></li></ul><ul class=\"NestComment\"><li class=\"NestComment--rootCommentNoChild\"><div class=\"CommentItemV2\"><div><div class=\"CommentItemV2-meta\"><span class=\"UserLink CommentItemV2-avatar\"><div class=\"Popover\"><div id=\"Popover15-toggle\" aria-haspopup=\"true\" aria-expanded=\"false\" aria-owns=\"Popover15-content\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/shi-yu-men-69\"><img class=\"Avatar UserLink-avatar\" width=\"24\" height=\"24\" src=\"https://pic4.zhimg.com/v2-94e7e01ccee6ffe6ebd805efeac9ab62_s.jpg?source=06d4cd63\" srcset=\"https://pic4.zhimg.com/v2-94e7e01ccee6ffe6ebd805efeac9ab62_xs.jpg?source=06d4cd63 2x\" alt=\"杀只鸡过年\"></a></div></div></span><span class=\"UserLink\"><a class=\"UserLink-link\" data-za-detail-view-element_name=\"User\" target=\"_blank\" href=\"//www.zhihu.com/people/shi-yu-men-69\">杀只鸡过年</a></span><span class=\"CommentItemV2-time\">06-29</span></div><div class=\"CommentItemV2-metaSibling\"><div class=\"CommentRichText CommentItemV2-content\"><div class=\"RichText ztext\"><p>请问select *，有什么具体的坏处呢？</p></div></div><div class=\"CommentItemV2-footer\"><button type=\"button\" class=\"Button CommentItemV2-likeBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>赞</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Reply\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z\" fill-rule=\"evenodd\"></path></svg></span>回复</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Like\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"transform: rotate(180deg); margin-right: 5px;\"><path d=\"M14.445 9h5.387s2.997.154 1.95 3.669c-.168.51-2.346 6.911-2.346 6.911s-.763 1.416-2.86 1.416H8.989c-1.498 0-2.005-.896-1.989-2v-7.998c0-.987.336-2.032 1.114-2.639 4.45-3.773 3.436-4.597 4.45-5.83.985-1.13 3.2-.5 3.037 2.362C15.201 7.397 14.445 9 14.445 9zM3 9h2a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V10a1 1 0 0 1 1-1z\" fill-rule=\"evenodd\"></path></svg></span>踩</button><button type=\"button\" class=\"Button CommentItemV2-hoverBtn Button--plain\"><span style=\"display: inline-flex; align-items: center;\">&#8203;<svg class=\"Zi Zi--Report\" fill=\"currentColor\" viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" style=\"margin-right: 5px;\"><path d=\"M19.947 3.129c-.633.136-3.927.639-5.697.385-3.133-.45-4.776-2.54-9.949-.888-.997.413-1.277 1.038-1.277 2.019L3 20.808c0 .3.101.54.304.718a.97.97 0 0 0 .73.304c.275 0 .519-.102.73-.304.202-.179.304-.418.304-.718v-6.58c4.533-1.235 8.047.668 8.562.864 2.343.893 5.542.008 6.774-.657.397-.178.596-.474.596-.887V3.964c0-.599-.42-.972-1.053-.835z\" fill-rule=\"evenodd\"></path></svg></span>举报</button></div></div></div></div></li></ul></div></div></div></div></div></div>"
  },
  {
    "category": "dataBase",
    "qes": "一条SQL语句在MySQL中如何执行的",
    "ans": "<div id=\"page-content\" class=\"rich_media_area_primary\">\n\n\t\t  <div class=\"rich_media_area_primary_inner\">\n\n            \n                        \n                        \n\n            <div id=\"img-content\" class=\"rich_media_wrp\">\n                \n                <h2 class=\"rich_media_title\" id=\"activity-name\">\n                    \n                    \n                    \n一条SQL语句在MySQL中如何执行的\n                </h2>\n                <div id=\"meta_content\" class=\"rich_media_meta_list\">\n                                                                <span id=\"copyright_logo\" class=\"rich_media_meta icon_appmsg_tag appmsg_title_tag\">原创</span>\n                                                                                            <span class=\"rich_media_meta rich_media_meta_text\">\n                                                                    木木匠\n                                                            </span>\n                                                                \n                                        <span class=\"rich_media_meta rich_media_meta_nickname\" id=\"profileBt\">\n                      <a href=\"javascript:void(0);\" id=\"js_name\">\n                        JavaGuide                      </a>\n                      <div id=\"js_profile_qrcode\" class=\"profile_container\" style=\"display:none;\">\n                          <div class=\"profile_inner\">\n                              <strong class=\"profile_nickname\">JavaGuide</strong>\n                              <img class=\"profile_avatar\" id=\"js_profile_qrcode_img\" src=\"\" alt=\"\">\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">微信号</label>\n                              <span class=\"profile_meta_value\">JavaGuide</span>\n                              </p>\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">功能介绍</label>\n                              <span class=\"profile_meta_value\">专注Java后端学习和大厂面试的公众号！开源项目—JavaGuide （88k+Star）作者运营维护。学习Java，首选JavaGuide！</span>\n                              </p>\n                              \n                          </div>\n                          <span class=\"profile_arrow_wrp\" id=\"js_profile_arrow_wrp\">\n                              <i class=\"profile_arrow arrow_out\"></i>\n                              <i class=\"profile_arrow arrow_in\"></i>\n                          </span>\n                      </div>\n                    </span>\n                    <em id=\"publish_time\" class=\"rich_media_meta rich_media_meta_text\">2019-04-02</em>\n                </div>\n\n                \n                                                <div id=\"js_tags\" class=\"article-tag__list\" style=\"display: none;\" data-len=\"0\">\n                                            \n                        <div class=\"article-tag-card__title\">收录于话题</div>\n                        <div class=\"article-tags\">\n                                                    </div>\n                                    </div>\n\n                \n                                \n                \n                \n\n                \n                                                                \n\n                \n                                \n\n\n                \n                \n                \n                \n                                                \n                                                                \n                                \n                                \n                \n                <div class=\"rich_media_content \" id=\"js_content\" style=\"visibility: visible;\">\n                    \n\n                    \n\n                    \n                    \n                    <section class=\"\" style=\"display:none;\" data-tools=\"新媒体管家\" data-label=\"powered by xmt.cn\"></section><blockquote style=\"box-sizing: border-box;margin: 20px 10px;padding-top: 1px;padding-bottom: 1px;font-size: 16px;white-space: normal;text-align: left;color: rgb(91, 91, 91);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;background: rgba(158, 158, 158, 0.1);border-left-color: rgb(158, 158, 158);\"><p style=\"box-sizing: border-box;margin: 10px;color: rgb(63, 63, 63);line-height: 1.6;\">本文来自木木匠投稿。</p></blockquote><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">本篇文章会分析一个 sql 语句在 MySQL 中的执行流程，包括 sql 的查询在 MySQL 内部会怎么流转，sql 语句的更新是怎么完成的。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">在分析之前我会先带着你看看 MySQL 的基础架构，知道了 MySQL 由那些组件组成以及这些组件的作用是什么，可以帮助我们理解和解决这些问题。</p><h2 style=\"box-sizing: border-box;margin: 80px 10px 40px;font-weight: bold;white-space: normal;text-align: center;color: rgb(63, 63, 63);line-height: 1.5;font-size: 22.4px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">一 MySQL 基础架构分析</h2><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">1.1 MySQL 基本架构概览</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">下图是 MySQL 的一个简要架构图，从下图你可以很清晰的看到用户的 SQL 语句在 MySQL 内部是如何执行的。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">先简单介绍一下下图涉及的一些组件的基本作用帮助大家理解这幅图，在 1.2 节中会详细介绍到这些组件的作用。</p><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">连接器：</strong>&nbsp;身份认证和权限相关(登录 MySQL 的时候)。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">查询缓存:</strong>&nbsp; 执行查询语句的时候，会先查询缓存（MySQL 8.0 版本后移除，因为这个功能不太实用）。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">分析器:</strong>&nbsp; 没有命中缓存的话，SQL 语句就会经过分析器，分析器说白了就是要先看你的 SQL 语句要干嘛，再检查你的 SQL 语句语法是否正确。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">优化器：</strong>&nbsp;按照 MySQL 认为最优的方案去执行。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">执行器:</strong>&nbsp; 执行语句，然后从存储引擎返回数据。</span></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><img class=\"\" data-ratio=\"1.1178947368421053\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8x9nVefLe59Q8SBNcZGIGn1VGNFfNUVQyOwQksDoyvIOUJicgzU6ICVLg/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"950\" style=\"box-sizing: border-box; margin: 20px auto; line-height: 1.5; border-radius: 4px; display: block; width: 315px !important; height: auto !important; visibility: visible !important;\" title=\"null\" _width=\"315px\" src=\"https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9TzWuuhjqx58LnibzsWR0Pf8x9nVefLe59Q8SBNcZGIGn1VGNFfNUVQyOwQksDoyvIOUJicgzU6ICVLg/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1\" crossorigin=\"anonymous\" data-fail=\"0\"></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">简单来说 MySQL 主要分为 Server 层和存储引擎层：</p><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">Server 层</strong>：主要包括连接器、查询缓存、分析器、优化器、执行器等，所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图，函数等，还有一个通用的日志模块 binglog 日志模块。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">存储引擎</strong>： 主要负责数据的存储和读取，采用可以替换的插件式架构，支持 InnoDB、MyISAM、Memory 等多个存储引擎，其中 InnoDB 引擎有自有的日志模块 redolog 模块。<strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始就被当做默认存储引擎了。</strong></span></p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">1.2 Server 层基本组件介绍</h3><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">1) 连接器</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">连接器主要和身份认证和权限相关的功能相关，就好比一个级别很高的门卫一样。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">主要负责用户登录数据库，进行用户的身份认证，包括校验账户密码，权限等操作，如果用户账户密码已通过，连接器会到权限表中查询该用户的所有权限，之后在这个连接里的权限逻辑判断都是会依赖此时读取到的权限数据，也就是说，后续只要这个连接不断开，即时管理员修改了该用户的权限，该用户也是不受影响的。</p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">2) 查询缓存(MySQL 8.0 版本后移除)</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">查询缓存主要用来缓存我们所执行的 SELECT 语句以及该语句的结果集。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">连接建立后，执行查询语句的时候，会先查询缓存，MySQL 会先校验这个 sql 是否执行过，以 Key-Value 的形式缓存在内存中，Key 是查询预计，Value 是结果集。如果缓存 key 被命中，就会直接返回给客户端，如果没有命中，就会执行后续的操作，完成后也会把结果缓存起来，方便下一次调用。当然在真正执行缓存查询的时候还是会校验用户的权限，是否有该表的查询条件。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">MySQL 查询不建议使用缓存，因为查询缓存失效在实际业务场景中可能会非常频繁，假如你对一个表更新的话，这个表上的所有的查询缓存都会被清空。对于不经常更新的数据来说，使用缓存还是可以的。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">所以，一般在大多数情况下我们都是不推荐去使用查询缓存的。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">MySQL 8.0 版本后删除了缓存的功能，官方也是认为该功能在实际的应用场景比较少，所以干脆直接删掉了。</p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">3) 分析器</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">MySQL 没有命中缓存，那么就会进入分析器，分析器主要是用来分析 SQL 语句是来干嘛的，分析器也会分为几步：</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">第一步，词法分析</strong>，一条 SQL 语句有多个字符串组成，首先要提取关键字，比如 select，提出查询的表，提出字段名，提出查询条件等等。做完这些操作后，就会进入第二步。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">第二步，语法分析</strong>，主要就是判断你输入的 sql 是否正确，是否符合 MySQL 的语法。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">完成这 2 步之后，MySQL 就准备开始执行了，但是如何执行，怎么执行是最好的结果呢？这个时候就需要优化器上场了。</p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">4) 优化器</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">优化器的作用就是它认为的最优的执行方案去执行（有时候可能也不是最优，这篇文章涉及对这部分知识的深入讲解），比如多个索引的时候该如何选择索引，多表查询的时候如何选择关联顺序等。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">可以说，经过了优化器之后可以说这个语句具体该如何执行就已经定下来。</p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">5) 执行器</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">当选择了执行方案后，MySQL 就准备开始执行了，首先执行前会校验该用户有没有权限，如果没有权限，就会返回错误信息，如果有权限，就会去调用引擎的接口，返回接口执行的结果。</p><h2 style=\"box-sizing: border-box;margin: 80px 10px 40px;font-weight: bold;white-space: normal;text-align: center;color: rgb(63, 63, 63);line-height: 1.5;font-size: 22.4px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">二 语句分析</h2><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">2.1 查询语句</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">说了以上这么多，那么究竟一条 sql 语句是如何执行的呢？其实我们的 sql 可以分为两种，一种是查询，一种是更新（增加，更新，删除）。我们先分析下查询语句，语句如下：</p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li></li></ul><pre class=\"code-snippet__js\" data-lang=\"sql\"><code style=\"box-sizing: border-box;font-size: 14px;white-space: pre;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;\"><span class=\"code-snippet_outer\" style=\"box-sizing: border-box;\">select * from tb_student  A where A.age='18' and A.name=' 张三 ';</span></code></pre></section><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">结合上面的说明，我们分析下这个语句的执行流程：</p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><span style=\"text-indent: -20px;\">先检查该语句是否有权限，如果没有权限，直接返回错误信息，如果有权限，在 MySQL8.0 版本以前，会先查询缓存，以这条 sql 语句为 key 在内存中查询是否有结果，如果有直接缓存，如果没有，执行下一步。</span></p></li><li><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><span style=\"text-indent: -20px;\">通过分析器进行词法分析，提取 sql 语句的关键元素，比如提取上面这个语句是查询 select，提取需要查询的表名为 tb_student,需要查询所有的列，查询条件是这个表的 id='1'。然后判断这个 sql 语句是否有语法错误，比如关键词是否正确等等，如果检查没问题就执行下一步。</span></p></li><li><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><span style=\"text-indent: -20px;\">接下来就是优化器进行确定执行方案，上面的 sql 语句，可以有两种执行方案：</span></p></li></ul><p><span style=\"box-sizing: border-box;margin: 10px;font-size: 16px;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-indent: -20px;display: block;\"></span></p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li></li><li></li></ul><pre class=\"code-snippet__js\" data-lang=\"\"><code style=\"box-sizing: border-box;font-size: 14px;white-space: pre;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;\"><span class=\"code-snippet_outer\" style=\"box-sizing: border-box;\">  a.先查询学生表中姓名为“张三”的学生，然后判断是否年龄是 18。</span></code><code style=\"box-sizing: border-box;font-size: 14px;white-space: pre;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;\"><span class=\"code-snippet_outer\" style=\"box-sizing: border-box;\">  b.先找出学生中年龄 18 岁的学生，然后再查询姓名为“张三”的学生。</span></code></pre></section><p style=\"box-sizing: border-box;margin: 10px;line-height: 1.6;\">&nbsp; &nbsp; &nbsp; &nbsp;那么优化器根据自己的优化算法进行选择执行效率最好的一个方案（优化器认为，有时候不一定最好）。那么确认了执行计划后就准备开始执行了。</p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p><span style=\"box-sizing: border-box;margin: 10px;font-size: 16px;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;text-indent: -20px;display: block;\"></span></p><p style=\"box-sizing: border-box;margin: 10px;line-height: 1.6;\">进行权限校验，如果没有权限就会返回错误信息，如果有权限就会调用数据库引擎接口，返回引擎的执行结果。</p></li></ul><p><br></p><h3 style=\"box-sizing: border-box;margin: 40px 10px 20px;font-weight: bold;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-size: 19.2px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">2.2 更新语句</h3><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">以上就是一条查询 sql 的执行流程，那么接下来我们看看一条更新语句如何执行的呢？sql 语句如下：</p><section class=\"code-snippet__fix code-snippet__js\"><ul class=\"code-snippet__line-index code-snippet__js\"><li></li></ul><pre class=\"code-snippet__js\" data-lang=\"\"><code style=\"box-sizing: border-box;font-size: 14px;white-space: pre;display: flex;font-family: Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace;\"><span class=\"code-snippet_outer\" style=\"box-sizing: border-box;\">update tb_student A set A.age='19' where A.name=' 张三 ';</span></code></pre></section><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">我们来给张三修改下年龄，在实际数据库肯定不会设置年龄这个字段的，不然要被技术负责人打的。其实条语句也基本上会沿着上一个查询的流程走，只不过执行更新的时候肯定要记录日志啦，这就会引入日志模块了，MySQL 自带的日志模块式&nbsp;<strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">binlog（归档日志）</strong>&nbsp;，所有的存储引擎都可以使用，我们常用的 InnoDB 引擎还自带了一个日志模块&nbsp;<strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">redo log（重做日志）</strong>，我们就以 InnoDB 模式下来探讨这个语句的执行流程。流程如下：</p><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>先查询到张三这一条数据，如果有缓存，也是会用到缓存。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>然后拿到查询的语句，把 age 改为 19，然后调用引擎 API 接口，写入这一行数据，InnoDB 引擎把数据保存在内存中，同时记录 redo log，此时 redo log 进入 prepare 状态，然后告诉执行器，执行完成了，随时可以提交。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>执行器收到通知后记录 binlog，然后调用引擎接口，提交 redo log 为提交状态。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>更新完成。</span></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\"><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">这里肯定有同学会问，为什么要用两个日志模块，用一个日志模块不行吗?</strong></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">这是因为最开始 MySQL 并没与 InnoDB 引擎( InnoDB 引擎是其他公司以插件形式插入 MySQL 的) ，MySQL 自带的引擎是 MyISAM，但是我们知道 redo log 是 InnoDB 引擎特有的，其他存储引擎都没有，这就导致会没有 crash-safe 的能力(crash-safe 的能力即使数据库发生异常重启，之前提交的记录都不会丢失)，binlog 日志只能用来归档。</p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">并不是说只用一个日志模块不可以，只是 InnoDB 引擎就是通过 redo log 来支持事务的。那么，又会有同学问，我用两个日志模块，但是不要这么复杂行不行，为什么 redo log 要引入 prepare 预提交状态？这里我们用反证法来说明下为什么要这么做？</p><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">先写 redo log 直接提交，然后写 binlog</strong>，假设写完 redo log 后，机器挂了，binlog 日志没有被写入，那么机器重启后，这台机器会通过 redo log 恢复数据，但是这个时候 bingog 并没有记录该数据，后续进行机器备份的时候，就会丢失这一条数据，同时主从同步也会丢失这一条数据。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span><strong style=\"box-sizing: border-box;color: rgb(247, 12, 21);line-height: 1.5;\">先写 binlog，然后写 redo log</strong>，假设写完了 binlog，机器异常重启了，由于没有 redo log，本机是无法恢复这一条记录的，但是 binlog 又有记录，那么和上面同样的道理，就会产生数据不一致的情况。</span></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">如果采用 redo log 两阶段提交的方式就不一样了，写完 binglog 后，然后再提交 redo log 就会防止出现上述的问题，从而保证了数据的一致性。那么问题来了，有没有一个极端的情况呢？假设 redo log 处于预提交状态，binglog 也已经写完了，这个时候发生了异常重启会怎么样呢？ 这个就要依赖于 MySQL 的处理机制了，MySQL 的处理过程如下：</p><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>判断 redo log 是否完整，如果判断是完整的，就立即提交。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>如果 redo log 只是预提交但不是 commit 状态，这个时候就会去判断 binlog 是否完整，如果完整就提交 redo log, 不完整就回滚事务。</span></p><p style=\"box-sizing: border-box;margin: 10px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">这样就解决了数据一致性的问题。</p><h2 style=\"box-sizing: border-box;margin: 80px 10px 40px;font-weight: bold;white-space: normal;text-align: center;color: rgb(63, 63, 63);line-height: 1.5;font-size: 22.4px;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">三 总结</h2><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>MySQL 主要分为 Server 层和引擎层，Server 层主要包括连接器、查询缓存、分析器、优化器、执行器，同时还有一个日志模块（binlog），这个日志模块所有执行引擎都可以共用,redolog 只有 InnoDB 有。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>引擎层是插件式的，目前主要包括，MyISAM,InnoDB,Memory 等。</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>SQL 等执行过程分为两类，一类对于查询等过程如下：权限校验---》查询缓存---》分析器---》优化器---》权限校验---》执行器---》引擎</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>对于更新等语句执行流程如下：分析器----》权限校验----》执行器---》引擎---redo log prepare---》binlog---》redo log commit</span></p><h3 style=\"margin: 40px 10px 20px;font-weight: bold;font-size: 19.2px;white-space: normal;box-sizing: border-box;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;\">References</h3><p style=\"box-sizing: border-box;margin-top: 20px;margin-right: 10px;margin-bottom: 20px;padding-left: 20px;font-size: 16px;white-space: normal;text-align: left;color: rgb(63, 63, 63);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;list-style: circle;\"><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>《MySQL实战45讲》</span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;margin-right: 10px;\">•</span>MySQL 5.6参考手册:<span style=\"box-sizing: border-box;color: rgb(20, 140, 228);line-height: 1.5;\">https://dev.MySQL.com/doc/refman/5.6/en/<sup style=\"box-sizing: border-box;\">[16]</sup></span></span><span style=\"box-sizing: border-box;margin: 10px;line-height: 1.5;text-indent: -20px;display: block;\"><span style=\"box-sizing: border-box;color: rgb(20, 140, 228);line-height: 1.5;\"><sup style=\"box-sizing: border-box;\"><br></sup></span></span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;color: rgb(255, 169, 0);font-size: 18px;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><strong style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">推荐阅读</strong></span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485085&amp;idx=1&amp;sn=01e5c29c49f32886bc897af7632b34ba&amp;chksm=cea24956f9d5c040a07e4d335219f11f888a2d32444c16cade3f69c294ae0a1e416bcd221fb6&amp;token=1613452699&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" style=\"box-sizing: border-box;color: rgb(30, 107, 184);font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align: start;white-space: pre-line;background-color: rgb(255, 255, 255);font-size: 15px !important;word-break: break-all !important;\" data-linktype=\"2\">一文带你轻松搞懂事务隔离级别(图文详解)</a></p><h2 class=\"\" style=\"max-width: 100%;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485070&amp;idx=1&amp;sn=31894a1bdda357d897962a9fc3a994b7&amp;chksm=cea24945f9d5c0531db568321f1d8d7a4e848e04aa2df18e589db9ba4aafee0fb0cebb965252&amp;token=463285003&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(30, 107, 184);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align: start;white-space: pre-line;overflow-wrap: break-word !important;font-size: 15px !important;word-break: break-all !important;\">记一次蚂蚁金服的面试经历</a></h2><p><br></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485059&amp;idx=1&amp;sn=a881a1ba6013c1214b64bbed23420b88&amp;chksm=cea24948f9d5c05edbd94bdc705da6d10ccc5c4213b7320f64b88b9a503d1c3adfe2b88fc6d7&amp;token=463285003&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(30, 107, 184);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;font-family: Avenir, -apple-system-font, 微软雅黑, sans-serif;text-align: start;white-space: pre-line;overflow-wrap: break-word !important;font-size: 15px !important;word-break: break-all !important;\">我觉得技术人员该有的提问方式</a></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484744&amp;idx=1&amp;sn=9db31dca13d327678845054af75efb74&amp;chksm=cea24a83f9d5c3956f4feb9956b068624ab2fdd6c4a75fe52d5df5dca356a016577301399548&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 0.544px;orphans: 4;white-space: pre-wrap;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">Java 8 新特性最佳指南</a></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"http://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484746&amp;idx=1&amp;sn=a519a9e3d638bff5c65008f7de167e4b&amp;chksm=cea24a81f9d5c397ca9ac5668ba6cb18b38065e0e282a34ebc077a2dea98de3f1eb285ea5f09&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;font-size: 14px;letter-spacing: 0.544px;orphans: 4;white-space: pre-wrap;font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">做公众号这一年的经历和一件“大事”</a><span style=\"max-width: 100%;font-size: 14px;letter-spacing: 0.544px;orphans: 4;white-space: pre-wrap;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;box-sizing: border-box !important;overflow-wrap: break-word !important;\">(2018-03-10)</span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;orphans: 4;white-space: pre-wrap;font-size: 14px;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484789&amp;idx=1&amp;sn=2ad9fabb8fc7fae3bd3756ea05594344&amp;chksm=cea24abef9d5c3a889b6cb8e00cb18abbb694d189c84a24fa1ed337ad4c56194cd39316dc6a5&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">盘点一下Github上开源的Java面试/学习相关的仓库，看完弄懂薪资至少增加10k</a>( 2018-12-24)</span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;orphans: 4;font-size: 14px;color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);white-space: pre-wrap;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484840&amp;idx=1&amp;sn=cf4611ac290ae3cbb381fe52aa76b60b&amp;chksm=cea24a63f9d5c375215f7539ff0f3d6320f091d5f8b73e95c724ec9a31d3b5baa98c3f5a1012&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">可能是一份最适合你的后端面试指南（部分内容前端同样适用）</a></span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;orphans: 4;white-space: pre-wrap;font-size: 14px;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484858&amp;idx=1&amp;sn=8e222ea6115e0b69cac91af14d2caf36&amp;chksm=cea24a71f9d5c367148dccec3d5ddecf5ecd8ea096b5c5ec32f22080e66ac3c343e99151c9e0&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\"><span md-inline=\"plain\" style=\"max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">redis 总结——重构版</span></a></span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;orphans: 4;font-size: 14px;color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);white-space: pre-wrap;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484850&amp;idx=1&amp;sn=3238360bfa8105cf758dcf7354af2814&amp;chksm=cea24a79f9d5c36fb2399aafa91d7fb2699b5006d8d037fe8aaf2e5577ff20ae322868b04a87&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">史上最全Redis高可用技术解决方案大全</a></span></p><p style=\"margin-top: 1.4em;margin-right: 16px;margin-left: 16px;max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;color: rgb(26, 26, 26);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 15px;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;letter-spacing: 0.544px;orphans: 4;font-size: 14px;color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);white-space: pre-wrap;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485068&amp;idx=1&amp;sn=c37267fe59978dbfcd6a9a54eee1c502&amp;chksm=cea24947f9d5c051008233a6a938e802b710ccf919f4215f84dcc0bf1fdad7d0101d37497d33&amp;scene=21#wechat_redirect\" target=\"_blank\" data-linktype=\"2\" style=\"-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\">可能是把Java内存区域讲的最清楚的一篇文章</a></span></p><p style=\"margin-bottom: 0.5rem;max-width: 100%;box-sizing: border-box;min-height: 1em;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;orphans: 4;white-space: pre-wrap;letter-spacing: 1.5px;line-height: 1.75em;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;font-size: 14px;overflow-wrap: break-word !important;\"><a spellcheck=\"false\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484877&amp;idx=1&amp;sn=f54d41b68f0cd6cc7c0348a2fddbda9f&amp;chksm=cea24a06f9d5c3102bfef946ba6c7cc5df9a503ccb14b9b141c54e179617e4923c260c0b0a01&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" data-linktype=\"2\" style=\"color: rgb(65, 131, 196);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;cursor: pointer;-webkit-user-drag: none;overflow-wrap: break-word !important;\">搞定 JVM 垃圾回收就是这么简单</a></span></p><p style=\"max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><img class=\"rich_pages img_loading\" data-copyright=\"0\" data-ratio=\"1\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/hvUCbRic69sA3xqsu3enj7FXeAJYZexsAqlpY7yqB72DlUWmjVvmCddzI2H1ZLvV4s9iajt6ibysnQzVsBIDkafJw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"258\" style=\"box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 175px !important; height: 175px !important;\" _width=\"175px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></p><p style=\"max-width: 100%;min-height: 1em;white-space: normal;background-color: rgb(255, 255, 255);font-size: 16px;text-align: center;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;font-weight: 600;color: rgb(36, 41, 46);text-align: start;overflow-wrap: break-word !important;\">欢迎关注<img class=\"\" data-ratio=\"1\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TxAghDEtyL0yGWb5bwkkbojspAFsIK81p9GbZ7ibpE1PM7HSBxvSm0BjwYa4v6JIlMIhYMMEDeOdUg/640?wx_fmt=png\" data-type=\"png\" data-w=\"19\" style=\"display: inline-block; vertical-align: text-bottom; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 19px !important; height: 19px !important;\" _width=\"19px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></span></p>\n                </div>\n\n                <script nonce=\"\" type=\"text/javascript\">\n                    var first_sceen__time = (+new Date());\n\n                    if (\"\" == 1 && document.getElementById('js_content')) {\n                        document.getElementById('js_content').addEventListener(\"selectstart\",function(e){ e.preventDefault(); });\n                    }\n\n                    \n                    (function(){\n                        if (navigator.userAgent.indexOf(\"WindowsWechat\") != -1){\n                            var link = document.createElement('link');\n                            var head = document.getElementsByTagName('head')[0];\n                            link.rel = 'stylesheet';\n                            link.type = 'text/css';\n                            link.href = \"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx502975.css\";\n                            head.appendChild(link);\n                        }\n                    })();\n                </script>\n\n                \n<div id=\"js_sponsor_ad_area\" style=\"display: none;\"></div>\n\n\n                \n                <div class=\"read-more__area\" id=\"js_more_read_area\" style=\"display:none;\">\n                    \n                </div>\n\n                 \n                                                    \n                              \n            </div>\n                                        <div id=\"js_tags_preview_toast\" class=\"article-tag__error-tips\" style=\"display: none;\">预览时标签不可点</div>\n                                    \n                        \n\n\n                        \n            <ul id=\"js_hotspot_area\" class=\"article_extend_area\"></ul>\n\n\n            \n            \n            <div id=\"js_album_keep_read\" class=\"appmsg_card_context album_read_card\" style=\"display: none;\">\n                <div class=\"album_read_hd weui-flex\" id=\"js_album_directory\">\n                    <div class=\"album_read_source\"><span>收录于话题 </span><span>#<span id=\"js_album_keep_read_title\"></span></span></div>\n                    <span class=\"weui-btn__word-wrp\"><span id=\"js_album_keep_read_size\"></span>个<i class=\"weui_right_arrow\"></i></span>\n                </div>\n                <div class=\"album_read_bd weui-flex\">\n                  <span class=\"album_read_nav_item album_read_nav_prev weui-flex__item\" id=\"js_album_prev\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">上一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_pre_title\"></span>\n                    </span>\n                  </span>\n                  <span class=\"album_read_nav_item album_read_nav_next weui-flex__item\" id=\"js_album_next\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">下一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_next_title\"></span>\n                    </span>\n                  </span>\n                </div>\n            </div>\n\n            \n\n            \n\n\n<div class=\"rich_media_tool\" id=\"js_toobar3\">\n  <div class=\"weui-flex\">\n    <div class=\"weui-flex__item\">\n      \n      \n      \n            <a class=\"media_tool_meta meta_primary\" id=\"js_view_source\" href=\"##\">阅读原文</a>\n            \n      <div id=\"js_read_area3\" class=\"media_tool_meta tips_global_primary meta_primary\" style=\"display:none;\">\n        <span id=\"readTxt\">阅读</span>\n        <span id=\"readNum3\"></span>\n      </div>\n    </div>\n  </div> \n  <div class=\"weui-flex sns_opr_area\" id=\"js_bottom_opr_right\" style=\"display: none;\">\n    <div class=\"weui-flex__item\">\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_share js_media_tool_meta\" id=\"js_bottom_share\">\n        <button class=\"sns_opr_btn sns_share_btn\" id=\"js_bottom_share_btn\"><span class=\"sns_opr_gap\">分享</span></button>\n      </span>\n\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_collect js_media_tool_meta\" id=\"js_bottom_collect\">\n        <button class=\"sns_opr_btn sns_collect_btn\" id=\"js_bottom_collect_btn\"><span class=\"sns_opr_gap\">收藏</span></button>\n      </span>\n    </div> \n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_praise js_media_tool_meta\" id=\"like_old\">\n      <button class=\"sns_opr_btn sns_praise_btn\" id=\"js_bottom_zan_btn\"><span class=\"sns_opr_gap\" id=\"js_parise_wording\">赞</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum_old\" style=\"display: none;\"></span></button>\n    </span>\n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_like js_media_tool_meta\" id=\"like3\">\n      \n      <button class=\"sns_opr_btn sns_like_btn\" id=\"js_like_btn\"><span class=\"sns_opr_gap\" id=\"js_like_wording\">在看</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum3\"></span></button>\n    </span>\n  </div> \n</div>\n  \n  <div class=\"like_comment_wrp\" id=\"js_like_comment\" style=\"display: none;\">\n    <div class=\"like_comment_inner\">\n      <div class=\"like_comment_hd\" style=\"display:none\" id=\"js_like_title\"></div>\n      <div class=\"like_comment_bd\">\n        <div class=\"like_comment_tips\" id=\"js_comment_area\">\n          <i class=\"weui-icon-success\"></i><i class=\"icon-success-primary\"></i>已同步到看一看<a href=\"javascript:;\" class=\"like_comment_share_link\" id=\"js_like_comment_share\">写下你的想法</a>\n        </div>\n        <div class=\"like_comment_extra_info\" id=\"js_like_educate\" style=\"display: none\">\n          <p class=\"like_comment_extra_tips\">\n            <span id=\"js_friend_like_area\" style=\"display: none\"></span>\n            <span id=\"js_friend_like_word\">前往“发现”-“看一看”浏览“朋友在看”</span>\n          </p>\n          <p class=\"like_comment_pic_wrp\">\n                          <img class=\"like_comment_pic\" src=\"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment492329.png\">\n                      </p>\n          <button class=\"weui-btn weui-btn_primary\" id=\"js_go_wow\">前往看一看</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div style=\"display:none;\" id=\"wow_close_inform\">\n    <div class=\"weui-mask\"></div>\n    <div class=\"weui-dialog\">\n      <div class=\"weui-dialog__hd\"><strong class=\"weui-dialog__title\">看一看入口已关闭</strong></div>\n      <div class=\"weui-dialog__bd\">\n        在“设置”-“通用”-“发现页管理”打开“看一看”入口      </div>\n      <div class=\"weui-dialog__ft\" id=\"wow_close_ack\">\n        <a href=\"javascript:;\" class=\"weui-dialog__btn weui-dialog__btn_primary\">我知道了</a>\n      </div>\n    </div>\n  </div>\n\n<div id=\"js_like_toast\" style=\"display: none;\">\n  <div class=\"weui-mask_transparent\"></div>\n  <div class=\"weui-toast\">\n    <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n    <p class=\"weui-toast__content\" id=\"js_toast_msg\">已发送</p>\n  </div>\n</div>\n\n<div style=\"display: none;\" id=\"js_comment_panel\">\n  <div class=\"like_comment_primary_wrp editing\" id=\"js_comment_wrp\">\n    <div class=\"like_comment_primary_inner\">\n      <div class=\"like_comment_primary_hd\">\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_cancel\" id=\"js_comment_cancel\">\n            取消            <i class=\"weui-icon-close-thin\"></i>\n          </button>\n        </div>\n        <h4 class=\"like_comment_primary_title\"> 发送到看一看 </h4>\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_btn\" id=\"js_comment_confirm\" disabled=\"disabled\">发送</button>\n        </div>\n      </div>\n      <div class=\"like_comment_primary_bd\">\n        <div class=\"like_comment_media_title\" id=\"js_panel_like_title\">\n                      一条SQL语句在MySQL中如何执行的\n                  </div>\n        <div class=\"like_comment_textarea_wrp\">\n          <textarea class=\"like_comment_textarea weui-textarea\" placeholder=\"写下你的想法...\" id=\"js_comment_text\"></textarea>\n        </div>\n      </div>\n      <span class=\"like_comment_msg\" id=\"js_like_comment_msg\" style=\"visibility: hidden;\">最多200字，当前共<span id=\"js_like_current_cnt\"></span>字</span>\n    </div>\n  </div>\n  <div class=\"like_comment_primary_mask\" id=\"js_mask_2\"></div>\n</div>\n\n<div id=\"js_loading\" style=\"display: none;\">\n    <div class=\"weui-mask_transparent\"></div>\n    <div class=\"weui-toast\">\n        <i class=\"weui-loading weui-icon_toast\"></i>\n        <p class=\"weui-toast__content\">发送中</p>\n    </div>\n</div>\n\n\n\n                      </div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "Mysql高性能优化规范建议",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body cnblogs-markdown\">\n    <span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"数据库命令规范\" tid=\"tid-dXGdFX\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">数据库命令规范</span></b></h1></span>\n<ol>\n<li>\n<p>所有数据库对象名称必须使用小写字母并用下划线分割</p>\n</li>\n<li>\n<p>所有数据库对象名称禁止使用mysql保留关键字（如果表名中包含关键字查询时，需要将其用单引号括起来）</p>\n</li>\n<li>\n<p>数据库对象的命名要能做到见名识意，并且最后不要超过32个字符</p>\n</li>\n<li>\n<p>临时库表必须以tmp_为前缀并以日期为后缀，备份表必须以bak_为前缀并以日期(时间戳)为后缀</p>\n</li>\n<li>\n<p>所有存储相同数据的列名和列类型必须一致（一般作为关联列，如果查询时关联列类型不一致会自动进行数据类型隐式转换，会造成列上的索引失效，导致查询效率降低）</p>\n</li>\n</ol>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"数据库基本设计规范\" tid=\"tid-xDdGSD\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">数据库基本设计规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"1-所有表必须使用innodb存储引擎\" tid=\"tid-M22sQr\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">1. 所有表必须使用Innodb存储引擎</span></b></h2></span>\n<code-box id=\"TxjXEa\" style=\"position: relative;display: block;\"><button code-id=\"TxjXEa\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-TxjXEa\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153); opacity: 0; visibility: hidden;\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-TxjXEa\" class=\"mCustomScrollbar _mCS_1 mCS-autoHide\"><div id=\"mCSB_1\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" style=\"max-height: none;\" tabindex=\"0\"><div id=\"mCSB_1_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 1119px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-mi3QRF\"><code-line class=\"line-numbers-rows\"></code-line>没有特殊要求（即<span class=\"hljs-selector-tag\">Innodb</span>无法满足的功能如：列存储，存储空间数据等）的情况下，所有表必须使用<span class=\"hljs-selector-tag\">Innodb</span>存储引擎（<span class=\"hljs-selector-tag\">mysql5</span><span class=\"hljs-selector-class\">.5</span>之前默认使用<span class=\"hljs-selector-tag\">Myisam</span>，5<span class=\"hljs-selector-class\">.6</span>以后默认的为<span class=\"hljs-selector-tag\">Innodb</span>）\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-selector-tag\">Innodb</span> 支持事务，支持行级锁，更好的恢复性，高并发下性能更好\n</code-pre></div></div><div id=\"mCSB_1_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_1_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_1_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_1_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_1_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_1_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 689px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"2-数据库和表的字符集统一使用utf8\" tid=\"tid-iRmkR3\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>2</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">2. 数据库和表的字符集统一使用UTF8</span></b></h2></span>\n<code-box id=\"3Pk2RH\" style=\"position: relative;display: block;\"><button code-id=\"3Pk2RH\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-3Pk2RH\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-3Pk2RH\" class=\"mCustomScrollbar _mCS_2 mCS-autoHide\"><div id=\"mCSB_2\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_2_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 1218px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-3k77G4\"><code-line class=\"line-numbers-rows\"></code-line>兼容性更好，统一字符集可以避免由于字符集转换产生的乱码，不同的字符集进行比较前需要进行转换会造成索引失效，如果数据库中有存储emoji表情的需要，字符集需要采用utf8mb4字符集\n</code-pre></div></div><div id=\"mCSB_2_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_2_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_2_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_2_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_2_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_2_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 633px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"3-所有表和字段都需要添加注释\" tid=\"tid-ZcdzNY\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>3</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">3. 所有表和字段都需要添加注释</span></b></h2></span>\n<code-box id=\"WZmYWG\" style=\"position: relative;display: block;\"><button code-id=\"WZmYWG\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-WZmYWG\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-WZmYWG\" class=\"mCustomScrollbar _mCS_3 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_3\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_3_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-jSBRJW\"><code-line class=\"line-numbers-rows\"></code-line>使用<span class=\"hljs-keyword\">comment</span>从句添加表和列的备注\n<code-line class=\"line-numbers-rows\"></code-line>从一开始就进行数据字典的维护\n</code-pre></div></div><div id=\"mCSB_3_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_3_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_3_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_3_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_3_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_3_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"4-尽量控制单表数据量的大小，建议控制在500万以内\" tid=\"tid-CSSbny\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>4</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">4. 尽量控制单表数据量的大小，建议控制在500万以内</span></b></h2></span>\n<p>500万并不是Mysql数据库的限制，过大会造成修改表结构，备份，恢复都会有很大的问题<br>\n可以用历史数据归档（应用于日志数据），分库分表（应用于业务数据）等手段来控制数据量大小</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"5-谨慎使用mysql分区表\" tid=\"tid-did7m3\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>5</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">5. 谨慎使用Mysql分区表</span></b></h2></span>\n<code-box id=\"mCEnCs\" style=\"position: relative;display: block;\"><button code-id=\"mCEnCs\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-mCEnCs\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-mCEnCs\" class=\"mCustomScrollbar _mCS_4 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_4\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_4_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-nPyWFb\"><code-line class=\"line-numbers-rows\"></code-line>分区表在物理上表现为多个文件，在逻辑上表现为一个表\n<code-line class=\"line-numbers-rows\"></code-line>谨慎选择分区键，跨分区查询效率可能更低\n<code-line class=\"line-numbers-rows\"></code-line>建议采用物理分表的方式管理大数据\n</code-pre></div></div><div id=\"mCSB_4_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_4_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_4_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_4_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_4_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_4_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"6-尽量做到冷热数据分离，减小表的宽度\" tid=\"tid-RMJw86\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>6</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">6. 尽量做到冷热数据分离，减小表的宽度</span></b></h2></span>\n<code-box id=\"TpRMPW\" style=\"position: relative;display: block;\"><button code-id=\"TpRMPW\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-TpRMPW\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-TpRMPW\" class=\"mCustomScrollbar _mCS_5 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_5\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_5_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-mcDGp8\"><code-line class=\"line-numbers-rows\"></code-line>Mysql限制每个表最多存储4096列，并且每一行数据的大小不能超过65535字节\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>减少磁盘IO,保证热数据的内存缓存命中率（表越宽，把表装载进内存缓冲池时所占用的内存也就越大,也会消耗更多的IO）\n<code-line class=\"line-numbers-rows\"></code-line>更有效的利用缓存，避免读入无用的冷数据\n<code-line class=\"line-numbers-rows\"></code-line>经常一起使用的列放到一个表中（避免更多的关联操作）\n</code-pre></div></div><div id=\"mCSB_5_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_5_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_5_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_5_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_5_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_5_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"7-禁止在表中建立预留字段\" tid=\"tid-DFnSFQ\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>7</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">7. 禁止在表中建立预留字段</span></b></h2></span>\n<code-box id=\"cbSQwE\" style=\"position: relative;display: block;\"><button code-id=\"cbSQwE\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-cbSQwE\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-cbSQwE\" class=\"mCustomScrollbar _mCS_6 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_6\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_6_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-PGjD2K\"><code-line class=\"line-numbers-rows\"></code-line>预留字段的命名很难做到见名识义\n<code-line class=\"line-numbers-rows\"></code-line>预留字段无法确认存储的数据类型，所以无法选择合适的类型\n<code-line class=\"line-numbers-rows\"></code-line>对预留字段类型的修改，会对表进行锁定\n</code-pre></div></div><div id=\"mCSB_6_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_6_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_6_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_6_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_6_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_6_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"8-禁止在数据库中存储图片，文件等大的二进制数据\" tid=\"tid-4h7Skp\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>8</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">8. 禁止在数据库中存储图片，文件等大的二进制数据</span></b></h2></span>\n<code-box id=\"QPH47T\" style=\"position: relative;display: block;\"><button code-id=\"QPH47T\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-QPH47T\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-QPH47T\" class=\"mCustomScrollbar _mCS_7 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_7\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_7_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-4pQczR\"><code-line class=\"line-numbers-rows\"></code-line>通常文件很大，会短时间内造成数据量快速增长，数据库进行数据库读取时，通常会进行大量的随机IO操作，文件很大时，IO操作很耗时\n<code-line class=\"line-numbers-rows\"></code-line>通常存储于文件服务器，数据库只存储文件地址信息\n</code-pre></div></div><div id=\"mCSB_7_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_7_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_7_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_7_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_7_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_7_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"9-禁止在线上做数据库压力测试\" tid=\"tid-yp56rk\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>9</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">9. 禁止在线上做数据库压力测试</span></b></h2></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"10-禁止从开发环境，测试环境直接连接生成环境数据库\" tid=\"tid-rcEBBk\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>2</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>10</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">10. 禁止从开发环境，测试环境直接连接生成环境数据库</span></b></h2></span>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"数据库字段设计规范\" tid=\"tid-hrn8EB\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">数据库字段设计规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"1-优先选择符合存储需要的最小的数据类型\" tid=\"tid-cZWQh3\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">1. 优先选择符合存储需要的最小的数据类型</span></b></h2></span>\n<code-box id=\"Knd6fr\" style=\"position: relative;display: block;\"><button code-id=\"Knd6fr\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-Knd6fr\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-Knd6fr\" class=\"mCustomScrollbar _mCS_8 mCS-autoHide\"><div id=\"mCSB_8\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_8_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 989px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-FmNMCf\"><code-line class=\"line-numbers-rows\"></code-line>原因是：列的字段越大，建立索引时所需要的空间也就越大，这样一页中所能存储的索引节点的数量也就越少也越少，在遍历时所需要的IO次数也就越多，\n<code-line class=\"line-numbers-rows\"></code-line>索引的性能也就越差\n<code-line class=\"line-numbers-rows\"></code-line>方法：\n</code-pre></div></div><div id=\"mCSB_8_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_8_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_8_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_8_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_8_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_8_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 779px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<ul>\n<li>将字符串转换成数字类型存储，如：将IP地址转换成整形数据</li>\n</ul>\n<p>mysql提供了两个方法来处理ip地址</p>\n<p>inet_aton 把ip转为无符号整型(4-8位)<br>\ninet_ntoa 把整型的ip转为地址</p>\n<p>插入数据前，先用inet_aton把ip地址转为整型，可以节省空间<br>\n显示数据时，使用inet_ntoa把整型的ip地址转为地址显示即可。</p>\n<ul>\n<li>对于非负型的数据（如自增ID、整型IP）来说，要优先使用无符号整型来存储</li>\n</ul>\n<p>因为：无符号相对于有符号可以多出一倍的存储空间<br>\nSIGNED INT -2147483648~2147483647<br>\nUNSIGNED INT         0~4294967295</p>\n<p>VARCHAR(N)中的N代表的是字符数，而不是字节数<br>\n使用UTF8存储255个汉字 Varchar(255)=765个字节</p>\n<p>过大的长度会消耗更多的内存</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"2-避免使用text、blob数据类型，最常见的text类型可以存储64k的数据\" tid=\"tid-3RJYxX\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>2</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">2. 避免使用TEXT、BLOB数据类型，最常见的TEXT类型可以存储64k的数据</span></b></h2></span>\n<ul>\n<li>建议把BLOB或是TEXT列分离到单独的扩展表中</li>\n</ul>\n<p>Mysql内存临时表不支持TEXT、BLOB这样的大数据类型，如果查询中包含这样的数据，在排序等操作时，就不能使用内存临时表，必须使用磁盘临时表进行<br>\n而且对于这种数据，Mysql还是要进行二次查询，会使sql性能变得很差，但是不是说一定不能使用这样的数据类型</p>\n<p>如果一定要使用，建议把BLOB或是TEXT列分离到单独的扩展表中，查询时一定不要使用select * 而只需要取出必要的列，不需要TEXT列的数据时不要对该列进行查询</p>\n<ul>\n<li>TEXT或BLOB类型只能使用前缀索引</li>\n</ul>\n<p>因为MySQL对索引字段长度是有限制的，所以TEXT类型只能使用前缀索引，并且TEXT列上是不能有默认值的</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"3-避免使用enum类型\" tid=\"tid-KkZy7P\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>3</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">3. 避免使用ENUM类型</span></b></h2></span>\n<p>修改ENUM值需要使用ALTER语句<br>\nENUM类型的ORDER BY操作效率低，需要额外操作<br>\n禁止使用数值作为ENUM的枚举值</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"4-尽可能把所有列定义为not-null\" tid=\"tid-6xJhiD\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>4</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">4. 尽可能把所有列定义为NOT NULL</span></b></h2></span>\n<p>原因：<br>\n索引NULL列需要额外的空间来保存，所以要占用更多的空间<br>\n进行比较和计算时要对NULL值做特别的处理</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"5-使用timestamp（4个字节）或datetime类型（8个字节）存储时间\" tid=\"tid-ZD5tZx\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>5</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">5. 使用TIMESTAMP（4个字节）或DATETIME类型（8个字节）存储时间</span></b></h2></span>\n<p>TIMESTAMP 存储的时间范围 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07<br>\nTIMESTAMP 占用4字节和INT相同，但比INT可读性高<br>\n超出TIMESTAMP取值范围的使用DATETIME类型存储</p>\n<p>经常会有人用字符串存储日期型的数据（不正确的做法）<br>\n缺点1：无法用日期函数进行计算和比较<br>\n缺点2：用字符串存储日期要占用更多的空间</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"6-同财务相关的金额类数据必须使用decimal类型\" tid=\"tid-eTMGwF\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>3</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>6</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">6. 同财务相关的金额类数据必须使用decimal类型</span></b></h2></span>\n<ul>\n<li>非精准浮点：float,double</li>\n<li>精准浮点：decimal</li>\n</ul>\n<p>Decimal类型为精准浮点数，在计算时不会丢失精度<br>\n占用空间由定义的宽度决定，每4个字节可以存储9位数字，并且小数点要占用一个字节<br>\n可用于存储比bigint更大的整型数据</p>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"索引设计规范\" tid=\"tid-e6MHjA\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>4</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">索引设计规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"1-限制每张表上的索引数量，建议单张表索引不超过5个\" tid=\"tid-Tz4TR2\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>4</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">1. 限制每张表上的索引数量，建议单张表索引不超过5个</span></b></h2></span>\n<code-box id=\"QGHwiR\" style=\"position: relative;display: block;\"><button code-id=\"QGHwiR\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-QGHwiR\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-QGHwiR\" class=\"mCustomScrollbar _mCS_9 mCS-autoHide\"><div id=\"mCSB_9\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_9_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 952px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-HKp226\"><code-line class=\"line-numbers-rows\"></code-line>索引并不是越多越好！索引可以提高效率同样可以降低效率\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>索引可以增加查询效率，但同样也会降低插入和更新的效率，甚至有些情况下会降低查询效率\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>因为mysql优化器在选择如何优化查询时，会根据统一信息，对每一个可以用到的索引来进行评估，以生成出一个最好的执行计划，如果同时有很多个\n<code-line class=\"line-numbers-rows\"></code-line>索引都可以用于查询，就会增加mysql优化器生成执行计划的时间，同样会降低查询性能 \n</code-pre></div></div><div id=\"mCSB_9_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_9_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_9_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_9_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_9_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_9_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 810px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"2-禁止给表中的每一列都建立单独的索引\" tid=\"tid-ayB8Gz\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>4</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>2</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">2. 禁止给表中的每一列都建立单独的索引</span></b></h2></span>\n<code-box id=\"CaCdYA\" style=\"position: relative;display: block;\"><button code-id=\"CaCdYA\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-CaCdYA\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-CaCdYA\" class=\"mCustomScrollbar _mCS_10 mCS-autoHide\"><div id=\"mCSB_10\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_10_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 951px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-nnyzdM\"><code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-attribute\">5</span>.<span class=\"hljs-number\">6</span>版本之前，一个sql只能使用到一个表中的一个索引，<span class=\"hljs-number\">5</span>.<span class=\"hljs-number\">6</span>以后，虽然有了合并索引的优化方式，但是还是远远没有使用一个联合索引的查询方式好\n</code-pre></div></div><div id=\"mCSB_10_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_10_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_10_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_10_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_10_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_10_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 811px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"3-每个innodb表必须有个主键\" tid=\"tid-NswJ3r\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>4</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>3</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">3. 每个Innodb表必须有个主键</span></b></h2></span>\n<code-box id=\"fy2QbN\" style=\"position: relative;display: block;\"><button code-id=\"fy2QbN\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-fy2QbN\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-fy2QbN\" class=\"mCustomScrollbar _mCS_11 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_11\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_11_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-ic6EYy\"><code-line class=\"line-numbers-rows\"></code-line>Innodb是一种索引组织表：数据的存储的逻辑顺序和索引的顺序是相同的\n<code-line class=\"line-numbers-rows\"></code-line>每个表都可以有多个索引，但是表的存储顺序只能有一种\n<code-line class=\"line-numbers-rows\"></code-line>Innodb是按照主键索引的顺序来组织表的\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>不要使用更新频繁的列作为主键，不适用多列主键（相当于联合索引）\n<code-line class=\"line-numbers-rows\"></code-line>不要使用UUID,MD5,HASH,字符串列作为主键（无法保证数据的顺序增长）\n<code-line class=\"line-numbers-rows\"></code-line>主键建议使用自增ID值\n</code-pre></div></div><div id=\"mCSB_11_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_11_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_11_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_11_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_11_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_11_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"常见索引列建议\" tid=\"tid-nMTmKS\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>5</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">常见索引列建议</span></b></h1></span>\n<ol>\n<li>\n<p>出现在SELECT、UPDATE、DELETE语句的WHERE从句中的列</p>\n</li>\n<li>\n<p>包含在ORDER BY、GROUP BY、DISTINCT中的字段</p>\n<p>并不要将符合1和2中的字段的列都建立一个索引， 通常将1、2中的字段建立联合索引效果更好</p>\n</li>\n<li>\n<p>多表join的关联列</p>\n</li>\n</ol>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"如何选择索引列的顺序\" tid=\"tid-nRAyWx\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>6</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">如何选择索引列的顺序</span></b></h1></span>\n<code-box id=\"iNB86D\" style=\"position: relative;display: block;\"><button code-id=\"iNB86D\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-iNB86D\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-iNB86D\" class=\"mCustomScrollbar _mCS_12 mCS-autoHide\"><div id=\"mCSB_12\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_12_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 895px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-bcfnMb\"><code-line class=\"line-numbers-rows\"></code-line>建立索引的目的是：希望通过索引进行数据查找，减少随机IO，增加查询性能 ，索引能过滤出越少的数据，则从磁盘中读入的数据也就越少\n</code-pre></div></div><div id=\"mCSB_12_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_12_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_12_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_12_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_12_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_12_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 861px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<ol>\n<li>区分度最高的放在联合索引的最左侧（区分度=列中不同值的数量/列的总行数）</li>\n<li>尽量把字段长度小的列放在联合索引的最左侧（因为字段长度越小，一页能存储的数据量越大，IO性能也就越好）</li>\n<li>使用最频繁的列放到联合索引的左侧（这样可以比较少的建立一些索引）</li>\n</ol>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"避免建立冗余索引和重复索引（增加了查询优化器生成执行计划的时间）\" tid=\"tid-wFkHyP\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>7</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">避免建立冗余索引和重复索引（增加了查询优化器生成执行计划的时间）</span></b></h1></span>\n<code-box id=\"wHxnrS\" style=\"position: relative;display: block;\"><button code-id=\"wHxnrS\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-wHxnrS\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-wHxnrS\" class=\"mCustomScrollbar _mCS_13 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_13\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_13_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-iSXpWh\"><code-line class=\"line-numbers-rows\"></code-line>重复索引示例：<span class=\"hljs-selector-tag\">primary</span> <span class=\"hljs-selector-tag\">key</span>(id)、<span class=\"hljs-selector-tag\">index</span>(id)、<span class=\"hljs-selector-tag\">unique</span> <span class=\"hljs-selector-tag\">index</span>(id)\n<code-line class=\"line-numbers-rows\"></code-line>冗余索引示例：<span class=\"hljs-selector-tag\">index</span>(a,b,c)、<span class=\"hljs-selector-tag\">index</span>(a,b)、<span class=\"hljs-selector-tag\">index</span>(a)\n</code-pre></div></div><div id=\"mCSB_13_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_13_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_13_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_13_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_13_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_13_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"对于频繁的查询优先考虑使用覆盖索引\" tid=\"tid-xs4MfH\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>8</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">对于频繁的查询优先考虑使用覆盖索引</span></b></h1></span>\n<p>覆盖索引：就是包含了所有查询字段(where,select,ordery by,group by包含的字段)的索引</p>\n<p>覆盖索引的好处:</p>\n<ol>\n<li>避免Innodb表进行索引的二次查询</li>\n</ol>\n<p>Innodb是以聚集索引的顺序来存储的，对于Innodb来说，二级索引在叶子节点中所保存的是行的主键信息，<br>\n如果是用二级索引查询数据的话，在查找到相应的键值后，还要通过主键进行二次查询才能获取我们真实所需要的数据<br>\n而在覆盖索引中，二级索引的键值中可以获取所有的数据，避免了对主键的二次查询 ，减少了IO操作，提升了查询效率</p>\n<ol start=\"2\">\n<li>可以把随机IO变成顺序IO加快查询效率</li>\n</ol>\n<p>由于覆盖索引是按键值的顺序存储的，对于IO密集型的范围查找来说，对比随机从磁盘读取每一行的数据IO要少的多，<br>\n因此利用覆盖索引在访问时也可以把磁盘的随机读取的IO转变成索引查找的顺序IO</p>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"索引set规范\" tid=\"tid-3wMem3\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>9</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">索引SET规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"尽量避免使用外键约束\" tid=\"tid-SZGGck\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>9</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">尽量避免使用外键约束</span></b></h2></span>\n<p>不建议使用外键约束（foreign key），但一定要在表与表之间的关联键上建立索引<br>\n外键可用于保证数据的参照完整性，但建议在业务端实现<br>\n外键会影响父表和子表的写操作从而降低性能</p>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"数据库sql开发规范\" tid=\"tid-dp4cDd\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">数据库SQL开发规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"1-建议使用预编译语句进行数据库操作\" tid=\"tid-aXMRZ4\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">1. 建议使用预编译语句进行数据库操作</span></b></h2></span>\n<code-box id=\"hEhMcy\" style=\"position: relative;display: block;\"><button code-id=\"hEhMcy\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-hEhMcy\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-hEhMcy\" class=\"mCustomScrollbar _mCS_14 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_14\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_14_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-imPhik\"><code-line class=\"line-numbers-rows\"></code-line>预编译语句可以重复使用这些计划，减少SQL编译所需要的时间，还可以解决动态SQL所带来的SQL注入的问题\n<code-line class=\"line-numbers-rows\"></code-line>只传参数，比传递SQL语句更高效\n<code-line class=\"line-numbers-rows\"></code-line>相同语句可以一次解析，多次使用，提高处理效率\n</code-pre></div></div><div id=\"mCSB_14_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_14_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_14_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_14_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_14_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_14_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"2-避免数据类型的隐式转换\" tid=\"tid-GdsJ43\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>2</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">2. 避免数据类型的隐式转换</span></b></h2></span>\n<code-box id=\"w5aN48\" style=\"position: relative;display: block;\"><button code-id=\"w5aN48\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-w5aN48\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-w5aN48\" class=\"mCustomScrollbar _mCS_15 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_15\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_15_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-dtfxAd\"><code-line class=\"line-numbers-rows\"></code-line>隐式转换会导致索引失效\n<code-line class=\"line-numbers-rows\"></code-line>如:  <span class=\"hljs-keyword\">select</span> <span class=\"hljs-keyword\">name</span>,phone <span class=\"hljs-keyword\">from</span> customer <span class=\"hljs-keyword\">where</span> <span class=\"hljs-keyword\">id</span> = <span class=\"hljs-string\">'111'</span>;\n</code-pre></div></div><div id=\"mCSB_15_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_15_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_15_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_15_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_15_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_15_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"3-充分利用表上已经存在的索引\" tid=\"tid-WjeSDj\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>3</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">3. 充分利用表上已经存在的索引</span></b></h2></span>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"避免使用双号的查询条件。\" tid=\"tid-xFW8kY\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">避免使用双%号的查询条件。</span></b></h3></span>\n<p>如 a like '%123%'，（如果无前置%,只有后置%，是可以用到列上的索引的）</p>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"一个sql只能利用到复合索引中的一列进行范围查询\" tid=\"tid-Kmz4wB\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">一个SQL只能利用到复合索引中的一列进行范围查询</span></b></h3></span>\n<code-box id=\"8wxtn4\" style=\"position: relative;display: block;\"><button code-id=\"8wxtn4\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-8wxtn4\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-8wxtn4\" class=\"mCustomScrollbar _mCS_16 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_16\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_16_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-dtkNAi\"><code-line class=\"line-numbers-rows\"></code-line>如 有 a,b,<span class=\"hljs-built_in\">c</span>列的联合索引，在查询条件中有a列的范围查询，则在b,<span class=\"hljs-built_in\">c</span>列上的索引将不会被用到，\n<code-line class=\"line-numbers-rows\"></code-line>在定义联合索引时，如果a列要用到范围查找的话，就要把a列放到联合索引的右侧\n</code-pre></div></div><div id=\"mCSB_16_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_16_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_16_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_16_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_16_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_16_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"使用left-join-或-not-exists-来优化not-in-操作\" tid=\"tid-swkdF3\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">使用left join 或 not exists 来优化not in 操作</span></b></h3></span>\n<code-box id=\"pw7CN8\" style=\"position: relative;display: block;\"><button code-id=\"pw7CN8\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-pw7CN8\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-pw7CN8\" class=\"mCustomScrollbar _mCS_17 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_17\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_17_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-M2mWzX\"><code-line class=\"line-numbers-rows\"></code-line>因为not in 也通常会使用索引失效\n</code-pre></div></div><div id=\"mCSB_17_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_17_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_17_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_17_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_17_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_17_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"4-数据库设计时，应该要对以后扩展进行考虑\" tid=\"tid-bGJ2DX\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>4</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">4. 数据库设计时，应该要对以后扩展进行考虑</span></b></h2></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"5-程序连接不同的数据库使用不同的账号，进制跨库查询\" tid=\"tid-8WD7CT\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>5</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">5. 程序连接不同的数据库使用不同的账号，进制跨库查询</span></b></h2></span>\n<code-box id=\"piAeyt\" style=\"position: relative;display: block;\"><button code-id=\"piAeyt\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-piAeyt\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-piAeyt\" class=\"mCustomScrollbar _mCS_18 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_18\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_18_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-xW2CTF\"><code-line class=\"line-numbers-rows\"></code-line>为数据库迁移和分库分表留出余地\n<code-line class=\"line-numbers-rows\"></code-line>降低业务耦合度\n<code-line class=\"line-numbers-rows\"></code-line>避免权限过大而产生的安全风险\n</code-pre></div></div><div id=\"mCSB_18_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_18_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_18_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_18_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_18_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_18_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"6-禁止使用select--必须使用select-字段列表-查询\" tid=\"tid-GdXF75\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>6</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">6. 禁止使用SELECT * 必须使用SELECT &lt;字段列表&gt; 查询</span></b></h2></span>\n<code-box id=\"KtW4XQ\" style=\"position: relative;display: block;\"><button code-id=\"KtW4XQ\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-KtW4XQ\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-KtW4XQ\" class=\"mCustomScrollbar _mCS_19 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_19\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_19_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-G5kaBf\"><code-line class=\"line-numbers-rows\"></code-line>原因：\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-code\">    消耗更多的CPU和IO以网络带宽资源\n<code-line class=\"line-numbers-rows\"></code-line>    无法使用覆盖索引\n<code-line class=\"line-numbers-rows\"></code-line>    可减少表结构变更带来的影响\n<code-line class=\"line-numbers-rows\"></code-line></span></code-pre></div></div><div id=\"mCSB_19_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_19_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_19_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_19_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_19_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_19_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"7-禁止使用不含字段列表的insert语句\" tid=\"tid-RAPZnf\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>7</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">7. 禁止使用不含字段列表的INSERT语句</span></b></h2></span>\n<code-box id=\"PhpdJM\" style=\"position: relative;display: block;\"><button code-id=\"PhpdJM\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-PhpdJM\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-PhpdJM\" class=\"mCustomScrollbar _mCS_20 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_20\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_20_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-NZ7T5e\"><code-line class=\"line-numbers-rows\"></code-line>如： <span class=\"hljs-keyword\">insert</span> <span class=\"hljs-keyword\">into</span> <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>);\n<code-line class=\"line-numbers-rows\"></code-line>应使用 <span class=\"hljs-keyword\">insert</span> <span class=\"hljs-keyword\">into</span> t(c1,c2,c3) <span class=\"hljs-keyword\">values</span> (<span class=\"hljs-string\">'a'</span>,<span class=\"hljs-string\">'b'</span>,<span class=\"hljs-string\">'c'</span>);\n</code-pre></div></div><div id=\"mCSB_20_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_20_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_20_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_20_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_20_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_20_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"8-避免使用子查询，可以把子查询优化为join操作\" tid=\"tid-Xkz7yB\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>8</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">8. 避免使用子查询，可以把子查询优化为join操作</span></b></h2></span>\n<code-box id=\"krbyTs\" style=\"position: relative;display: block;\"><button code-id=\"krbyTs\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-krbyTs\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-krbyTs\" class=\"mCustomScrollbar _mCS_21 mCS-autoHide\"><div id=\"mCSB_21\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_21_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 1025px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-PswQdt\"><code-line class=\"line-numbers-rows\"></code-line>通常子查询在<span class=\"hljs-keyword\">in</span>子句中，且子查询中为简单SQL(不包含union、<span class=\"hljs-keyword\">group</span> <span class=\"hljs-keyword\">by</span>、<span class=\"hljs-keyword\">order</span> <span class=\"hljs-keyword\">by</span>、limit从句)时,才可以把子查询转化为关联查询进行优化\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>子查询性能差的原因：\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line> 子查询的结果集无法使用索引，通常子查询的结果集会被存储到临时表中，不论是内存临时表还是磁盘临时表都不会存在索引，所以查询性能会受到一定的影响\n<code-line class=\"line-numbers-rows\"></code-line> 特别是对于返回结果集比较大的子查询，其对查询性能的影响也就越大\n<code-line class=\"line-numbers-rows\"></code-line> 由于子查询会产生大量的临时表也没有索引，所以会消耗过多的CPU和IO资源，产生大量的慢查询\n</code-pre></div></div><div id=\"mCSB_21_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_21_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_21_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_21_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_21_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_21_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 752px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"9-避免使用join关联太多的表\" tid=\"tid-x3cnCY\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>9</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">9. 避免使用JOIN关联太多的表</span></b></h2></span>\n<code-box id=\"6W7cHz\" style=\"position: relative;display: block;\"><button code-id=\"6W7cHz\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-6W7cHz\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-6W7cHz\" class=\"mCustomScrollbar _mCS_22 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_22\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_22_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-CX43TG\"><code-line class=\"line-numbers-rows\"></code-line>对于Mysql来说，是存在关联缓存的，缓存的大小可以由<span class=\"hljs-keyword\">join_buffer_size参数进行设置\n<code-line class=\"line-numbers-rows\"></code-line></span>在Mysql中，对于同一个SQL多关联（<span class=\"hljs-keyword\">join）一个表，就会多分配一个关联缓存，如果在一个SQL中关联的表越多，\n<code-line class=\"line-numbers-rows\"></code-line></span>所占用的内存也就越大\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>如果程序中大量的使用了多表关联的操作，同时<span class=\"hljs-keyword\">join_buffer_size设置的也不合理的情况下，就容易造成服务器内存溢出的情况，\n<code-line class=\"line-numbers-rows\"></code-line></span>就会影响到服务器数据库性能的稳定性\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>同时对于关联操作来说，会产生临时表操作，影响查询效率\n<code-line class=\"line-numbers-rows\"></code-line>Mysql最多允许关联<span class=\"hljs-number\">61</span>个表，建议不超过<span class=\"hljs-number\">5</span>个\n</code-pre></div></div><div id=\"mCSB_22_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_22_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_22_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_22_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_22_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_22_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"10-减少同数据库的交互次数\" tid=\"tid-JfhnmT\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>10</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">10. 减少同数据库的交互次数</span></b></h2></span>\n<code-box id=\"rz7ist\" style=\"position: relative;display: block;\"><button code-id=\"rz7ist\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-rz7ist\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-rz7ist\" class=\"mCustomScrollbar _mCS_23 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_23\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_23_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-nR28sw\"><code-line class=\"line-numbers-rows\"></code-line>数据库更适合处理批量操作\n<code-line class=\"line-numbers-rows\"></code-line>合并多个相同的操作到一起，可以提高处理效率\n</code-pre></div></div><div id=\"mCSB_23_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_23_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_23_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_23_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_23_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_23_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"11-对应同一列进行or判断时，使用in代替or\" tid=\"tid-aE8jsT\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>11</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">11. 对应同一列进行or判断时，使用in代替or</span></b></h2></span>\n<code-box id=\"aJKWrN\" style=\"position: relative;display: block;\"><button code-id=\"aJKWrN\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-aJKWrN\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-aJKWrN\" class=\"mCustomScrollbar _mCS_24 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_24\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_24_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-FdRDHt\"><code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-attr\">in</span> <span class=\"hljs-string\">的值不要超过500个</span>\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-attr\">in</span> <span class=\"hljs-string\">操作可以更有效的利用索引，or大多数情况下很少能利用到索引</span>\n</code-pre></div></div><div id=\"mCSB_24_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_24_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_24_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_24_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_24_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_24_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"12-禁止使用order-by-rand-进行随机排序\" tid=\"tid-Jdx5X3\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>12</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">12. 禁止使用order by rand() 进行随机排序</span></b></h2></span>\n<code-box id=\"Hs4bBh\" style=\"position: relative;display: block;\"><button code-id=\"Hs4bBh\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-Hs4bBh\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-Hs4bBh\" class=\"mCustomScrollbar _mCS_25 mCS-autoHide\"><div id=\"mCSB_25\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_25_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y\" style=\"position: relative; top: 0px; left: 0px; width: 1105px;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-nPJrXE\"><code-line class=\"line-numbers-rows\"></code-line>会把表中所有符合条件的数据装载到内存中，然后在内存中对所有数据根据随机生成的值进行排序，并且可能会对每一行都生成一个随机值，如果满足条件的数据集非常大，\n<code-line class=\"line-numbers-rows\"></code-line>就会消耗大量的<span class=\"hljs-meta\">CPU</span>和IO及内存资源\n<code-line class=\"line-numbers-rows\"></code-line>推荐在程序中获取一个随机值，然后从数据库中获取数据的方式\n</code-pre></div></div><div id=\"mCSB_25_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_25_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_25_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_25_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_25_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: block;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_25_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; display: block; width: 698px; max-width: 866px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"13-where从句中禁止对列进行函数转换和计算\" tid=\"tid-X7ZxkY\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>13</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">13. WHERE从句中禁止对列进行函数转换和计算</span></b></h2></span>\n<code-box id=\"7NeYJS\" style=\"position: relative;display: block;\"><button code-id=\"7NeYJS\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-7NeYJS\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-7NeYJS\" class=\"mCustomScrollbar _mCS_26 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_26\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_26_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-TmXDZb\"><code-line class=\"line-numbers-rows\"></code-line>对列进行函数转换或计算时会导致无法使用索引\n<code-line class=\"line-numbers-rows\"></code-line>\n<code-line class=\"line-numbers-rows\"></code-line>不推荐：\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-function\"><span class=\"hljs-keyword\">where</span> <span class=\"hljs-title\">date</span>(<span class=\"hljs-params\">create_time</span>)</span>=<span class=\"hljs-string\">'20190101'</span>\n<code-line class=\"line-numbers-rows\"></code-line>推荐：\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-keyword\">where</span> create_time &gt;= <span class=\"hljs-string\">'20190101'</span> <span class=\"hljs-keyword\">and</span> create_time &lt; <span class=\"hljs-string\">'20190102'</span>\n</code-pre></div></div><div id=\"mCSB_26_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_26_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_26_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_26_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_26_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_26_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"14-在明显不会有重复值时使用union-all-而不是union\" tid=\"tid-WKMjah\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>14</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">14. 在明显不会有重复值时使用UNION ALL 而不是UNION</span></b></h2></span>\n<code-box id=\"sTRBNM\" style=\"position: relative;display: block;\"><button code-id=\"sTRBNM\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-sTRBNM\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-sTRBNM\" class=\"mCustomScrollbar _mCS_27 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_27\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_27_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-xbP3ht\"><code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-attr\">UNION</span> <span class=\"hljs-string\">会把两个结果集的所有数据放到临时表中后再进行去重操作</span>\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-attr\">UNION</span> <span class=\"hljs-string\">ALL 不会再对结果集进行去重操作</span>\n</code-pre></div></div><div id=\"mCSB_27_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_27_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_27_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_27_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_27_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_27_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"15-拆分复杂的大sql为多个小sql\" tid=\"tid-PXp5M8\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>10</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>15</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">15. 拆分复杂的大SQL为多个小SQL</span></b></h2></span>\n<code-box id=\"bQYkY7\" style=\"position: relative;display: block;\"><button code-id=\"bQYkY7\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-bQYkY7\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-bQYkY7\" class=\"mCustomScrollbar _mCS_28 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_28\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_28_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-ZfKSnX\"><code-line class=\"line-numbers-rows\"></code-line>大SQL:逻辑上比较复杂，需要占用大量<span class=\"hljs-meta\">CPU</span>进行计算的SQL\n<code-line class=\"line-numbers-rows\"></code-line>MySQL 一个SQL只能使用一个<span class=\"hljs-meta\">CPU</span>进行计算\n<code-line class=\"line-numbers-rows\"></code-line>SQL拆分后可以通过并行执行来提高处理效率\n</code-pre></div></div><div id=\"mCSB_28_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_28_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_28_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_28_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_28_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_28_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h1\" class=\"header__span\" style=\"transform:scale(1.0);\"><h1 id=\"数据库操作行为规范\" tid=\"tid-YKMw6B\" class=\"header__dev\"><span style=\"\"><b class=\"dev__fe\"><i>11</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">数据库操作行为规范</span></b></h1></span>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"超100万行的批量写（update、delete、insert）操作，要分批多次进行操作\" tid=\"tid-pBydQZ\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>11</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>1</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">超100万行的批量写（UPDATE、DELETE、INSERT）操作，要分批多次进行操作</span></b></h2></span>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"1-大批量操作可能会造成严重的主从延迟\" tid=\"tid-EaGZxe\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">1. 大批量操作可能会造成严重的主从延迟</span></b></h3></span>\n<p>主从环境中,大批量操作可能会造成严重的主从延迟，大批量的写操作一般都需要执行一定长的时间，<br>\n而只有当主库上执行完成后，才会在其他从库上执行，所以会造成主库与从库长时间的延迟情况</p>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"2-binlog日志为row格式时会产生大量的日志\" tid=\"tid-et5fnk\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">2. binlog日志为row格式时会产生大量的日志</span></b></h3></span>\n<p>大批量写操作会产生大量日志，特别是对于row格式二进制数据而言，由于在row格式中会记录每一行数据的修改，我们一次修改的数据越多，<br>\n产生的日志量也就会越多，日志的传输和恢复所需要的时间也就越长，这也是造成主从延迟的一个原因</p>\n<span title-type=\"h3\" class=\"header__span\" style=\"transform:scale(0.8);left: -74.00px;\"><h3 id=\"3-避免产生大事务操作\" tid=\"tid-7xkND7\" class=\"header__dev\"><span style=\"visibility: hidden;\"><b class=\"dev__fe\"><i>1</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>0</i></b></span><span class=\"iconfont icon-weibiaoti22 titleIcon\" style=\"left: 32.00px;\"></span><b class=\"dev__developer\"><span class=\"dev__title\">3. 避免产生大事务操作</span></b></h3></span>\n<p>大批量修改数据，一定是在一个事务中进行的，这就会造成表中大批量数据进行锁定，从而导致大量的阻塞，阻塞会对MySQL的性能产生非常大的影响<br>\n特别是长时间的阻塞会占满所有数据库的可用连接，这会使生产环境中的其他应用无法连接到数据库，因此一定要注意大批量写操作要进行分批</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"对于大表使用pt-online-schema-change修改表结构\" tid=\"tid-DbsCwP\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>11</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>2</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">对于大表使用pt-online-schema-change修改表结构</span></b></h2></span>\n<ol>\n<li>避免大表修改产生的主从延迟</li>\n<li>避免在对表字段进行修改时进行锁表</li>\n</ol>\n<p>对大表数据结构的修改一定要谨慎，会造成严重的锁表操作，尤其是生产环境，是不能容忍的</p>\n<p>pt-online-schema-change它会首先建立一个与原表结构相同的新表，并且在新表上进行表结构的修改，然后再把原表中的数据复制到新表中，并在原表中增加一些触发器<br>\n把原表中新增的数据也复制到新表中，在行所有数据复制完成之后，把新表命名成原表，并把原来的表删除掉<br>\n把原来一个DDL操作，分解成多个小的批次进行</p>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"禁止为程序使用的账号赋予super权限\" tid=\"tid-ZH5AHH\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>11</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>3</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">禁止为程序使用的账号赋予super权限</span></b></h2></span>\n<code-box id=\"DTS8Yn\" style=\"position: relative;display: block;\"><button code-id=\"DTS8Yn\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-DTS8Yn\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-DTS8Yn\" class=\"mCustomScrollbar _mCS_29 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_29\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_29_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-WiDGdx\"><code-line class=\"line-numbers-rows\"></code-line>当达到最大连接数限制时，还运行<span class=\"hljs-number\">1</span>个有<span class=\"hljs-built_in\">super</span>权限的用户连接\n<code-line class=\"line-numbers-rows\"></code-line><span class=\"hljs-built_in\">super</span>权限只能留给DBA处理问题的账号使用\n</code-pre></div></div><div id=\"mCSB_29_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_29_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_29_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_29_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_29_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_29_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n<span title-type=\"h2\" class=\"header__span\" style=\"transform:scale(0.9);left: -37.00px;\"><h2 id=\"对于程序连接数据库账号，遵循权限最小原则\" tid=\"tid-xC5FhZ\" class=\"header__dev\"><span style=\"position: relative;left: -5px;\"><b class=\"dev__fe\"><i>11</i></b><span class=\"dev__slash\">|</span><b class=\"dev__ux\"><i>4</i></b></span><b class=\"dev__developer\"><span class=\"dev__title\">对于程序连接数据库账号，遵循权限最小原则</span></b></h2></span>\n<code-box id=\"a36zjE\" style=\"position: relative;display: block;\"><button code-id=\"a36zjE\" type=\"button\" class=\"clipboard code-copay-btn\" data-clipboard-action=\"copy\" data-clipboard-target=\"#pre-a36zjE\" aria-label=\"复制代码\" style=\"color: rgb(153, 153, 153);\"><i class=\"iconfont icon-fuzhi1\"></i></button><pre style=\"font-family: &quot;Ubuntu Mono&quot;, monospace !important; font-size: 14px !important; background-color: rgb(246, 248, 250); overflow: visible; position: relative;\" id=\"pre-a36zjE\" class=\"mCustomScrollbar _mCS_30 mCS-autoHide mCS_no_scrollbar\"><div id=\"mCSB_30\" class=\"mCustomScrollBox mCS-minimal-dark mCSB_vertical_horizontal mCSB_outside\" tabindex=\"0\" style=\"max-height: none;\"><div id=\"mCSB_30_container\" class=\"mCSB_container mCS_y_hidden mCS_no_scrollbar_y mCS_x_hidden mCS_no_scrollbar_x\" style=\"position: relative; top: 0px; left: 0px; width: 100%;\" dir=\"ltr\"><code-pre class=\"code-pre\" id=\"pre-dwZTpJ\"><code-line class=\"line-numbers-rows\"></code-line>程序使用数据库账号只能在一个DB下使用，不准跨库\n<code-line class=\"line-numbers-rows\"></code-line>程序使用的账号原则上不准有<span class=\"hljs-built_in\">drop</span>权限</code-pre></div></div><div id=\"mCSB_30_scrollbar_vertical\" class=\"mCSB_scrollTools mCSB_30_scrollbar mCS-minimal-dark mCSB_scrollTools_vertical\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_30_dragger_vertical\" class=\"mCSB_dragger\" style=\"position: absolute; min-height: 50px; height: 0px; top: 0px;\"><div class=\"mCSB_dragger_bar\" style=\"line-height: 50px;\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div><div id=\"mCSB_30_scrollbar_horizontal\" class=\"mCSB_scrollTools mCSB_30_scrollbar mCS-minimal-dark mCSB_scrollTools_horizontal\" style=\"display: none;\"><div class=\"mCSB_draggerContainer\"><div id=\"mCSB_30_dragger_horizontal\" class=\"mCSB_dragger\" style=\"position: absolute; min-width: 50px; width: 0px; left: 0px;\"><div class=\"mCSB_dragger_bar\"></div></div><div class=\"mCSB_draggerRail\"></div></div></div></pre></code-box>\n\n<br><p class=\"essaySuffix-eof\">__EOF__</p><div class=\"essaySuffix-box\"><div class=\"essaySuffix-box-left\"><img src=\"https://images.cnblogs.com/cnblogs_com/huchong/1886814/t_201123054445head.png?t=1606110294587\" alt=\"\"></div><div class=\"essaySuffix-box-right\"><span class=\"essaySuffix-right-title\">本文作者</span>：<strong><span style=\"font-size: 12px;\"><a href=\"https://www.cnblogs.com/huchong/p/10219318.html\" target=\"_blank\">听风。</a></span></strong> <br><span style=\"font-weight: bold; white-space:nowrap;\">本文链接</span>：<a href=\"https://www.cnblogs.com/huchong/p/10219318.html\" target=\"_blank\">https://www.cnblogs.com/huchong/p/10219318.html</a><br><span class=\"essaySuffix-right-title\">关于博主</span>：评论和私信会在第一时间回复。或者<a href=\"https://msg.cnblogs.com/msg/send/huchong\" target=\"_blank\">直接私信</a>我。<br><span class=\"essaySuffix-right-title\">版权声明</span>：本博客所有文章除特别声明外，均采用 <a href=\"https://creativecommons.org/licenses/by-nc-nd/4.0/\" alt=\"BY-NC-SA\" title=\"BY-NC-SA\" target=\"_blank\">BY-NC-SA</a> 许可协议。转载请注明出处！<br><span class=\"essaySuffix-right-title\">声援博主</span>：如果您觉得文章对您有帮助，可以点击文章右下角<strong><span style=\"color: #ff0000; font-size: 12pt;\">【<a id=\"post-up\" onclick=\"votePost(10219318,'Digg')\" href=\"javascript:void(0);\">推荐</a>】</span></strong>一下。您的鼓励是博主的最大动力！<br></div><div style=\"clear: both;\"></div></div></div>"
  },
  {
    "category": "dataBase",
    "qes": "一条SQL语句执行得很慢的原因有哪些",
    "ans": "<div id=\"page-content\" class=\"rich_media_area_primary\">\n\n\t\t  <div class=\"rich_media_area_primary_inner\">\n\n            \n                        \n                        \n\n            <div id=\"img-content\" class=\"rich_media_wrp\">\n                \n                <h2 class=\"rich_media_title\" id=\"activity-name\">\n                    \n                    \n                    \n腾讯面试：一条SQL语句执行得很慢的原因有哪些？---不看后悔系列\n                </h2>\n                <div id=\"meta_content\" class=\"rich_media_meta_list\">\n                                                                                                                            \n                                                                                                            <span class=\"rich_media_meta rich_media_meta_nickname\" id=\"profileBt\">\n                      <a href=\"javascript:void(0);\" id=\"js_name\">\n                        JavaGuide                      </a>\n                      <div id=\"js_profile_qrcode\" class=\"profile_container\" style=\"display:none;\">\n                          <div class=\"profile_inner\">\n                              <strong class=\"profile_nickname\">JavaGuide</strong>\n                              <img class=\"profile_avatar\" id=\"js_profile_qrcode_img\" src=\"\" alt=\"\">\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">微信号</label>\n                              <span class=\"profile_meta_value\">JavaGuide</span>\n                              </p>\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">功能介绍</label>\n                              <span class=\"profile_meta_value\">专注Java后端学习和大厂面试的公众号！开源项目—JavaGuide （88k+Star）作者运营维护。学习Java，首选JavaGuide！</span>\n                              </p>\n                              \n                          </div>\n                          <span class=\"profile_arrow_wrp\" id=\"js_profile_arrow_wrp\">\n                              <i class=\"profile_arrow arrow_out\"></i>\n                              <i class=\"profile_arrow arrow_in\"></i>\n                          </span>\n                      </div>\n                    </span>\n                    <em id=\"publish_time\" class=\"rich_media_meta rich_media_meta_text\">2019-04-29</em>\n                </div>\n\n                \n                                                <div id=\"js_tags\" class=\"article-tag__list\" style=\"display: none;\" data-len=\"0\">\n                                            \n                        <div class=\"article-tag-card__title\">收录于话题</div>\n                        <div class=\"article-tags\">\n                                                    </div>\n                                    </div>\n\n                \n                                \n                \n                \n\n                \n                                                                \n\n                \n                                    \n                    <div class=\"original_area_primary\" style=\"margin-bottom: 0;\">\n                                                                                                </div>\n\n                    \n                                            <div class=\"original_area_primary\">\n                            <p class=\"original_primary_card_tips\">\n                                                                    <span>以下文章来源于苦逼的码农</span>\n                                                                                                    <span>，作者帅地</span>\n                                                            </p>\n                            <a class=\"weui-flex original_primary_card appmsg_card_context appmsg_card_active\" href=\"#\" id=\"copyright_info\">\n                                <div class=\"weui-flex__hd\">\n                                    <span class=\"radius_avatar\">\n                                        <img class=\"avatar\" src=\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM4zNibDC2sPtRe5L54BQxiabOHcFbdCQ7d02EUGm3X5h0Fw/0\" alt=\"苦逼的码农\">\n                                    </span>\n                                </div>\n                                <div class=\"weui-flex__item\">\n                                    <strong class=\"original_primary_nickname\">苦逼的码农</strong>\n                                                                            <p class=\"original_primary_desc\">本号专注于讲解数据结构与算法、计算机基础(如计算机网络+操作系统+数据库+Linux)等编程知识，期待你的关注。</p>\n                                                                    </div>\n                                <div class=\"weui-flex__ft\"></div>\n                            </a>\n                        </div>\n                                                    \n\n\n                \n                \n                \n                \n                                                \n                                                                \n                                \n                                \n                \n                <div class=\"rich_media_content \" id=\"js_content\" style=\"visibility: visible;\">\n                    \n\n                    \n\n                    \n                    \n                    <blockquote style=\"box-sizing: border-box;margin: 20px 10px;padding-top: 1px;padding-bottom: 1px;font-size: 16px;white-space: normal;text-align: left;color: rgb(91, 91, 91);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;background: rgba(158, 158, 158, 0.1);border-left-color: rgb(158, 158, 158);\"><p style=\"box-sizing: border-box;margin: 10px;color: rgb(63, 63, 63);line-height: 1.6;\"><span style=\"font-size: 14px;\">本文转载自公众号:苦逼的码农 作者：帅地</span></p></blockquote><p style=\"text-align: center;margin-left: 0.5em;margin-right: 0.5em;\"><img class=\"rich_pages \" data-copyright=\"0\" data-ratio=\"0.41888888888888887\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/gsQM61GSzIP728VzIZ4dP5TcFI3AIWAh95dc714n8FibhN3os4sWQSBjrciaJ5BN6VOT9drNvQBicfpgoXHOFZwzA/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"900\" style=\"box-shadow: rgb(170, 170, 170) 0em 0em 1em 0px; width: 677px !important; height: auto !important; visibility: visible !important;\" _width=\"677px\" src=\"https://mmbiz.qpic.cn/mmbiz_jpg/gsQM61GSzIP728VzIZ4dP5TcFI3AIWAh95dc714n8FibhN3os4sWQSBjrciaJ5BN6VOT9drNvQBicfpgoXHOFZwzA/640?wx_fmt=jpeg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1\" crossorigin=\"anonymous\" data-fail=\"0\"></p><section class=\"\" style=\"font-size: 16px;margin-left: 0.5em;margin-right: 0.5em;color: rgb(62, 62, 62);line-height: 1.75;letter-spacing: 1px;\"><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">说实话，这个问题可以涉及到&nbsp;MySQL&nbsp;的很多核心知识，可以扯出一大堆，就像要考你计算机网络的知识时，问你“输入URL回车之后，究竟发生了什么”一样，看看你能说出多少了。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">之前腾讯面试的实话，也问到这个问题了，不过答的很不好，之前没去想过相关原因，导致一时之间扯不出来。所以今天，我带大家来详细扯一下有哪些原因，相信你看完之后一定会有所收获，不然你打我。</p><h3 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;font-weight: bold;font-size: 18px;margin-bottom: 2em;margin-right: 1em;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">一、开始装逼：分类讨论</span></h3><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">一条&nbsp;SQL&nbsp;语句执行的很慢，那是每次执行都很慢呢？还是大多数情况下是正常的，偶尔出现很慢呢？所以我觉得，我们还得分以下两种情况来讨论。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong>1、大多数情况是正常的，只是偶尔会出现很慢的情况。</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong>2、在数据量不变的情况下，这条SQL语句一直以来都执行的很慢。</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">针对这两种情况，我们来分析下可能是哪些原因导致的。</p><h2 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;font-weight: bold;font-size: 19px;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">二、针对偶尔很慢的情况</span></h2><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">一条&nbsp;SQL&nbsp;大多数情况正常，偶尔才能出现很慢的情况，针对这种情况，我觉得这条SQL语句的书写本身是没什么问题的，而是其他原因导致的，那会是什么原因呢？</p><h3 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;font-weight: bold;font-size: 18px;margin-bottom: 2em;margin-right: 1em;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">1、数据库在刷新脏页</span>（flush）我也无奈啊</h3><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">当我们要往数据库插入一条数据、或者要更新一条数据的时候，我们知道数据库会在<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">内存</strong>中把对应字段的数据更新了，但是更新之后，这些更新的字段并不会马上同步持久化到<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">磁盘</strong>中去，而是把这些更新的记录写入到 redo log 日记中去，等到空闲的时候，在通过 redo log 里的日记把最新的数据同步到<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">磁盘</strong>中去。</p><blockquote style=\"box-sizing: border-box;margin: 20px 10px;padding-top: 1px;padding-bottom: 1px;font-size: 16px;white-space: normal;text-align: left;color: rgb(91, 91, 91);line-height: 1.5;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;background: rgba(158, 158, 158, 0.1);border-left-color: rgb(158, 158, 158);\"><p style=\"box-sizing: border-box;margin: 10px;color: rgb(63, 63, 63);line-height: 1.6;\">当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。</p></blockquote><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong>刷脏页有下面4种场景（后两种不用太关注“性能”问题）：</strong></p><ul class=\"list-paddingleft-2\" style=\"list-style-type: disc;\"><li><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong>redolog写满了：</strong>redo log 里的容量是有限的，如果数据库一直很忙，更新又很频繁，这个时候 redo log 很快就会被写满了，这个时候就没办法等到空闲的时候再把数据同步到磁盘的，只能暂停其他操作，全身心来把数据同步到磁盘中去的，而这个时候，<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">就会导致我们平时正常的SQL语句突然执行的很慢</strong>，所以说，数据库在在同步数据到磁盘的时候，就有可能导致我们的SQL语句执行的很慢了。</p></li><li><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong>内存不够用了：</strong>如果一次查询较多的数据，恰好碰到所查数据页不在内存中时，需要申请内存，而此时恰好内存不足的时候就需要淘汰一部分内存数据页，如果是干净页，就直接释放，如果恰好是脏页就需要刷脏页。</p></li><li><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong><span style=\"color: rgb(0, 0, 0);font-family: &quot;Lucida Grande&quot;, Helvetica, Arial, STXihei, 华文细黑, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif;font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);\">MySQL 认为系统“空闲”的时候：</span></strong>这时系统没什么压力。<br></p></li><li><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong><span style=\"color: rgb(0, 0, 0);font-family: &quot;Lucida Grande&quot;, Helvetica, Arial, STXihei, 华文细黑, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif;font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);\">MySQL 正常关闭的时候：</span></strong><span style=\"color: rgb(0, 0, 0);font-family: &quot;Lucida Grande&quot;, Helvetica, Arial, STXihei, 华文细黑, &quot;Microsoft YaHei&quot;, 微软雅黑, sans-serif;font-size: 16px;text-align: left;background-color: rgb(255, 255, 255);\">这时候，MySQL 会把内存的脏页都 flush 到磁盘上，这样下次 MySQL 启动的时候，就可以直接从磁盘上读数据，启动速度会很快。</span><br></p></li></ul><h3 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;font-weight: bold;font-size: 18px;margin-bottom: 2em;margin-right: 1em;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">2、拿不到锁我能怎么办</span></h3><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">这个就比较容易想到了，我们要执行的这条语句，刚好这条语句涉及到的<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">表</strong>，别人在用，并且加锁了，我们拿不到锁，只能慢慢等待别人释放锁了。或者，表没有加锁，但要使用到的某个一行被加锁了，这个时候，我也没办法啊。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">如果要判断是否真的在等待锁，我们可以用 <strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">show processlist</strong>这个命令来查看当前的状态哦，这里我要提醒一下，有些命令最好记录一下，反正，我被问了好几个命令，都不知道怎么写，呵呵。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">下来我们来访分析下第二种情况，我觉得第二种情况的分析才是最重要的</p><h2 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;font-weight: bold;font-size: 19px;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">三、针对一直都这么慢的情况</span></h2><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">如果在数据量一样大的情况下，这条&nbsp;SQL&nbsp;语句每次都执行的这么慢，那就就要好好考虑下你的&nbsp;SQL&nbsp;书写了，下面我们来分析下哪些原因会导致我们的&nbsp;SQL&nbsp;语句执行的很不理想。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">我们先来假设我们有一个表，表里有下面两个字段,分别是主键&nbsp;id，和两个普通字段&nbsp;c&nbsp;和&nbsp;d。</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\">mysql&gt;&nbsp;CREATE&nbsp;TABLE&nbsp;`t`&nbsp;(<br>&nbsp;&nbsp;`id`&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">int</span>(<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">11</span>)&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">NOT</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">NULL</span>,<br>&nbsp;&nbsp;`c`&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">int</span>(<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">11</span>)&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">DEFAULT</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">NULL</span>,<br>&nbsp;&nbsp;`d`&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">int</span>(<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">11</span>)&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">DEFAULT</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">NULL</span>,<br>&nbsp;&nbsp;PRIMARY&nbsp;KEY&nbsp;(`id`)<br>)&nbsp;ENGINE=InnoDB;<br></code></pre><h3 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;font-weight: bold;font-size: 18px;margin-bottom: 2em;margin-right: 1em;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">1、扎心了，没用到索引</span></h3><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">没有用上索引，我觉得这个原因是很多人都能想到的，例如你要查询这条语句</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100</span>&nbsp;&lt;c&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">and</span>&nbsp;c&nbsp;&lt;&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100000</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">（1）、字段没有索引</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">刚好你的&nbsp;c&nbsp;字段上没有索引，那么抱歉，只能走全表扫描了，你就体验不会索引带来的乐趣了，所以，这回导致这条查询语句很慢。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">（2）、字段有索引，但却没有用索引</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">好吧，这个时候你给 c 这个字段加上了索引，然后又查询了一条语句</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;c&nbsp;-&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">1</span>&nbsp;=&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">1000</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">我想问大家一个问题，这样子在查询的时候会用索引查询吗？</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">答是不会，如果我们在字段的左边做了运算，那么很抱歉，在查询的时候，就不会用上索引了，所以呢，大家要注意这种<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">字段上有索引，但由于自己的疏忽，导致系统没有使用索引</strong>的情况了。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">正确的查询应该如下</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;c&nbsp;=&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">1000</span>&nbsp;+&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">1</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">有人可能会说，右边有运算就能用上索引？难道数据库就不会自动帮我们优化一下，自动把&nbsp;c&nbsp;-&nbsp;1=1000&nbsp;自动转换为&nbsp;c&nbsp;=&nbsp;1000+1。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">不好意思，确实不会帮你，所以，你要注意了。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">（3）、函数操作导致没有用上索引</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">如果我们在查询的时候，对字段进行了函数操作，也是会导致没有用上索引的，例如</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">pow</span>(c,<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">2</span>)&nbsp;=&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">1000</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">这里我只是做一个例子，假设函数&nbsp;pow&nbsp;是求&nbsp;c&nbsp;的&nbsp;n&nbsp;次方，实际上可能并没有&nbsp;pow(c,2)这个函数。其实这个和上面在左边做运算也是很类似的。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">所以呢，一条语句执行都很慢的时候，可能是该语句没有用上索引了，不过具体是啥原因导致没有用上索引的呢，你就要会分析了，我上面列举的三个原因，应该是出现的比较多的吧。</p><h3 style=\"color: inherit;line-height: inherit;margin-top: 1.5em;font-weight: bold;font-size: 18px;margin-bottom: 2em;margin-right: 1em;\"><span style=\"font-size: inherit;color: inherit;line-height: inherit;\">2、呵呵，数据库自己选错索引了</span></h3><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">我们在进行查询操作的时候，例如</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100</span>&nbsp;&lt;&nbsp;c&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">and</span>&nbsp;c&nbsp;&lt;&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100000</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">我们知道，主键索引和非主键索引是有区别的，主键索引存放的值是<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">整行字段的数据</strong>，而非主键索引上存放的值不是整行字段的数据，而且存放<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">主键字段的值</strong>。不大懂的可以看这篇文章：&nbsp; <a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484848&amp;idx=1&amp;sn=77a0e6e82944ec385f5df17e91ce3bf2&amp;chksm=cea24a7bf9d5c36d4b289cccb017292f9f36da9f3c887fd2b93ecd6af021fcf30121ba09799f&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"【思维导图-索引篇】搞定数据库索引就是这么简单\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;letter-spacing: 0.544px;text-align: left;text-indent: -20px;white-space: normal;background-color: rgb(255, 255, 255);overflow-wrap: break-word !important;\">【思维导图-索引篇】搞定数据库索引就是这么简单</a>&nbsp; 里面有说到主键索引和非主键索引的区别</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">也就是说，我们如果走&nbsp;c&nbsp;这个字段的索引的话，最后会查询到对应主键的值，然后，再根据主键的值走主键索引，查询到整行数据返回。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">好吧扯了这么多，其实我就是想告诉你，就算你在&nbsp;c&nbsp;字段上有索引，系统也并不一定会走&nbsp;c&nbsp;这个字段上的索引，而是有可能会直接扫描扫描全表，找出所有符合&nbsp;100&nbsp;&lt;&nbsp;c&nbsp;and&nbsp;c&nbsp;&lt;&nbsp;100000&nbsp;的数据。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">为什么会这样呢？</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">其实是这样的，系统在执行这条语句的时候，会进行预测：究竟是走&nbsp;c&nbsp;索引扫描的行数少，还是直接扫描全表扫描的行数少呢？显然，扫描行数越少当然越好了，因为扫描行数越少，意味着I/O操作的次数越少。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">如果是扫描全表的话，那么扫描的次数就是这个表的总行数了，假设为&nbsp;n；而如果走索引&nbsp;c&nbsp;的话，我们通过索引&nbsp;c&nbsp;找到主键之后，还得再通过主键索引来找我们整行的数据，也就是说，需要走两次索引。而且，我们也不知道符合&nbsp;100&nbsp;c&nbsp;&lt;&nbsp;and&nbsp;c&nbsp;&lt;&nbsp;10000&nbsp;这个条件的数据有多少行，万一这个表是全部数据都符合呢？这个时候意味着，走&nbsp;c&nbsp;索引不仅扫描的行数是&nbsp;n，同时还得每行数据走两次索引。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">所以呢，系统是有可能走全表扫描而不走索引的。那系统是怎么判断呢？</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">判断来源于系统的预测，也就是说，如果要走&nbsp;c&nbsp;字段索引的话，系统会预测走&nbsp;c&nbsp;字段索引大概需要扫描多少行。如果预测到要扫描的行数很多，它可能就不走索引而直接扫描全表了。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">那么问题来了，<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">系统是怎么预测判断的呢？</strong>这里我给你讲下系统是怎么判断的吧，虽然这个时候我已经写到脖子有点酸了。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">系统是通过<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">索引的区分度</strong>来判断的，一个索引上不同的值越多，意味着出现相同数值的索引越少，意味着索引的区分度越高。我们也把区分度称之为<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">基数</strong>，即区分度越高，基数越大。所以呢，基数越大，意味着符合&nbsp;100&nbsp;&lt;&nbsp;c&nbsp;and&nbsp;c&nbsp;&lt;&nbsp;10000&nbsp;这个条件的行数越少。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">所以呢，一个索引的基数越大，意味着走索引查询越有优势。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">那么问题来了，怎么知道这个索引的基数呢？</strong></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">系统当然是不会遍历全部来获得一个索引的基数的，代价太大了，索引系统是通过遍历部分数据，也就是通过<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">采样</strong>的方式，来预测索引的基数的。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">扯了这么多，重点的来了</strong>，居然是采样，那就有可能出现<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">失误</strong>的情况，也就是说，c&nbsp;这个索引的基数实际上是很大的，但是采样的时候，却很不幸，把这个索引的基数预测成很小。例如你采样的那一部分数据刚好基数很小，然后就误以为索引的基数很小。<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">然后就呵呵，系统就不走 c 索引了，直接走全部扫描了</strong>。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">所以呢，说了这么多，得出结论：<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">由于统计的失误，导致系统没有走索引，而是走了全表扫描</strong>，而这，也是导致我们&nbsp;SQL&nbsp;语句执行的很慢的原因。</p><blockquote style=\"line-height: inherit;padding: 15px 15px 15px 1rem;font-size: 0.9em;color: rgb(129, 145, 152);border-left-width: 6px;border-left-color: rgb(220, 230, 240);background: rgb(242, 247, 251);overflow: auto;overflow-wrap: normal;word-break: normal;\"><p style=\"font-size: inherit;color: inherit;line-height: inherit;\">这里我声明一下，系统判断是否走索引，扫描行数的预测其实只是原因之一，这条查询语句是否需要使用使用临时表、是否需要排序等也是会影响系统的选择的。</p></blockquote><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">不过呢，我们有时候也可以通过强制走索引的方式来查询，例如</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">select</span>&nbsp;*&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">force</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">index</span>(a)&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">where</span>&nbsp;c&nbsp;&lt;&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">and</span>&nbsp;c&nbsp;&lt;&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(174, 135, 250);overflow-wrap: inherit !important;word-break: inherit !important;\">100000</span>;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">我们也可以通过</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">show</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">index</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">from</span>&nbsp;t;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">来查询索引的基数和实际是否符合，如果和实际很不符合的话，我们可以重新来统计索引的基数，可以用这条命令</p><pre style=\"font-size: inherit;color: inherit;line-height: inherit;\"><code class=\"\" style=\"margin-right: 2px;margin-left: 2px;line-height: 15px;font-size: 11px;word-spacing: -3px;letter-spacing: 0px;font-family: Consolas, Inconsolata, Courier, monospace;border-radius: 0px;color: rgb(169, 183, 198);background: rgb(40, 43, 46);padding: 0.5em;display: block !important;overflow-wrap: normal !important;word-break: normal !important;overflow: auto !important;\"><span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">analyze</span>&nbsp;<span class=\"\" style=\"font-size: inherit;line-height: inherit;color: rgb(248, 35, 117);overflow-wrap: inherit !important;word-break: inherit !important;\">table</span>&nbsp;t;<br></code></pre><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">来重新统计分析。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">既然会预测错索引的基数，这也意味着，当我们的查询语句有多个索引的时候，系统有可能也会选错索引哦</strong>，这也可能是&nbsp;SQL&nbsp;执行的很慢的一个原因。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">好吧，就先扯这么多了，你到时候能扯出这么多，我觉得已经很棒了，下面做一个总结。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><span style=\"font-size: 19px;\"><strong>四、总结</strong></span></p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">以上是我的总结与理解，最后一个部分，我怕很多人不大懂<strong style=\"font-size: inherit;line-height: inherit;color: rgb(255, 104, 39);\">数据库居然会选错索引</strong>，所以我详细解释了一下，下面我对以上做一个总结。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">一个&nbsp;SQL&nbsp;执行的很慢，我们要分两种情况讨论：</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">1、大多数情况下很正常，偶尔很慢，则有如下原因</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">(1)、数据库在刷新脏页，例如&nbsp;redo&nbsp;log&nbsp;写满了需要同步到磁盘。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">(2)、执行的时候，遇到锁，如表锁、行锁。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">2、这条&nbsp;SQL&nbsp;语句一直执行的很慢，则有如下原因。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">(1)、没有用上索引：例如该字段没有索引；由于对字段进行运算、函数操作导致无法用索引。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">(2)、数据库选错了索引。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\">大家如果有补充的，也是可以留言区补充一波哦。</p><p style=\"font-size: inherit;color: inherit;line-height: inherit;margin-top: 1.5em;margin-bottom: 1.5em;\"><br></p></section><p style=\"margin-top: 5px;margin-bottom: 5px;max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;background-color: rgb(255, 255, 255);text-align: center;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><strong style=\"max-width: 100%;color: rgb(255, 169, 0);font-family: -apple-system, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Microsoft YaHei&quot;, &quot;Source Han Sans SC&quot;, &quot;Noto Sans CJK SC&quot;, &quot;WenQuanYi Micro Hei&quot;, sans-serif;font-size: 18px;letter-spacing: 1.5px;box-sizing: border-box !important;overflow-wrap: break-word !important;\">推荐阅读</strong></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485181&amp;idx=1&amp;sn=7a7a7ce0671e8c5456add8da098501c2&amp;scene=21#wechat_redirect\" title=\"不就是个短信登录API嘛，有这么复杂吗？\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">不就是个短信登录API嘛，有这么复杂吗？</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485159&amp;idx=1&amp;sn=c97c087c45ad6dfc0ef61d80a9d0f702&amp;scene=21#wechat_redirect\" title=\"盘点阿里巴巴 15 款开发者工具\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">盘点阿里巴巴 15 款开发者工具</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485147&amp;idx=1&amp;sn=90e525a83a451d8c20298a7ef2d35ab9&amp;scene=21#wechat_redirect\" title=\"蚂蚁金服2019实习生面经总结(已拿口头offer)\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">蚂蚁金服2019实习生面经总结(已拿口头offer)</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485070&amp;idx=1&amp;sn=31894a1bdda357d897962a9fc3a994b7&amp;chksm=cea24945f9d5c0531db568321f1d8d7a4e848e04aa2df18e589db9ba4aafee0fb0cebb965252&amp;token=463285003&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"记一次蚂蚁金服的面试经历\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">记一次蚂蚁金服的面试经历</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485113&amp;idx=1&amp;sn=e4dd1bb22778e4e9139bf29d98a7492b&amp;chksm=cea24972f9d5c064e5b454b84b9bc0d42f4aec007f20f79b564398e6dec7c0cdcda0e64193b5&amp;token=183738038&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"Java学习必备书籍推荐终极版！\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">Java学习必备书籍推荐终极版！</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485059&amp;idx=1&amp;sn=a881a1ba6013c1214b64bbed23420b88&amp;chksm=cea24948f9d5c05edbd94bdc705da6d10ccc5c4213b7320f64b88b9a503d1c3adfe2b88fc6d7&amp;token=463285003&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"我觉得技术人员该有的提问方式\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">我觉得技术人员该有的提问方式</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484744&amp;idx=1&amp;sn=9db31dca13d327678845054af75efb74&amp;chksm=cea24a83f9d5c3956f4feb9956b068624ab2fdd6c4a75fe52d5df5dca356a016577301399548&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"Java 8 新特性最佳指南\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">Java 8 新特性最佳指南</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484746&amp;idx=1&amp;sn=a519a9e3d638bff5c65008f7de167e4b&amp;scene=21#wechat_redirect\" title=\"做公众号这一年的经历和一件“大事”(2018-03-10)\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">做公众号这一年的经历和一件“大事”(2018-03-10)</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484789&amp;idx=1&amp;sn=2ad9fabb8fc7fae3bd3756ea05594344&amp;chksm=cea24abef9d5c3a889b6cb8e00cb18abbb694d189c84a24fa1ed337ad4c56194cd39316dc6a5&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"盘点一下Github上开源的Java面试/学习相关的仓库，看完弄懂薪资至少增加10k\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">盘点一下Github上开源的Java面试/学习相关的仓库，看完弄懂薪资至少增加10k</a>( 2018-12-24)</p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484840&amp;idx=1&amp;sn=cf4611ac290ae3cbb381fe52aa76b60b&amp;chksm=cea24a63f9d5c375215f7539ff0f3d6320f091d5f8b73e95c724ec9a31d3b5baa98c3f5a1012&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"可能是一份最适合你的后端面试指南（部分内容前端同样适用）\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">可能是一份最适合你的后端面试指南（部分内容前端同样适用）</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484858&amp;idx=1&amp;sn=8e222ea6115e0b69cac91af14d2caf36&amp;chksm=cea24a71f9d5c367148dccec3d5ddecf5ecd8ea096b5c5ec32f22080e66ac3c343e99151c9e0&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"redis 总结——重构版\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">redis 总结——重构版</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484850&amp;idx=1&amp;sn=3238360bfa8105cf758dcf7354af2814&amp;chksm=cea24a79f9d5c36fb2399aafa91d7fb2699b5006d8d037fe8aaf2e5577ff20ae322868b04a87&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"史上最全Redis高可用技术解决方案大全\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">史上最全Redis高可用技术解决方案大全</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485068&amp;idx=1&amp;sn=c37267fe59978dbfcd6a9a54eee1c502&amp;chksm=cea24947f9d5c051008233a6a938e802b710ccf919f4215f84dcc0bf1fdad7d0101d37497d33&amp;token=42880587&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"听说又被 JVM 内存区域方面的面试题给虐了？看看这篇文章吧！\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">听说又被 JVM 内存区域方面的面试题给虐了？看看这篇文章吧！</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247484877&amp;idx=1&amp;sn=f54d41b68f0cd6cc7c0348a2fddbda9f&amp;chksm=cea24a06f9d5c3102bfef946ba6c7cc5df9a503ccb14b9b141c54e179617e4923c260c0b0a01&amp;token=1082669959&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"搞定 JVM 垃圾回收就是这么简单\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">搞定 JVM 垃圾回收就是这么简单</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485097&amp;idx=1&amp;sn=84c89da477b1338bdf3e9fcd65514ac1&amp;scene=21#wechat_redirect\" title=\"一条SQL语句在MySQL中如何执行的\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">一条SQL语句在MySQL中如何执行的</a></p><p style=\"margin: 10px;max-width: 100%;box-sizing: border-box;min-height: 1em;letter-spacing: 0.544px;white-space: normal;font-size: 16px;text-align: center;color: rgb(63, 63, 63);line-height: 1.6;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;overflow-wrap: break-word !important;\"><a href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485085&amp;idx=1&amp;sn=01e5c29c49f32886bc897af7632b34ba&amp;chksm=cea24956f9d5c040a07e4d335219f11f888a2d32444c16cade3f69c294ae0a1e416bcd221fb6&amp;token=1613452699&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" title=\"一文带你轻松搞懂事务隔离级别(图文详解)\" data-linktype=\"2\" style=\"color: rgb(20, 140, 228);-webkit-tap-highlight-color: rgba(0, 0, 0, 0);max-width: 100%;box-sizing: border-box;overflow-wrap: break-word !important;\">一文带你轻松搞懂事务隔离级别(图文详解)</a></p><p style=\"max-width: 100%;min-height: 1em;white-space: normal;font-size: 16px;text-align: center;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><img class=\"rich_pages img_loading\" data-copyright=\"0\" data-ratio=\"1\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_jpg/hvUCbRic69sA3xqsu3enj7FXeAJYZexsAqlpY7yqB72DlUWmjVvmCddzI2H1ZLvV4s9iajt6ibysnQzVsBIDkafJw/640?wx_fmt=jpeg\" data-type=\"jpeg\" data-w=\"258\" style=\"box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 175px !important; height: 175px !important;\" _width=\"175px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></p><p style=\"max-width: 100%;min-height: 1em;white-space: normal;font-size: 16px;text-align: center;letter-spacing: 1.5px;line-height: 1.75em;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><span style=\"max-width: 100%;box-sizing: border-box;font-weight: 600;color: rgb(36, 41, 46);text-align: start;overflow-wrap: break-word !important;\">欢迎关注<img class=\"\" data-ratio=\"1\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TxAghDEtyL0yGWb5bwkkbojspAFsIK81p9GbZ7ibpE1PM7HSBxvSm0BjwYa4v6JIlMIhYMMEDeOdUg/640?wx_fmt=png\" data-type=\"png\" data-w=\"19\" style=\"display: inline-block; vertical-align: text-bottom; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 19px !important; height: 19px !important;\" _width=\"19px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">点个再看<img class=\"\" data-ratio=\"1\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyKb57lE0g04qWvTs2hykJYtD2NElGSPQXZwyYVJCRC6vIzAI3L0LvEYFRibC3BjLwbmibvev2lniadA/640?wx_fmt=png\" data-type=\"png\" data-w=\"18\" style=\"display: inline-block; vertical-align: text-bottom; box-sizing: border-box !important; overflow-wrap: break-word !important; visibility: visible !important; width: 18px !important; height: 18px !important;\" _width=\"18px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></span></p><p style=\"max-width: 100%;min-height: 1em;letter-spacing: 0.544px;white-space: normal;box-sizing: border-box !important;overflow-wrap: break-word !important;\"><br style=\"max-width: 100%;box-sizing: border-box !important;overflow-wrap: break-word !important;\"></p><p style=\"text-align: center;margin-left: 0.5em;margin-right: 0.5em;\"><br></p>\n                </div>\n\n                <script nonce=\"\" type=\"text/javascript\">\n                    var first_sceen__time = (+new Date());\n\n                    if (\"\" == 1 && document.getElementById('js_content')) {\n                        document.getElementById('js_content').addEventListener(\"selectstart\",function(e){ e.preventDefault(); });\n                    }\n\n                    \n                    (function(){\n                        if (navigator.userAgent.indexOf(\"WindowsWechat\") != -1){\n                            var link = document.createElement('link');\n                            var head = document.getElementsByTagName('head')[0];\n                            link.rel = 'stylesheet';\n                            link.type = 'text/css';\n                            link.href = \"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx502975.css\";\n                            head.appendChild(link);\n                        }\n                    })();\n                </script>\n\n                \n<div id=\"js_sponsor_ad_area\" style=\"display: none;\"></div>\n\n\n                \n                <div class=\"read-more__area\" id=\"js_more_read_area\" style=\"display:none;\">\n                    \n                </div>\n\n                 \n                                                    \n                              \n            </div>\n                                        <div id=\"js_tags_preview_toast\" class=\"article-tag__error-tips\" style=\"display: none;\">预览时标签不可点</div>\n                                    \n                        \n\n\n                        \n            <ul id=\"js_hotspot_area\" class=\"article_extend_area\"></ul>\n\n\n            \n            \n            <div id=\"js_album_keep_read\" class=\"appmsg_card_context album_read_card\" style=\"display: none;\">\n                <div class=\"album_read_hd weui-flex\" id=\"js_album_directory\">\n                    <div class=\"album_read_source\"><span>收录于话题 </span><span>#<span id=\"js_album_keep_read_title\"></span></span></div>\n                    <span class=\"weui-btn__word-wrp\"><span id=\"js_album_keep_read_size\"></span>个<i class=\"weui_right_arrow\"></i></span>\n                </div>\n                <div class=\"album_read_bd weui-flex\">\n                  <span class=\"album_read_nav_item album_read_nav_prev weui-flex__item\" id=\"js_album_prev\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">上一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_pre_title\"></span>\n                    </span>\n                  </span>\n                  <span class=\"album_read_nav_item album_read_nav_next weui-flex__item\" id=\"js_album_next\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">下一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_next_title\"></span>\n                    </span>\n                  </span>\n                </div>\n            </div>\n\n            \n\n            \n\n\n<div class=\"rich_media_tool\" id=\"js_toobar3\">\n  <div class=\"weui-flex\">\n    <div class=\"weui-flex__item\">\n      \n      \n      \n            \n      <div id=\"js_read_area3\" class=\"media_tool_meta tips_global_primary meta_primary\" style=\"display:none;\">\n        <span id=\"readTxt\">阅读</span>\n        <span id=\"readNum3\"></span>\n      </div>\n    </div>\n  </div> \n  <div class=\"weui-flex sns_opr_area\" id=\"js_bottom_opr_right\" style=\"display: none;\">\n    <div class=\"weui-flex__item\">\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_share js_media_tool_meta\" id=\"js_bottom_share\">\n        <button class=\"sns_opr_btn sns_share_btn\" id=\"js_bottom_share_btn\"><span class=\"sns_opr_gap\">分享</span></button>\n      </span>\n\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_collect js_media_tool_meta\" id=\"js_bottom_collect\">\n        <button class=\"sns_opr_btn sns_collect_btn\" id=\"js_bottom_collect_btn\"><span class=\"sns_opr_gap\">收藏</span></button>\n      </span>\n    </div> \n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_praise js_media_tool_meta\" id=\"like_old\">\n      <button class=\"sns_opr_btn sns_praise_btn\" id=\"js_bottom_zan_btn\"><span class=\"sns_opr_gap\" id=\"js_parise_wording\">赞</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum_old\" style=\"display: none;\"></span></button>\n    </span>\n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_like js_media_tool_meta\" id=\"like3\">\n      \n      <button class=\"sns_opr_btn sns_like_btn\" id=\"js_like_btn\"><span class=\"sns_opr_gap\" id=\"js_like_wording\">在看</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum3\"></span></button>\n    </span>\n  </div> \n</div>\n  \n  <div class=\"like_comment_wrp\" id=\"js_like_comment\" style=\"display: none;\">\n    <div class=\"like_comment_inner\">\n      <div class=\"like_comment_hd\" style=\"display:none\" id=\"js_like_title\"></div>\n      <div class=\"like_comment_bd\">\n        <div class=\"like_comment_tips\" id=\"js_comment_area\">\n          <i class=\"weui-icon-success\"></i><i class=\"icon-success-primary\"></i>已同步到看一看<a href=\"javascript:;\" class=\"like_comment_share_link\" id=\"js_like_comment_share\">写下你的想法</a>\n        </div>\n        <div class=\"like_comment_extra_info\" id=\"js_like_educate\" style=\"display: none\">\n          <p class=\"like_comment_extra_tips\">\n            <span id=\"js_friend_like_area\" style=\"display: none\"></span>\n            <span id=\"js_friend_like_word\">前往“发现”-“看一看”浏览“朋友在看”</span>\n          </p>\n          <p class=\"like_comment_pic_wrp\">\n                          <img class=\"like_comment_pic\" src=\"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment492329.png\">\n                      </p>\n          <button class=\"weui-btn weui-btn_primary\" id=\"js_go_wow\">前往看一看</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div style=\"display:none;\" id=\"wow_close_inform\">\n    <div class=\"weui-mask\"></div>\n    <div class=\"weui-dialog\">\n      <div class=\"weui-dialog__hd\"><strong class=\"weui-dialog__title\">看一看入口已关闭</strong></div>\n      <div class=\"weui-dialog__bd\">\n        在“设置”-“通用”-“发现页管理”打开“看一看”入口      </div>\n      <div class=\"weui-dialog__ft\" id=\"wow_close_ack\">\n        <a href=\"javascript:;\" class=\"weui-dialog__btn weui-dialog__btn_primary\">我知道了</a>\n      </div>\n    </div>\n  </div>\n\n<div id=\"js_like_toast\" style=\"display: none;\">\n  <div class=\"weui-mask_transparent\"></div>\n  <div class=\"weui-toast\">\n    <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n    <p class=\"weui-toast__content\" id=\"js_toast_msg\">已发送</p>\n  </div>\n</div>\n\n<div style=\"display: none;\" id=\"js_comment_panel\">\n  <div class=\"like_comment_primary_wrp editing\" id=\"js_comment_wrp\">\n    <div class=\"like_comment_primary_inner\">\n      <div class=\"like_comment_primary_hd\">\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_cancel\" id=\"js_comment_cancel\">\n            取消            <i class=\"weui-icon-close-thin\"></i>\n          </button>\n        </div>\n        <h4 class=\"like_comment_primary_title\"> 发送到看一看 </h4>\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_btn\" id=\"js_comment_confirm\" disabled=\"disabled\">发送</button>\n        </div>\n      </div>\n      <div class=\"like_comment_primary_bd\">\n        <div class=\"like_comment_media_title\" id=\"js_panel_like_title\">\n                      腾讯面试：一条SQL语句执行得很慢的原因有哪些？---不看后悔系列\n                  </div>\n        <div class=\"like_comment_textarea_wrp\">\n          <textarea class=\"like_comment_textarea weui-textarea\" placeholder=\"写下你的想法...\" id=\"js_comment_text\"></textarea>\n        </div>\n      </div>\n      <span class=\"like_comment_msg\" id=\"js_like_comment_msg\" style=\"visibility: hidden;\">最多200字，当前共<span id=\"js_like_current_cnt\"></span>字</span>\n    </div>\n  </div>\n  <div class=\"like_comment_primary_mask\" id=\"js_mask_2\"></div>\n</div>\n\n<div id=\"js_loading\" style=\"display: none;\">\n    <div class=\"weui-mask_transparent\"></div>\n    <div class=\"weui-toast\">\n        <i class=\"weui-loading weui-icon_toast\"></i>\n        <p class=\"weui-toast__content\">发送中</p>\n    </div>\n</div>\n\n\n\n                      </div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "后端程序员必备：书写高质量SQL的30条建议",
    "ans": "<div id=\"page-content\" class=\"rich_media_area_primary\">\n\n\t\t  <div class=\"rich_media_area_primary_inner\">\n\n            \n                        \n                        \n\n            <div id=\"img-content\" class=\"rich_media_wrp\">\n                \n                <h2 class=\"rich_media_title\" id=\"activity-name\">\n                    \n                    \n                    \n后端程序员必备：书写高质量SQL的30条建议\n                </h2>\n                <div id=\"meta_content\" class=\"rich_media_meta_list\">\n                                                                                                                            \n                                                                                                            <span class=\"rich_media_meta rich_media_meta_nickname\" id=\"profileBt\">\n                      <a href=\"javascript:void(0);\" id=\"js_name\">\n                        JavaGuide                      </a>\n                      <div id=\"js_profile_qrcode\" class=\"profile_container\" style=\"display:none;\">\n                          <div class=\"profile_inner\">\n                              <strong class=\"profile_nickname\">JavaGuide</strong>\n                              <img class=\"profile_avatar\" id=\"js_profile_qrcode_img\" src=\"\" alt=\"\">\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">微信号</label>\n                              <span class=\"profile_meta_value\">JavaGuide</span>\n                              </p>\n\n                              <p class=\"profile_meta\">\n                              <label class=\"profile_meta_label\">功能介绍</label>\n                              <span class=\"profile_meta_value\">专注Java后端学习和大厂面试的公众号！开源项目—JavaGuide （88k+Star）作者运营维护。学习Java，首选JavaGuide！</span>\n                              </p>\n                              \n                          </div>\n                          <span class=\"profile_arrow_wrp\" id=\"js_profile_arrow_wrp\">\n                              <i class=\"profile_arrow arrow_out\"></i>\n                              <i class=\"profile_arrow arrow_in\"></i>\n                          </span>\n                      </div>\n                    </span>\n                    <em id=\"publish_time\" class=\"rich_media_meta rich_media_meta_text\">3月27日</em>\n                </div>\n\n                \n                                                <div id=\"js_tags\" class=\"article-tag__list\" style=\"display: none;\" data-len=\"0\">\n                                            \n                        <div class=\"article-tag-card__title\">收录于话题</div>\n                        <div class=\"article-tags\">\n                                                    </div>\n                                    </div>\n\n                \n                                \n                \n                \n\n                \n                                                                \n\n                \n                                    \n                    <div class=\"original_area_primary\" style=\"margin-bottom: 0;\">\n                                                                                                </div>\n\n                    \n                                            <div class=\"original_area_primary\">\n                            <p class=\"original_primary_card_tips\">\n                                                                    <span>以下文章来源于捡田螺的小男孩</span>\n                                                                                                    <span>，作者捡田螺的小男孩</span>\n                                                            </p>\n                            <a class=\"weui-flex original_primary_card appmsg_card_context appmsg_card_active\" href=\"#\" id=\"copyright_info\">\n                                <div class=\"weui-flex__hd\">\n                                    <span class=\"radius_avatar\">\n                                        <img class=\"avatar\" src=\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM7ibLc65ZtAgj2O8e7jiakwd36tBWhXF0iaCZRga5xFoVNqg/0\" alt=\"捡田螺的小男孩\">\n                                    </span>\n                                </div>\n                                <div class=\"weui-flex__item\">\n                                    <strong class=\"original_primary_nickname\">捡田螺的小男孩</strong>\n                                                                            <p class=\"original_primary_desc\">专注后端技术栈，热爱分享，热爱交朋友，热爱工作总结。毕业于华南理工大学，软件工程专业~</p>\n                                                                    </div>\n                                <div class=\"weui-flex__ft\"></div>\n                            </a>\n                        </div>\n                                                    \n\n\n                \n                \n                \n                \n                                                \n                                                                \n                                \n                                \n                \n                <div class=\"rich_media_content \" id=\"js_content\" style=\"visibility: visible;\">\n                    \n\n                    \n\n                    \n                    \n                    <section data-tool=\"mdnice编辑器\" data-website=\"https://www.mdnice.com\" style=\"padding-right: 10px;padding-left: 10px;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;margin-top: -10px;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;\"><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><span style=\"color: rgb(136, 136, 136);\">大家好！我是 Guide 哥。今天推荐一篇非常不错的文章，助你写出更高质量的 SQL。文章内容过多，为了方便随时查阅，建议收藏！</span></p></section><p><br></p><section data-tool=\"mdnice编辑器\" data-website=\"https://www.mdnice.com\" style=\"padding-right: 10px;padding-left: 10px;overflow-wrap: break-word;text-align: left;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;margin-top: -10px;line-height: 1.6;letter-spacing: 0.034em;color: rgb(63, 63, 63);font-size: 16px;\"><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">前言</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">本文将结合实例demo，阐述30条有关于优化SQL的建议，多数是实际开发中总结出来的，希望对大家有帮助。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">1、查询SQL尽量不要使用select *，而是select具体字段。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例子：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例子：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">只取需要的字段，节省资源、减少网络开销。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">select * 进行查询时，很可能就不会使用到覆盖索引了，就会造成回表查询。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">2、如果知道查询结果只有一条或者只要最大/最小一条记录，建议用limit 1</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">假设现在有employee员工表，要找出一个名字叫jay的人.</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">CREATE</span> <span style=\"color: #a626a4;line-height: 26px;\">TABLE</span> <span style=\"color: #50a14f;line-height: 26px;\">`employee`</span> (<br>  <span style=\"color: #50a14f;line-height: 26px;\">`id`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) <span style=\"color: #a626a4;line-height: 26px;\">NOT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`name`</span> <span style=\"color: #c18401;line-height: 26px;\">varchar</span>(<span style=\"color: #986801;line-height: 26px;\">255</span>) <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`age`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`date`</span> datetime <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`sex`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">1</span>) <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  PRIMARY <span style=\"color: #a626a4;line-height: 26px;\">KEY</span> (<span style=\"color: #50a14f;line-height: 26px;\">`id`</span>)<br>) <span style=\"color: #a626a4;line-height: 26px;\">ENGINE</span>=<span style=\"color: #a626a4;line-height: 26px;\">InnoDB</span> <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #a626a4;line-height: 26px;\">CHARSET</span>=utf8;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee <span style=\"color: #a626a4;line-height: 26px;\">where</span> <span style=\"color: #a626a4;line-height: 26px;\">name</span>=<span style=\"color: #50a14f;line-height: 26px;\">'jay'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee <span style=\"color: #a626a4;line-height: 26px;\">where</span> <span style=\"color: #a626a4;line-height: 26px;\">name</span>=<span style=\"color: #50a14f;line-height: 26px;\">'jay'</span> <span style=\"color: #a626a4;line-height: 26px;\">limit</span> <span style=\"color: #986801;line-height: 26px;\">1</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">加上limit 1后,只要找到了对应的一条记录,就不会继续向下扫描了,效率将会大大提高。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">当然，如果name是唯一索引的话，是不必要加上limit 1了，因为limit的存在主要就是为了防止全表扫描，从而提高性能,如果一个语句本身可以预知不用全表扫描，有没有limit ，性能的差别并不大。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">3、应尽量避免在where子句中使用or来连接条件</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">新建一个user表，它有一个普通索引userId，表结构如下：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">CREATE</span> <span style=\"color: #a626a4;line-height: 26px;\">TABLE</span> <span style=\"color: #50a14f;line-height: 26px;\">`user`</span> (<br>  <span style=\"color: #50a14f;line-height: 26px;\">`id`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) <span style=\"color: #a626a4;line-height: 26px;\">NOT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span> AUTO_INCREMENT,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`userId`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) <span style=\"color: #a626a4;line-height: 26px;\">NOT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`age`</span> <span style=\"color: #c18401;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) <span style=\"color: #a626a4;line-height: 26px;\">NOT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  <span style=\"color: #50a14f;line-height: 26px;\">`name`</span> <span style=\"color: #c18401;line-height: 26px;\">varchar</span>(<span style=\"color: #986801;line-height: 26px;\">255</span>) <span style=\"color: #a626a4;line-height: 26px;\">NOT</span> <span style=\"color: #0184bb;line-height: 26px;\">NULL</span>,<br>  PRIMARY <span style=\"color: #a626a4;line-height: 26px;\">KEY</span> (<span style=\"color: #50a14f;line-height: 26px;\">`id`</span>),<br>  <span style=\"color: #a626a4;line-height: 26px;\">KEY</span> <span style=\"color: #50a14f;line-height: 26px;\">`idx_userId`</span> (<span style=\"color: #50a14f;line-height: 26px;\">`userId`</span>)<br>) <span style=\"color: #a626a4;line-height: 26px;\">ENGINE</span>=<span style=\"color: #a626a4;line-height: 26px;\">InnoDB</span> <span style=\"color: #a626a4;line-height: 26px;\">DEFAULT</span> <span style=\"color: #a626a4;line-height: 26px;\">CHARSET</span>=utf8;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">假设现在需要查询userid为1或者年龄为18岁的用户，很容易有以下sql</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例:</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userid=<span style=\"color: #986801;line-height: 26px;\">1</span> <span style=\"color: #a626a4;line-height: 26px;\">or</span> age =<span style=\"color: #986801;line-height: 26px;\">18</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">//使用union all<br><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userid=<span style=\"color: #986801;line-height: 26px;\">1</span> <br><span style=\"color: #a626a4;line-height: 26px;\">union</span> <span style=\"color: #a626a4;line-height: 26px;\">all</span> <br><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> age = <span style=\"color: #986801;line-height: 26px;\">18</span><br><br>//或者分开两条<span style=\"color: #a626a4;line-height: 26px;\">sql</span>写：<br><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userid=<span style=\"color: #986801;line-height: 26px;\">1</span><br><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> age = <span style=\"color: #986801;line-height: 26px;\">18</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">使用or可能会使索引失效，从而全表扫描。</section></li></ul><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">对于or+没有索引的age这种情况，假设它走了userId的索引，但是走到age查询条件时，它还得全表扫描，也就是需要三步过程：全表扫描+索引扫描+合并\n如果它一开始就走全表扫描，直接一遍扫描就完事。mysql是有优化器的，处于效率与成本考虑，遇到or条件，索引可能失效，看起来也合情合理。</p></blockquote><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">4、优化limit分页</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">我们日常做分页需求时，一般会用 limit 实现，但是当偏移量特别大的时候，查询效率就变得低下。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span>，age <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee <span style=\"color: #a626a4;line-height: 26px;\">limit</span> <span style=\"color: #986801;line-height: 26px;\">10000</span>，<span style=\"color: #986801;line-height: 26px;\">10</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">//方案一 ：返回上次查询的最大记录(偏移量)<br><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee <span style=\"color: #a626a4;line-height: 26px;\">where</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>&gt;<span style=\"color: #986801;line-height: 26px;\">10000</span> <span style=\"color: #a626a4;line-height: 26px;\">limit</span> <span style=\"color: #986801;line-height: 26px;\">10.</span><br><br>//方案二：<span style=\"color: #a626a4;line-height: 26px;\">order</span> <span style=\"color: #a626a4;line-height: 26px;\">by</span> + 索引<br><span style=\"color: #a626a4;line-height: 26px;\">select</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> employee <span style=\"color: #a626a4;line-height: 26px;\">order</span> <span style=\"color: #a626a4;line-height: 26px;\">by</span> <span style=\"color: #a626a4;line-height: 26px;\">id</span>  <span style=\"color: #a626a4;line-height: 26px;\">limit</span> <span style=\"color: #986801;line-height: 26px;\">10000</span>，<span style=\"color: #986801;line-height: 26px;\">10</span><br><br>//方案三：在业务允许的情况下限制页数：<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">当偏移量最大的时候，查询效率就会越低，因为Mysql并非是跳过偏移量直接去取后面的数据，而是先把偏移量+要取的条数，然后再把前面偏移量这一段的数据抛弃掉再返回的。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果使用优化方案一，返回上次最大查询记录（偏移量），这样可以跳过偏移量，效率提升不少。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">方案二使用order by+索引，也是可以提高查询效率的。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">方案三的话，建议跟业务讨论，有没有必要查这么后的分页啦。因为绝大多数用户都不会往后翻太多页。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">5、优化你的like语句</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">日常开发中，如果用到模糊关键字查询，很容易想到like，但是like很可能让你的索引失效。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> userId，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userId <span style=\"color: #a626a4;line-height: 26px;\">like</span> <span style=\"color: #50a14f;line-height: 26px;\">'%123'</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> userId，<span style=\"color: #a626a4;line-height: 26px;\">name</span> <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userId <span style=\"color: #a626a4;line-height: 26px;\">like</span> <span style=\"color: #50a14f;line-height: 26px;\">'123%'</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">把%放前面，并不走索引，如下：<img data-ratio=\"0.2578125\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu2W0g1RicAGBtCuibQ8m9gCGExjPdn9iboffODSrHpnibbFVKS15nfkKQHw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 632px !important; height: 164.422px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">把% 放关键字后面，还是会走索引的。如下：<img data-ratio=\"0.2453125\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuMK6QQTu6HXJV0StsqYe9ePSugiaxfRyMH6Q1g6QM3KnLZAA9LQXf5bw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 632px !important; height: 156.547px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">6、使用where条件限定要查询的数据，避免返回多余的行</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">假设业务场景是这样：查询某个用户是否是会员。曾经看过老的实现代码是这样。。。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">List&lt;Long&gt; userIds = sqlMap.queryList(\"<span style=\"color: #a626a4;line-height: 26px;\">select</span> userId <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> isVip=<span style=\"color: #986801;line-height: 26px;\">1</span><span style=\"color: #50a14f;line-height: 26px;\">\");<br>boolean isVip = userIds.contains(userId);<br></span></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">Long userId = sqlMap.queryObject(\"<span style=\"color: #a626a4;line-height: 26px;\">select</span> userId <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> userId=<span style=\"color: #50a14f;line-height: 26px;\">'userId'</span> <span style=\"color: #a626a4;line-height: 26px;\">and</span> isVip=<span style=\"color: #50a14f;line-height: 26px;\">'1'</span> <span style=\"color: #50a14f;line-height: 26px;\">\")<br>boolean isVip = userId！=null;<br></span></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">需要什么数据，就去查什么数据，避免返回不必要的数据，节省开销。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">7、尽量避免在索引列上使用mysql的内置函数</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">业务需求：查询最近七天内登陆过的用户(假设loginTime加了索引)</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> userId,loginTime <span style=\"color: #a626a4;line-height: 26px;\">from</span> loginuser <span style=\"color: #a626a4;line-height: 26px;\">where</span> <span style=\"color: #a626a4;line-height: 26px;\">Date_ADD</span>(loginTime,<span style=\"color: #c18401;line-height: 26px;\">Interval</span> <span style=\"color: #986801;line-height: 26px;\">7</span> <span style=\"color: #a626a4;line-height: 26px;\">DAY</span>) &gt;=<span style=\"color: #a626a4;line-height: 26px;\">now</span>();<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">explain</span>  <span style=\"color: #a626a4;line-height: 26px;\">select</span> userId,loginTime <span style=\"color: #a626a4;line-height: 26px;\">from</span> loginuser <span style=\"color: #a626a4;line-height: 26px;\">where</span>  loginTime &gt;= <span style=\"color: #a626a4;line-height: 26px;\">Date_ADD</span>(<span style=\"color: #a626a4;line-height: 26px;\">NOW</span>(),<span style=\"color: #c18401;line-height: 26px;\">INTERVAL</span> - <span style=\"color: #986801;line-height: 26px;\">7</span> <span style=\"color: #a626a4;line-height: 26px;\">DAY</span>);<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">索引列上使用mysql的内置函数，索引失效</section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.2357930449533503\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtutUR12HMRCWEhUSoeSKLLf5DVf8giaXkc33S6Gp8jnnlUCWuWEPRgnFA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1179\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 156.444px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果索引列不加内置函数，索引还是会走的。<img data-ratio=\"0.2414654454621149\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuhTTrKuP8qgO7GbRicj5xryFrvVFLY20l5gGJcdfyRjyX0soarsicS4Mw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1201\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 632px !important; height: 154.123px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致系统放弃使用索引而进行全表扫</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> age<span style=\"color: #986801;line-height: 26px;\">-1</span> =<span style=\"color: #986801;line-height: 26px;\">10</span>；<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">select</span> * <span style=\"color: #a626a4;line-height: 26px;\">from</span> <span style=\"color: #a626a4;line-height: 26px;\">user</span> <span style=\"color: #a626a4;line-height: 26px;\">where</span> age =<span style=\"color: #986801;line-height: 26px;\">11</span>；<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">虽然age加了索引，但是因为对它进行运算，索引直接迷路了。。。<img data-ratio=\"0.20703125\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuOicC7DAPprh2nhRtgVdRJp9f6ZkdU161ICbxYrHfkWMJXDYR8EsRoSg/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 632px !important; height: 132.43px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">9、Inner join 、left join、right join，优先使用Inner join，如果是left join，左边表结果尽量小</span><span style=\"display: none;\"></span></h3><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><ul style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">Inner join 内连接，在两张表进行连接查询时，只保留两张表中完全匹配的结果集</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">left join 在两张表进行连接查询时，会返回左表所有的行，即使在右表中没有匹配的记录。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">right join 在两张表进行连接查询时，会返回右表所有的行，即使在左表中没有匹配的记录。</section></li></ul></blockquote><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">都满足SQL需求的前提下，推荐优先使用Inner join（内连接），如果要使用left join，左边表数据结果尽量小，如果有条件的尽量放到左边处理。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例:</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from tab1 t1 left join tab2 t2  on t1.size = t2.size where t1.id&gt;<span style=\"color: #986801;line-height: 26px;\">2</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from (select * from tab1 where id &gt;<span style=\"color: #986801;line-height: 26px;\">2</span>) t1 left join tab2 t2 on t1.size = t2.size;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果inner join是等值连接，或许返回的行数比较少，所以性能相对会好一点。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">同理，使用了左连接，左边表数据结果尽量小，条件尽量放到左边处理，意味着返回的行数可能比较少。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">10、应尽量避免在 where 子句中使用!=或&lt;&gt;操作符，否则将引擎放弃使用索引而进行全表扫描。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select age,name  from user where age &lt;&gt;<span style=\"color: #986801;line-height: 26px;\">18</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//可以考虑分开两条sql写</span><br>select age,name  from user where age &lt;<span style=\"color: #986801;line-height: 26px;\">18</span>;<br>select age,name  from user where age &gt;<span style=\"color: #986801;line-height: 26px;\">18</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">使用!=和&lt;&gt;很可能会让索引失效</section></li></ul><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.24466192170818504\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuevbQmNfLffh6TlPmyFwIGiaGP6jbxiaLOOxHoMAjia4aJAEvsvkPkU3ibQ/640?wx_fmt=png\" data-type=\"png\" data-w=\"1124\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 162.254px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">11、使用联合索引时，注意索引列的顺序，一般遵循最左匹配原则。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">表结构：（有一个联合索引idx_userid_age，userId在前，age在后）</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">CREATE TABLE `user` (<br>  `id` <span style=\"color: #a626a4;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) NOT NULL AUTO_INCREMENT,<br>  `userId` <span style=\"color: #a626a4;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) NOT NULL,<br>  `age` <span style=\"color: #a626a4;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) DEFAULT NULL,<br>  `name` varchar(<span style=\"color: #986801;line-height: 26px;\">255</span>) NOT NULL,<br>  <span style=\"line-height: 26px;\">PRIMARY <span style=\"color: #4078f2;line-height: 26px;\">KEY</span> <span style=\"line-height: 26px;\">(`id`)</span>,<br>  KEY `idx_userid_age` <span style=\"line-height: 26px;\">(`userId`,`age`)</span> USING BTREE<br>) ENGINE</span>=InnoDB AUTO_INCREMENT=<span style=\"color: #986801;line-height: 26px;\">2</span> DEFAULT CHARSET=utf8;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where age = <span style=\"color: #986801;line-height: 26px;\">10</span>;<br></code></pre><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.13984375\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuxEufP2e7ic7k7qKNiaJotWfmV98xU0UiajeNo8ialwOGnQV3k7SyzwicPUA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 93.5977px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//符合最左匹配原则</span><br>select * from user where userid=<span style=\"color: #986801;line-height: 26px;\">10</span> and age =<span style=\"color: #986801;line-height: 26px;\">10</span>；<br><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//符合最左匹配原则</span><br>select * from user where userid =<span style=\"color: #986801;line-height: 26px;\">10</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.21927162367223066\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuKYqMic3jIbclefAOf44N6I4x53ic940icTXzAar4wYjpVUlg4AoJzia9KA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1318\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 145.623px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><img data-ratio=\"0.1804733727810651\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuPeU6wGKChNW57IkAmY8Ges9Yj5DLUZFV6DC6tsiatrrhWfIklO4S4LQ/640?wx_fmt=png\" data-type=\"png\" data-w=\"1352\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 120.21px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">当我们创建一个联合索引的时候，如(k1,k2,k3)，相当于创建了（k1）、(k1,k2)和(k1,k2,k3)三个索引，这就是最左匹配原则。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">联合索引不满足最左原则，索引一般会失效，但是这个还跟Mysql优化器有关的。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">12、对查询进行优化，应考虑在 where 及 order by 涉及的列上建立索引，尽量避免全表扫描。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where address ='深圳' order by age ;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.25229357798165136\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtucgK5bG6qRqyrHAo7BibzxTfpaJF03KkkQ4JLD0Z52GaR9JMtiaerNnHw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1090\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 167.252px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">添加索引<br><span style=\"line-height: 26px;\">alter table user add index <span style=\"color: #4078f2;line-height: 26px;\">idx_address_age</span> <span style=\"line-height: 26px;\">(address,age)</span><br></span></code></pre><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.231203007518797\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuicUB2B2vYbpgSH4j3rohJVrBNOI7dsFdAJp5Eef81JGVDZnric0G0bUg/640?wx_fmt=png\" data-type=\"png\" data-w=\"1064\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 153.438px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">13、如果插入数据过多，考虑批量插入。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a626a4;line-height: 26px;\">for</span>(User u :list){<br> <span style=\"line-height: 26px;\">INSERT into <span style=\"color: #4078f2;line-height: 26px;\">user</span><span style=\"line-height: 26px;\">(name,age)</span> <span style=\"color: #4078f2;line-height: 26px;\">values</span><span style=\"line-height: 26px;\">(#name#,#age#)</span>   <br>}<br></span></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//一次500批量插入，分批进行</span><br><span style=\"line-height: 26px;\">insert into <span style=\"color: #4078f2;line-height: 26px;\">user</span><span style=\"line-height: 26px;\">(name,age)</span> values<br>&lt;foreach collection</span>=<span style=\"color: #50a14f;line-height: 26px;\">\"list\"</span> item=<span style=\"color: #50a14f;line-height: 26px;\">\"item\"</span> index=<span style=\"color: #50a14f;line-height: 26px;\">\"index\"</span> separator=<span style=\"color: #50a14f;line-height: 26px;\">\",\"</span>&gt;<br>    (#{item.name},#{item.age})<br>&lt;/foreach&gt;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">批量插入性能好，更加省时间</section></li></ul><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">打个比喻:假如你需要搬一万块砖到楼顶,你有一个电梯,电梯一次可以放适量的砖（最多放500）,你可以选择一次运送一块砖,也可以一次运送500,你觉得哪个时间消耗大?</p></blockquote><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">14、在适当的时候，使用覆盖索引。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">覆盖索引能够使得你的SQL语句不需要回表，仅仅访问索引就能够得到所有需要的数据，大大提高了查询效率。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">// like模糊查询，不走索引了</span><br>select * from user where userid like <span style=\"color: #50a14f;line-height: 26px;\">'%123%'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.25857519788918204\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu3vwWV87E3WEQwvJ6qZjUWDibwxZgoM3ZRCLwMriauTXNZmDTQ4Kkh2SQ/640?wx_fmt=png\" data-type=\"png\" data-w=\"1137\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 171.367px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//id为主键，那么为普通索引，即覆盖索引登场了。</span><br>select id,name from user where userid like <span style=\"color: #50a14f;line-height: 26px;\">'%123%'</span>;<br></code></pre><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.23723118279569894\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuDCFuMVqNt1omQpuRXz53loYfx0qrrxz6lRAhGnIuibPhjgAWgpWFt5A/640?wx_fmt=png\" data-type=\"png\" data-w=\"1488\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 157.386px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">15、慎用distinct关键字</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">distinct 关键字一般用来过滤重复记录，以返回不重复的记录。在查询一个字段或者很少字段的情况下使用时，给查询带来优化效果。但是在字段很多的时候使用，却会大大降低查询效率。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">SELECT DISTINCT * from  user;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select DISTINCT name from user;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">带distinct的语句cpu时间和占用时间都高于不带distinct的语句。因为当查询很多字段时，如果使用distinct，数据库引擎就会对数据进行比较，过滤掉重复数据，然而这个比较，过滤的过程会占用系统资源，cpu时间。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">16、删除冗余和重复索引</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">  KEY `idx_userId` (`userId`)<br>  KEY `idx_userId_age` (`userId`,`age`)<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例:</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">  <span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//删除userId索引，因为组合索引（A，B）相当于创建了（A）和（A，B）索引</span><br>  KEY `idx_userId_age` (`userId`,`age`)<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">重复的索引需要维护，并且优化器在优化查询的时候也需要逐个地进行考虑，这会影响性能的。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">17、如果数据量较大，优化你的修改/删除语句。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">避免同时修改或删除过多数据，因为会造成cpu利用率过高，从而影响别人对数据库的访问。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//一次删除10万或者100万+？</span><br>delete from user where id &lt;<span style=\"color: #986801;line-height: 26px;\">100000</span>;<br><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//或者采用单一循环操作，效率低，时间漫长</span><br><span style=\"color: #a626a4;line-height: 26px;\">for</span>（User user：list）{<br>   delete from user；<br>}<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//分批进行删除,如每次500</span><br>delete user where id&lt;<span style=\"color: #986801;line-height: 26px;\">500</span><br>delete product where id&gt;=<span style=\"color: #986801;line-height: 26px;\">500</span> and id&lt;<span style=\"color: #986801;line-height: 26px;\">1000</span>；<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">一次性删除太多数据，可能会有lock wait timeout exceed的错误，所以建议分批操作。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">18、where子句中考虑使用默认值代替null。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where age is not <span style=\"color: #a626a4;line-height: 26px;\">null</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.1828231292517007\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuXgpicfG7iaTEKLVibqeWwwGHTVwh5DQFLLJ1icYZkDiagJiakV2b9nRE5UhA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1176\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 121.749px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//设置0为默认值</span><br>select * from user where age&gt;<span style=\"color: #986801;line-height: 26px;\">0</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.18907563025210083\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuib5dldeYXUAKUMkkpT6EicCoz6fURDFRSyXkm63NmjiaP0bGic4Ipw2diaA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1190\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 125.845px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">并不是说使用了is null 或者 is not null 就会不走索引了，这个跟mysql版本以及查询成本都有关。</section></li></ul><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">如果mysql优化器发现，走索引比不走索引成本还要高，肯定会放弃索引，这些条件<code style=\"font-size: 14px;overflow-wrap: break-word;padding: 2px 4px;border-radius: 4px;margin-right: 2px;margin-left: 2px;background-color: rgba(27, 31, 35, 0.05);font-family: &quot;Operator Mono&quot;, Consolas, Monaco, Menlo, monospace;word-break: break-all;color: rgb(40, 202, 113);\">！=，&gt;is null，is not null</code>经常被认为让索引失效，其实是因为一般情况下，查询的成本高，优化器自动放弃的。</p></blockquote><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果把null值，换成默认值，很多时候让走索引成为可能，同时，表达意思会相对清晰一点。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">19、不要有超过5个以上的表连接</span><span style=\"display: none;\"></span></h3><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">连表越多，编译的时间和开销也就越大。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">把连接表拆开成较小的几个执行，可读性更高。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果一定需要连接很多表才能得到数据，那么意味着糟糕的设计了。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">20、exist &amp; in的合理利用</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">假设表A表示某企业的员工表，表B表示部门表，查询所有部门的所有员工，很容易有以下SQL:</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * <span style=\"line-height: 26px;\">from A where deptId <span style=\"color: #4078f2;line-height: 26px;\">in</span> <span style=\"line-height: 26px;\">(select deptId from B)</span></span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">这样写等价于：</p><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">先查询部门表B</p><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">select deptId from B</p><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">再由部门deptId，查询A的员工</p><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">select * from A where A.deptId = B.deptId</p></blockquote><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">可以抽象成这样的一个循环：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">   List&lt;&gt; resultSet ;<br>    <span style=\"color: #a626a4;line-height: 26px;\">for</span>(<span style=\"color: #a626a4;line-height: 26px;\">int</span> i=<span style=\"color: #986801;line-height: 26px;\">0</span>;i&lt;B.length;i++) {<br>          <span style=\"color: #a626a4;line-height: 26px;\">for</span>(<span style=\"color: #a626a4;line-height: 26px;\">int</span> j=<span style=\"color: #986801;line-height: 26px;\">0</span>;j&lt;A.length;j++) {<br>          <span style=\"color: #a626a4;line-height: 26px;\">if</span>(A[i].id==B[j].id) {<br>             resultSet.add(A[i]);<br>             <span style=\"color: #a626a4;line-height: 26px;\">break</span>;<br>          }<br>       }<br>    }<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">显然，除了使用in，我们也可以用exists实现一样的查询功能，如下：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * <span style=\"line-height: 26px;\">from A where <span style=\"color: #4078f2;line-height: 26px;\">exists</span> <span style=\"line-height: 26px;\">(select <span style=\"color: #986801;line-height: 26px;\">1</span> from B where A.deptId = B.deptId)</span></span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">因为exists查询的理解就是，先执行主查询，获得数据后，再放到子查询中做条件验证，根据验证结果（true或者false），来决定主查询的数据结果是否得意保留。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">那么，这样写就等价于：</p><blockquote data-tool=\"mdnice编辑器\" style=\"font-size: 0.9em;overflow: auto;background: rgb(251, 249, 253);color: rgb(106, 115, 125);margin-bottom: 20px;margin-top: 20px;padding: 15px 20px;line-height: 27px;border-left-color: rgb(53, 179, 120);\"><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">select * from A,先从A表做循环</p><p style=\"line-height: 26px;font-size: 15px;color: rgb(89, 89, 89);\">select * from B where A.deptId = B.deptId,再从B表做循环.</p></blockquote><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">同理，可以抽象成这样一个循环：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">   List&lt;&gt; resultSet ;<br>    <span style=\"color: #a626a4;line-height: 26px;\">for</span>(<span style=\"color: #a626a4;line-height: 26px;\">int</span> i=<span style=\"color: #986801;line-height: 26px;\">0</span>;i&lt;A.length;i++) {<br>          <span style=\"color: #a626a4;line-height: 26px;\">for</span>(<span style=\"color: #a626a4;line-height: 26px;\">int</span> j=<span style=\"color: #986801;line-height: 26px;\">0</span>;j&lt;B.length;j++) {<br>          <span style=\"color: #a626a4;line-height: 26px;\">if</span>(A[i].deptId==B[j].deptId) {<br>             resultSet.add(A[i]);<br>             <span style=\"color: #a626a4;line-height: 26px;\">break</span>;<br>          }<br>       }<br>    }<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">数据库最费劲的就是跟程序链接释放。假设链接了两次，每次做上百万次的数据集查询，查完就走，这样就只做了两次；相反建立了上百万次链接，申请链接释放反复重复，这样系统就受不了了。即mysql优化原则，就是小表驱动大表，小的数据集驱动大的数据集，从而让性能更优。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">因此，我们要选择最外层循环小的，也就是，如果<strong style=\"line-height: 1.75em;\">B的数据量小于A，适合使用in，如果B的数据量大于A，即适合选择exist</strong>。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">21、尽量用 union all 替换 union</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">如果检索结果中不会有重复的记录，推荐union all 替换 union。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where userid=<span style=\"color: #986801;line-height: 26px;\">1</span> <br>union<br>select * from user where age = <span style=\"color: #986801;line-height: 26px;\">10</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where userid=<span style=\"color: #986801;line-height: 26px;\">1</span> <br>union all<br>select * from user where age = <span style=\"color: #986801;line-height: 26px;\">10</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">如果使用union，不管检索结果有没有重复，都会尝试进行合并，然后在输出最终结果前进行排序。如果已知检索结果没有重复记录，使用union all 代替union，这样会提高效率。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">22、索引不宜太多，一般5个以内。</span><span style=\"display: none;\"></span></h3><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">索引并不是越多越好，索引虽然提高了查询的效率，但是也降低了插入和更新的效率。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">insert或update时有可能会重建索引，所以建索引需要慎重考虑，视具体情况来定。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">一个表的索引数最好不要超过5个，若太多需要考虑一些索引是否没有存在的必要。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">23、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">king_id` varchar（<span style=\"color: #986801;line-height: 26px;\">20</span>） NOT NULL COMMENT <span style=\"color: #50a14f;line-height: 26px;\">'守护者Id'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">`king_id` <span style=\"color: #a626a4;line-height: 26px;\">int</span>(<span style=\"color: #986801;line-height: 26px;\">11</span>) NOT NULL COMMENT <span style=\"color: #50a14f;line-height: 26px;\">'守护者Id'</span>`<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">相对于数字型字段，字符型会降低查询和连接的性能，并会增加存储开销。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">24、索引不适合建在有大量重复数据的字段上，如性别这类型数据库字段。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">因为SQL优化器是根据表中数据量来进行查询优化的，如果索引列有大量重复数据，Mysql查询优化器推算发现不走索引的成本更低，很可能就放弃索引了。</p><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">25、尽量避免向客户端返回过多数据量。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">假设业务需求是，用户请求查看自己最近一年观看过的直播数据。</p><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//一次性查询所有数据回来</span><br>select * from LivingInfo where watchId =useId and watchTime &gt;= Date_sub(now(),Interval <span style=\"color: #986801;line-height: 26px;\">1</span> Y)<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\"><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//分页查询</span><br>select * from LivingInfo where watchId =useId and watchTime&gt;= Date_sub(now(),Interval <span style=\"color: #986801;line-height: 26px;\">1</span> Y) limit offset，pageSize<br><br><span style=\"color: #a0a1a7;font-style: italic;line-height: 26px;\">//如果是前端分页，可以先查询前两百条记录，因为一般用户应该也不会往下翻太多页，</span><br>select * from LivingInfo where watchId =useId and watchTime&gt;= Date_sub(now(),Interval <span style=\"color: #986801;line-height: 26px;\">1</span> Y) limit <span style=\"color: #986801;line-height: 26px;\">200</span> ;<br></code></pre><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">26、当在SQL语句中连接多个表时,请使用表的别名，并把别名前缀于每一列上，这样语义更加清晰。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select  * from A inner<br>join B on A.deptId = B.deptId;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select  memeber.name,deptment.deptName from A member inner<br>join B deptment on member.deptId = deptment.deptId;<br></code></pre><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">27、尽可能使用varchar/nvarchar 代替 char/nchar。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">  `deptName` <span style=\"color: #a626a4;line-height: 26px;\">char</span>(<span style=\"color: #986801;line-height: 26px;\">100</span>) DEFAULT NULL COMMENT <span style=\"color: #50a14f;line-height: 26px;\">'部门名称'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">  `deptName` varchar(<span style=\"color: #986801;line-height: 26px;\">100</span>) DEFAULT NULL COMMENT <span style=\"color: #50a14f;line-height: 26px;\">'部门名称'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">因为首先变长字段存储空间小，可以节省存储空间。</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">其次对于查询来说，在一个相对较小的字段内搜索，效率更高。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">28、为了提高group by 语句的效率，可以在执行到该语句前，把不需要的记录过滤掉。</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select job，avg（salary） from employee  group by job having job =<span style=\"color: #50a14f;line-height: 26px;\">'president'</span> <br>or job = <span style=\"color: #50a14f;line-height: 26px;\">'managent'</span><br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select job，avg（salary） from employee where job =<span style=\"color: #50a14f;line-height: 26px;\">'president'</span> <br>or job = <span style=\"color: #50a14f;line-height: 26px;\">'managent'</span> group by job；<br></code></pre><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">29、如何字段类型是字符串，where时一定用引号括起来，否则索引失效</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">反例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where userid =<span style=\"color: #986801;line-height: 26px;\">123</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.21796875\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuBOy70hoQsAtbuBX69HkbYwgfMy5s3dLHgN9D7KyMsH21M7kyRJE35g/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 144.77px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">正例：</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">select * from user where userid =<span style=\"color: #50a14f;line-height: 26px;\">'123'</span>;<br></code></pre><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\"><img data-ratio=\"0.23125\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtudbyXWS0NqV5zWY8UACzxJI9VDpnlaiagCGLxBj7nh8jtOHpMmtMPvvQ/640?wx_fmt=png\" data-type=\"png\" data-w=\"1280\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 153.469px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\">理由：</p><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">为什么第一条语句未加单引号就不走索引了呢？这是因为不加单引号时，是字符串跟数字的比较，它们类型不匹配，MySQL会做隐式的类型转换，把它们转换为浮点数再做比较。</section></li></ul><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">30、使用explain 分析你SQL的计划</span><span style=\"display: none;\"></span></h3><p data-tool=\"mdnice编辑器\" style=\"padding-bottom: 8px;padding-top: 1em;color: rgb(74, 74, 74);line-height: 1.75em;\">日常开发写SQL的时候，尽量养成一个习惯吧。用explain分析一下你写的SQL，尤其是走不走索引这一块。</p><pre data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;border-radius: 5px;box-shadow: rgba(0, 0, 0, 0.55) 0px 2px 10px;\"><span style=\"display: -webkit-box;background: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtu1tqNL6Tor5msjmaV184V9Q18IFAXb6N9wxGkR3iczH3OBEibaQW8q2aw/640?wx_fmt=png&quot;) 10px 10px / 40px no-repeat rgb(250, 250, 250);height: 30px;width: 100%;margin-bottom: -7px;border-radius: 5px;\"></span><code style=\"overflow-x: auto;padding: 16px;color: #383a42;display: -webkit-box;font-family: Operator Mono, Consolas, Monaco, Menlo, monospace;font-size: 12px;-webkit-overflow-scrolling: touch;padding-top: 15px;background: #fafafa;border-radius: 5px;\">explain select * from user where userid =<span style=\"color: #986801;line-height: 26px;\">10086</span> or age =<span style=\"color: #986801;line-height: 26px;\">18</span>;<br></code></pre><figure data-tool=\"mdnice编辑器\" style=\"margin-top: 10px;margin-bottom: 10px;\"><img data-ratio=\"0.1649122807017544\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuXzDH3ibeEndHict3xDmiaWdZYLZ7okJ2FSIo8xQBFpAOp8MInKcYRYZjQ/640?wx_fmt=png\" data-type=\"png\" data-w=\"1140\" style=\"display: block; margin-right: auto; margin-left: auto; border-radius: 4px; margin-bottom: 25px; width: 657px !important; height: 110.018px !important;\" _width=\"auto\" class=\"img_loading\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"><figcaption style=\"margin-top: 5px;text-align: center;color: rgb(136, 136, 136);font-size: 12px;font-family: PingFangSC-Light;\">img</figcaption></figure><h3 data-tool=\"mdnice编辑器\" style=\"margin-bottom: 15px;font-weight: bold;color: black;font-size: 20px;margin-top: 1.2em;\"><span style=\"background-image: url(&quot;https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgturSbqTMHGRGQbPz0kiaZIqiaLs6Spk7LFkwaXJocgyEibrQ46WicMRibxkEw/640?wx_fmt=png&quot;);background-size: 100% 100%;background-repeat: no-repeat;display: inline-block;width: 16px;height: 15px;line-height: 15px;margin-bottom: -1px;\"></span><span style=\"display: none;\"></span><span style=\"font-size: 17px;display: inline-block;margin-left: 8px;color: rgb(72, 179, 120);\">参考与感谢</span><span style=\"display: none;\"></span></h3><ul data-tool=\"mdnice编辑器\" style=\"margin-top: 8px;margin-bottom: 8px;padding-left: 25px;color: black;\" class=\"list-paddingleft-2\"><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">Mysql优化原则_小表驱动大表IN和EXISTS的合理利用:https://segmentfault.com/a/1190000014509559</section></li><li><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\">sql语句的优化分析: https://www.cnblogs.com/knowledgesea/p/3686105.html</section></li></ul><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\"><br></section><section>插点题外话，这两周利用业余时间一直在写，<a target=\"_blank\" href=\"https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247485927&amp;idx=1&amp;sn=1b5913a2a5e62989eac3c8ab681e4f33&amp;chksm=cea2462cf9d5cf3aa3ba63b93aedcefafc046214f5fdc7228d01427123d81c012da6dd62756f&amp;token=292197051&amp;lang=zh_CN&amp;scene=21#wechat_redirect\" textvalue=\"《【Java 大厂真实面试经历】我和阿里面试官的一次“邂逅”(附问题详解)》\" tab=\"innerlink\" data-linktype=\"2\">《【Java 大厂真实面试经历】我和阿里面试官的一次“邂逅”(附问题详解)》</a>的下一期，这篇文章算是鸽了很久。为了写好这篇文章差不多把《现代操作系统》这本书过了一遍，大学学的差不错忘完了。今天晚上边听同事分享他的加拿大学习生活，边继续写文章。</section><section style=\"margin-top: 5px;margin-bottom: 5px;line-height: 26px;color: rgb(1, 1, 1);\"><span style=\"color: rgb(74, 74, 74);letter-spacing: 0.034em;\"><br></span></section></section><p style=\"text-align: center;\"><img class=\"rich_pages img_loading\" data-ratio=\"0.75\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtum9gMiaaorriapiaibv6hibL6zycN1Pu6zbKKYapnGIX0GGyVVnWZqv1uZJw/640?wx_fmt=png\" data-type=\"png\" data-w=\"1440\" style=\"width: 575.45px !important; height: 432.087px !important;\" _width=\"85%\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></p><p style=\"text-align: center;\"><img class=\"rich_pages img_loading\" data-ratio=\"0.75\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9TyibwicuIHfKnuNX0KYngDgtuTnibbzvYegEcbru5XbUJDFHH78Sy74xZ2DU4HC9ag8zjUoc3tgKHzYA/640?wx_fmt=png\" data-type=\"png\" data-w=\"1440\" style=\"width: 575.45px !important; height: 432.087px !important;\" _width=\"85%\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></p><p><span style=\"color: rgb(74, 74, 74);font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;letter-spacing: 0.544px;text-align: left;\">然后我的 Kafka 也还没更新完，哭了～～～下周还要上线，今天临时领了一个还算复杂的前后端都有的任务。哭了\uD83D\uDE2D我的自由时间在哪里哦？</span></p><p><br></p><section data-role=\"outer\" label=\"Powered by 135editor.com\" style=\"color: rgb(63, 63, 63);white-space: normal;font-size: 16px;\"><section data-tools=\"135编辑器\" data-id=\"92648\"><section style=\"margin-top: 15px;margin-right: auto;margin-left: auto;\"><section style=\"margin-right: auto;margin-left: auto;display: -webkit-flex;justify-content: center;\"><section style=\"margin-top: -14px;padding-right: 5px;padding-left: 5px;width: 55px;background: rgb(255, 255, 255);\"><img data-ratio=\"0.19718309859154928\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/YUyZ7AOL3okNrbpwK1O7dyBzC2Plfz68uy4bVIZv9HiaianJyzmbnG37rc8RVw7HcZClFVvgeeAU7lythIgh0Ekw/640?wx_fmt=png\" data-type=\"png\" data-w=\"71\" data-width=\"100%\" style=\"width: 45px !important; height: 8.87324px !important;\" _width=\"55px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></section></section></section></section><section data-role=\"paragraph\"><p><br></p></section></section><section data-role=\"outer\" label=\"Powered by 135editor.com\" style=\"color: rgb(63, 63, 63);white-space: normal;font-size: 16px;\"><section data-tools=\"135编辑器\" data-id=\"95098\"><section style=\"margin: 1em auto;\"><section style=\"display: flex;justify-content: center;align-items: center;\"><section data-width=\"50%\" style=\"width: 234.328px;height: 1px;background: rgb(203, 203, 239);overflow: hidden;\"><br></section><section style=\"margin-right: 4px;margin-left: 4px;width: 125px;\"><img data-ratio=\"0.37423312883435583\" data-src=\"https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6aqek98EtTHUKcyP8jibR2dMpmVDlnHv7DyMlWaib0sO2Qib2XtVPL8wictxAoKMch1iancskn5BpaYcg/640?wx_fmt=gif\" data-type=\"gif\" data-w=\"163\" style=\"display: block; width: 125px !important; height: 48.0307px !important;\" _width=\"125px\" class=\"img_loading __bg_gif\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" data-order=\"0\"></section><section data-width=\"50%\" style=\"width: 234.328px;height: 1px;background: rgb(203, 203, 239);overflow: hidden;\"><br></section></section></section></section></section><p><br></p><p><br></p><section data-from=\"xmt-recommend\" data-tools=\"新媒体排版\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247486449&amp;idx=1&amp;sn=c3b502529ff991c7180281bcc22877af&amp;chksm=cea2443af9d5cd2c1c87049ed15ccf6f88275419c7dbe542406166a703b27d0f3ecf2af901f8&amp;scene=21#wechat_redirect\" target=\"_blank\" style=\"width:100%;\" data-linktype=\"2\"><section style=\"white-space:nowrap;text-align:left;text-decoration:none;display:block;margin:16px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-border-radius:4px;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;box-shadow:rgba(0, 0, 0, 0.15) 0 0 12px 0;height:154px;\">\n\t\t\t\t\t\t\t\t\t<section style=\"margin:0;bottom:0;-webkit-box-sizing:border-box;box-sizing:border-box;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;width:100%;height:154px;\">\n\t\t\t\t\t\t\t\t\t\t<section class=\"h5_image_link\" style=\"width:100%;height:154px;-webkit-background-size:cover;background-size:cover;background-position:50%;background-image:url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9TxphwGUXUJkiaIvQu7ZQaicNpwc0gp0yuuQfv43HyqGjCQvBN1OFYiblUV1r5Kv7V2lUpWpMzQmhSHGg/640?wx_fmt=jpeg&quot;);display:inherit;font-size:inherit;z-index: -1;\">&nbsp;</section>\n\t\t\t\t\t\t\t\t\t\t<section style=\"bottom:0;padding:5px 16px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(0,0,0,.5);color:#fff;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:16px;margin-top:-35px;\">编码5分钟，命名2小时？史上最全的Java命名规范参考！</section>\n\t\t\t\t\t\t\t\t\t</section>\n\t\t\t\t\t\t\t\t</section></a></section><section data-from=\"xmt-recommend\" data-tools=\"新媒体排版\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247486441&amp;idx=1&amp;sn=2b675b6e62215aa2f4d0bbf8e38baf2b&amp;chksm=cea24422f9d5cd34fbdef3351ba9918faa091ba821364163b9e201721d5e16d9956e2c2eb5ab&amp;scene=21#wechat_redirect\" target=\"_blank\" style=\"width:100%;\" data-linktype=\"2\"><section style=\"white-space:nowrap;text-align:left;text-decoration:none;display:block;margin:16px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-border-radius:4px;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;box-shadow:rgba(0, 0, 0, 0.15) 0 0 12px 0;height:154px;\">\n\t\t\t\t\t\t\t\t\t<section style=\"margin:0;bottom:0;-webkit-box-sizing:border-box;box-sizing:border-box;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;width:100%;height:154px;\">\n\t\t\t\t\t\t\t\t\t\t<section class=\"h5_image_link\" style=\"width:100%;height:154px;-webkit-background-size:cover;background-size:cover;background-position:50%;background-image:url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9TwibWz8iardurUjC9jPyyKRb1fibJ3tAwvhfxrUsDzaZwx1cY5g7xpnBGzxefqZwic65XZ9JJMia4icQvLw/640?wx_fmt=jpeg&quot;);display:inherit;font-size:inherit;z-index: -1;\">&nbsp;</section>\n\t\t\t\t\t\t\t\t\t\t<section style=\"bottom:0;padding:5px 16px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(0,0,0,.5);color:#fff;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:16px;margin-top:-35px;\">避免自己写的 url 被diss！建议看看这篇RestFul API简明教程！</section>\n\t\t\t\t\t\t\t\t\t</section>\n\t\t\t\t\t\t\t\t</section></a></section><section data-from=\"xmt-recommend\" data-tools=\"新媒体排版\"><a href=\"http://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&amp;mid=2247486429&amp;idx=1&amp;sn=1b33cd11491ac2bb502c8f8eceb39042&amp;chksm=cea24416f9d5cd0065823a44830d323eb44cdc4a413128d511dcd94e1180fee52590b86f79fd&amp;scene=21#wechat_redirect\" target=\"_blank\" style=\"width:100%;\" data-linktype=\"2\"><section style=\"white-space:nowrap;text-align:left;text-decoration:none;display:block;margin:16px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-border-radius:4px;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box;overflow:hidden;box-shadow:rgba(0, 0, 0, 0.15) 0 0 12px 0;height:154px;\">\n\t\t\t\t\t\t\t\t\t<section style=\"margin:0;bottom:0;-webkit-box-sizing:border-box;box-sizing:border-box;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;width:100%;height:154px;\">\n\t\t\t\t\t\t\t\t\t\t<section class=\"h5_image_link\" style=\"width:100%;height:154px;-webkit-background-size:cover;background-size:cover;background-position:50%;background-image:url(&quot;https://mmbiz.qpic.cn/mmbiz_jpg/iaIdQfEric9Tzov1xkum8PdIBJoWMJzU0eIy6u8CGxlBl9QAyHeE1iaLS9pIEGULY9GXr80lcvjQgSIw5x54HYKdw/640?wx_fmt=jpeg&quot;);display:inherit;font-size:inherit;z-index: -1;\">&nbsp;</section>\n\t\t\t\t\t\t\t\t\t\t<section style=\"bottom:0;padding:5px 16px;width:100%;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(0,0,0,.5);color:#fff;-o-text-overflow:ellipsis;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;font-size:16px;margin-top:-35px;\">面试官：为什么不能轻易修改 serialVersionUID 字段？</section>\n\t\t\t\t\t\t\t\t\t</section>\n\t\t\t\t\t\t\t\t</section></a></section><p><br></p><p><br></p><p style=\"text-align: center;\"><img class=\"rich_pages img_loading\" data-ratio=\"0.45818815331010454\" data-s=\"300,640\" data-src=\"https://mmbiz.qpic.cn/mmbiz_png/iaIdQfEric9Tx5at4b0kpBf4KgrX6SicJvUp4hmAloliaSBqoDqwH0PHr2YgWUGLqibOlCKgHyawGNicU0FEh1HWIwHw/640?wx_fmt=png\" data-type=\"png\" data-w=\"574\" style=\"width: 574px !important; height: 264.084px !important;\" _width=\"574px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" crossorigin=\"anonymous\"></p><p style=\"white-space: normal;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;letter-spacing: 0.544px;text-align: left;color: rgb(0, 0, 0);\"><br></p><section data-role=\"outer\" label=\"Powered by 135editor.com\" style=\"white-space: normal;font-family: Optima-Regular, Optima, PingFangSC-light, PingFangTC-light, &quot;PingFang SC&quot;, Cambria, Cochin, Georgia, Times, &quot;Times New Roman&quot;, serif;font-size: 16px;letter-spacing: 0.544px;text-align: left;color: rgb(0, 0, 0);\"><section data-tools=\"135编辑器\" data-id=\"95172\"><section style=\"display: flex;justify-content: flex-end;align-items: center;\"><section style=\"display: inline-block;text-align: right;\"><section data-brushtype=\"text\" style=\"margin-bottom: -15px;color: rgb(63, 63, 63);letter-spacing: 2px;transform: rotate(0deg);\">好文让朋友知道你“在看”</section></section><section style=\"width: 22px;\"><section style=\"margin-top: 15px;width: 22px;\"><img data-ratio=\"1.0377358490566038\" data-src=\"https://mmbiz.qpic.cn/mmbiz_gif/7QRTvkK2qC6sLlAPcPheDLycujYrOvsZviaSODbRbQzQvW8VL1yiaGA8FTPbpObFuJibSdib3T55sJOa3QfVCyiaPcA/640?wx_fmt=gif\" data-type=\"gif\" data-w=\"53\" data-width=\"100%\" style=\"display: block; width: 22px !important; height: 22.8302px !important;\" _width=\"22px\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\" class=\" __bg_gif\" data-order=\"1\"></section></section></section></section></section>\n                </div>\n\n                <script nonce=\"\" type=\"text/javascript\">\n                    var first_sceen__time = (+new Date());\n\n                    if (\"\" == 1 && document.getElementById('js_content')) {\n                        document.getElementById('js_content').addEventListener(\"selectstart\",function(e){ e.preventDefault(); });\n                    }\n\n                    \n                    (function(){\n                        if (navigator.userAgent.indexOf(\"WindowsWechat\") != -1){\n                            var link = document.createElement('link');\n                            var head = document.getElementsByTagName('head')[0];\n                            link.rel = 'stylesheet';\n                            link.type = 'text/css';\n                            link.href = \"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/style/page/appmsg_new/winwx502975.css\";\n                            head.appendChild(link);\n                        }\n                    })();\n                </script>\n\n                \n<div id=\"js_sponsor_ad_area\" style=\"display: none;\"></div>\n\n\n                \n                <div class=\"read-more__area\" id=\"js_more_read_area\" style=\"display:none;\">\n                    \n                </div>\n\n                 \n                                                    \n                              \n            </div>\n                                        <div id=\"js_tags_preview_toast\" class=\"article-tag__error-tips\" style=\"display: none;\">预览时标签不可点</div>\n                                    \n                        \n\n\n                        \n            <ul id=\"js_hotspot_area\" class=\"article_extend_area\"></ul>\n\n\n            \n            \n            <div id=\"js_album_keep_read\" class=\"appmsg_card_context album_read_card\" style=\"display: none;\">\n                <div class=\"album_read_hd weui-flex\" id=\"js_album_directory\">\n                    <div class=\"album_read_source\"><span>收录于话题 </span><span>#<span id=\"js_album_keep_read_title\"></span></span></div>\n                    <span class=\"weui-btn__word-wrp\"><span id=\"js_album_keep_read_size\"></span>个<i class=\"weui_right_arrow\"></i></span>\n                </div>\n                <div class=\"album_read_bd weui-flex\">\n                  <span class=\"album_read_nav_item album_read_nav_prev weui-flex__item\" id=\"js_album_prev\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">上一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_pre_title\"></span>\n                    </span>\n                  </span>\n                  <span class=\"album_read_nav_item album_read_nav_next weui-flex__item\" id=\"js_album_next\">\n                    <span class=\"album_read_nav_inner\">\n                      <span class=\"album_read_nav_btn\">下一篇</span>\n                      <span class=\"album_read_nav_title\" id=\"js_album_keep_read_next_title\"></span>\n                    </span>\n                  </span>\n                </div>\n            </div>\n\n            \n\n            \n\n\n<div class=\"rich_media_tool\" id=\"js_toobar3\">\n  <div class=\"weui-flex\">\n    <div class=\"weui-flex__item\">\n      \n      \n      \n            \n      <div id=\"js_read_area3\" class=\"media_tool_meta tips_global_primary meta_primary\" style=\"display:none;\">\n        <span id=\"readTxt\">阅读</span>\n        <span id=\"readNum3\"></span>\n      </div>\n    </div>\n  </div> \n  <div class=\"weui-flex sns_opr_area\" id=\"js_bottom_opr_right\" style=\"display: none;\">\n    <div class=\"weui-flex__item\">\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_share js_media_tool_meta\" id=\"js_bottom_share\">\n        <button class=\"sns_opr_btn sns_share_btn\" id=\"js_bottom_share_btn\"><span class=\"sns_opr_gap\">分享</span></button>\n      </span>\n\n      \n      <span style=\"display: none;\" class=\"media_tool_meta meta_primary meta_collect js_media_tool_meta\" id=\"js_bottom_collect\">\n        <button class=\"sns_opr_btn sns_collect_btn\" id=\"js_bottom_collect_btn\"><span class=\"sns_opr_gap\">收藏</span></button>\n      </span>\n    </div> \n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_praise js_media_tool_meta\" id=\"like_old\">\n      <button class=\"sns_opr_btn sns_praise_btn\" id=\"js_bottom_zan_btn\"><span class=\"sns_opr_gap\" id=\"js_parise_wording\">赞</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum_old\" style=\"display: none;\"></span></button>\n    </span>\n\n    \n    <span style=\"display:none;\" class=\"media_tool_meta meta_extra meta_like js_media_tool_meta\" id=\"like3\">\n      \n      <button class=\"sns_opr_btn sns_like_btn\" id=\"js_like_btn\"><span class=\"sns_opr_gap\" id=\"js_like_wording\">在看</span><span class=\"sns_opr_num sns_opr_gap\" id=\"likeNum3\"></span></button>\n    </span>\n  </div> \n</div>\n  \n  <div class=\"like_comment_wrp\" id=\"js_like_comment\" style=\"display: none;\">\n    <div class=\"like_comment_inner\">\n      <div class=\"like_comment_hd\" style=\"display:none\" id=\"js_like_title\"></div>\n      <div class=\"like_comment_bd\">\n        <div class=\"like_comment_tips\" id=\"js_comment_area\">\n          <i class=\"weui-icon-success\"></i><i class=\"icon-success-primary\"></i>已同步到看一看<a href=\"javascript:;\" class=\"like_comment_share_link\" id=\"js_like_comment_share\">写下你的想法</a>\n        </div>\n        <div class=\"like_comment_extra_info\" id=\"js_like_educate\" style=\"display: none\">\n          <p class=\"like_comment_extra_tips\">\n            <span id=\"js_friend_like_area\" style=\"display: none\"></span>\n            <span id=\"js_friend_like_word\">前往“发现”-“看一看”浏览“朋友在看”</span>\n          </p>\n          <p class=\"like_comment_pic_wrp\">\n                          <img class=\"like_comment_pic\" src=\"//res.wx.qq.com/mmbizwap/zh_CN/htmledition/images/pic/appmsg/pic_like_comment492329.png\">\n                      </p>\n          <button class=\"weui-btn weui-btn_primary\" id=\"js_go_wow\">前往看一看</button>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div style=\"display:none;\" id=\"wow_close_inform\">\n    <div class=\"weui-mask\"></div>\n    <div class=\"weui-dialog\">\n      <div class=\"weui-dialog__hd\"><strong class=\"weui-dialog__title\">看一看入口已关闭</strong></div>\n      <div class=\"weui-dialog__bd\">\n        在“设置”-“通用”-“发现页管理”打开“看一看”入口      </div>\n      <div class=\"weui-dialog__ft\" id=\"wow_close_ack\">\n        <a href=\"javascript:;\" class=\"weui-dialog__btn weui-dialog__btn_primary\">我知道了</a>\n      </div>\n    </div>\n  </div>\n\n<div id=\"js_like_toast\" style=\"display: none;\">\n  <div class=\"weui-mask_transparent\"></div>\n  <div class=\"weui-toast\">\n    <i class=\"weui-icon-success-no-circle weui-icon_toast\"></i>\n    <p class=\"weui-toast__content\" id=\"js_toast_msg\">已发送</p>\n  </div>\n</div>\n\n<div style=\"display: none;\" id=\"js_comment_panel\">\n  <div class=\"like_comment_primary_wrp editing\" id=\"js_comment_wrp\">\n    <div class=\"like_comment_primary_inner\">\n      <div class=\"like_comment_primary_hd\">\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_cancel\" id=\"js_comment_cancel\">\n            取消            <i class=\"weui-icon-close-thin\"></i>\n          </button>\n        </div>\n        <h4 class=\"like_comment_primary_title\"> 发送到看一看 </h4>\n        <div class=\"like_comment_primary_hd_side\">\n          <button class=\"like_comment_primary_btn\" id=\"js_comment_confirm\" disabled=\"disabled\">发送</button>\n        </div>\n      </div>\n      <div class=\"like_comment_primary_bd\">\n        <div class=\"like_comment_media_title\" id=\"js_panel_like_title\">\n                      后端程序员必备：书写高质量SQL的30条建议\n                  </div>\n        <div class=\"like_comment_textarea_wrp\">\n          <textarea class=\"like_comment_textarea weui-textarea\" placeholder=\"写下你的想法...\" id=\"js_comment_text\"></textarea>\n        </div>\n      </div>\n      <span class=\"like_comment_msg\" id=\"js_like_comment_msg\" style=\"visibility: hidden;\">最多200字，当前共<span id=\"js_like_current_cnt\"></span>字</span>\n    </div>\n  </div>\n  <div class=\"like_comment_primary_mask\" id=\"js_mask_2\"></div>\n</div>\n\n<div id=\"js_loading\" style=\"display: none;\">\n    <div class=\"weui-mask_transparent\"></div>\n    <div class=\"weui-toast\">\n        <i class=\"weui-loading weui-icon_toast\"></i>\n        <p class=\"weui-toast__content\">发送中</p>\n    </div>\n</div>\n\n\n\n                      </div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "为什么要用redis而不用map做缓存?",
    "ans": "<div id=\"comment-area\" class=\"my-4 answer-area\">\n                                                    <div class=\"d-flex justify-content-between mb-2\">\n                                <div id=\"comment-total\" class=\"h5 mb-0\"><span itemprop=\"answerCount\">5</span> 个回答\n                                </div>\n                                <div>\n                                    <a href=\"/q/1010000009106416#comment-area\" class=\"sort text-dark\" data-sort=\"default\">得票</a><span class=\"split-dot text-secondary\"></span><a href=\"?sort=created#comment-area\" class=\"sort text-secondary\" data-sort=\"desc\">时间</a>\n                                </div>\n                            </div>\n                        \n                                                \n                                                        <div class=\"card mb-2 border-0\">\n    <div class=\"media card-body p-lg-30\" id=\"answer-1020000009106894\" itemscope=\"\" itemtype=\"https://schema.org/Answer\" itemprop=\"acceptedAnswer\">\n        <div class=\"media-body w-0\">\n            <div class=\"commentUnit\">\n                <div class=\"mb-4 information d-flex align-items-center\">\n                    <a class=\"d-uname sflex-center mr-1\" href=\"/u/gipplelake\" itemprop=\"author\" itemscope=\"\" itemtype=\"https://schema.org/Person\">\n                        <img class=\"d-inline-block rounded-circle mr-2 \" width=\"32\" src=\"https://avatar-static.segmentfault.com/385/550/3855503704-58f4879046284_big64\" alt=\"avatar\" itemprop=\"image\">\n                        <strong itemprop=\"name\">GippleLake</strong></a>\n                    <ul class=\"list-inline mb-0 authentication-info sflex-center font-size-14\">\n                                                <li class=\"list-inline-item\">\n                            <svg class=\"svg-inline--fa fa-dice-d8 fa-w-16\" style=\"color: #BF7158;\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"dice-d8\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z\"></path></svg><!-- <i class=\"fas fa-dice-d8\" style=\"color:#BF7158\"></i> -->\n                            <span style=\"color: #BF7158;font-weight:bold\">399</span>\n                        </li>\n\n                        \n                                            </ul>\n\n                </div>\n                <article class=\"article fmt my-3 parsedText\" itemprop=\"text\">\n                    \n<p>缓存分为本地缓存和分布式缓存。以java为例，使用自带的map或者guava实现的是本地缓存，最主要的特点是轻量以及快速，生命周期随着jvm的销毁而结束，并且在多实例的情况下，每个实例都需要各自保存一份缓存，缓存不具有一致性。</p>\n<p>使用redis或memcached之类的称为分布式缓存，在多实例的情况下，各实例共用一份缓存数据，缓存具有一致性。缺点是需要保持redis或memcached服务的高可用，整个程序架构上较为复杂。</p>\n\n                </article>\n\n                <form class=\"d-none edit-form edit-top-comment-form\" action=\"/api/comment/1020000009106894/edit\" method=\"post\">\n                    <div class=\"form-group\">\n                    <textarea autoheight=\"true\" class=\"form-control comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" data-init=\"缓存分为本地缓存和分布式缓存。以java为例，使用自带的map或者guava实现的是本地缓存，最主要的特点是轻量以及快速，生命周期随着jvm的销毁而结束，并且在多实例的情况下，每个实例都需要各自保存一份缓存，缓存不具有一致性。\n\n使用redis或memcached之类的称为分布式缓存，在多实例的情况下，各实例共用一份缓存数据，缓存具有一致性。缺点是需要保持redis或memcached服务的高可用，整个程序架构上较为复杂。\n\n\"></textarea>\n                    </div>\n                    <div class=\"my-3 d-flex align-content-center justify-content-end\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm mr-2 edit-top-comment-cancel-btn cancelEdit\">\n                            取消\n                        </button>\n                        <button type=\"button\" submit-type=\"comment-edit\" class=\"btn btn-primary btn-sm\">\n                            提交\n                        </button>\n                        <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                        <input type=\"hidden\" name=\"id\" value=\"1020000009106894\" autocomplete=\"off\">\n                    </div>\n                </form>\n\n                                \n                <div class=\"handle-bar font-size-14 d-flex justify-content-between mt-3 flex-column flex-md-row\">\n                    <div class=\"sflex-center  flex-column flex-md-row\">\n                        <div class=\"sflex-center\">\n                            <div class=\"btn-group like-group\" role=\"group\" data-like=\"-1\" data-hate=\"-1\">\n                                <button data-type=\"answer\" class=\"func-btn mainLike like-btn btn btn-outline-primary \" data-id=\"1020000009106894\">\n                                        <svg class=\"svg-inline--fa fa-thumbs-up fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z\"></path></svg><!-- <i class=\"far fa-thumbs-up\"></i> -->\n                                        <span class=\"ml-1\">赞</span>\n                                                                                <span class=\"mainLikeNum\" itemprop=\"upvoteCount\">9</span>\n                                                                            </button>\n                                <button data-type=\"answer\" data-toggle=\"popover\" data-placement=\"top\" data-content=\"如果该内容有可改进的余地，欢迎通过回复给作者建议。\" class=\"func-btn downLike btn like-btn btn-outline-secondary \" data-id=\"1020000009106894\">\n                                    <svg class=\"svg-inline--fa fa-thumbs-down fa-w-16 fa-flip-horizontal\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z\"></path></svg><!-- <i class=\"far fa-thumbs-down fa-flip-horizontal\"></i> -->\n                                </button>\n                            </div>\n\n                            \n                                                                                                <button class=\"btn btn-outline-success ml-2 active func-btn\"><svg class=\"svg-inline--fa fa-check-circle fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"check-circle\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z\"></path></svg><!-- <i class=\"far fa-check-circle\"></i> --> 已采纳</button>\n                                                                                    </div>\n                        <div class=\"ml-3\">\n                            <a class=\"text-secondary btn-comment\" href=\"javascript:;\" data-id=\"1020000009106894\">评论</a>\n                            <span class=\"split-dot\"></span>\n                            <a class=\"text-secondary btn-reward\" href=\"javascript:;\" data-payid=\"1020000009106894\">赞赏</a>\n                            <span class=\"split-dot\"></span>\n                                                        <a itemprop=\"url\" href=\"/q/1010000009106416/a-1020000009106894\"><time class=\"text-secondary\" itemprop=\"dateCreated\" data-toggle=\"tooltip\" data-placement=\"top\" datetime=\"2017-04-18T15:20:44+08:00\" title=\"\" data-original-title=\"发布于 2017-04-18 \">更新于 2017-04-18 </time></a>\n                                                    </div>\n                        \n                    </div>\n                    <div class=\"control-area align-self-center d-none\">\n                                        </div>\n                </div>\n\n                <div class=\"card bg-light border-0 mt-3 d-none\" id=\"answer-1020000009106894-form\">\n                    <form class=\"card-body my-2 add-comment-form py-0 pt-3\" action=\"/api/answer/1020000009106894/comments/add\" method=\"post\">\n                        <div class=\"form-group\">\n                        <textarea autoheight=\"true\" class=\"form-control form-control-sm comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" aria-placeholder=\"撰写评论...\"></textarea>\n                        </div>\n                        <div class=\"mt-y d-flex align-content-center justify-content-end\">\n                            <button type=\"button\" submit-type=\"reply\" class=\"btn btn-primary btn-sm\">\n                                提交评论\n                            </button>\n                            <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                            <input type=\"hidden\" name=\"replyUserId\" value=\"1020000009106894\" autocomplete=\"off\">\n                        </div>\n                    </form>\n                </div>\n                            </div>\n            <div class=\"replies mt-3 d-none\" data-content=\"null\" data-id=\"1020000009106894\" data-type=\"answer\" data-hasmore=\"0\" data-user=\"null\">\n                <div class=\"card bg-light border-0\">\n                    <div class=\"card-body py-0\">\n                        <ul class=\"list-group list-group-flush reply-list\" data-page=\"1\"></ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n\n                        \n                                                        <div class=\"card mb-2 border-0\">\n    <div class=\"media card-body p-lg-30\" id=\"answer-1020000009115041\" itemscope=\"\" itemtype=\"https://schema.org/Answer\" itemprop=\"suggestedAnswer\">\n        <div class=\"media-body w-0\">\n            <div class=\"commentUnit\">\n                <div class=\"mb-4 information d-flex align-items-center\">\n                    <a class=\"d-uname sflex-center mr-1\" href=\"/u/xtuer\" itemprop=\"author\" itemscope=\"\" itemtype=\"https://schema.org/Person\">\n                        <img class=\"d-inline-block rounded-circle mr-2 \" width=\"32\" src=\"https://cdn.segmentfault.com/v-5fc4b0fa/global/img/user-64.png\" alt=\"avatar\" itemprop=\"image\">\n                        <strong itemprop=\"name\">公孙二狗</strong></a>\n                    <ul class=\"list-inline mb-0 authentication-info sflex-center font-size-14\">\n                                                <li class=\"list-inline-item\">\n                            <svg class=\"svg-inline--fa fa-dice-d8 fa-w-16\" style=\"color: #BF7158;\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"dice-d8\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z\"></path></svg><!-- <i class=\"fas fa-dice-d8\" style=\"color:#BF7158\"></i> -->\n                            <span style=\"color: #BF7158;font-weight:bold\">1.1k</span>\n                        </li>\n\n                        \n                                            </ul>\n\n                </div>\n                <article class=\"article fmt my-3 parsedText\" itemprop=\"text\">\n                    <ol>\n<li><p>Redis 可以用几十 G 内存来做缓存，Map 不行，一般 JVM 也就分几个 G 数据就够大了</p></li>\n<li><p>Redis 的缓存可以持久化，Map 是内存对象，程序一重启数据就没了</p></li>\n<li><p>Redis 可以实现分布式的缓存，Map 只能存在创建它的程序里</p></li>\n<li><p>Redis 可以处理每秒百万级的并发，是专业的缓存服务，Map 只是一个普通的对象</p></li>\n<li><p>Redis 缓存有过期机制，Map 本身无此功能</p></li>\n<li><p>Redis 有丰富的 API，Map 就简单太多了</p></li>\n</ol>\n                </article>\n\n                <form class=\"d-none edit-form edit-top-comment-form\" action=\"/api/comment/1020000009115041/edit\" method=\"post\">\n                    <div class=\"form-group\">\n                    <textarea autoheight=\"true\" class=\"form-control comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" data-init=\"1. Redis 可以用几十 G 内存来做缓存，Map 不行，一般 JVM 也就分几个 G 数据就够大了\n2. Redis 的缓存可以持久化，Map 是内存对象，程序一重启数据就没了\n3. Redis 可以实现分布式的缓存，Map 只能存在创建它的程序里\n4. Redis 可以处理每秒百万级的并发，是专业的缓存服务，Map 只是一个普通的对象\n5. Redis 缓存有过期机制，Map 本身无此功能\n6. Redis 有丰富的 API，Map 就简单太多了\"></textarea>\n                    </div>\n                    <div class=\"my-3 d-flex align-content-center justify-content-end\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm mr-2 edit-top-comment-cancel-btn cancelEdit\">\n                            取消\n                        </button>\n                        <button type=\"button\" submit-type=\"comment-edit\" class=\"btn btn-primary btn-sm\">\n                            提交\n                        </button>\n                        <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                        <input type=\"hidden\" name=\"id\" value=\"1020000009115041\" autocomplete=\"off\">\n                    </div>\n                </form>\n\n                                \n                <div class=\"handle-bar font-size-14 d-flex justify-content-between mt-3 flex-column flex-md-row\">\n                    <div class=\"sflex-center  flex-column flex-md-row\">\n                        <div class=\"sflex-center\">\n                            <div class=\"btn-group like-group\" role=\"group\" data-like=\"-1\" data-hate=\"-1\">\n                                <button data-type=\"answer\" class=\"func-btn mainLike like-btn btn btn-outline-primary \" data-id=\"1020000009115041\">\n                                        <svg class=\"svg-inline--fa fa-thumbs-up fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z\"></path></svg><!-- <i class=\"far fa-thumbs-up\"></i> -->\n                                        <span class=\"ml-1\">赞</span>\n                                                                                <span class=\"mainLikeNum\" itemprop=\"upvoteCount\">13</span>\n                                                                            </button>\n                                <button data-type=\"answer\" data-toggle=\"popover\" data-placement=\"top\" data-content=\"如果该内容有可改进的余地，欢迎通过回复给作者建议。\" class=\"func-btn downLike btn like-btn btn-outline-secondary \" data-id=\"1020000009115041\">\n                                    <svg class=\"svg-inline--fa fa-thumbs-down fa-w-16 fa-flip-horizontal\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z\"></path></svg><!-- <i class=\"far fa-thumbs-down fa-flip-horizontal\"></i> -->\n                                </button>\n                            </div>\n\n                            \n                                                                                                                </div>\n                        <div class=\"ml-3\">\n                            <a class=\"text-secondary btn-comment\" href=\"javascript:;\" data-id=\"1020000009115041\">评论</a>\n                            <span class=\"split-dot\"></span>\n                            <a class=\"text-secondary btn-reward\" href=\"javascript:;\" data-payid=\"1020000009115041\">赞赏</a>\n                            <span class=\"split-dot\"></span>\n                                                        <a itemprop=\"url\" href=\"/q/1010000009106416/a-1020000009115041\"><time class=\"text-secondary\" itemprop=\"dateCreated\" datetime=\"2017-04-19T09:34:46+08:00\">发布于 2017-04-19 </time></a>\n                                                    </div>\n                        \n                    </div>\n                    <div class=\"control-area align-self-center d-none\">\n                                        </div>\n                </div>\n\n                <div class=\"card bg-light border-0 mt-3 d-none\" id=\"answer-1020000009115041-form\">\n                    <form class=\"card-body my-2 add-comment-form py-0 pt-3\" action=\"/api/answer/1020000009115041/comments/add\" method=\"post\">\n                        <div class=\"form-group\">\n                        <textarea autoheight=\"true\" class=\"form-control form-control-sm comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" aria-placeholder=\"撰写评论...\"></textarea>\n                        </div>\n                        <div class=\"mt-y d-flex align-content-center justify-content-end\">\n                            <button type=\"button\" submit-type=\"reply\" class=\"btn btn-primary btn-sm\">\n                                提交评论\n                            </button>\n                            <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                            <input type=\"hidden\" name=\"replyUserId\" value=\"1020000009115041\" autocomplete=\"off\">\n                        </div>\n                    </form>\n                </div>\n                            </div>\n            <div class=\"replies mt-3 d-none\" data-content=\"null\" data-id=\"1020000009115041\" data-type=\"answer\" data-hasmore=\"0\" data-user=\"null\">\n                <div class=\"card bg-light border-0\">\n                    <div class=\"card-body py-0\">\n                        <ul class=\"list-group list-group-flush reply-list\" data-page=\"1\"></ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n\n                                                        <div class=\"card mb-2 border-0\">\n    <div class=\"media card-body p-lg-30\" id=\"answer-1020000009112797\" itemscope=\"\" itemtype=\"https://schema.org/Answer\" itemprop=\"suggestedAnswer\">\n        <div class=\"media-body w-0\">\n            <div class=\"commentUnit\">\n                <div class=\"mb-4 information d-flex align-items-center\">\n                    <a class=\"d-uname sflex-center mr-1\" href=\"/u/sunzhexing\" itemprop=\"author\" itemscope=\"\" itemtype=\"https://schema.org/Person\">\n                        <img class=\"d-inline-block rounded-circle mr-2 \" width=\"32\" src=\"https://cdn.segmentfault.com/v-5fc4b0fa/global/img/user-64.png\" alt=\"avatar\" itemprop=\"image\">\n                        <strong itemprop=\"name\">孙者行</strong></a>\n                    <ul class=\"list-inline mb-0 authentication-info sflex-center font-size-14\">\n                                                <li class=\"list-inline-item\">\n                            <svg class=\"svg-inline--fa fa-dice-d8 fa-w-16\" style=\"color: #BF7158;\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"dice-d8\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z\"></path></svg><!-- <i class=\"fas fa-dice-d8\" style=\"color:#BF7158\"></i> -->\n                            <span style=\"color: #BF7158;font-weight:bold\">74</span>\n                        </li>\n\n                        \n                                            </ul>\n\n                </div>\n                <article class=\"article fmt my-3 parsedText\" itemprop=\"text\">\n                    \n<p>redis可以独立部署，这样网站代码更新后redis缓存的数据还在，本地内存每次网站更新都会释放掉<br>数据存到redis，多个项目间可以共享缓存数据，如果是本地内存是无法跨项目共享的</p>\n<p>本地缓存不方面查看及修改 redis有丰富工具管理缓存数据</p>\n\n                </article>\n\n                <form class=\"d-none edit-form edit-top-comment-form\" action=\"/api/comment/1020000009112797/edit\" method=\"post\">\n                    <div class=\"form-group\">\n                    <textarea autoheight=\"true\" class=\"form-control comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" data-init=\"redis可以独立部署，这样网站代码更新后redis缓存的数据还在，本地内存每次网站更新都会释放掉\n数据存到redis，多个项目间可以共享缓存数据，如果是本地内存是无法跨项目共享的\n\n本地缓存不方面查看及修改 redis有丰富工具管理缓存数据\"></textarea>\n                    </div>\n                    <div class=\"my-3 d-flex align-content-center justify-content-end\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm mr-2 edit-top-comment-cancel-btn cancelEdit\">\n                            取消\n                        </button>\n                        <button type=\"button\" submit-type=\"comment-edit\" class=\"btn btn-primary btn-sm\">\n                            提交\n                        </button>\n                        <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                        <input type=\"hidden\" name=\"id\" value=\"1020000009112797\" autocomplete=\"off\">\n                    </div>\n                </form>\n\n                                \n                <div class=\"handle-bar font-size-14 d-flex justify-content-between mt-3 flex-column flex-md-row\">\n                    <div class=\"sflex-center  flex-column flex-md-row\">\n                        <div class=\"sflex-center\">\n                            <div class=\"btn-group like-group\" role=\"group\" data-like=\"-1\" data-hate=\"-1\">\n                                <button data-type=\"answer\" class=\"func-btn mainLike like-btn btn btn-outline-primary \" data-id=\"1020000009112797\">\n                                        <svg class=\"svg-inline--fa fa-thumbs-up fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z\"></path></svg><!-- <i class=\"far fa-thumbs-up\"></i> -->\n                                        <span class=\"ml-1\">赞</span>\n                                                                                <span class=\"mainLikeNum\" itemprop=\"upvoteCount\">3</span>\n                                                                            </button>\n                                <button data-type=\"answer\" data-toggle=\"popover\" data-placement=\"top\" data-content=\"如果该内容有可改进的余地，欢迎通过回复给作者建议。\" class=\"func-btn downLike btn like-btn btn-outline-secondary \" data-id=\"1020000009112797\">\n                                    <svg class=\"svg-inline--fa fa-thumbs-down fa-w-16 fa-flip-horizontal\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z\"></path></svg><!-- <i class=\"far fa-thumbs-down fa-flip-horizontal\"></i> -->\n                                </button>\n                            </div>\n\n                            \n                                                                                                                </div>\n                        <div class=\"ml-3\">\n                            <a class=\"text-secondary btn-comment\" href=\"javascript:;\" data-id=\"1020000009112797\">评论</a>\n                            <span class=\"split-dot\"></span>\n                            <a class=\"text-secondary btn-reward\" href=\"javascript:;\" data-payid=\"1020000009112797\">赞赏</a>\n                            <span class=\"split-dot\"></span>\n                                                        <a itemprop=\"url\" href=\"/q/1010000009106416/a-1020000009112797\"><time class=\"text-secondary\" itemprop=\"dateCreated\" datetime=\"2017-04-18T22:50:25+08:00\">发布于 2017-04-18 </time></a>\n                                                    </div>\n                        \n                    </div>\n                    <div class=\"control-area align-self-center d-none\">\n                                        </div>\n                </div>\n\n                <div class=\"card bg-light border-0 mt-3 d-none\" id=\"answer-1020000009112797-form\">\n                    <form class=\"card-body my-2 add-comment-form py-0 pt-3\" action=\"/api/answer/1020000009112797/comments/add\" method=\"post\">\n                        <div class=\"form-group\">\n                        <textarea autoheight=\"true\" class=\"form-control form-control-sm comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" aria-placeholder=\"撰写评论...\"></textarea>\n                        </div>\n                        <div class=\"mt-y d-flex align-content-center justify-content-end\">\n                            <button type=\"button\" submit-type=\"reply\" class=\"btn btn-primary btn-sm\">\n                                提交评论\n                            </button>\n                            <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                            <input type=\"hidden\" name=\"replyUserId\" value=\"1020000009112797\" autocomplete=\"off\">\n                        </div>\n                    </form>\n                </div>\n                            </div>\n            <div class=\"replies mt-3 d-none\" data-content=\"null\" data-id=\"1020000009112797\" data-type=\"answer\" data-hasmore=\"0\" data-user=\"null\">\n                <div class=\"card bg-light border-0\">\n                    <div class=\"card-body py-0\">\n                        <ul class=\"list-group list-group-flush reply-list\" data-page=\"1\"></ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n\n                                                        <div class=\"card mb-2 border-0\">\n    <div class=\"media card-body p-lg-30\" id=\"answer-1020000009107572\" itemscope=\"\" itemtype=\"https://schema.org/Answer\" itemprop=\"suggestedAnswer\">\n        <div class=\"media-body w-0\">\n            <div class=\"commentUnit\">\n                <div class=\"mb-4 information d-flex align-items-center\">\n                    <a class=\"d-uname sflex-center mr-1\" href=\"/u/yooz\" itemprop=\"author\" itemscope=\"\" itemtype=\"https://schema.org/Person\">\n                        <img class=\"d-inline-block rounded-circle mr-2 \" width=\"32\" src=\"https://avatar-static.segmentfault.com/110/827/1108278722-54be7d3e464fc_big64\" alt=\"avatar\" itemprop=\"image\">\n                        <strong itemprop=\"name\">yooz_hardy</strong></a>\n                    <ul class=\"list-inline mb-0 authentication-info sflex-center font-size-14\">\n                                                <li class=\"list-inline-item\">\n                            <svg class=\"svg-inline--fa fa-dice-d8 fa-w-16\" style=\"color: #BF7158;\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"dice-d8\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z\"></path></svg><!-- <i class=\"fas fa-dice-d8\" style=\"color:#BF7158\"></i> -->\n                            <span style=\"color: #BF7158;font-weight:bold\">463</span>\n                        </li>\n\n                                                                            \n                                            </ul>\n\n                </div>\n                <article class=\"article fmt my-3 parsedText\" itemprop=\"text\">\n                    <p>1.如果你的缓存要加载很多内容，你启动的时候需要很久；<br>2.JVM 内存太大容易挂掉的；<br>3.redis 是 C 写的，稳定性和性能更好；<br>4.目前的 redis 已经支持集群模式、持久化等更多特性；<br>5.redis 的 api 已经很简单了，朗朗上手；</p>\n                </article>\n\n                <form class=\"d-none edit-form edit-top-comment-form\" action=\"/api/comment/1020000009107572/edit\" method=\"post\">\n                    <div class=\"form-group\">\n                    <textarea autoheight=\"true\" class=\"form-control comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" data-init=\"1.如果你的缓存要加载很多内容，你启动的时候需要很久；\n2.JVM 内存太大容易挂掉的；\n3.redis 是 C 写的，稳定性和性能更好；\n4.目前的 redis 已经支持集群模式、持久化等更多特性；\n5.redis 的 api 已经很简单了，朗朗上手；\"></textarea>\n                    </div>\n                    <div class=\"my-3 d-flex align-content-center justify-content-end\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm mr-2 edit-top-comment-cancel-btn cancelEdit\">\n                            取消\n                        </button>\n                        <button type=\"button\" submit-type=\"comment-edit\" class=\"btn btn-primary btn-sm\">\n                            提交\n                        </button>\n                        <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                        <input type=\"hidden\" name=\"id\" value=\"1020000009107572\" autocomplete=\"off\">\n                    </div>\n                </form>\n\n                                \n                <div class=\"handle-bar font-size-14 d-flex justify-content-between mt-3 flex-column flex-md-row\">\n                    <div class=\"sflex-center  flex-column flex-md-row\">\n                        <div class=\"sflex-center\">\n                            <div class=\"btn-group like-group\" role=\"group\" data-like=\"-1\" data-hate=\"-1\">\n                                <button data-type=\"answer\" class=\"func-btn mainLike like-btn btn btn-outline-primary \" data-id=\"1020000009107572\">\n                                        <svg class=\"svg-inline--fa fa-thumbs-up fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z\"></path></svg><!-- <i class=\"far fa-thumbs-up\"></i> -->\n                                        <span class=\"ml-1\">赞</span>\n                                                                                <span class=\"mainLikeNum\" itemprop=\"upvoteCount\">1</span>\n                                                                            </button>\n                                <button data-type=\"answer\" data-toggle=\"popover\" data-placement=\"top\" data-content=\"如果该内容有可改进的余地，欢迎通过回复给作者建议。\" class=\"func-btn downLike btn like-btn btn-outline-secondary \" data-id=\"1020000009107572\">\n                                    <svg class=\"svg-inline--fa fa-thumbs-down fa-w-16 fa-flip-horizontal\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z\"></path></svg><!-- <i class=\"far fa-thumbs-down fa-flip-horizontal\"></i> -->\n                                </button>\n                            </div>\n\n                            \n                                                                                                                </div>\n                        <div class=\"ml-3\">\n                            <a class=\"text-secondary btn-comment\" href=\"javascript:;\" data-id=\"1020000009107572\">评论</a>\n                            <span class=\"split-dot\"></span>\n                            <a class=\"text-secondary btn-reward\" href=\"javascript:;\" data-payid=\"1020000009107572\">赞赏</a>\n                            <span class=\"split-dot\"></span>\n                                                        <a itemprop=\"url\" href=\"/q/1010000009106416/a-1020000009107572\"><time class=\"text-secondary\" itemprop=\"dateCreated\" data-toggle=\"tooltip\" data-placement=\"top\" datetime=\"2017-04-18T15:58:34+08:00\" title=\"\" data-original-title=\"发布于 2017-04-18 \">更新于 2017-04-18 </time></a>\n                                                    </div>\n                        \n                    </div>\n                    <div class=\"control-area align-self-center d-none\">\n                                        </div>\n                </div>\n\n                <div class=\"card bg-light border-0 mt-3 d-none\" id=\"answer-1020000009107572-form\">\n                    <form class=\"card-body my-2 add-comment-form py-0 pt-3\" action=\"/api/answer/1020000009107572/comments/add\" method=\"post\">\n                        <div class=\"form-group\">\n                        <textarea autoheight=\"true\" class=\"form-control form-control-sm comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" aria-placeholder=\"撰写评论...\"></textarea>\n                        </div>\n                        <div class=\"mt-y d-flex align-content-center justify-content-end\">\n                            <button type=\"button\" submit-type=\"reply\" class=\"btn btn-primary btn-sm\">\n                                提交评论\n                            </button>\n                            <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                            <input type=\"hidden\" name=\"replyUserId\" value=\"1020000009107572\" autocomplete=\"off\">\n                        </div>\n                    </form>\n                </div>\n                            </div>\n            <div class=\"replies mt-3 d-none\" data-content=\"null\" data-id=\"1020000009107572\" data-type=\"answer\" data-hasmore=\"0\" data-user=\"null\">\n                <div class=\"card bg-light border-0\">\n                    <div class=\"card-body py-0\">\n                        <ul class=\"list-group list-group-flush reply-list\" data-page=\"1\"></ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n\n                                                        <div class=\"card mb-2 border-0\">\n    <div class=\"media card-body p-lg-30\" id=\"answer-1020000009107214\" itemscope=\"\" itemtype=\"https://schema.org/Answer\" itemprop=\"suggestedAnswer\">\n        <div class=\"media-body w-0\">\n            <div class=\"commentUnit\">\n                <div class=\"mb-4 information d-flex align-items-center\">\n                    <a class=\"d-uname sflex-center mr-1\" href=\"/u/panshir\" itemprop=\"author\" itemscope=\"\" itemtype=\"https://schema.org/Person\">\n                        <img class=\"d-inline-block rounded-circle mr-2 high-rank-user\" width=\"32\" src=\"https://avatar-static.segmentfault.com/322/030/3220303168-58e6fb61613d8_big64\" alt=\"avatar\" itemprop=\"image\">\n                        <strong itemprop=\"name\">panshir</strong></a>\n                    <ul class=\"list-inline mb-0 authentication-info sflex-center font-size-14\">\n                                                <li class=\"list-inline-item\">\n                            <svg class=\"svg-inline--fa fa-dice-d8 fa-w-16\" style=\"color: #BF7158;\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"dice-d8\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M225.53 2.52L2.36 233.83c-4.21 4.37-2.56 11.71 3.1 13.77l234.13 85.06V8.39c-.01-7.49-8.91-11.21-14.06-5.87zm284.11 231.31L286.47 2.52C281.32-2.82 272.41.9 272.41 8.4v324.27l234.13-85.06c5.66-2.07 7.31-9.42 3.1-13.78zM33.53 310.38l192 199.1c5.15 5.34 14.06 1.62 14.06-5.88V368.29L42.13 296.61c-8.21-2.98-14.72 7.43-8.6 13.77zm436.34-13.77l-197.46 71.68V503.6c0 7.5 8.91 11.22 14.06 5.88l192-199.1c6.12-6.34-.39-16.75-8.6-13.77z\"></path></svg><!-- <i class=\"fas fa-dice-d8\" style=\"color:#BF7158\"></i> -->\n                            <span style=\"color: #BF7158;font-weight:bold\">1k</span>\n                        </li>\n\n                        \n                                            </ul>\n\n                </div>\n                <article class=\"article fmt my-3 parsedText\" itemprop=\"text\">\n                    <p>1,redis 数据可持久化保存，有些缓存你想重启程序后还能继续使用，那么map实现不了<br>2，redis 可以实现分布式部署，只要涉及到多台多进程啥的，map就实现不了<br>3，redis 有很多数据结构，方便操作，比如 hash set list sort-set等，在某些场景下操作起来比map方便</p>\n                </article>\n\n                <form class=\"d-none edit-form edit-top-comment-form\" action=\"/api/comment/1020000009107214/edit\" method=\"post\">\n                    <div class=\"form-group\">\n                    <textarea autoheight=\"true\" class=\"form-control comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" data-init=\"1,redis 数据可持久化保存，有些缓存你想重启程序后还能继续使用，那么map实现不了\n2，redis 可以实现分布式部署，只要涉及到多台多进程啥的，map就实现不了\n3，redis 有很多数据结构，方便操作，比如 hash set list sort-set等，在某些场景下操作起来比map方便\n\"></textarea>\n                    </div>\n                    <div class=\"my-3 d-flex align-content-center justify-content-end\">\n                        <button type=\"button\" class=\"btn btn-outline-secondary btn-sm mr-2 edit-top-comment-cancel-btn cancelEdit\">\n                            取消\n                        </button>\n                        <button type=\"button\" submit-type=\"comment-edit\" class=\"btn btn-primary btn-sm\">\n                            提交\n                        </button>\n                        <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                        <input type=\"hidden\" name=\"id\" value=\"1020000009107214\" autocomplete=\"off\">\n                    </div>\n                </form>\n\n                                \n                <div class=\"handle-bar font-size-14 d-flex justify-content-between mt-3 flex-column flex-md-row\">\n                    <div class=\"sflex-center  flex-column flex-md-row\">\n                        <div class=\"sflex-center\">\n                            <div class=\"btn-group like-group\" role=\"group\" data-like=\"-1\" data-hate=\"-1\">\n                                <button data-type=\"answer\" class=\"func-btn mainLike like-btn btn btn-outline-primary \" data-id=\"1020000009107214\">\n                                        <svg class=\"svg-inline--fa fa-thumbs-up fa-w-16\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-up\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z\"></path></svg><!-- <i class=\"far fa-thumbs-up\"></i> -->\n                                        <span class=\"ml-1\">赞</span>\n                                                                                <span class=\"mainLikeNum hidden\" itemprop=\"upvoteCount\">0</span>\n                                                                            </button>\n                                <button data-type=\"answer\" data-toggle=\"popover\" data-placement=\"top\" data-content=\"如果该内容有可改进的余地，欢迎通过回复给作者建议。\" class=\"func-btn downLike btn like-btn btn-outline-secondary \" data-id=\"1020000009107214\">\n                                    <svg class=\"svg-inline--fa fa-thumbs-down fa-w-16 fa-flip-horizontal\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"far\" data-icon=\"thumbs-down\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\" data-fa-i2svg=\"\"><path fill=\"currentColor\" d=\"M466.27 225.31c4.674-22.647.864-44.538-8.99-62.99 2.958-23.868-4.021-48.565-17.34-66.99C438.986 39.423 404.117 0 327 0c-7 0-15 .01-22.22.01C201.195.01 168.997 40 128 40h-10.845c-5.64-4.975-13.042-8-21.155-8H32C14.327 32 0 46.327 0 64v240c0 17.673 14.327 32 32 32h64c11.842 0 22.175-6.438 27.708-16h7.052c19.146 16.953 46.013 60.653 68.76 83.4 13.667 13.667 10.153 108.6 71.76 108.6 57.58 0 95.27-31.936 95.27-104.73 0-18.41-3.93-33.73-8.85-46.54h36.48c48.602 0 85.82-41.565 85.82-85.58 0-19.15-4.96-34.99-13.73-49.84zM64 296c-13.255 0-24-10.745-24-24s10.745-24 24-24 24 10.745 24 24-10.745 24-24 24zm330.18 16.73H290.19c0 37.82 28.36 55.37 28.36 94.54 0 23.75 0 56.73-47.27 56.73-18.91-18.91-9.46-66.18-37.82-94.54C206.9 342.89 167.28 272 138.92 272H128V85.83c53.611 0 100.001-37.82 171.64-37.82h37.82c35.512 0 60.82 17.12 53.12 65.9 15.2 8.16 26.5 36.44 13.94 57.57 21.581 20.384 18.699 51.065 5.21 65.62 9.45 0 22.36 18.91 22.27 37.81-.09 18.91-16.71 37.82-37.82 37.82z\"></path></svg><!-- <i class=\"far fa-thumbs-down fa-flip-horizontal\"></i> -->\n                                </button>\n                            </div>\n\n                            \n                                                                                                                </div>\n                        <div class=\"ml-3\">\n                            <a class=\"text-secondary btn-comment\" href=\"javascript:;\" data-id=\"1020000009107214\">评论</a>\n                            <span class=\"split-dot\"></span>\n                            <a class=\"text-secondary btn-reward\" href=\"javascript:;\" data-payid=\"1020000009107214\">赞赏</a>\n                            <span class=\"split-dot\"></span>\n                                                        <a itemprop=\"url\" href=\"/q/1010000009106416/a-1020000009107214\"><time class=\"text-secondary\" itemprop=\"dateCreated\" datetime=\"2017-04-18T15:38:34+08:00\">发布于 2017-04-18 </time></a>\n                                                    </div>\n                        \n                    </div>\n                    <div class=\"control-area align-self-center d-none\">\n                                        </div>\n                </div>\n\n                <div class=\"card bg-light border-0 mt-3 d-none\" id=\"answer-1020000009107214-form\">\n                    <form class=\"card-body my-2 add-comment-form py-0 pt-3\" action=\"/api/answer/1020000009107214/comments/add\" method=\"post\">\n                        <div class=\"form-group\">\n                        <textarea autoheight=\"true\" class=\"form-control form-control-sm comment-text\" rows=\"1\" placeholder=\"撰写评论 ...\" style=\"overflow: hidden; overflow-wrap: break-word; resize: none;\" name=\"text\" aria-placeholder=\"撰写评论...\"></textarea>\n                        </div>\n                        <div class=\"mt-y d-flex align-content-center justify-content-end\">\n                            <button type=\"button\" submit-type=\"reply\" class=\"btn btn-primary btn-sm\">\n                                提交评论\n                            </button>\n                            <input type=\"hidden\" name=\"objectId\" value=\"1010000009106416\" autocomplete=\"off\">\n                            <input type=\"hidden\" name=\"replyUserId\" value=\"1020000009107214\" autocomplete=\"off\">\n                        </div>\n                    </form>\n                </div>\n                            </div>\n            <div class=\"replies mt-3 d-none\" data-content=\"null\" data-id=\"1020000009107214\" data-type=\"answer\" data-hasmore=\"0\" data-user=\"null\">\n                <div class=\"card bg-light border-0\">\n                    <div class=\"card-body py-0\">\n                        <ul class=\"list-group list-group-flush reply-list\" data-page=\"1\"></ul>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    </div>\n\n                        \n                        \n                        <div class=\"d-none ignore-answer\">\n                                                    </div>\n                    </div>"
  },
  {
    "category": "dataBase",
    "qes": "Redis 和 Memcached 有什么区别？Redis 的线程模型是什么？为什么单线程的 Redis 比多线程的 Memcached 效率要高得多？",
    "ans": "<div class=\"content_post\">\n                        <!-- 摘要 -->\n                        <section class=\"ad\"><h1 style=\"margin: 0px; padding: 0px; border: 0px; background-image: initial; background-position: initial; background-size: initial; background-repeat: initial; background-attachment: initial; background-origin: initial; background-clip: initial; line-height: 42px; text-rendering: optimizelegibility; font-weight: normal; font-size: 32px; box-sizing: border-box; font-family: 'PingFang SC', 'Microsoft Yahei', 'Helvetica Neue', Helvetica, STHeiTi, sans-serif;\"></h1>\n<strong><a href=\"https://www.javazhiyin.com/jvkx/%e5%bc%ba%e5%a4%a7%ef%bc%8c10k%e7%82%b9%e8%b5%9e%e7%9a%84-springboot-%e5%90%8e%e5%8f%b0%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f%e7%ab%9f%e7%84%b6%e5%87%ba%e4%ba%86%e8%af%a6%e7%bb%86%e6%95%99%e7%a8%8b\">&gt;&gt;强大，10k+点赞的 SpringBoot 后台管理系统竟然出了详细教程！</a></strong></section>                        <h2>面试题</h2>\n<p>redis 和 memcached 有什么区别？redis 的线程模型是什么？为什么 redis 单线程却能支撑高并发？</p>\n<h2><a id=\"user-content-面试官心理分析\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#%E9%9D%A2%E8%AF%95%E5%AE%98%E5%BF%83%E7%90%86%E5%88%86%E6%9E%90\" aria-hidden=\"true\" rel=\"nofollow\"></a>面试官心理分析</h2>\n<p>这个是问 redis 的时候，最基本的问题吧，redis 最基本的一个内部原理和特点，就是 redis 实际上是个<strong>单线程工作模型</strong>，你要是这个都不知道，那后面玩儿 redis 的时候，出了问题岂不是什么都不知道？</p>\n<p>还有可能面试官会问问你 redis 和 memcached 的区别，但是 memcached 是早些年各大互联网公司常用的缓存方案，但是现在近几年基本都是 redis，没什么公司用 memcached 了。</p>\n<h2><a id=\"user-content-面试题剖析\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#%E9%9D%A2%E8%AF%95%E9%A2%98%E5%89%96%E6%9E%90\" aria-hidden=\"true\" rel=\"nofollow\"></a>面试题剖析</h2>\n<h3><a id=\"user-content-redis-和-memcached-有啥区别\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#redis-%E5%92%8C-memcached-%E6%9C%89%E5%95%A5%E5%8C%BA%E5%88%AB\" aria-hidden=\"true\" rel=\"nofollow\"></a>redis 和 memcached 有啥区别？</h3>\n<h4><a id=\"user-content-redis-支持复杂的数据结构\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#redis-%E6%94%AF%E6%8C%81%E5%A4%8D%E6%9D%82%E7%9A%84%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84\" aria-hidden=\"true\" rel=\"nofollow\"></a>redis 支持复杂的数据结构</h4>\n<p>redis 相比 memcached 来说，拥有更多的数据结构，能支持更丰富的数据操作。如果需要缓存能够支持更复杂的结构和操作， redis 会是不错的选择。</p>\n<h4><a id=\"user-content-redis-原生支持集群模式\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#redis-%E5%8E%9F%E7%94%9F%E6%94%AF%E6%8C%81%E9%9B%86%E7%BE%A4%E6%A8%A1%E5%BC%8F\" aria-hidden=\"true\" rel=\"nofollow\"></a>redis 原生支持集群模式</h4>\n<p>在 redis3.x 版本中，便能支持 cluster 模式，而 memcached 没有原生的集群模式，需要依靠客户端来实现往集群中分片写入数据。</p>\n<h4><a id=\"user-content-性能对比\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94\" aria-hidden=\"true\" rel=\"nofollow\"></a>性能对比</h4>\n<p>由于 redis 只使用单核，而 memcached 可以使用多核，所以平均每一个核上 redis 在存储小数据时比 memcached 性能更高。而在 100k 以上的数据中，memcached 性能要高于 redis，虽然 redis 最近也在存储大数据的性能上进行优化，但是比起 memcached，还是稍有逊色。</p>\n<h3><a id=\"user-content-redis-的线程模型\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#redis-%E7%9A%84%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B\" aria-hidden=\"true\" rel=\"nofollow\"></a>redis 的线程模型</h3>\n<p>redis 内部使用文件事件处理器&nbsp;<code>file event handler</code>，这个文件事件处理器是单线程的，所以 redis 才叫做单线程的模型。它采用 IO 多路复用机制同时监听多个 socket，根据 socket 上的事件来选择对应的事件处理器进行处理。</p>\n<p>文件事件处理器的结构包含 4 个部分：</p>\n<ul>\n<li>多个 socket</li>\n<li>IO 多路复用程序</li>\n<li>文件事件分派器</li>\n<li>事件处理器（连接应答处理器、命令请求处理器、命令回复处理器）</li>\n</ul>\n<p>多个 socket 可能会并发产生不同的操作，每个操作对应不同的文件事件，但是 IO 多路复用程序会监听多个 socket，会将 socket 产生的事件放入队列中排队，事件分派器每次从队列中取出一个事件，把该事件交给对应的事件处理器进行处理。</p>\n<p>来看客户端与 redis 的一次通信过程：</p>\n<p><img class=\"alignnone size-full wp-image-22945\" data-original=\"https://www.javazhiyin.com/wp-content/uploads/2018/12/redis-single-thread-model.png\" src=\"https://www.javazhiyin.com/wp-content/uploads/2018/12/redis-single-thread-model.png\" width=\"1280\" height=\"346\" alt=\"redis-single-thread-model\" style=\"display: block;\"></p>\n<p>客户端 socket01 向 redis 的 server socket 请求建立连接，此时 server socket 会产生一个&nbsp;<code>AE_READABLE</code>&nbsp;事件，IO 多路复用程序监听到 server socket 产生的事件后，将该事件压入队列中。文件事件分派器从队列中获取该事件，交给<code>连接应答处理器</code>。连接应答处理器会创建一个能与客户端通信的 socket01，并将该 socket01 的&nbsp;<code>AE_READABLE</code>&nbsp;事件与命令请求处理器关联。</p>\n<p>假设此时客户端发送了一个&nbsp;<code>set key value</code>&nbsp;请求，此时 redis 中的 socket01 会产生&nbsp;<code>AE_READABLE</code>&nbsp;事件，IO 多路复用程序将事件压入队列，此时事件分派器从队列中获取到该事件，由于前面 socket01 的&nbsp;<code>AE_READABLE</code>&nbsp;事件已经与命令请求处理器关联，因此事件分派器将事件交给命令请求处理器来处理。命令请求处理器读取 socket01 的&nbsp;<code>key value</code>&nbsp;并在自己内存中完成&nbsp;<code>key value</code>&nbsp;的设置。操作完成后，它会将 socket01 的&nbsp;<code>AE_WRITABLE</code>&nbsp;事件与命令回复处理器关联。</p>\n<p>如果此时客户端准备好接收返回结果了，那么 redis 中的 socket01 会产生一个&nbsp;<code>AE_WRITABLE</code>&nbsp;事件，同样压入队列中，事件分派器找到相关联的命令回复处理器，由命令回复处理器对 socket01 输入本次操作的一个结果，比如&nbsp;<code>ok</code>，之后解除 socket01 的&nbsp;<code>AE_WRITABLE</code>&nbsp;事件与命令回复处理器的关联。</p>\n<p>这样便完成了一次通信。</p>\n<h3><a id=\"user-content-为啥-redis-单线程模型也能效率这么高\" class=\"anchor\" href=\"https://github.com/doocs/advanced-java/blob/master/docs/high-concurrency/redis-single-thread-model.md#%E4%B8%BA%E5%95%A5-redis-%E5%8D%95%E7%BA%BF%E7%A8%8B%E6%A8%A1%E5%9E%8B%E4%B9%9F%E8%83%BD%E6%95%88%E7%8E%87%E8%BF%99%E4%B9%88%E9%AB%98\" aria-hidden=\"true\" rel=\"nofollow\"></a>为啥 redis 单线程模型也能效率这么高？</h3>\n<ul>\n<li>纯内存操作</li>\n<li>核心是基于非阻塞的 IO 多路复用机制</li>\n<li>单线程反而避免了多线程的频繁上下文切换问题</li>\n</ul>\n                                                    <!-- 关键词 -->\n<div class=\"tags\">\n    <svg t=\"1509677553769\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"3178\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><path d=\"M888.264 64v896L511.998 736 135.736 960V64h752.528z\"></path></svg><a href=\"https://www.javazhiyin.com/tag/redis%e7%bc%93%e5%ad%98\" title=\"Redis缓存\" target=\"_blank\">Redis缓存(7)</a><a href=\"https://www.javazhiyin.com/tag/%e7%bc%93%e5%ad%98\" title=\"缓存\" target=\"_blank\">缓存(20)</a></div>\n                                            </div>"
  },
  {
    "category": "dataBase",
    "qes": "redis持久化机制",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body\">\n    <p><strong><span style=\"font-size: 14pt\">Redis提供的持久化机制</span></strong><strong><span style=\"font-size: 14pt\">　</span></strong></p>\n<p>　　Redis是一种面向“key-value”类型数据的分布式NoSQL数据库系统，具有高性能、持久存储、适应高并发应用场景等优势。它虽然起步较晚，但发展却十分迅速。&nbsp;<br><br>近日，Redis的作者在博客中写到，<strong>他看到的所有针对Redis的讨论中，对Redis持久化的误解是最大的</strong>，于是他写了一篇长文来对Redis的持久化进行了系统性的论述。</p>\n<p>文章主要包含三个方面：<strong>Redis持久化是如何工作的、这一性能是否可靠以及和其它类型的数据库比较</strong>。以下为文章内容：&nbsp;<br><br><strong>一、Redis持久化是如何工作的？</strong>&nbsp;<br><br>　　什么是持久化？简单来讲就是将数据放到断电后数据不会丢失的设备中，也就是我们通常理解的硬盘上。</p>\n<p><strong>首先我们来看一下数据库在进行写操作时到底做了哪些事，主要有下面五个过程</strong>：&nbsp;</p>\n<p>&nbsp;</p>\n<ul>\n<li>客户端向服务端发送写操作（数据在客户端的内存中）。</li>\n<li>数据库服务端接收到写请求的数据（数据在服务端的内存中）。</li>\n<li>服务端调用write这个系统调用，将数据往磁盘上写（数据在系统内存的缓冲区中）。</li>\n<li>操作系统将缓冲区中的数据转移到磁盘控制器上（数据在磁盘缓存中）。</li>\n<li>磁盘控制器将数据写到磁盘的物理介质中（数据真正落到磁盘上）。</li>\n\n\n\n\n</ul>\n<p>&nbsp;</p>\n<p><strong>故障分析</strong>&nbsp;<br><br>写操作大致有上面5个流程，<strong>下面我们结合上面的5个流程看一下各种级别的故障</strong>：&nbsp;</p>\n<p>&nbsp;</p>\n<ul>\n<li>当数据库系统故障时，这时候系统内核还是完好的。那么此时只要我们执行完了第3步，那么数据就是安全的，因为后续操作系统会来完成后面几步，保证数据最终会落到磁盘上。</li>\n<li>当系统断电时，这时候上面5项中提到的所有缓存都会失效，并且数据库和操作系统都会停止工作。<strong>所以只有当数据在完成第5步后，才能保证在断电后数据不丢失</strong>。</li>\n\n\n\n\n</ul>\n<p>&nbsp;</p>\n<p><strong>通过上面5步的了解，可能我们会希望搞清下面一些问题</strong>：&nbsp;</p>\n<ul>\n<li>数据库多长时间调用一次write，将数据写到内核缓冲区？</li>\n<li>内核多长时间会将系统缓冲区中的数据写到磁盘控制器？</li>\n<li>磁盘控制器又在什么时候把缓存中的数据写到物理介质上？</li>\n\n\n\n\n</ul>\n<p>&nbsp;</p>\n<p>　　对于第一个问题，通常数据库层面会进行全面控制。</p>\n<p>　　而对第二个问题，操作系统有其默认的策略，但是我们也可以通过POSIX API提供的fsync系列命令强制操作系统将数据从内核区写到磁盘控制器上。</p>\n<p>　　对于第三个问题，好像数据库已经无法触及，但实际上，大多数情况下磁盘缓存是被设置关闭的，或者是只开启为读缓存，也就是说写操作不会进行缓存，直接写到磁盘。</p>\n<p>　　<strong>建议的做法是仅仅当你的磁盘设备有备用电池时才开启写缓存</strong>。&nbsp;<br><br><strong>数据损坏</strong>&nbsp;<br><br>　　所谓数据损坏，就是数据无法恢复，上面我们讲的都是如何保证数据是确实写到磁盘上去，但是写到磁盘上可能并不意味着数据不会损坏。比如我们可能一次写请求会进行两次不同的写操作，当意外发生时，可能会导致一次写操作安全完成，但是另一次还没有进行。如果数据库的数据文件结构组织不合理，可能就会导致数据完全不能恢复的状况出现。&nbsp;<br><br><strong>这里通常也有三种策略来组织数据，以防止数据文件损坏到无法恢复的情况</strong>：&nbsp;<br><br></p>\n<ul>\n<ul>\n<li>第一种是最粗糙的处理，就是不通过数据的组织形式保证数据的可恢复性。而是通过配置数据同步备份的方式，在数据文件损坏后通过数据备份来进行恢复。实际上MongoDB在不开启操作日志，通过配置Replica Sets时就是这种情况。</li>\n<li>另一种是在上面基础上添加一个操作日志，每次操作时记一下操作的行为，这样我们可以通过操作日志来进行数据恢复。因为操作日志是顺序追加的方式写的，所以不会出现操作日志也无法恢复的情况。这也类似于MongoDB开启了操作日志的情况。</li>\n<li>更保险的做法是数据库不进行旧数据的修改，只是以追加方式去完成写操作，这样数据本身就是一份日志，这样就永远不会出现数据无法恢复的情况了。实际上CouchDB就是此做法的优秀范例。</li>\n\n</ul>\n\n</ul>\n<p>　</p>\n<h2 id=\"rdb机制的优势和略施\">二 、Redis提供了RDB持久化和AOF持久化</h2>\n<h2 id=\"rdb机制的优势和略施\">RDB机制的优势和略施</h2>\n<p>　　RDB持久化是指在指定的时间间隔内将内存中的数据集快照写入磁盘。 </p>\n<p>　　<span style=\"color: rgba(255, 0, 0, 1)\">也是默认的持久化方式</span>，这种方式是就是将内存中数据以快照的方式写入到二进制文件中,默认的文件名为dump.rdb。</p>\n<p>可以通过配置设置自动做快照持久化的方式。我们可以配置redis在n秒内如果超过m个key被修改就自动做快照，下面是默认的快照保存配置</p>\n<pre><code class=\"hljs fortran apache\">   <span class=\"hljs-keyword\"><span class=\"hljs-attribute\">save</span> <span class=\"hljs-number\"><span class=\"hljs-number\">900</span> <span class=\"hljs-number\"><span class=\"hljs-number\">1</span>     #<span class=\"hljs-number\"><span class=\"hljs-number\">900</span>秒内如果超过<span class=\"hljs-number\"><span class=\"hljs-number\">1</span>个key被修改，则发起快照保存\n   <span class=\"hljs-keyword\"><span class=\"hljs-attribute\">save</span> <span class=\"hljs-number\"><span class=\"hljs-number\">300</span> <span class=\"hljs-number\"><span class=\"hljs-number\">10</span>    #<span class=\"hljs-number\"><span class=\"hljs-number\">300</span>秒内容如超过<span class=\"hljs-number\"><span class=\"hljs-number\">10</span>个key被修改，则发起快照保存\n   <span class=\"hljs-keyword\"><span class=\"hljs-attribute\">save</span> <span class=\"hljs-number\"><span class=\"hljs-number\">60</span> <span class=\"hljs-number\"><span class=\"hljs-number\">10000</span>\n</span></span></span></span></span></span></span></span></span></span></span></span></span></code></pre>\n<h3 id=\"rdb文件保存过程\">RDB文件保存过程</h3>\n<ul>\n<li>redis调用fork,现在有了子进程和父进程。</li>\n<li>父进程继续处理client请求，子进程负责将内存内容写入到临时文件。由于os的写时复制机制（copy on write)父子进程会共享相同的物理页面，当父进程处理写请求时os会为父进程要修改的页面创建副本，而不是写共享的页面。所以子进程的地址空间内的数 据是fork时刻整个数据库的一个快照。</li>\n<li>当子进程将快照写入临时文件完毕后，用临时文件替换原来的快照文件，然后子进程退出。</li>\n</ul>\n<p>client 也可以使用save或者bgsave命令通知redis做一次快照持久化。save操作是在主线程中保存快照的，由于redis是用一个主线程来处理所有 client的请求，这种方式会阻塞所有client请求。所以不推荐使用。</p>\n<p>另一点需要注意的是，每次快照持久化都是将内存数据完整写入到磁盘一次，并不 是增量的只同步脏数据。如果数据量大的话，而且写操作比较多，必然会引起大量的磁盘io操作，可能会严重影响性能。</p>\n<h3 id=\"优势\">优势</h3>\n<ul>\n<li>一旦采用该方式，那么你的整个Redis数据库将只包含一个文件，这样非常方便进行备份。比如你可能打算没1天归档一些数据。</li>\n<li>方便备份，我们可以很容易的将一个一个RDB文件移动到其他的存储介质上</li>\n<li>RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。</li>\n<li>RDB 可以最大化 Redis 的性能：父进程在保存 RDB 文件时唯一要做的就是 fork 出一个子进程，然后这个子进程就会处理接下来的所有保存工作，父进程无须执行任何磁盘 I/O 操作。</li>\n</ul>\n<h3 id=\"劣势\">劣势</h3>\n<ul>\n<li>如果你需要尽量避免在服务器故障时丢失数据，那么 RDB 不适合你。 虽然 Redis 允许你设置不同的保存点（save point）来控制保存 RDB 文件的频率， 但是， 因为RDB 文件需要保存整个数据集的状态， 所以它并不是一个轻松的操作。 因此你可能会至少 5 分钟才保存一次 RDB 文件。 在这种情况下， 一旦发生故障停机， 你就可能会丢失好几分钟的数据。</li>\n<li>每次保存 RDB 的时候，Redis 都要 fork() 出一个子进程，并由子进程来进行实际的持久化工作。 在数据集比较庞大时， fork() 可能会非常耗时，造成服务器在某某毫秒内停止处理客户端； 如果数据集非常巨大，并且 CPU 时间非常紧张的话，那么这种停止时间甚至可能会长达整整一秒。 虽然 AOF 重写也需要进行 fork() ，但无论 AOF 重写的执行间隔有多长，数据的耐久性都不会有任何损失。</li>\n</ul>\n<h2 id=\"aof文件保存过程\">AOF文件保存过程</h2>\n<p>redis会将每一个收到的写命令都通过write函数追加到文件中(默认是 appendonly.aof)。</p>\n<p>当redis重启时会通过重新执行文件中保存的写命令来在内存中重建整个数据库的内容。当然由于os会在内核中缓存 write做的修改，所以可能不是立即写到磁盘上。这样aof方式的持久化也还是有可能会丢失部分修改。不过我们可以通过配置文件告诉redis我们想要 通过fsync函数强制os写入到磁盘的时机。有三种方式如下（默认是：每秒fsync一次）</p>\n<div class=\"sourceCode\">\n<pre class=\"sourceCode javascript\"><code class=\"sourceCode javascript hljs\">appendonly yes              <span class=\"co\"><span class=\"hljs-comment\" data-garbage=\"true\"><span class=\"hljs-comment\">//启用aof持久化方式</span>\n# appendfsync always      <span class=\"co\"><span class=\"hljs-comment\" data-garbage=\"true\"><span class=\"hljs-comment\">//每次收到写命令就立即强制写入磁盘，最慢的，但是保证完全的持久化，不推荐使用</span>\nappendfsync everysec     <span class=\"co\"><span class=\"hljs-comment\" data-garbage=\"true\"><span class=\"hljs-comment\">//每秒钟强制写入磁盘一次，在性能和持久化方面做了很好的折中，推荐</span>\n# appendfsync no    <span class=\"co\"><span class=\"hljs-comment\" data-garbage=\"true\"><span class=\"hljs-comment\">//完全依赖os，性能最好,持久化没保证</span></span></span></span></span></span></span></span></span></code></pre>\n</div>\n<p>aof 的方式也同时带来了另一个问题。持久化文件会变的越来越大。例如我们调用incr test命令100次，文件中必须保存全部的100条命令，其实有99条都是多余的。因为要恢复数据库的状态其实文件中保存一条set test 100就够了。</p>\n<p>为了压缩aof的持久化文件。redis提供了bgrewriteaof命令。收到此命令redis将使用与快照类似的方式将内存中的数据 以命令的方式保存到临时文件中，最后替换原来的文件。具体过程如下</p>\n<ul>\n<li>redis调用fork ，现在有父子两个进程</li>\n<li>子进程根据内存中的数据库快照，往临时文件中写入重建数据库状态的命令</li>\n<li>父进程继续处理client请求，除了把写命令写入到原来的aof文件中。同时把收到的写命令缓存起来。这样就能保证如果子进程重写失败的话并不会出问题。</li>\n<li>当子进程把快照内容写入已命令方式写到临时文件中后，子进程发信号通知父进程。然后父进程把缓存的写命令也写入到临时文件。</li>\n<li>现在父进程可以使用临时文件替换老的aof文件，并重命名，后面收到的写命令也开始往新的aof文件中追加。</li>\n</ul>\n<p>需要注意到是重写aof文件的操作，并没有读取旧的aof文件，而是将整个内存中的数据库内容用命令的方式重写了一个新的aof文件,这点和快照有点类似。</p>\n<h3 id=\"优势-1\">优势</h3>\n<ul>\n<li>\n<p>使用 AOF 持久化会让 Redis 变得非常耐久（much more durable）：你可以设置不同的 fsync 策略，比如无 fsync ，每秒钟一次 fsync ，或者每次执行写入命令时 fsync 。 AOF 的默认策略为每秒钟 fsync 一次，在这种配置下，Redis 仍然可以保持良好的性能，并且就算发生故障停机，也最多只会丢失一秒钟的数据（ fsync 会在后台线程执行，所以主线程可以继续努力地处理命令请求）。</p>\n</li>\n<li>\n<p>AOF 文件是一个只进行追加操作的日志文件（append only log）， 因此对 AOF 文件的写入不需要进行 seek ， 即使日志因为某些原因而包含了未写入完整的命令（比如写入时磁盘已满，写入中途停机，等等）， redis-check-aof 工具也可以轻易地修复这种问题。<br>Redis 可以在 AOF 文件体积变得过大时，自动地在后台对 AOF 进行重写： 重写后的新 AOF 文件包含了恢复当前数据集所需的最小命令集合。 整个重写操作是绝对安全的，因为 Redis 在创建新 AOF 文件的过程中，会继续将命令追加到现有的 AOF 文件里面，即使重写过程中发生停机，现有的 AOF 文件也不会丢失。 而一旦新 AOF 文件创建完毕，Redis 就会从旧 AOF 文件切换到新 AOF 文件，并开始对新 AOF 文件进行追加操作。</p>\n\n\n\n\n\n</li>\n<li>\n<p>AOF 文件有序地保存了对数据库执行的所有写入操作， 这些写入操作以 Redis 协议的格式保存， 因此 AOF 文件的内容非常容易被人读懂， 对文件进行分析（parse）也很轻松。 导出（export） AOF 文件也非常简单： 举个例子， 如果你不小心执行了 FLUSHALL 命令， 但只要 AOF 文件未被重写， 那么只要停止服务器， 移除 AOF 文件末尾的 FLUSHALL 命令， 并重启 Redis ， 就可以将数据集恢复到 FLUSHALL 执行之前的状态。</p>\n\n\n\n\n\n</li>\n\n\n\n\n\n</ul>\n<h3 id=\"劣势-1\">劣势</h3>\n<ul>\n<li>\n<p>对于相同的数据集来说，AOF 文件的体积通常要大于 RDB 文件的体积。</p>\n\n\n\n\n\n</li>\n<li>\n<p>根据所使用的 fsync 策略，AOF 的速度可能会慢于 RDB 。 在一般情况下， 每秒 fsync 的性能依然非常高， 而关闭 fsync 可以让 AOF 的速度和 RDB 一样快， 即使在高负荷之下也是如此。 不过在处理巨大的写入载入时，RDB 可以提供更有保证的最大延迟时间（latency）。</p>\n\n\n\n\n\n</li>\n<li>\n<p>AOF 在过去曾经发生过这样的 bug ： 因为个别命令的原因，导致 AOF 文件在重新载入时，无法将数据集恢复成保存时的原样。 （举个例子，阻塞命令 BRPOPLPUSH 就曾经引起过这样的 bug 。） 测试套件里为这种情况添加了测试： 它们会自动生成随机的、复杂的数据集， 并通过重新载入这些数据来确保一切正常。 虽然这种 bug 在 AOF 文件中并不常见， 但是对比来说， RDB 几乎是不可能出现这种 bug 的。</p>\n\n\n\n\n\n</li>\n\n\n\n\n\n</ul>\n<h2 id=\"抉择\">抉择</h2>\n<p>一般来说， 如果想达到足以媲美 PostgreSQL 的数据安全性， 你应该同时使用两种持久化功能。</p>\n<p>如果你非常关心你的数据， 但仍然可以承受数分钟以内的数据丢失， 那么你可以只使用 RDB 持久化。</p>\n<p>其余情况我个人喜好选择AOF</p>\n<p>&nbsp;</p>\n<p>三</p>\n<p>1. Snapshotting:<br>缺省情况下，Redis会将数据集的快照dump到dump.rdb文件中。此外，我们也可以通过配置文件来修改Redis服务器dump快照的频率，在打开6379.conf文件之后，我们搜索save，可以看到下面的配置信息：<br>save 900 1 #在900秒(15分钟)之后，如果至少有1个key发生变化，则dump内存快照。<br>save 300 10 #在300秒(5分钟)之后，如果至少有10个key发生变化，则dump内存快照。<br>save 60 10000 #在60秒(1分钟)之后，如果至少有10000个key发生变化，则dump内存快照。<br><br>2. Dump快照的机制：<br>1). Redis先fork子进程。<br>2). 子进程将快照数据写入到临时RDB文件中。<br>3). 当子进程完成数据写入操作后，再用临时文件替换老的文件。<br><br>5.4.3. AOF文件：<br>上面已经多次讲过，RDB的快照定时dump机制无法保证很好的数据持久性。如果我们的应用确实非常关注此点，我们可以考虑使用Redis中的AOF机制。对于Redis服务器而言，其缺省的机制是RDB，如果需要使用AOF，则需要修改配置文件中的以下条目：<br>将appendonly no改为appendonly yes<br>从现在起，Redis在每一次接收到数据修改的命令之后，都会将其追加到AOF文件中。在Redis下一次重新启动时，需要加载AOF文件中的信息来构建最新的数据到内存中。<br><br>5.4.5. AOF的配置：<br>在Redis的配置文件中存在三种同步方式，它们分别是：<br>appendfsync always #每次有数据修改发生时都会写入AOF文件。<br>appendfsync everysec #每秒钟同步一次，该策略为AOF的缺省策略。<br>appendfsync no #从不同步。高效但是数据不会被持久化。<br><br>5.4.6. 如何修复坏损的AOF文件：<br>1). 将现有已经坏损的AOF文件额外拷贝出来一份。<br>2). 执行\"redis-check-aof --fix &lt;filename&gt;\"命令来修复坏损的AOF文件。<br>3). 用修复后的AOF文件重新启动Redis服务器。<br><br>5.4.7. Redis的数据备份：<br>在Redis中我们可以通过copy的方式在线备份正在运行的Redis数据文件。这是因为RDB文件一旦被生成之后就不会再被修改。Redis每次都是将最新的数据dump到一个临时文件中，之后在利用rename函数原子性的将临时文件改名为原有的数据文件名。因此我们可以说，在任意时刻copy数据文件都是安全的和一致的。鉴于此，我们就可以通过创建cron job的方式定时备份Redis的数据文件，并将备份文件copy到安全的磁盘介质中。</p>\n<p>5.5、立即写入</p>\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><img src=\"https://common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></span></div>\n<pre>//立即保存，同步保存\n    public static void syncSave() throws Exception{\n        Jedis jedis=new Jedis(\"127.0.0.1\",6379);\n        for (int i = 0; i &lt;1000; i++) {\n            jedis.set(\"key\"+i, \"Hello\"+i);\n            System.out.println(\"设置key\"+i+\"的数据到redis\");\n            Thread.sleep(2);\n        }\n        //执行保存，会在服务器下生成一个dump.rdb数据库文件\n        jedis.save();\n        jedis.close();\n        System.out.println(\"写入完成\");\n    }</pre>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><img src=\"https://common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></span></div>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\n<p>运行结果：</p>\n<p><img src=\"https://images2015.cnblogs.com/blog/63651/201607/63651-20160722100912185-4109245.png\" alt=\"\"></p>\n<p>这里的save方法是同步的，没有写入完成前不执行后面的代码。</p>\n<p>5.6、异步写入</p>\n<div class=\"cnblogs_code\"><div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><img src=\"https://common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></span></div>\n<pre>    //异步保存\n    public static void asyncSave() throws Exception{\n        Jedis jedis=new Jedis(\"127.0.0.1\",6379);\n        for (int i = 0; i &lt;1000; i++) {\n            jedis.set(\"key\"+i, \"Hello\"+i);\n            System.out.println(\"设置key\"+i+\"的数据到redis\");\n            Thread.sleep(2);\n        }\n        //执行异步保存，会在服务器下生成一个dump.rdb数据库文件\n        jedis.bgsave();\n        jedis.close();\n        System.out.println(\"写入完成\");\n    }</pre>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><img src=\"https://common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></span></div>\n<div class=\"cnblogs_code_toolbar\"><span class=\"cnblogs_code_copy\"><a href=\"javascript:void(0);\" onclick=\"copyCnblogsCode(this)\" title=\"复制代码\"><img src=\"//common.cnblogs.com/images/copycode.gif\" alt=\"复制代码\"></a></span></div></div>\n<p>如果数据量非常大，要保存的内容很多，建议使用bgsave，如果内容少则可以使用save方法。关于各方式的比较源自网友的博客。</p>\n<div><a name=\"_lab2_4_0\"></a></div>\n<div>&nbsp;\n<p><strong>1、Redis的第一个持久化策略：RDB快照</strong>&nbsp;<br><br><strong>Redis支持将当前数据的快照存成一个数据文件的持久化机制</strong>。而一个持续写入的数据库如何生成快照呢。Redis借助了fork命令的copy on write机制。在生成快照时，将当前进程fork出一个子进程，然后在子进程中循环所有的数据，将数据写成为RDB文件。&nbsp;<br><br>我们可以通过Redis的save指令来配置RDB快照生成的时机，比如你可以配置当10分钟以内有100次写入就生成快照，也可以配置当1小时内有1000次写入就生成快照，也可以多个规则一起实施。这些规则的定义就在Redis的配置文件中，你也可以通过Redis的CONFIG SET命令在Redis运行时设置规则，不需要重启Redis。&nbsp;<br><br>Redis的RDB文件不会坏掉，因为其写操作是在一个新进程中进行的，当生成一个新的RDB文件时，Redis生成的子进程会先将数据写到一个临时文件中，然后通过原子性rename系统调用将临时文件重命名为RDB文件，这样在任何时候出现故障，Redis的RDB文件都总是可用的。&nbsp;<br><br>同时，Redis的RDB文件也是Redis主从同步内部实现中的一环。&nbsp;<br><br>但是，我们可以很明显的看到，<strong>RDB有它的不足，就是一旦数据库出现问题，那么我们的RDB文件中保存的数据并不是全新的</strong>，从上次RDB文件生成到 Redis停机这段时间的数据全部丢掉了。在某些业务下，这是可以忍受的，我们也推荐这些业务使用RDB的方式进行持久化，因为开启RDB的代价并不高。 但是对于另外一些对数据安全性要求极高的应用，无法容忍数据丢失的应用，RDB就无能为力了，所以Redis引入了另一个重要的持久化机制：AOF日志。&nbsp;<br><br><strong>2、Redis的第二个持久化策略：AOF日志</strong>&nbsp;<br><br>AOF日志的全称是Append Only File，从名字上我们就能看出来，它是一个追加写入的日志文件。与一般数据库不同的是，<strong>AOF文件是可识别的纯文本，它的内容就是一个个的Redis标准命令</strong>。比如我们进行如下实验，使用Redis2.6 版本，在启动命令参数中设置开启AOF功能：</p>\n<div class=\"cnblogs_Highlighter\">\n<div>\n<div id=\"highlighter_258396\" class=\"syntaxhighlighter nogutter  csharp\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td class=\"code\">\n<div class=\"container\">\n<div class=\"line number1 index0 alt2\"><code class=\"csharp plain\">./redis-server --appendonly yes</code></div>\n\n\n\n</div>\n\n\n\n</td>\n\n\n\n</tr>\n\n\n\n</tbody>\n\n\n\n</table>\n\n\n\n</div>\n\n\n\n</div>\n\n\n\n</div>\n<p>　　然后我们执行如下的命令：</p>\n<div class=\"cnblogs_Highlighter\">\n<div>\n<div id=\"highlighter_320512\" class=\"syntaxhighlighter nogutter  csharp\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td class=\"code\">\n<div class=\"container\">\n<div class=\"line number1 index0 alt2\"><code class=\"csharp plain\">redis 127.0.0.1:6379&gt; </code><code class=\"csharp keyword\">set</code>&nbsp;<code class=\"csharp plain\">key1 Hello</code></div>\n<div class=\"line number2 index1 alt1\"><code class=\"csharp plain\">OK</code></div>\n<div class=\"line number3 index2 alt2\"><code class=\"csharp plain\">redis 127.0.0.1:6379&gt; append key1 </code><code class=\"csharp string\">\" World!\"</code></div>\n<div class=\"line number4 index3 alt1\"><code class=\"csharp plain\">(integer) 12</code></div>\n<div class=\"line number5 index4 alt2\"><code class=\"csharp plain\">redis 127.0.0.1:6379&gt; del key1</code></div>\n<div class=\"line number6 index5 alt1\"><code class=\"csharp plain\">(integer) 1</code></div>\n<div class=\"line number7 index6 alt2\"><code class=\"csharp plain\">redis 127.0.0.1:6379&gt; del non_existing_key</code></div>\n<div class=\"line number8 index7 alt1\"><code class=\"csharp plain\">(integer) 0</code></div>\n\n\n\n</div>\n\n\n\n</td>\n\n\n\n</tr>\n\n\n\n</tbody>\n\n\n\n</table>\n\n\n\n</div>\n\n\n\n</div>\n\n\n\n</div>\n<p>　　这时我们查看AOF日志文件，就会得到如下内容：</p>\n<div class=\"cnblogs_Highlighter\">\n<div>\n<div id=\"highlighter_52020\" class=\"syntaxhighlighter nogutter  csharp\">\n<table border=\"0\" cellspacing=\"0\" cellpadding=\"0\">\n<tbody>\n<tr>\n<td class=\"code\">\n<div class=\"container\">\n<div class=\"line number1 index0 alt2\"><code class=\"csharp plain\">$ cat appendonly.aof</code></div>\n<div class=\"line number2 index1 alt1\"><code class=\"csharp plain\">*2</code></div>\n<div class=\"line number3 index2 alt2\"><code class=\"csharp plain\">$6</code></div>\n<div class=\"line number4 index3 alt1\"><code class=\"csharp plain\">SELECT</code></div>\n<div class=\"line number5 index4 alt2\"><code class=\"csharp plain\">$1</code></div>\n<div class=\"line number6 index5 alt1\"><code class=\"csharp plain\">0</code></div>\n<div class=\"line number7 index6 alt2\"><code class=\"csharp plain\">*3</code></div>\n<div class=\"line number8 index7 alt1\"><code class=\"csharp plain\">$3</code></div>\n<div class=\"line number9 index8 alt2\"><code class=\"csharp keyword\">set</code></div>\n<div class=\"line number10 index9 alt1\"><code class=\"csharp plain\">$4</code></div>\n<div class=\"line number11 index10 alt2\"><code class=\"csharp plain\">key1</code></div>\n<div class=\"line number12 index11 alt1\"><code class=\"csharp plain\">$5</code></div>\n<div class=\"line number13 index12 alt2\"><code class=\"csharp plain\">Hello</code></div>\n<div class=\"line number14 index13 alt1\"><code class=\"csharp plain\">*3</code></div>\n<div class=\"line number15 index14 alt2\"><code class=\"csharp plain\">$6</code></div>\n<div class=\"line number16 index15 alt1\"><code class=\"csharp plain\">append</code></div>\n<div class=\"line number17 index16 alt2\"><code class=\"csharp plain\">$4</code></div>\n<div class=\"line number18 index17 alt1\"><code class=\"csharp plain\">key1</code></div>\n<div class=\"line number19 index18 alt2\"><code class=\"csharp plain\">$7</code></div>\n<div class=\"line number20 index19 alt1\"><code class=\"csharp spaces\">&nbsp;</code><code class=\"csharp plain\">World!</code></div>\n<div class=\"line number21 index20 alt2\"><code class=\"csharp plain\">*2</code></div>\n<div class=\"line number22 index21 alt1\"><code class=\"csharp plain\">$3</code></div>\n<div class=\"line number23 index22 alt2\"><code class=\"csharp plain\">del</code></div>\n<div class=\"line number24 index23 alt1\"><code class=\"csharp plain\">$4</code></div>\n<div class=\"line number25 index24 alt2\"><code class=\"csharp plain\">key1</code></div>\n\n\n\n</div>\n\n\n\n</td>\n\n\n\n</tr>\n\n\n\n</tbody>\n\n\n\n</table>\n\n\n\n</div>\n\n\n\n</div>\n\n\n\n</div>\n<p>　　可以看到，写操作都生成了一条相应的命令作为日志。<strong>其中值得注意的是最后一个del命令，它并没有被记录在AOF日志中，这是因为Redis判断出 这个命令不会对当前数据集做出修改</strong>。所以不需要记录这个无用的写命令。另外AOF日志也不是完全按客户端的请求来生成日志的，比如命令 INCRBYFLOAT 在记AOF日志时就被记成一条SET记录，因为浮点数操作可能在不同的系统上会不同，所以为了避免同一份日志在不同的系统上生成不同的数据集，所以这里只将操作后的结果通过SET来记录。&nbsp;<br><br><strong>AOF重写</strong>&nbsp;<br><br>你可以会想，每一条写命令都生成一条日志，那么AOF文件是不是会很大？答案是肯定的，AOF文件会越来越大，<strong>所以Redis又提供了一个功能，叫做AOF rewrite</strong>。其功能就是重新生成一份AOF文件，新的AOF文件中一条记录的操作只会有一次，而不像一份老文件那样，可能记录了对同一个值的多次操作。其生成过程和RDB类似，也是fork一个进程，直接遍历数据，写入新的AOF临时文件。在写入新文件的过程中，所有的写操作日志还是会写到原来老的 AOF文件中，同时还会记录在内存缓冲区中。当重完操作完成后，会将所有缓冲区中的日志一次性写入到临时文件中。然后调用原子性的rename命令用新的 AOF文件取代老的AOF文件。&nbsp;<br><br><strong>二、Redis持久化性能是否可靠？</strong>&nbsp;<br><br>从上面的流程我们能够看到，RDB是顺序IO操作，性能很高。而同时在通过RDB文件进行数据库恢复的时候，也是顺序的读取数据加载到内存中。所以也不会造成磁盘的随机读取错误。&nbsp;<br><br>而AOF是一个写文件操作，其目的是将操作日志写到磁盘上，所以它也同样会遇到我们上面说的写操作的5个流程。那么写AOF的操作安全性又有多高呢？实际上这是可以设置的，<strong>在Redis中对AOF调用write写入后，何时再调用fsync将其写到磁盘上，通过appendfsync选项来控制，下面appendfsync的三个设置项，安全强度逐渐变强。</strong>&nbsp;<br><br><strong>1、appendfsync no</strong>&nbsp;<br><br>当设置appendfsync为no的时候，Redis不会主动调用fsync去将AOF日志内容同步到磁盘，所以这一切就完全依赖于操作系统的调试了。<strong>对大多数Linux操作系统，是每30秒进行一次fsync，将缓冲区中的数据写到磁盘上</strong>。&nbsp;<br><br><strong>2、appendfsync everysec</strong>&nbsp;<br><br>当设置appendfsync为everysec的时候，Redis会默认每隔一秒进行一次fsync调用，将缓冲区中的数据写到磁盘。但是当这一 次的fsync调用时长超过1秒时。Redis会采取延迟fsync的策略，再等一秒钟。也就是在两秒后再进行fsync，这一次的fsync就不管会执行多长时间都会进行。这时候由于在fsync时文件描述符会被阻塞，所以当前的写操作就会阻塞。&nbsp;<br><br>所以，<strong>结论就是：在绝大多数情况下，Redis会每隔一秒进行一次fsync。在最坏的情况下，两秒钟会进行一次fsync操作</strong>。&nbsp;<br><br>这一操作在大多数数据库系统中被称为group commit，就是组合多次写操作的数据，一次性将日志写到磁盘。&nbsp;<br><br><strong>3、appednfsync always</strong>&nbsp;<br><br>当设置appendfsync为always时，每一次写操作都会调用一次fsync，这时数据是最安全的，当然，由于每次都会执行fsync，所以其性能也会受到影响。&nbsp;<br><br><strong>对于pipelining有什么不同？</strong>&nbsp;<br><br>对于pipelining的操作，其具体过程是客户端一次性发送N个命令，然后等待这N个命令的返回结果被一起返回。通过采用pipilining 就意味着放弃了对每一个命令的返回值确认。由于在这种情况下，N个命令是在同一个执行过程中执行的。所以当设置appendfsync为everysec 时，可能会有一些偏差，因为这N个命令可能执行时间超过1秒甚至2秒。但是可以保证的是，最长时间不会超过这N个命令的执行时间和。&nbsp;<br><br><strong>三、和其它数据库的比较</strong>&nbsp;<br><br>上面操作系统层面的数据安全我们已经讲了很多，其实，不同的数据库在实现上都大同小异。总之，最后的结论就是，<strong>在Redis开启AOF的情况下，其单机数据安全性并不比这些成熟的SQL数据库弱</strong>。&nbsp;<br><br><strong>在数据导入方面的比较</strong>&nbsp;<br><br>这些持久化的数据有什么用，当然是用于重启后的数据恢复。Redis是一个内存数据库，无论是RDB还是AOF，都只是其保证数据恢复的措施。所以 Redis在利用RDB和AOF进行恢复的时候，都会读取RDB或AOF文件，重新加载到内存中。相对于MySQL等数据库的启动时间来说，会长很多，因为MySQL本来是不需要将数据加载到内存中的。&nbsp;<br><br>但是相对来说，MySQL启动后提供服务时，其被访问的热数据也会慢慢加载到内存中，通常我们称之为预热，而在预热完成前，其性能都不会太高。<strong>而Redis的好处是一次性将数据加载到内存中，一次性预热</strong>。这样只要Redis启动完成，那么其提供服务的速度都是非常快的。&nbsp;<br><br>而在利用RDB和利用AOF启动上，其启动时间有一些差别。RDB的启动时间会更短，原因有两个，一是RDB文件中每一条数据只有一条记录，不会像 AOF日志那样可能有一条数据的多次操作记录。所以每条数据只需要写一次就行了。另一个原因是RDB文件的存储格式和Redis数据在内存中的编码格式是一致的，不需要再进行数据编码工作。在CPU消耗上要远小于AOF日志的加载。</p>\n<p>&nbsp;</p>\n\n\n</div>\n<div>&nbsp;</div>\n</div>"
  },
  {
    "category": "dataBase",
    "qes": "缓存雪崩与缓存穿透",
    "ans": "<div id=\"cnblogs_post_body\" class=\"blogpost-body\">\n    <h2>缓存穿透</h2>\n<h3>什么是缓存穿透？</h3>\n<div>一般的缓存系统，都是按照key去缓存查询，如果不存在对应的value，就应该去后端系统查找（比如DB）。如果key对应的value是一定不存在的，并且对该key并发请求量很大，就会对后端系统造成很大的压力。这就叫做缓存穿透。</div>\n<div>&nbsp;</div>\n<h3>如何避免？</h3>\n<div>1：对查询结果为空的情况也进行缓存，缓存时间设置短一点，或者该key对应的数据insert了之后清理缓存。</div>\n<div>2：对一定不存在的key进行过滤。可以把所有的可能存在的key放到一个大的Bitmap中，查询时通过该bitmap过滤。【感觉应该用的不多吧】</div>\n<h2>缓存雪崩</h2>\n<h3>什么是缓存雪崩？</h3>\n<div>当缓存服务器重启或者大量缓存集中在某一个时间段失效，这样在失效的时候，也会给后端系统(比如DB)带来很大压力。</div>\n<h3>如何避免？</h3>\n<div>1：在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</div>\n<div>2：不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</div>\n<div>3：做二级缓存，A1为原始缓存，A2为拷贝缓存，A1失效时，可以访问A2，A1缓存失效时间设置为短期，A2设置为长期（此点为补充）</div>\n<div>&nbsp;</div>\n<h2>分布式缓存系统</h2>\n<h3>分布式缓存系统面临的问题</h3>\n<h4>缓存一致性问题</h4>\n<p>1：缓存系统与底层数据的一致性。这点在底层系统是“可读可写”时，写得尤为重要&nbsp;</p>\n<p>2：有继承关系的缓存之间的一致性。为了尽量提高缓存命中率，缓存也是分层：全局缓存，二级缓存。他们是存在继承关系的。全局缓存可以有二级缓存来组成。&nbsp;</p>\n<p>3：多个缓存副本之间的一致性。为了保证系统的高可用性，缓存系统背后往往会接两套存储系统（如memcache，redis等）</p>\n<h4>缓存穿透和缓存雪崩</h4>\n<div>上面有讲述。</div>\n<div>&nbsp;</div>\n<h3>缓存数据的淘汰</h3>\n<div>缓存淘汰的策略有两种： (1) 定时去清理过期的缓存。 （2）当有用户请求过来时，再判断这个请求所用到的缓存是否过期，过期的话就去底层系统得到新数据并更新缓存。&nbsp;</div>\n<div>两者各有优劣，第一种的缺点是维护大量缓存的key是比较麻烦的，第二种的缺点就是每次用户请求过来都要判断缓存失效，逻辑相对比较复杂，具体用哪种方案，大家可以根据自己的应用场景来权衡。</div>\n<div>&nbsp;</div>\n<div>1. 预估失效时间 2. 版本号（必须单调递增，时间戳是最好的选择）3. 提供手动清理缓存的接口。</div>\n</div>"
  },
  {
    "category": "dataBase",
    "qes": "布隆过滤器",
    "ans": "<div class=\"content-wrapper\" style=\"padding-bottom: 20px;\" data-spm-anchor-id=\"a2c6h.12873639.0.i3.7fab74b8xkVB4C\">\n            <h1 class=\"article-title\" data-spm-anchor-id=\"a2c6h.12873639.0.i17.7fab74b8xkVB4C\">布隆过滤器，这一篇给你讲的明明白白</h1>\n            <p class=\"article-info\">\n                <a class=\"article-info-author question-avatar-wrapper wechat-disable\" href=\"/profile/yjrb526a7vci6\">JavaKeeper</a>\n\n                <img src=\"https://img.alicdn.com/tfs/TB10fDzdND1gK0jSZFsXXbldVXa-36-32.png\" class=\"article-info-medal\" alt=\"\" data-url=\"https://ucc.alicdn.com/pic/ucc-admin/eee40c5017904f91b1ac40db688c0111.png\" data-time=\"2020-01-21 17:52:00\" data-btn-text=\"获取我的勋章 >\" data-btn-url=\"//developer.aliyun.com/certification\">\n\n                <span class=\"article-info-time\">2020-09-24</span>\n                <span class=\"article-info-read\">628浏览量</span>\n                \n            </p>\n            \n            \n            <div class=\"article-desc\">\n                <b>简介：</b>\n                <span>浅谈布隆过滤器</span>\n            </div>\n\n            <div class=\"article-inner markdown-body\" data-spm-anchor-id=\"a2c6h.12873639.0.i4.7fab74b8xkVB4C\">\n<h2 data-spm-anchor-id=\"a2c6h.12873639.0.i1.7fab74b8xkVB4C\">什么是 BloomFilter</h2>\n<p data-spm-anchor-id=\"a2c6h.12873639.0.i2.7fab74b8xkVB4C\"><strong>布隆过滤器</strong>（英语：Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。主要用于判断一个元素是否在一个集合中。</p>\n<p>通常我们会遇到很多要判断一个元素是否在某个集合中的业务场景，一般想到的是将集合中所有元素保存起来，然后通过比较确定。链表、树、散列表（又叫哈希表，Hash table）等等数据结构都是这种思路。但是随着集合中元素的增加，我们需要的存储空间也会呈现线性增长，最终达到瓶颈。同时检索速度也越来越慢，上述三种结构的检索时间复杂度分别为$O(n)$，$O(logn)$，$O(1)$。</p>\n<p>这个时候，布隆过滤器（Bloom Filter）就应运而生。</p>\n<h2>布隆过滤器原理</h2>\n<p>了解布隆过滤器原理之前，先回顾下 Hash 函数原理。</p>\n<h3 data-spm-anchor-id=\"a2c6h.12873639.0.i8.7fab74b8xkVB4C\">哈希函数</h3>\n<p data-spm-anchor-id=\"a2c6h.12873639.0.i5.7fab74b8xkVB4C\">哈希函数的概念是：将任意大小的输入数据转换成特定大小的输出数据的函数，转换后的数据称为哈希值或哈希编码，也叫散列值。下面是一幅示意图：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1ge9vykn7uej31at0u01kx.jpg\" alt=\"\" title=\"\" data-spm-anchor-id=\"a2c6h.12873639.0.i7.7fab74b8xkVB4C\"></p>\n<p>所有散列函数都有如下基本特性：</p>\n<ul data-spm-anchor-id=\"a2c6h.12873639.0.i14.7fab74b8xkVB4C\">\n<li>如果两个散列值是不相同的（根据同一函数），那么这两个散列值的原始输入也是不相同的。这个特性是散列函数具有确定性的结果，具有这种性质的散列函数称为<strong>单向散列函数</strong>。</li>\n<li data-spm-anchor-id=\"a2c6h.12873639.0.i12.7fab74b8xkVB4C\">散列函数的输入和输出不是唯一对应关系的，如果两个散列值相同，两个输入值很可能是相同的，但也可能不同，这种情况称为“<strong data-spm-anchor-id=\"a2c6h.12873639.0.i13.7fab74b8xkVB4C\">散列碰撞</strong>（collision）”。</li>\n</ul>\n<p data-spm-anchor-id=\"a2c6h.12873639.0.i11.7fab74b8xkVB4C\">但是用 hash表存储大数据量时，空间效率还是很低，当只有一个 hash 函数时，还很容易发生哈希碰撞。</p>\n<h3 data-spm-anchor-id=\"a2c6h.12873639.0.i15.7fab74b8xkVB4C\">布隆过滤器数据结构</h3>\n<p data-spm-anchor-id=\"a2c6h.12873639.0.i9.7fab74b8xkVB4C\">BloomFilter 是由一个固定大小的二进制向量或者位图（bitmap）和一系列映射函数组成的。</p>\n<p>在初始状态时，对于长度为 m 的位数组，它的所有位都被置为0，如下图所示：</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gebubj40y3j312e0i277i.jpg\" alt=\"\" title=\"\" data-spm-anchor-id=\"a2c6h.12873639.0.i10.7fab74b8xkVB4C\"></p>\n<p>当有变量被加入集合时，通过 K 个映射函数将这个变量映射成位图中的 K 个点，把它们置为 1（假定有两个变量都通过 3 个映射函数）。</p>\n<p><img src=\"https://tva1.sinaimg.cn/large/007S8ZIlly1gebuc2ee3dj31o10u0drg.jpg\" alt=\"\" title=\"\"></p>\n<p>查询某个变量的时候我们只要看看这些点是不是都是 1 就可以大概率知道集合中有没有它了</p>\n<ul>\n<li>如果这些点有任何一个 0，则被查询变量一定不在；</li>\n<li>如果都是 1，则被查询变量很<strong>可能存在</strong>\n</li>\n</ul>\n<p>为什么说是可能存在，而不是一定存在呢？那是因为映射函数本身就是散列函数，散列函数是会有碰撞的。</p>\n<h3>误判率</h3>\n<p>布隆过滤器的误判是指多个输入经过哈希之后在相同的bit位置1了，这样就无法判断究竟是哪个输入产生的，因此误判的根源在于相同的 bit 位被多次映射且置 1。</p>\n<p>这种情况也造成了布隆过滤器的删除问题，因为布隆过滤器的每一个 bit 并不是独占的，很有可能多个元素共享了某一位。如果我们直接删除这一位的话，会影响其他的元素。(比如上图中的第 3 位)</p>\n<h3>特性</h3>\n<ul>\n<li>\n<strong>一个元素如果判断结果为存在的时候元素不一定存在，但是判断结果为不存在的时候则一定不存在</strong>。</li>\n<li>\n<strong>布隆过滤器可以添加元素，但是不能删除元素</strong>。因为删掉元素会导致误判率增加。</li>\n</ul>\n<h3>添加与查询元素步骤</h3>\n<h4>添加元素</h4>\n<ol>\n<li>将要添加的元素给 k 个哈希函数</li>\n<li>得到对应于位数组上的 k 个位置</li>\n<li>将这k个位置设为 1</li>\n</ol>\n<h4>查询元素</h4>\n<ol>\n<li>将要查询的元素给k个哈希函数</li>\n<li>得到对应于位数组上的k个位置</li>\n<li>如果k个位置有一个为 0，则肯定不在集合中</li>\n<li>如果k个位置全部为 1，则可能在集合中</li>\n</ol>\n<h3>优点</h3>\n<p>相比于其它的数据结构，布隆过滤器在空间和时间方面都有巨大的优势。布隆过滤器存储空间和插入/查询时间都是常数 $O(K)$，另外，散列函数相互之间没有关系，方便由硬件并行实现。布隆过滤器不需要存储元素本身，在某些对保密要求非常严格的场合有优势。</p>\n<p>布隆过滤器可以表示全集，其它任何数据结构都不能；</p>\n<h3>缺点</h3>\n<p>但是布隆过滤器的缺点和优点一样明显。误算率是其中之一。随着存入的元素数量增加，误算率随之增加。但是如果元素数量太少，则使用散列表足矣。</p>\n<p>另外，一般情况下不能从布隆过滤器中删除元素。我们很容易想到把位数组变成整数数组，每插入一个元素相应的计数器加 1, 这样删除元素时将计数器减掉就可以了。然而要保证安全地删除元素并非如此简单。首先我们必须保证删除的元素的确在布隆过滤器里面。这一点单凭这个过滤器是无法保证的。另外计数器回绕也会造成问题。</p>\n<p>在降低误算率方面，有不少工作，使得出现了很多布隆过滤器的变种。</p>\n<h2>布隆过滤器使用场景和实例</h2>\n<p>在程序的世界中，布隆过滤器是程序员的一把利器，利用它可以快速地解决项目中一些比较棘手的问题。</p>\n<p>如网页 URL 去重、垃圾邮件识别、大集合中重复元素的判断和缓存穿透等问题。</p>\n<p>布隆过滤器的典型应用有：</p>\n<ul>\n<li>数据库防止穿库。 Google Bigtable，HBase 和 Cassandra 以及 Postgresql 使用BloomFilter来减少不存在的行或列的磁盘查找。避免代价高昂的磁盘查找会大大提高数据库查询操作的性能。</li>\n<li>业务场景中判断用户是否阅读过某视频或文章，比如抖音或头条，当然会导致一定的误判，但不会让用户看到重复的内容。</li>\n<li>缓存宕机、缓存击穿场景，一般判断用户是否在缓存中，如果在则直接返回结果，不在则查询db，如果来一波冷数据，会导致缓存大量击穿，造成雪崩效应，这时候可以用布隆过滤器当缓存的索引，只有在布隆过滤器中，才去查询缓存，如果没查询到，则穿透到db。如果不在布隆器中，则直接返回。</li>\n<li>WEB拦截器，如果相同请求则拦截，防止重复被攻击。用户第一次请求，将请求参数放入布隆过滤器中，当第二次请求时，先判断请求参数是否被布隆过滤器命中。可以提高缓存命中率。Squid 网页代理缓存服务器在 cache digests 中就使用了布隆过滤器。Google Chrome浏览器使用了布隆过滤器加速安全浏览服务</li>\n<li>Venti 文档存储系统也采用布隆过滤器来检测先前存储的数据。</li>\n<li>SPIN 模型检测器也使用布隆过滤器在大规模验证问题时跟踪可达状态空间。</li>\n</ul>\n<h2>Coding~</h2>\n<p>知道了布隆过滤去的原理和使用场景，我们可以自己实现一个简单的布隆过滤器</p>\n<h3>自定义的 BloomFilter</h3>\n<pre><code class=\"java hljs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MyBloomFilter</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 一个长度为10 亿的比特位\n     */</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">int</span> DEFAULT_SIZE = <span class=\"hljs-number\">256</span> &lt;&lt; <span class=\"hljs-number\">22</span>;\n\n    <span class=\"hljs-comment\">/**\n     * 为了降低错误率，使用加法hash算法，所以定义一个8个元素的质数数组\n     */</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">int</span>[] seeds = {<span class=\"hljs-number\">3</span>, <span class=\"hljs-number\">5</span>, <span class=\"hljs-number\">7</span>, <span class=\"hljs-number\">11</span>, <span class=\"hljs-number\">13</span>, <span class=\"hljs-number\">31</span>, <span class=\"hljs-number\">37</span>, <span class=\"hljs-number\">61</span>};\n\n    <span class=\"hljs-comment\">/**\n     * 相当于构建 8 个不同的hash算法\n     */</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> HashFunction[] functions = <span class=\"hljs-keyword\">new</span> HashFunction[seeds.length];\n\n    <span class=\"hljs-comment\">/**\n     * 初始化布隆过滤器的 bitmap\n     */</span>\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> BitSet bitset = <span class=\"hljs-keyword\">new</span> BitSet(DEFAULT_SIZE);\n\n    <span class=\"hljs-comment\">/**\n     * 添加数据\n     *\n     * <span class=\"hljs-doctag\">@param</span> value 需要加入的值\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">add</span><span class=\"hljs-params\">(String value)</span> </span>{\n        <span class=\"hljs-keyword\">if</span> (value != <span class=\"hljs-keyword\">null</span>) {\n            <span class=\"hljs-keyword\">for</span> (HashFunction f : functions) {\n                <span class=\"hljs-comment\">//计算 hash 值并修改 bitmap 中相应位置为 true</span>\n                bitset.set(f.hash(value), <span class=\"hljs-keyword\">true</span>);\n            }\n        }\n    }\n\n    <span class=\"hljs-comment\">/**\n     * 判断相应元素是否存在\n     * <span class=\"hljs-doctag\">@param</span> value 需要判断的元素\n     * <span class=\"hljs-doctag\">@return</span> 结果\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">contains</span><span class=\"hljs-params\">(String value)</span> </span>{\n        <span class=\"hljs-keyword\">if</span> (value == <span class=\"hljs-keyword\">null</span>) {\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;\n        }\n        <span class=\"hljs-keyword\">boolean</span> ret = <span class=\"hljs-keyword\">true</span>;\n        <span class=\"hljs-keyword\">for</span> (HashFunction f : functions) {\n            ret = bitset.get(f.hash(value));\n            <span class=\"hljs-comment\">//一个 hash 函数返回 false 则跳出循环</span>\n            <span class=\"hljs-keyword\">if</span> (!ret) {\n                <span class=\"hljs-keyword\">break</span>;\n            }\n        }\n        <span class=\"hljs-keyword\">return</span> ret;\n    }\n\n    <span class=\"hljs-comment\">/**\n     * 模拟用户是不是会员，或用户在不在线。。。\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>{\n\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; seeds.length; i++) {\n            functions[i] = <span class=\"hljs-keyword\">new</span> HashFunction(DEFAULT_SIZE, seeds[i]);\n        }\n\n        <span class=\"hljs-comment\">// 添加1亿数据</span>\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100000000</span>; i++) {\n            add(String.valueOf(i));\n        }\n        String id = <span class=\"hljs-string\">\"123456789\"</span>;\n        add(id);\n\n        System.out.println(contains(id));   <span class=\"hljs-comment\">// true</span>\n        System.out.println(<span class=\"hljs-string\">\"\"</span> + contains(<span class=\"hljs-string\">\"234567890\"</span>));  <span class=\"hljs-comment\">//false</span>\n    }\n}\n\n<span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HashFunction</span> </span>{\n\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> size;\n    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> seed;\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">HashFunction</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> size, <span class=\"hljs-keyword\">int</span> seed)</span> </span>{\n        <span class=\"hljs-keyword\">this</span>.size = size;\n        <span class=\"hljs-keyword\">this</span>.seed = seed;\n    }\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">hash</span><span class=\"hljs-params\">(String value)</span> </span>{\n        <span class=\"hljs-keyword\">int</span> result = <span class=\"hljs-number\">0</span>;\n        <span class=\"hljs-keyword\">int</span> len = value.length();\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; len; i++) {\n            result = seed * result + value.charAt(i);\n        }\n        <span class=\"hljs-keyword\">int</span> r = (size - <span class=\"hljs-number\">1</span>) &amp; result;\n        <span class=\"hljs-keyword\">return</span> (size - <span class=\"hljs-number\">1</span>) &amp; result;\n    }\n}</code></pre>\n<blockquote>\n<p>What？我们写的这些早有大牛帮我们实现，还造轮子，真是浪费时间，No，No，No，我们学习过程中是可以造轮子的，造轮子本身就是我们自己对设计和实现的具体落地过程，不仅能提高我们的编程能力，在造轮子的过程中肯定会遇到很多我们没有思考过的问题，成长看的见~~</p>\n<p>实际项目使用的时候，领导和我说项目一定要稳定运行，没自信的我放弃了自己的轮子。</p>\n</blockquote>\n<h3>Guava 中的 BloomFilter</h3>\n<pre><code class=\"xml hljs\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>23.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span></code></pre>\n<pre><code class=\"java hljs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">GuavaBloomFilterDemo</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>{\n        <span class=\"hljs-comment\">//后边两个参数：预计包含的数据量，和允许的误差值</span>\n        BloomFilter&lt;Integer&gt; bloomFilter = BloomFilter.create(Funnels.integerFunnel(), <span class=\"hljs-number\">100000</span>, <span class=\"hljs-number\">0.01</span>);\n        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; <span class=\"hljs-number\">100000</span>; i++) {\n            bloomFilter.put(i);\n        }\n        System.out.println(bloomFilter.mightContain(<span class=\"hljs-number\">1</span>));\n        System.out.println(bloomFilter.mightContain(<span class=\"hljs-number\">2</span>));\n        System.out.println(bloomFilter.mightContain(<span class=\"hljs-number\">3</span>));\n        System.out.println(bloomFilter.mightContain(<span class=\"hljs-number\">100001</span>));\n\n        <span class=\"hljs-comment\">//bloomFilter.writeTo();</span>\n    }\n}</code></pre>\n<p>分布式环境中，布隆过滤器肯定还需要考虑是可以共享的资源，这时候我们会想到 Redis，是的，Redis 也实现了布隆过滤器。</p>\n<p><strong>当然我们也可以把布隆过滤器通过 <code>bloomFilter.writeTo()</code> 写入一个文件，放入OSS、S3这类对象存储中。</strong></p>\n<h3>Redis 中的 BloomFilter</h3>\n<p>Redis 提供的 bitMap 可以实现布隆过滤器，但是需要自己设计映射函数和一些细节，这和我们自定义没啥区别。</p>\n<p>Redis 官方提供的布隆过滤器到了 Redis 4.0 提供了插件功能之后才正式登场。布隆过滤器作为一个插件加载到 Redis Server 中，给 Redis 提供了强大的布隆去重功能。</p>\n<p>在已安装 Redis 的前提下，安装 RedisBloom，有两种方式</p>\n<p><strong>直接编译进行安装</strong></p>\n<pre><code class=\"shell hljs\">git clone https://github.com/RedisBloom/RedisBloom.git\ncd RedisBloom\nmake     #编译 会生成一个rebloom.so文件\nredis-server --loadmodule /path/to/rebloom.so   #运行redis时加载布隆过滤器模块\nredis-cli    # 启动连接容器中的 redis 客户端验证</code></pre>\n<p><strong data-spm-anchor-id=\"a2c6h.12873639.0.i16.7fab74b8xkVB4C\">使用Docker进行安装</strong></p>\n<pre><code class=\"shell hljs\">docker pull redislabs/rebloom:latest # 拉取镜像\ndocker run -p 6379:6379 --name redis-redisbloom redislabs/rebloom:latest #运行容器\ndocker exec -it redis-redisbloom bash\nredis-cli     </code></pre>\n<p><strong>使用</strong></p>\n<p>布隆过滤器基本指令：</p>\n<ul>\n<li>bf.add 添加元素到布隆过滤器</li>\n<li>bf.exists 判断元素是否在布隆过滤器</li>\n<li>bf.madd 添加多个元素到布隆过滤器，bf.add 只能添加一个</li>\n<li>bf.mexists 判断多个元素是否在布隆过滤器</li>\n</ul>\n<pre><code class=\"hljs routeros\">127.0.0.1:6379&gt; bf.<span class=\"hljs-builtin-name\">add</span><span class=\"hljs-built_in\"> user </span>Tom\n(integer) 1\n127.0.0.1:6379&gt; bf.<span class=\"hljs-builtin-name\">add</span><span class=\"hljs-built_in\"> user </span>John\n(integer) 1\n127.0.0.1:6379&gt; bf.exists<span class=\"hljs-built_in\"> user </span>Tom\n(integer) 1\n127.0.0.1:6379&gt; bf.exists<span class=\"hljs-built_in\"> user </span>Linda\n(integer) 0\n127.0.0.1:6379&gt; bf.madd<span class=\"hljs-built_in\"> user </span>Barry Jerry Mars\n1) (integer) 1\n2) (integer) 1\n3) (integer) 1\n127.0.0.1:6379&gt; bf.mexists<span class=\"hljs-built_in\"> user </span>Barry Linda\n1) (integer) 1\n2) (integer) 0</code></pre>\n<p>我们只有这几个参数，肯定不会有误判，当元素逐渐增多时，就会有一定的误判了，这里就不做这个实验了。</p>\n<p>上面使用的布隆过滤器只是默认参数的布隆过滤器，它在我们第一次 add 的时候自动创建。</p>\n<p>Redis 还提供了自定义参数的布隆过滤器，<code>bf.reserve 过滤器名 error_rate initial_size</code></p>\n<ul>\n<li>error_rate：允许布隆过滤器的错误率，这个值越低过滤器的位数组的大小越大，占用空间也就越大</li>\n<li>initial_size：布隆过滤器可以储存的元素个数，当实际存储的元素个数超过这个值之后，过滤器的准确率会下降</li>\n</ul>\n<p>但是这个操作需要在 add 之前显式创建。如果对应的 key 已经存在，bf.reserve 会报错</p>\n<pre><code class=\"hljs angelscript\"><span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">6379</span>&gt; bf.reserve user <span class=\"hljs-number\">0.01</span> <span class=\"hljs-number\">100</span>\n(error) ERR item exists\n<span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span>:<span class=\"hljs-number\">6379</span>&gt; bf.reserve topic <span class=\"hljs-number\">0.01</span> <span class=\"hljs-number\">1000</span>\nOK</code></pre>\n<p>我是一名 Javaer，肯定还要用 Java 来实现的，Java 的 Redis 客户端比较多，有些还没有提供指令扩展机制，笔者已知的 Redisson 和 lettuce 是可以使用布隆过滤器的，我们这里用 <a href=\"https://github.com/redisson/redisson/wiki/6.-\">Redisson</a></p>\n<pre><code class=\"java hljs\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">RedissonBloomFilterDemo</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>{\n\n        Config config = <span class=\"hljs-keyword\">new</span> Config();\n        config.useSingleServer().setAddress(<span class=\"hljs-string\">\"redis://127.0.0.1:6379\"</span>);\n        RedissonClient redisson = Redisson.create(config);\n\n        RBloomFilter&lt;String&gt; bloomFilter = redisson.getBloomFilter(<span class=\"hljs-string\">\"user\"</span>);\n        <span class=\"hljs-comment\">// 初始化布隆过滤器，预计统计元素数量为55000000，期望误差率为0.03</span>\n        bloomFilter.tryInit(<span class=\"hljs-number\">55000000L</span>, <span class=\"hljs-number\">0.03</span>);\n        bloomFilter.add(<span class=\"hljs-string\">\"Tom\"</span>);\n        bloomFilter.add(<span class=\"hljs-string\">\"Jack\"</span>);\n        System.out.println(bloomFilter.count());   <span class=\"hljs-comment\">//2</span>\n        System.out.println(bloomFilter.contains(<span class=\"hljs-string\">\"Tom\"</span>));  <span class=\"hljs-comment\">//true</span>\n        System.out.println(bloomFilter.contains(<span class=\"hljs-string\">\"Linda\"</span>));  <span class=\"hljs-comment\">//false</span>\n    }\n}</code></pre>\n<h2>扩展</h2>\n<p>为了解决布隆过滤器不能删除元素的问题，布谷鸟过滤器横空出世。论文《Cuckoo Filter：Better Than Bloom》作者将布谷鸟过滤器和布隆过滤器进行了深入的对比。相比布谷鸟过滤器而言布隆过滤器有以下不足：查询性能弱、空间利用效率低、不支持反向操作（删除）以及不支持计数。</p>\n<p>由于使用较少，暂不深入。</p>\n<blockquote><p>文章持续更新，可以微信搜「 <strong>JavaKeeper</strong> 」第一时间阅读，无套路领取 500+ 本电子书和 30+ 视频教学和源码，本文 <strong>GitHub</strong> <a href=\"https://github.com/Jstarfish/JavaKeeper\">github.com/JavaKeeper</a> 已经收录，Javaer 开发、面试必备技能兵器谱，有你想要的。</p></blockquote>\n<h2>参考与感谢</h2>\n<p><a href=\"https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf\">https://www.cs.cmu.edu/~dga/papers/cuckoo-conext2014.pdf</a></p>\n<p><a href=\"http://www.justdojava.com/2019/10/22/bloomfilter/\">http://www.justdojava.com/2019/10/22/bloomfilter/</a></p>\n<p><a href=\"https://www.cnblogs.com/cpselvis/p/6265825.html\">https://www.cnblogs.com/cpselvis/p/6265825.html</a></p>\n<p><a href=\"https://juejin.im/post/5cc5aa7ce51d456e431adac5\">https://juejin.im/post/5cc5aa7ce51d456e431adac5</a></p>\n</div>\n            \n            <div>\n                \n            </div>\n\n            \n\n            \n\n            <div class=\"article-share float-right\">\n                <span>分享：</span>\n                <span href=\"javascript:;\" class=\"ico-wechat ico-weixin\">\n                        <div class=\"qrcode-float\">\n                            <img alt=\"\" src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAIAAAC1nk4lAAABvElEQVR42u2ZwQrDQAhE8/8/3R4KJaDztK4GCuZQSrpsZs04jvZ6/eF1LegFvaAX9IJe0As6Bfryru/9+xq7+HPnvtX9i9q5B7R7B06SOQzs3AbaBg8eCfjsDuq1jIB2w2O/25Pkdx4BbWPvxlhBGQetHmahM/sz62fV4/xzSj2Sh1EL3BAmwZ2CdmMMkuyiZ3lpjrQqE0qhLUSO/U9ZWOG0CpgLlAMMValTPTjfLXlCUU+KY12nQ54oBqt3UohxJREVbVTKcna6Z25ORPZAoOIqHVWR6kxEsJcha11pKxCjUlxYK1RZAQs+qB4grmoB0OO8NP4AWrkfPoA6z6zkgVCon4A8kBL9FVFVb+j8uJ2p+buiYYLSkOluWuxe0XuE8sxUhmrVLHkwGGBOg5zzmp5EBG8duj8lLCOcDucb6tkgLFyP+hvbsIVh/YYOd8RPQ0mDIZgSk1lOh30Kjzuu9PXE1BTmGDwYSbJ8ZO4RDsHAijzhp5N9YVjJue8c6RG57IXWJ+x0HgWt8imcrvPgeBB0qLvg+Mq5eMRpZfrC1x3+vzGoHpB8YW9yotb7l9yCXtALekEv6AW9oJ+83n3MxAy5wkjEAAAAAElFTkSuQmCCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA==\">\n                        </div>\n                    </span>\n                <a class=\"ico-weibo\" target=\"_blank\" href=\"http://service.weibo.com/share/share.php?title=%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%EF%BC%8C%E8%BF%99%E4%B8%80%E7%AF%87%E7%BB%99%E4%BD%A0%E8%AE%B2%E7%9A%84%E6%98%8E%E6%98%8E%E7%99%BD%E7%99%BD%E6%B5%85%E8%B0%88%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8&amp;url=https%3A%2F%2Fdeveloper.aliyun.com%2Farticle%2F773205\"></a>\n            </div>\n\n        <div class=\"article-publicity\"> <div class=\"publicity-share\">\n            <div class=\"publicity-title\">推荐关注：</div>\n          </div><div class=\"publicity-article-wrapper\"><a data-spm-click=\"gostr=/developer.publicity.space;locaid=d102020001;psid=query:1&amp;ext=\" class=\"article-slide\" href=\"https://developer.aliyun.com/plan/promotion/1?utm_content=g_1000198932\" key=\"0\" target=\"_blank\"> · 手慢无！云服务器免费领取，实时计算净省3258元</a><a data-spm-click=\"gostr=/developer.publicity.space;locaid=d102020002;psid=216842514002344448&amp;ext=\" class=\"article-slide\" href=\"https://developer.aliyun.com/article/778940?utm_content=g_1000212138\" key=\"1\" target=\"_blank\"> · 开发者冬季装备来了！四步夺宝攻略抢先看</a><a data-spm-click=\"gostr=/developer.publicity.space;locaid=d102020003;psid=query:3&amp;ext=\" class=\"article-slide\" href=\"https://developer.aliyun.com/topic/opensourceday?utm_content=g_1000196451\" key=\"2\" target=\"_blank\"> · 每周二看直播，学最新阿里开源技术</a><a data-spm-click=\"gostr=/developer.publicity.space;locaid=d102020004;psid=query:13&amp;ext=\" class=\"article-slide\" href=\"https://developer.aliyun.com/topic/ffa2020/live?utm_content=g_1000212139\" key=\"3\" target=\"_blank\"> · 错过再等一年！Flink Forward Asia 2020线上进行时</a></div></div><div class=\"article-copyright\">\n                <p class=\"article-copyright-info\">\n                    <b>版权声明：</b><span>本文内容由阿里云实名注册用户自发贡献，版权归原作者所有，阿里云开发者社区不拥有其著作权，亦不承担相应法律责任。具体规则请查看《<a style=\"color:#ff6a00\" href=\"https://developer.aliyun.com/article/768092\">阿里云开发者社区用户服务协议</a>》和《<a style=\"color:#ff6a00\" href=\"https://developer.aliyun.com/article/768093\">阿里云开发者社区知识产权保护指引</a>》。如果您发现本社区中有涉嫌抄袭的内容，填写<a style=\"color:#ff6a00\" href=\"https://yida.alibaba-inc.com/o/right\">侵权投诉表单</a>进行举报，一经查实，本社区将立刻删除涉嫌侵权内容。</span></p>\n            </div><div class=\"article-tags\">\n                    <span class=\"tag-item\"><span>存储</span></span>\n                    <span class=\"tag-item\"><span>缓存</span></span>\n                    <span class=\"tag-item\"><span>NoSQL</span></span>\n                    <span class=\"tag-item\"><span>算法</span></span>\n                    <span class=\"tag-item\"><span>Java</span></span>\n                    <span class=\"tag-item\"><span>Redis</span></span>\n                    <span class=\"tag-item\"><span>数据库</span></span>\n                    <span class=\"tag-item\"><span>对象存储</span></span>\n                    <span class=\"tag-item\"><span>Docker</span></span>\n                    <span class=\"tag-item\"><span>容器</span></span>\n                </div></div>"
  },
  {
  "category": "dataBase",
  "qes": "如何解决Redis并发竞争key的问题",
  "ans":"<div id=\"article_content\" class=\"article_content clearfix\">\n        <link rel=\"stylesheet\" href=\"https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-b5506197d8.css\">\n                <div id=\"content_views\" class=\"htmledit_views\">\n                    <h1><a name=\"t0\"></a><a name=\"t0\"></a><strong>第一种方案：分布式锁</strong></h1> \n<p><strong>1.整体技术方案</strong></p> \n<p>这种情况，主要是准备一个分布式锁，大家去抢锁，抢到锁就做set操作。</p> \n<p><strong>2.为什么是分布式锁</strong></p> \n<p>因为传统的加锁的做法（如java的synchronized和Lock）这里没用，只适合单点。因为这是分布式环境，需要的是分布式锁。</p> \n<p>当然，分布式锁可以基于很多种方式实现，比如zookeeper、redis等，不管哪种方式实现，基本原理是不变的：用一个状态值表示锁，对锁的占用和释放通过状态值来标识。</p> \n<p>&nbsp;</p> \n<p>&nbsp;</p> \n<p><strong>3.分布式锁的要求</strong></p> \n<p>&nbsp;</p> \n<ul><li>&nbsp;互斥性：在任意一个时刻，只有一个客户端持有锁。</li><li>&nbsp;无死锁：即便持有锁的客户端崩溃或者其他意外事件，锁仍然可以被获取。</li><li>&nbsp;容错：只要大部分Redis节点都活着，客户端就可以获取和释放锁</li></ul>\n<p>&nbsp;</p> \n<p><strong>4.分布式锁的实现方式</strong></p> \n<p>&nbsp;</p> \n<ul><li>&nbsp;数据库</li><li>&nbsp;Memcached（add命令）</li><li>&nbsp;Redis（setnx命令）</li><li>&nbsp;Zookeeper（临时节点）</li></ul>\n<p>&nbsp;</p> \n<h1><a name=\"t1\"></a><a name=\"t1\"></a><strong>第二种方案：利用消息队列</strong></h1> \n<p>在并发量过大的情况下,可以通过消息中间件进行处理,把并行读写进行串行化。</p> \n<p>把Redis.set操作放在队列中使其串行化,必须的一个一个执行。</p> \n<p>这种方式在一些高并发的场景中算是一种通用的解决方案。</p>\n                </div><div><div></div></div>\n        </div>"
  },
  {
    "category": "dataBase",
    "qes": "如何保证缓存与数据库的双写一致性",
    "ans":"<article class=\"markdown-body entry-content container-lg\" itemprop=\"text\"><h2><a id=\"user-content-面试题\" class=\"anchor\" aria-hidden=\"true\" href=\"#面试题\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>面试题</h2>\n<p>如何保证缓存与数据库的双写一致性？</p>\n<h2><a id=\"user-content-面试官心理分析\" class=\"anchor\" aria-hidden=\"true\" href=\"#面试官心理分析\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>面试官心理分析</h2>\n<p>你只要用缓存，就可能会涉及到缓存与数据库双存储双写，你只要是双写，就一定会有数据一致性的问题，那么你如何解决一致性问题？</p>\n<h2><a id=\"user-content-面试题剖析\" class=\"anchor\" aria-hidden=\"true\" href=\"#面试题剖析\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>面试题剖析</h2>\n<p>一般来说，如果允许缓存可以稍微的跟数据库偶尔有不一致的情况，也就是说如果你的系统<strong>不是严格要求</strong> “缓存+数据库” 必须保持一致性的话，最好不要做这个方案，即：<strong>读请求和写请求串行化</strong>，串到一个<strong>内存队列</strong>里去。</p>\n<p>串行化可以保证一定不会出现不一致的情况，但是它也会导致系统的吞吐量大幅度降低，用比正常情况下多几倍的机器去支撑线上的一个请求。</p>\n<h3><a id=\"user-content-cache-aside-pattern\" class=\"anchor\" aria-hidden=\"true\" href=\"#cache-aside-pattern\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>Cache Aside Pattern</h3>\n<p>最经典的缓存+数据库读写的模式，就是 Cache Aside Pattern。</p>\n<ul>\n<li>读的时候，先读缓存，缓存没有的话，就读数据库，然后取出数据后放入缓存，同时返回响应。</li>\n<li>更新的时候，<strong>先更新数据库，然后再删除缓存</strong>。</li>\n</ul>\n<p><strong>为什么是删除缓存，而不是更新缓存？</strong></p>\n<p>原因很简单，很多时候，在复杂点的缓存场景，缓存不单单是数据库中直接取出来的值。</p>\n<p>比如可能更新了某个表的一个字段，然后其对应的缓存，是需要查询另外两个表的数据并进行运算，才能计算出缓存最新的值的。</p>\n<p>另外更新缓存的代价有时候是很高的。是不是说，每次修改数据库的时候，都一定要将其对应的缓存更新一份？也许有的场景是这样，但是对于<strong>比较复杂的缓存数据计算的场景</strong>，就不是这样了。如果你频繁修改一个缓存涉及的多个表，缓存也频繁更新。但是问题在于，<strong>这个缓存到底会不会被频繁访问到？</strong></p>\n<p>举个栗子，一个缓存涉及的表的字段，在 1 分钟内就修改了 20 次，或者是 100 次，那么缓存更新 20 次、100 次；但是这个缓存在 1 分钟内只被读取了 1 次，有<strong>大量的冷数据</strong>。实际上，如果你只是删除缓存的话，那么在 1 分钟内，这个缓存不过就重新计算一次而已，开销大幅度降低。<strong>用到缓存才去算缓存。</strong></p>\n<p>其实删除缓存，而不是更新缓存，就是一个 lazy 计算的思想，不要每次都重新做复杂的计算，不管它会不会用到，而是让它到需要被使用的时候再重新计算。像 mybatis，hibernate，都有懒加载思想。查询一个部门，部门带了一个员工的 list，没有必要说每次查询部门，都把里面的 1000 个员工的数据也同时查出来啊。80% 的情况，查这个部门，就只是要访问这个部门的信息就可以了。先查部门，同时要访问里面的员工，那么这个时候只有在你要访问里面的员工的时候，才会去数据库里面查询 1000 个员工。</p>\n<h3><a id=\"user-content-最初级的缓存不一致问题及解决方案\" class=\"anchor\" aria-hidden=\"true\" href=\"#最初级的缓存不一致问题及解决方案\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>最初级的缓存不一致问题及解决方案</h3>\n<p>问题：先更新数据库，再删除缓存。如果删除缓存失败了，那么会导致数据库中是新数据，缓存中是旧数据，数据就出现了不一致。</p>\n<p><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"/doocs/advanced-java/blob/main/docs/high-concurrency/images/redis-junior-inconsistent.png\"><img src=\"/doocs/advanced-java/raw/main/docs/high-concurrency/images/redis-junior-inconsistent.png\" alt=\"redis-junior-inconsistent\" style=\"max-width:100%;\"></a></p>\n<p>解决思路：先删除缓存，再更新数据库。如果数据库更新失败了，那么数据库中是旧数据，缓存中是空的，那么数据不会不一致。因为读的时候缓存没有，所以去读了数据库中的旧数据，然后更新到缓存中。</p>\n<h3><a id=\"user-content-比较复杂的数据不一致问题分析\" class=\"anchor\" aria-hidden=\"true\" href=\"#比较复杂的数据不一致问题分析\"><svg class=\"octicon octicon-link\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.775 3.275a.75.75 0 001.06 1.06l1.25-1.25a2 2 0 112.83 2.83l-2.5 2.5a2 2 0 01-2.83 0 .75.75 0 00-1.06 1.06 3.5 3.5 0 004.95 0l2.5-2.5a3.5 3.5 0 00-4.95-4.95l-1.25 1.25zm-4.69 9.64a2 2 0 010-2.83l2.5-2.5a2 2 0 012.83 0 .75.75 0 001.06-1.06 3.5 3.5 0 00-4.95 0l-2.5 2.5a3.5 3.5 0 004.95 4.95l1.25-1.25a.75.75 0 00-1.06-1.06l-1.25 1.25a2 2 0 01-2.83 0z\"></path></svg></a>比较复杂的数据不一致问题分析</h3>\n<p>数据发生了变更，先删除了缓存，然后要去修改数据库，此时还没修改。一个请求过来，去读缓存，发现缓存空了，去查询数据库，<strong>查到了修改前的旧数据</strong>，放到了缓存中。随后数据变更的程序完成了数据库的修改。完了，数据库和缓存中的数据不一样了...</p>\n<p><strong>为什么上亿流量高并发场景下，缓存会出现这个问题？</strong></p>\n<p>只有在对一个数据在并发的进行读写的时候，才可能会出现这种问题。其实如果说你的并发量很低的话，特别是读并发很低，每天访问量就 1 万次，那么很少的情况下，会出现刚才描述的那种不一致的场景。但是问题是，如果每天的是上亿的流量，每秒并发读是几万，每秒只要有数据更新的请求，就<strong>可能会出现上述的数据库+缓存不一致的情况</strong>。</p>\n<p><strong>解决方案如下：</strong></p>\n<p>更新数据的时候，根据<strong>数据的唯一标识</strong>，将操作路由之后，发送到一个 jvm 内部队列中。读取数据的时候，如果发现数据不在缓存中，那么将重新执行“读取数据+更新缓存”的操作，根据唯一标识路由之后，也发送到同一个 jvm 内部队列中。</p>\n<p>一个队列对应一个工作线程，每个工作线程<strong>串行</strong>拿到对应的操作，然后一条一条的执行。这样的话，一个数据变更的操作，先删除缓存，然后再去更新数据库，但是还没完成更新。此时如果一个读请求过来，没有读到缓存，那么可以先将缓存更新的请求发送到队列中，此时会在队列中积压，然后同步等待缓存更新完成。</p>\n<p>这里有一个<strong>优化点</strong>，一个队列中，其实<strong>多个更新缓存请求串在一起是没意义的</strong>，因此可以做过滤，如果发现队列中已经有一个更新缓存的请求了，那么就不用再放个更新请求操作进去了，直接等待前面的更新操作请求完成即可。</p>\n<p>待那个队列对应的工作线程完成了上一个操作的数据库的修改之后，才会去执行下一个操作，也就是缓存更新的操作，此时会从数据库中读取最新的值，然后写入缓存中。</p>\n<p>如果请求还在等待时间范围内，不断轮询发现可以取到值了，那么就直接返回；如果请求等待的时间超过一定时长，那么这一次直接从数据库中读取当前的旧值。</p>\n<p>高并发的场景下，该解决方案要注意的问题：</p>\n<ul>\n<li>读请求长时阻塞</li>\n</ul>\n<p>由于读请求进行了非常轻度的异步化，所以一定要注意读超时的问题，每个读请求必须在超时时间范围内返回。</p>\n<p>该解决方案，最大的风险点在于说，<strong>可能数据更新很频繁</strong>，导致队列中积压了大量更新操作在里面，然后<strong>读请求会发生大量的超时</strong>，最后导致大量的请求直接走数据库。务必通过一些模拟真实的测试，看看更新数据的频率是怎样的。</p>\n<p>另外一点，因为一个队列中，可能会积压针对多个数据项的更新操作，因此需要根据自己的业务情况进行测试，可能需要<strong>部署多个服务</strong>，每个服务分摊一些数据的更新操作。如果一个内存队列里居然会挤压 100 个商品的库存修改操作，每个库存修改操作要耗费 10ms 去完成，那么最后一个商品的读请求，可能等待 10 * 100 = 1000ms = 1s 后，才能得到数据，这个时候就导致<strong>读请求的长时阻塞</strong>。</p>\n<p>一定要做根据实际业务系统的运行情况，去进行一些压力测试，和模拟线上环境，去看看最繁忙的时候，内存队列可能会挤压多少更新操作，可能会导致最后一个更新操作对应的读请求，会 hang 多少时间，如果读请求在 200ms 返回，如果你计算过后，哪怕是最繁忙的时候，积压 10 个更新操作，最多等待 200ms，那还可以的。</p>\n<p><strong>如果一个内存队列中可能积压的更新操作特别多</strong>，那么你就要<strong>加机器</strong>，让每个机器上部署的服务实例处理更少的数据，那么每个内存队列中积压的更新操作就会越少。</p>\n<p>其实根据之前的项目经验，一般来说，数据的写频率是很低的，因此实际上正常来说，在队列中积压的更新操作应该是很少的。像这种针对读高并发、读缓存架构的项目，一般来说写请求是非常少的，每秒的 QPS 能到几百就不错了。</p>\n<p>我们来<strong>实际粗略测算一下</strong>。</p>\n<p>如果一秒有 500 的写操作，如果分成 5 个时间片，每 200ms 就 100 个写操作，放到 20 个内存队列中，每个内存队列，可能就积压 5 个写操作。每个写操作性能测试后，一般是在 20ms 左右就完成，那么针对每个内存队列的数据的读请求，也就最多 hang 一会儿，200ms 以内肯定能返回了。</p>\n<p>经过刚才简单的测算，我们知道，单机支撑的写 QPS 在几百是没问题的，如果写 QPS 扩大了 10 倍，那么就扩容机器，扩容 10 倍的机器，每个机器 20 个队列。</p>\n<ul>\n<li>读请求并发量过高</li>\n</ul>\n<p>这里还必须做好压力测试，确保恰巧碰上上述情况的时候，还有一个风险，就是突然间大量读请求会在几十毫秒的延时 hang 在服务上，看服务能不能扛的住，需要多少机器才能扛住最大的极限情况的峰值。</p>\n<p>但是因为并不是所有的数据都在同一时间更新，缓存也不会同一时间失效，所以每次可能也就是少数数据的缓存失效了，然后那些数据对应的读请求过来，并发量应该也不会特别大。</p>\n<ul>\n<li>多服务实例部署的请求路由</li>\n</ul>\n<p>可能这个服务部署了多个实例，那么必须<strong>保证</strong>说，执行数据更新操作，以及执行缓存更新操作的请求，都通过 Nginx 服务器<strong>路由到相同的服务实例上</strong>。</p>\n<p>比如说，对同一个商品的读写请求，全部路由到同一台机器上。可以自己去做服务间的按照某个请求参数的 hash 路由，也可以用 Nginx 的 hash 路由功能等等。</p>\n<ul>\n<li>热点商品的路由问题，导致请求的倾斜</li>\n</ul>\n<p>万一某个商品的读写请求特别高，全部打到相同的机器的相同的队列里面去了，可能会造成某台机器的压力过大。就是说，因为只有在商品数据更新的时候才会清空缓存，然后才会导致读写并发，所以其实要根据业务系统去看，如果更新频率不是太高的话，这个问题的影响并不是特别大，但是的确可能某些机器的负载会高一些。</p>\n<hr>\n<p>关于这道面试题的详细讨论，见 <a href=\"https://github.com/doocs/advanced-java/issues/54\">#54</a>。</p>\n</article>"
  },
  {
    "category": "dataBase",
    "qes": "",
    "ans":""
  },
  {
    "category": "dataBase",
    "qes": "",
    "ans":""
  },
  {
    "category": "dataBase",
    "qes": "",
    "ans":""
  }
]